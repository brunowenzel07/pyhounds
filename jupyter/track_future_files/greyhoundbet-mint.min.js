(webApp=webApp||{}).SimplePriceListener=function(e){var t=e||{},r=t.price||function(){},i=t.eachWay||function(){},s=t.bestOdds||function(){},n=webApp.userSettings.get("odds");this.onUpdate=function(e){-1===$.inArray("EACH_WAY",e.topic)?-1===$.inArray("INFO",e.topic)?this._processPriceData(e):this._processBestOddsData(e):this._processEachWayData(e)},this._processPriceData=function(e){var t=new rp.HorseBetInfo(e,n);r(t)},this._processEachWayData=function(e){var t=new rp.models.EachWay(e);i(t)},this._processBestOddsData=function(e){s(e)}},(webApp=webApp||{}).SimpleRaceListener=function(e){this.controller=e,this.onUpdate=function(e){this.update(e)},this.update=function(e){this.controller.acceptRaceInfo(e)}},(webApp=webApp||{}).PriceHistoryListener=function(e){this.controller=e,this.onUpdate=function(e){this.update(e)},this.update=function(e){-1===$.inArray("EACH_WAY",e.topic)?-1===$.inArray("INFO",e.topic)?this.controller.acceptPriceHistory(e):this.controller.setBOG(e):this.controller.setEachWay(new rp.models.EachWay(e))}},(webApp=webApp||{}).HorseInfoListener=function(n){var a={"non-runner":function(e,t){return"N"===t[1]},reserved:function(e,t){return-1<t[0].toLowerCase().indexOf("reserve")},runner:function(e,t){var r=a.reserved(e,t),i=a["non-runner"](e,t);return!(r||i)}};this.onUpdate=function(e){this.update(e)},this.update=function(e){var t,r,i=e.data||[],s=e.topic;if($.isArray(i)&&i[0])for(r in a)t=a[r],n[r]&&t(s,i)&&n[r](s[6],s,i)}},diffusion.listeners.Abstract=joop.createClass({TOPIC_PART_COMPETITION:"competitionTopicID",TOPIC_PART_EVENT:"eventTopicID",TOPIC_PART_DATE:"dateTopicID",TOPIC_PART_BOOKIE:"bookmakerTopicID",TOPIC_PART_OUTCOME:"outcomeTopicID",TOPIC_PART_SPORT:"sportTopicID",TOPIC_PART_MARKET:"marketTopicID",TOPIC_PART_ORDER_SPORT:1,TOPIC_PART_ORDER_MARKET:5,TOPIC_PART_ORDER_COMPETITON:3,TOPIC_PART_ORDER_EVENT:4,TOPIC_PART_ORDER_DATE:2,TOPIC_PART_ORDER_BOOKIE:7,TOPIC_PART_ORDER_OUTCOME:6,_prepareDataAndCallListener:function(e){var t=this._convert(e);this.update(t.data,t.delta,t.isItl)},_array_combine:function(e,t,r){var i={};"object"==typeof r&&(i=r);for(var s=0;s<t.length;s++)null!=t[s]&&s in e&&(i[e[s]]=t[s]);return i}}),diffusion.listeners.AbstractMonothread=joop.createClass({extend:diffusion.listeners.Abstract,onUpdate:function(e){this._prepareDataAndCallListener(e)}}),diffusion.listeners.AbstractMultithread=joop.createClass({extend:diffusion.listeners.Abstract,construct:function(){},onUpdate:function(e){var t=this;setTimeout(function(){t._prepareDataAndCallListener(e)},1)}}),namespace("diffusion.listeners"),diffusion.listeners.price=function(e){$.extend(this,{prefix:"",prefixEachWay:"",templates:{},callbacks:{},useBookmaker:0,preferredFilter:0,pageRef:"",ACTION_CLEAR:1,ACTION_UPDATE:2},e),this.mainBookmaker=e.bookmaker||"",this.storage={}},function(){this.processData=function(e,t){var r;if(-1!==$.inArray("EACH_WAY",e.topic))r=new diffusion.types.EachWay;else if(-1!==$.inArray("INFO",e.topic))r=new diffusion.types.Info;else if(-1!==$.inArray("PRC_HIST",e.topic))r=new diffusion.types.PriceHistory;else{if(-1===$.inArray("PRC",e.topic))return!1;r=new diffusion.types.Price}var i={preferredFilter:this.preferredFilter,useBookmaker:this.useBookmaker,prefix:this.prefix,prefixEachWay:this.prefixEachWay,templates:this.templates,callbacks:this.callbacks,data:e,storage:this.storage,pageRef:this.pageRef,mainBookmaker:this.mainBookmaker};return r.init(i)&&(r.preProcess(this),t==this.ACTION_UPDATE?(this.addToStorage(r.getStorageData()),r.draw()):t==this.ACTION_CLEAR&&r.clear(),r.proceed(),r.postProcess(this)),!0},this.onClear=function(e){return this.processData(e,this.ACTION_CLEAR)},this.onUpdate=function(e){return this.processData(e,this.ACTION_UPDATE)},this.addToStorage=function(e){$.extend(!0,this.storage,e)},this.clearStorage=function(e){},this.setBookmaker=function(e){this.mainBookmaker=e},this.resetBookmaker=function(){this.mainBookmaker=""}}.call(diffusion.listeners.price.prototype),(webApp=webApp||{}).configs={defaultHash:"#meeting-list",controllerNamespaces:["greyhoundbet","webApp","footballbet"],templates:{level:"view-level","page-preloader":"view-page-preloader","block-preloader":"view-block-preloader",page:"view-page",ad:"adCms"},holders:{header:"#pageHeader"},tree:{meeting:{homeUrl:"#meeting-list",controllers:["meeting-list","meeting-races","trap-draws-races","card","predictor","dog","form-explained","video","advanced-video","card-meeting-result","card-dog","card-video","search"],rememberLastVisited:!0,allowOverrideHomeUrl:!1},results:{homeUrl:"#results-list",controllers:["results-list","result-meeting","result-meeting-result","results-latest","results-dog","results-form-explained","result-video"],rememberLastVisited:!0,allowOverrideHomeUrl:!1},news:{homeUrl:"#news-home",controllers:["news-home","news-story"]},betslip:{rememberLastVisited:!1,allowOverrideHomeUrl:!1,homeUrl:"#bet-slip",controllers:["bet-slip","bets-explained","generic-error","market-suspend-error","price-changed-error","receipt","generic-error","market-suspend-error","price-changed-error","wh-gambling-details","ladb-gambling-details"]},account:{homeUrl:"#account-home",allowOverrideHomeUrl:!1,controllers:["account-home","account-customise","account-form-lines","account-sort-by","account-odds","bet-slip","mult-bets-explained","wh-home","wh-account-home","wh-terms","wh-register","wh-help-info","wh-forgotten-password","wh-free-bets-offer","wh-open-bets","wh-withdraw","wh-top-up","wh-bet-detail","connectivity-check","ladb-home","ladb-open-bets","ladb-account-home","ladb-withdraw","ladb-top-up"]},search:{controllers:["search-dog","search-form-explained"]},errors:{controllers:["error404"]}},controllers:{search:{cacheLifetime:0,blocks:{header:{level:1,template:"search-header"},search:{level:2,template:"search-results",cacheBy:["page","search_text"],noCache:!0}}},"search-dog":{cacheLifetime:0,blocks:{"search-dog-header":{level:1,template:"search-dog-header"},"search-dog-details":{level:2,template:"search-dog-details",cacheBy:["dog_id"],noCache:!0}}},"search-form-explained":{cacheLifetime:0,blocks:{header:{template:"form-explained-head",level:1},main:{template:"form-explained",level:2}}},error404:{secondLinks:{cards:{referers:["card","dog","predictor"],text:"Today's cards",controller:"card"},meeting:{referers:["meeting-races","trap-draws-races"],text:"Today's cards",controller:"meeting-list"},news:{referers:["news-home","news-story"],text:"News",controller:"news-home"},results:{referers:["results-list"],text:"Return to Results menu",hideMainSiteLink:!0,controller:"results-list"}},cacheLifetime:0,blocks:{header:{template:"search-header",level:1},main:{template:"error-404",level:2}}},"account-home":{cacheLifetime:0,blocks:{header:{level:1,template:"account-header"},main:{template:"account-home-main",level:2,beforeRender:"addDataToView",afterRender:"afterMainRender"}}},"account-sort-by":{cacheLifetime:0,blocks:{header:{level:1,template:"account-sort-by-header"},main:{template:"account-sort-by",level:2}}},"account-odds":{cacheLifetime:0,blocks:{header:{level:1,template:"account-odds-header"},main:{template:"account-odds",level:2}}},"wh-home":{cacheLifetime:0,blocks:{header:{level:1,template:"wh-home-header"},main:{template:"wh-home-main",level:2}}},"wh-account-home":{cacheLifetime:0,blocks:{"main-header":{template:"user-page-header",level:1},main:{template:"user-page",level:2}}},"bet-slip":{cacheLifetime:0,blocks:{main:{template:"wh-betslip-main",level:2}},hideMainTabs:!0,defaultScroll:!0},"bets-explained":{blocks:{header:{template:"bets-explained-header",level:1},main:{template:"bets-explained-main",level:2}},hideMainTabs:!0},"wh-terms":{cacheLifetime:0,blocks:{header:{level:1,template:"wh-terms-header"},main:{template:"wh-terms-main",level:2}}},"wh-register":{cacheLifetime:0,blocks:{header:{level:1,template:"wh-register-header"},registration:{template:"wh-register-main",level:2}}},receipt:{cacheLifetime:0,blocks:{main:{template:"wh-receipt",level:1}},hideMainTabs:!0,hideMainTabsMobile:!0,defaultScroll:!0},"wh-help-info":{cacheLifetime:0,blocks:{header:{level:1,template:"wh-help-info-header"},main:{template:"wh-help-info-main",level:2}}},"wh-forgotten-password":{cacheLifetime:0,blocks:{header:{level:1,template:"wh-forgotten-password-header"},main:{template:"wh-forgotten-password-main",level:2}}},"wh-withdraw":{cacheLifetime:0,blocks:{header:{level:1,template:"wh-withdraw-header"},main:{template:"wh-withdraw-main",level:2}}},"market-suspend-error":{cacheLifetime:0,blocks:{main:{template:"wh-market-suspend-error",level:1,afterRender:"mainAfterRender",beforeRender:"mainBeforeRender"}},hideMainTabs:!0,defaultScroll:!0},"price-changed-error":{cacheLifetime:0,blocks:{main:{template:"wh-price-changed-error",level:1,afterRender:"mainAfterRender",beforeRender:"mainBeforeRender"}},hideMainTabs:!0,defaultScroll:!0},"generic-error":{cacheLifetime:0,blocks:{main:{template:"wh-generic-error",level:1}},hideMainTabs:!0},"wh-open-bets":{cacheLifetime:0,blocks:{header:{template:"wh-open-bets-header",level:1},main:{template:"wh-open-bets",level:2,afterRender:"mainAfterRender",beforeRender:"mainBeforeRender"}}},"wh-top-up":{cacheLifetime:0,blocks:{header:{level:1,template:"wh-header-top-up"},main:{template:"wh-top-up-main",level:2}}},"wh-bet-detail":{cacheLifetime:0,blocks:{main:{template:"wh-bet-detail",level:1}}},"wh-free-bets-offer":{cacheLifetime:0,blocks:{header:{level:1,template:"wh-free-bets-offer-header"},main:{template:"wh-free-bets-offer",level:2}}},"meeting-list":{cacheLifetime:0,blocks:{header:{level:1,template:"meetings-header",renderCacheBy:["r_date"],cacheLifetime:0},list:{level:2,template:"meeting-list-by-meeting",cacheBy:["view","r_date"],cacheLifetime:0},"empty-list":{level:2,template:"meeting-list-empty",cacheBy:["r_date"],cacheLifetime:0}}},"trap-draws-races":{cacheLifetime:0,blocks:{"trap-draws-header":{level:1,template:"trap-draws-header"},"trap-draws-races":{level:2,template:"trap-draws-races-list",cacheBy:["r_date","track_id"],cacheLifetime:0}}},"meeting-races":{cacheLifetime:0,blocks:{header:{level:1,template:"meeting-races-header",cacheBy:["track_id","r_date"]},tips:{level:2,cacheBy:["race_id"]},list:{level:2,template:"meeting-races",cacheBy:["track_id","r_time","r_date"],cacheLifetime:0}}},card:{cacheLifetime:0,blocks:{"next-race":{level:1,cacheLifetime:0},"card-header":{level:1,template:"card-header",cacheBy:["r_date"]},"card-pager":{level:2,template:"card-pager"},"card-tabs":{level:3,template:"card-tabs"},"card-title":{level:4,template:"card-title",cacheBy:["race_id"]},card:{level:5,template:"tab-card",cacheBy:["race_id","r_date"]},form:{level:5,template:"tab-form",cacheBy:["race_id"]},stats:{level:5,template:"tab-stats",cacheBy:["race_id"]},tips:{level:5,template:"tab-tips",cacheBy:["race_id"]}}},predictor:{cacheLifetime:0,blocks:{simulator:{level:1,template:"predictor",cacheBy:["race_id"]}},hideMainTabs:!0,hideMainTabsMobile:!0},dog:{cacheLifetime:0,blocks:{header:{template:"greyhound-info-header",level:1,cacheBy:["r_date","race_id"]},details:{template:"greyhound-info",level:2,cacheBy:["dog_id"]}}},"form-explained":{cacheLifetime:0,blocks:{header:{template:"form-explained-head",level:1},main:{template:"form-explained",level:2}}},"results-form-explained":{cacheLifetime:0,blocks:{header:{template:"form-explained-head",level:1},main:{template:"form-explained",level:2}}},"results-list":{cacheLifetime:0,blocks:{header:{level:1,template:"results-meetings-header"},meetings:{level:2,template:"results-meetings-list",cacheBy:["r_date"],cacheLifetime:0}}},"result-meeting":{cacheLifetime:0,blocks:{header:{level:1,template:"results-meeting-header"},list:{level:2,template:"results-meeting-list",cacheBy:["track_id","r_date","r_time"],cacheLifetime:0}}},"card-meeting-result":{cacheLifetime:0,blocks:{meetingHeader:{level:1,cacheBy:["r_date"],template:"results-meeting-header"},"results-meeting-pager":{level:2,cacheBy:["r_date"],template:"results-meeting-pager",afterRender:"initResultPager"},list:{level:3,template:"results-meeting-result",cacheBy:["race_id","track_id","r_date"],cacheLifetime:0}}},"result-meeting-result":{cacheLifetime:0,blocks:{meetingHeader:{level:1,cacheBy:["r_date"],template:"results-meeting-header"},"results-meeting-pager":{level:2,cacheBy:["r_date"],template:"results-meeting-pager",afterRender:"initResultPager"},list:{level:3,template:"results-meeting-result",cacheBy:["race_id","track_id","r_date"],cacheLifetime:0}}},"results-latest":{cacheLifetime:0,blocks:{latestHeader:{level:1,cacheBy:["r_date"],template:"results-meeting-header"},latestList:{level:2,template:"results-latest-list",cacheLifetime:0}}},"results-dog":{cacheLifetime:0,blocks:{"results-dog-header":{template:"results-dog-header",level:1,cacheBy:["race_id"],beforeRender:"saveDogData",afterRender:"bindHeaderEvents"},"results-dog-details":{level:2,template:"results-dog-details",cacheBy:["dog_id"]}}},"card-dog":{cacheLifetime:0,blocks:{"results-dog-header":{template:"results-dog-header",level:1,cacheBy:["race_id"],beforeRender:"saveDogData",afterRender:"bindHeaderEvents"},"results-dog-details":{level:2,template:"results-dog-details",cacheBy:["dog_id"]}}},"result-video":{cacheLifetime:0,blocks:{header:{template:"archive-header",level:1},"player-data":{template:"archive-player",cacheBy:["video_id","r_date"],level:2},list:{level:3,template:"archive-details",cacheBy:["race_id","track_id","r_date"],cacheLifetime:0}}},"card-video":{cacheLifetime:0,blocks:{header:{template:"archive-header",level:1},"player-data":{template:"archive-player",cacheBy:["video_id","r_date"],level:2},list:{level:3,template:"archive-details",cacheBy:["race_id","track_id","r_date"],cacheLifetime:0}}},"news-home":{cacheLifetime:0,blocks:{"news-header":{level:1,template:"news-home-header",afterRender:"bindRefresh"},"news-list":{level:2,template:"news-home-list",cacheId:"news-list"}}},"news-story":{cacheLifetime:0,blocks:{"top-nav":{template:"news-story-header",level:1,cacheId:"news-list"},content:{template:"news-story-content",level:2,cacheBy:["story_id"]}}},video:{cacheLifetime:0,blocks:{header:{template:"video-header",level:1},"video-urls":{template:"video-player",level:2,cacheBy:["race_id"],cacheLifetime:0}}},"advanced-video":{cacheLifetime:0,blocks:{header:{template:"video-header",level:1},"video-urls":{template:"advanced-video-player",level:2,cacheBy:["race_id"],cacheLifetime:0},content:{template:"video-details",level:3,cacheLifetime:0}}},"connectivity-check":{cacheLifetime:0,blocks:{header:{template:"connectivity-check-header",level:1},main:{template:"connectivity-check",level:2}}},"ladb-home":{cacheLifetime:0,blocks:{header:{template:"ladb-home-header",level:1},"ladb-home":{template:"ladb-home",level:2}},defaultScroll:"frame"},"ladb-account-home":{cacheLifetime:0,blocks:{"main-header":{template:"user-page-header",level:1},main:{template:"user-page",level:2}}},"ladb-top-up":{cacheLifetime:0,blocks:{main:{template:"ladb-top-up",level:1}},defaultScroll:"frame"},"ladb-withdraw":{cacheLifetime:0,blocks:{header:{template:"ladb-withdraw-header",level:1},main:{template:"ladb-withdraw",level:2}}},"ladb-open-bets":{cacheLifetime:0,blocks:{header:{template:"ladb-open-bets-header",level:1},main:{template:"ladb-open-bets",level:2}}},"wh-gambling-details":{cacheLifetime:0,blocks:{header:{template:"gambling-details-header",level:1},main:{template:"wh-gambling-details",level:2}}},"ladb-gambling-details":{cacheLifetime:0,blocks:{header:{template:"gambling-details-header",level:1},main:{template:"ladb-gambling-details",level:2}}}}};var webApp=webApp||{};(greyhoundbet=greyhoundbet||{}).URL_MEETING="/meeting/blocks.sd",greyhoundbet.URL_CARD="/card/blocks.sd",greyhoundbet.URL_NEWS="/news/blocks.sd",greyhoundbet.URL_DOG="/dog/blocks.sd",greyhoundbet.URL_MEETING="/meeting/blocks.sd",greyhoundbet.URL_RESULTS="/results/blocks.sd",greyhoundbet.URL_CARD="/card/blocks.sd",greyhoundbet.URL_NEWS="/news/blocks.sd",greyhoundbet.URL_VIDEO="/video/blocks.sd",webApp.URL_SELF_CHECK="/maintenance/check_server.sd",greyhoundbet.URL_SEARCH="/search/blocks.sd",webApp.routes={"meeting-list":greyhoundbet.URL_MEETING,"meeting-races":greyhoundbet.URL_MEETING,"trap-draws-races":greyhoundbet.URL_MEETING,meeting:greyhoundbet.URL_MEETING,card:greyhoundbet.URL_CARD,predictor:greyhoundbet.URL_CARD,dog:greyhoundbet.URL_DOG,"results-list":greyhoundbet.URL_RESULTS,"results-latest":greyhoundbet.URL_RESULTS,"result-meeting":greyhoundbet.URL_RESULTS,"result-meeting-result":greyhoundbet.URL_RESULTS,"result-video":greyhoundbet.URL_RESULTS,"news-home":greyhoundbet.URL_NEWS,video:greyhoundbet.URL_VIDEO,"advanced-video":greyhoundbet.URL_VIDEO,"news-story":greyhoundbet.URL_NEWS,"results-dog":greyhoundbet.URL_RESULTS,"connectivity-check":greyhoundbet.URL_SELF_CHECK,search:greyhoundbet.URL_SEARCH,"search-dog":greyhoundbet.URL_SEARCH,"card-meeting-result":greyhoundbet.URL_RESULTS,"card-dog":greyhoundbet.URL_RESULTS,"card-video":greyhoundbet.URL_RESULTS};var rp,greyhoundbet=greyhoundbet||{};(webApp=webApp||{}).EVENT_VIEW_RENDER_TPL="view.renderTpl",webApp.EVENT_CHANGE_ORIENTATION="changeorientaion",webApp.EVENT_CHANGE_HASH="changehash",webApp.EVENT_CHANGE_CONTROLLER="changecontroller",webApp.EVENT_BETSLIP_EMPTIED="betslipemptied",webApp.PREFERRED_BOOKMAKER="PREFERRED_BOOKMAKER",webApp.LIVEEVENTS_PER_PAGE=8,webApp.NEWS_LIVE_VIEW_ID=4,webApp.RACEDAY_LIVE_VIEW_ID=1,greyhoundbet.VIEW_FORMAT_RACE="hh:mn",(webApp=webApp||{}).gaEvents={main_menu_news:["Main Menu","News"],main_menu_account:["Main Menu","Accounts"],main_menu_cards:["Main Menu","Cards"],main_menu_results:["Main Menu","Results"],side_menu_cards_today:["Main Menu","Cards","Today"],side_menu_cards_future:["Main Menu","Cards","Future"],side_menu_cards_trap_draws:["Main Menu","Cards","Trap Draws"],side_menu_cards_rpgtv:["Main Menu","Cards","RPGTV"],side_menu_results_today:["Main Menu","Results","Today"],side_menu_results_archive:["Main Menu","Results","Archive"],cards_by_time:["Cards","Order By Time"],cards_by_meetings:["Cards","Order By Meetings"],cards_next_race:["Cards","Next Race Off"],cards_meetings_click:["Cards","Meetings Click"],cards_next_time:["Cards","Next Card Time"],cards_prev_time:["Cards","Previous Card Time"],cards_card:["Cards","Card"],cards_tab_card:["Cards","Tab Card"],cards_tab_form:["Cards","Tab Form"],cards_tab_stats:["Cards","Tab Stats"],cards_tab_tips:["Cards","Tab Tips"],cards_title_toggle:["Cards","Card Title Toggle"],cards_more_button:["Cards","More Detail Button"],cards_runner:["Cards","Lifetime Form"],cards_prev_runner:["Cards","Previous Card Runner"],cards_next_runner:["Cards","Next Card Runner"],cards_predictor:["Cards","Predictor"],cards_back_to_card:["Cards","Back to Card"],predictor_back:["Cards","Back to Card"],cards_back_to_list:["Cards","Back to Cards List"],cards_back:["Cards","Back"],cards_form_explained:["Cards","Form Explained Button"],cards_stats_swipe:["Cards","Stats Swipe"],results_latest:["Results","Latest Results"],results_meetings_click:["Results","Meetings Click"],results_date_select:["Results","Results Date Selection"],results_refresh:["Results","Results Refresh"],results_race_result:["Results","Race Result"],results_next_time:["Results","Next Result Time"],results_prev_time:["Results","Previous Result Time"],results_title_toggle:["Results","Result Title Toggle"],results_lifetime_form:["Results","Lifetime Form"],results_next_runner:["Results","Next Result Runner"],results_prev_runner:["Results","Previous Result Runner"],results_back_to_list:["Results","Back to Results Home"],results_back_to_result:["Results","Back to Result"],news_refresh:["News","Refresh"],news_story:["News","Story"],news_back_to_all:["News","Back to All News"],news_previous_story:["News","Previous Story"],news_next_story:["News","Next Story"],news_email_story:["News","Email Story"],news_post_on_facebook:["News","Post Story on Facebook"],news_post_on_twitter:["News","Post Story to Twitter"],account_wh_logined:["Accounts","Log in to William Hill"],account_wh_terms:["Accounts","Bookmaker Terms & Conditions"],account_wh_phone:["Accounts","Call Phone"],account_wh_site:["Accounts","Visit Website"],account_back:["Accounts","Back To Account"],account_ladb_terms:["Accounts","Bookmaker Terms & Conditions"],account_ladb_site:["Accounts","Visit Website"],account_ladb_phone:["Accounts","Call Phone"],account_login:["Accounts","Log in"],account_logout:["Accounts","Log out"],account_save_name:["Accounts","Save Username"],account_save_pass:["Accounts","Save Password"],account_forgot_pass:["Accounts","Forgotten Account Details"],account_no_account:["Accounts","Register"],account_topup:["Accounts","Top up"],account_bet_history:["Accounts","Bet History"],account_withdraw:["Accounts","Withdraw"],account_terms:["Accounts","Bookmaker Terms & Conditions"],account_sort_card:["Accounts","Sort Card By"],account_odds_display:["Accounts","Odds Display"],account_odds_type:["Accounts","Odds Type"],account_help:["Accounts","Help"],account_share:["Accounts","Share with Friends"],account_feedback:["Accounts","Email feedback"],account_pref_bookie:["Accounts","Preferred Bookmaker"],account_wh_bet_prom:["Accounts","Exclusive RP Offer"],bets_price_click:["Bets","Price Click"],bets_each_way:["Bets","Each Way"],bets_starting_price:["Bets","Starting Price"],error_404:["Errors","Error 404"],error_generic:["Errors","Generic"],error_market_suspended:["Errors","Market Suspended"],error_price_changed:["Errors","Price Change"],error_no_betting:["Errors","No Betting Error"],error_location_unknown:["Errors","Cancel Bet -"],deposit_deposit:["Deposit","Deposit"],deposit_account:["Deposit","My Account"],bet_receipt_card:["Bet Receipt","Bet Receipt Back Button"],bet_receipt_done:["Bet Receipt","Done"],bet_receipt_account:["Bet Receipt","Account"],betslip_place_bet:["Bet Slip","Place Bet"],betslip_account:["Bet Slip","Account Button"],betslip_back:["Bet Slip","Back"],betslip_login_and_bet:["Bet Slip","Log in & Place Bet"],betslip_login:["Bet Slip","Log in"],betslip_open_account:["Bet Slip","Open Account"],betslip_bet_offer:["Bet Slip","Bet Offer"],pref_bookie_login:["Preferred Bookmaker"],pref_bookie_register:["Preferred Bookmaker"],pref_bookie_start:["Preferred Bookmaker"],pref_bookie_select:["Preferred Bookmaker"]},(webApp=webApp||{}).SelectionsManager=function(){var n=function(){};return{init:function(){return $(window).bind("changebookie",function(e){rp.betting.SelectionsCollection.instance()._restoreSelections(),webApp.SelectionsManager.updateCounter()}),webApp.SelectionsManager.updateCounter(),this},updateCounter:function(){var e=this.getSelections().length;e?webApp.selectionsAlert.setCounter(e):webApp.selectionsAlert.hideCounter()},getSelections:function(){return rp.betting.SelectionsCollection.instance().selections()},removeAllSelections:function(){return rp.betting.SelectionsCollection.instance().clear(),webApp.selectionsAlert.hideCounter(),this},addSelection:function(e){rp.betting.SelectionsCollection.instance().add(e)},getSelectionForSingleMode:function(){return rp.betting.SelectionsCollection.instance().selections()[0]},removeSelection:function(e){return rp.betting.SelectionsCollection.instance().remove(e),this},isSelected:function(e){return rp.betting.SelectionsCollection.instance().exists(e)},highlightSelectionPrice:function(e){$(e).addClass("active"),$(e).find("i").text("IN SLIP")},unhighlightSelectionPrice:function(e,t){$(e).removeClass("active"),$(e).find("i").text(t)},setOnAddMultModeCallback:function(e){if("function"!=typeof e)throw new Error("Illegal argument type, function is expected");n=e},processPriceClick:function(e,t,r,i){if(this.getSelections().length)if(this.isSelected(e)){this.removeSelection(e),this.unhighlightSelectionPrice(t,i);var s=this.getSelections().length;webApp.selectionsAlert.show(s),0===s&&$(window).trigger(webApp.EVENT_BETSLIP_EMPTIED)}else this.getSelections().length<10?(this.addSelection(e),this.highlightSelectionPrice(t),n.call(this)):alert("You have the max of 10 selections in your slip already");else rp.betting.SelectionsCollection.instance().clear(),this.addSelection(e),r instanceof webApp.AbstractController?r._redirect("bet-slip"):"function"==typeof r&&r()}}}(),namespace("rp"),rp.Object=function(e){if(!(this instanceof arguments.callee))throw new Error("rp.Object called as function.");this.set(e)},extend(rp.Object,Object,function(o){var c="__objectProperties";this.property=function(e,t){var r,i;this.hasOwnProperty(c)||(this[c]=(r=this[c],(i=function(){}).prototype=r,new i));var s,n,a="_"+e;return s=(t=t||{}).get,$.isFunction(s)||(s=this[e]||function(){return this[a]}),n=this[e],t.set&&(n=t.set,$.isFunction(n)||(n=this[e]||function(e){this[a]=e})),this[c][e]=this[e]=function(){return 0===arguments.length?s.call(this):(n&&n.apply(this,arguments),this)},this},this.get=function(e){for(var t,r,i,s={},n=0,a=arguments.length;n<a;n++)r=this[t=arguments[n]],$.isFunction(r)&&(i=o.toJSON(r.call(this)),s[t]=i);return s},this.set=function(e){var t;for(var r in e)t=this[r],$.isFunction(t)&&t.call(this,e[r]);return this},this.proxy=function(e){return $.proxy(e,this)};var e="id-"+Number(new Date).toString(36),t=1;this.uid=function(){return this._uid||(this._uid=o.uid()),this._uid},this.toJSON=function(){var e={};for(var t in this[c])e[t]=o.toJSON(this[c][t].call(this));return e},o.uid=function(){return e+(t++).toString(36)},o.toJSON=function(e){var t=null;if($.isArray(e)){t=[];for(var r=0,i=e.length;r<i;r++)t[r]=this.toJSON(e[r])}else if(e&&e.constructor===Object)for(var r in t={},e)t[r]=this.toJSON(e[r]);else e&&e.toJSON?t=e.toJSON():null!=e&&(t=e.valueOf());return t}}),namespace("rp"),rp.Storage=function(e){arguments.callee.$super.apply(this,arguments)},extend(rp.Storage,rp.Object,function(e,t){var r;try{r=window.localStorage}catch(e){r={getItem:function(e){return this[e]},setItem:function(e,t){this[e]=t}}}function s(e){var t=r.getItem(e);return t&&JSON.parse(t)||{}}function n(e,t){r.setItem(e,JSON.stringify(t))}this._name="rp",this.property("name",{set:!0}),this.getValue=function(e,t){var r=s(this._name);return r&&r.hasOwnProperty(e)?r[e]:t},this.setValue=function(e,t,r){var i=s(this._name)||{};r&&(t=$.extend(i[e]||{},t)),i[e]=t,n(this._name,i)},this.unsetValue=function(e){var t=s(this._name);delete t[e],n(this._name,t)}}),namespace("rp"),rp.EventTarget=function(){arguments.callee.$super.apply(this,arguments)},extend(rp.EventTarget,rp.Object,function(e,t){var o=Array.prototype.slice;this._listeners=null,this.property("listeners",{get:function(){return this._listeners||(this._listeners={}),this._listeners}}),this.event=function(r,e){var t,i;return t=(e=e||{}).get,$.isFunction(t)||(t=this[r]||function(){var e=o.call(arguments);return e.unshift(r),this.trigger.apply(this,e),this}),i=e.set,$.isFunction(i)||(i=this[r]||function(e,t){this.bind(r,e,t)}),this[r]=function(){return($.isFunction(arguments[0])?i:t).apply(this,arguments),this},this["un"+r]=function(e,t){return this.unbind(r,e,t),this},this},this.bind=function(e,t,r){var i,s;e=String(e).toLowerCase().split(/\s/),r=r||this,s=this.uid.call(t)+this.uid.call(r);for(var n=0,a=e.length;n<a;n++)(i=namespace.call(this.listeners(),e[n])).hasOwnProperty(s)||(i[s]={handler:t,context:r});return this},this.unbind=function(e,t,r){var i,s;e=String(e).toLowerCase().split(/\s/),r=r||this,s=this.uid.call(t)+this.uid.call(r);for(var n=0,a=e.length;n<a;n++)(i=this.listeners()[e[n]])&&delete i[s];return this},this.trigger=function(e,t){var r,i=o.call(arguments),s=(e=String(e).toLowerCase(),new rp.Event(e,this)),n=this.listeners()[e];for(var a in i[0]=s,n)if((r=n[a]).handler.apply(r.context,i),s.isImmediatePropagationStopped())break;return!s.isDefaultPrevented()}}),namespace("rp"),rp.Event=function(e,t){this.type=e,this.target=t},extend(rp.Event,rp.Object,function(e,t){this.type="",this.target=null,this._defaultPrevented=!1,this._propagationStopped=0,this.stopPropagation=function(){this._propagationStopped|=1},this.stopImmediatePropagation=function(){this._propagationStopped|=2},this.isPropagationStopped=function(){return!!this._propagationStopped},this.isImmediatePropagationStopped=function(){return!!this._propagationStopped},this.preventDefault=function(){this._defaultPrevented=!0},this.isDefaultPrevented=function(){return this._defaultPrevented}}),(rp=rp||{}).models=rp.models||{},rp.models.EachWay=function(e){var t=e.data[0].split("|"),r=t[0],i=t[1],s=r.indexOf("/");this.num=r.substring(0,s),this.den=r.substring(s+1),this.places=i},(rp=rp||{}).HorseBetInfo=function(e,t){NOON_HOURS=12;var r=e.data[3],i=e.topic[4],s=Math.floor(i/100),n=Math.round(i%100),a=e.data[1],o=a.indexOf("/"),c=e.topic[2].split("-").reverse().join("-")+"T"+s+":"+(n<10?"0":"")+n;this._oddsType=t||"fractional",this.selectionId=r.substring(0,r.indexOf("|")),this.horseName=e.topic[6],this.selectionName=this.horseName,this.name=e.topic[6].replace(/_/g," ").replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),this.hours=s!=NOON_HOURS?s%=NOON_HOURS:s,this.minutes=n<10?"0"+n:n,this.numerator=parseInt(a.substring(0,o),10)||1,this.denominator=parseInt(a.substring(o+1),10)||1,this.fractional=e.data[1],this.decimal=e.data[2],this.isSuspended=1==e.data[5],this.raceTs=moment.utc(c).unix()},rp.HorseBetInfo.prototype.toString=function(e){var t="";return t="decimal"==(e=e||this._oddsType)?parseFloat(this.decimal).toFixed(2):this.fractional,"SP"!=this.fractional&&"0.0"!=this.decimal||(t="SP"),this.isSuspended&&(t="&mdash;"),t},namespace("rp",function(t){t.Timeout=function(){arguments.callee.$super.apply(this,arguments)},extend(t.Timeout,t.EventTarget,function(e,t){e.EVENT_TICK="tick",this.event(e.EVENT_TICK),this._handle=null,this.property("isStarted",{get:function(){return null!=this._handle}}),this._interval=1e3,this.property("interval",{set:function(e){this.stop(),this._interval=Number(e)||0}}),this._handleTick=function(){this._handle=null,this.trigger(e.EVENT_TICK)},this.start=function(){this.stop(),this._handle=window.setTimeout($.proxy(this._handleTick,this),this._interval)},this.stop=function(){this._handle&&(window.clearTimeout(this._handle),this._handle=null)}}),t.timeout=function(e){return new t.Timeout({interval:e})}}),namespace("rp",function(s){function n(){n.$super.apply(this,arguments)}function a(){this._values={}}s.url=function(e,t){return e instanceof n||(e=n.create(e,t)),e},extend(n,s.Object,function(t,e){var r=/^[a-z][a-z0-9\+\-\.]+$/,i=/^(?:([^:@]+)(?::([^@]+))?@)?([^:]*)(?::(\d+))?$/;t.normalize=function(e){var t=[],r="";for(e=String(e).split("/");e.length;)"."!=(r=e.shift())&&(".."==r?t.pop():t.push(r));return t.length?t.join("/"):"/"},this._scheme=null,this.property("scheme",{set:function(e){if(!r.test(e))throw new Error("Invalid scheme.");this._scheme=String(e)}}),this._user=null,this.property("user",{set:function(e){this._user=String(e||"")}}),this._password=null,this.property("password",{set:function(e){this._password=String(e||"")}}),this._host="",this.property("host",{set:function(e){this._host=String(e)}}),this._port=null,this.property("port",{set:function(e){this._port=0<e&&Number(e)||null}}),this._path="",this.property("path",{set:function(e){this._path=t.normalize(e)}}),this._params=null,this.property("params",{get:function(){return this._params},set:function(e){this._params=$.extend({},this._params,e)}}),this._hash="",this.property("hash",{set:function(e){this._hash=String(e||"")}}),this.property("authority",{get:function(){return[this._user?this._user+(this._password?":"+this._password:"")+"@":"",this._host,this._port?":"+this._port:""].join("")},set:function(e){var t=String(e).match(i);if(!t)throw new Error(e+" is not well formed url authority.");this.user(t[1]).password(t[2]).host(t[3]).port(t[4])}}),this.property("origin",{get:function(){return this._scheme+"://"+this.authority()}}),this.property("href",{get:function(){return this.origin()+this._path}}),this.property("folder",{get:function(){return this._path.replace(/[^\/]+$/,"")}}),this.property("query",{get:function(){return a.stringify(this.params())},set:function(e){this.params(a.parse(e))}}),this.param=function(e,t){return 1===arguments.length?this._params.hasOwnProperty(e)?this._params[e]:null:(this._params[e]=t,this)},this.toString=function(){var e=this.authority(),t=this.query(),r=this.hash();return String(this._scheme+":"+(e?"//"+e:"")+this._path+(t?"?"+t:"")+(r?"#"+r:""))},t.create=function(e,t){if(!(e=utils.string.url(e)))throw new Error(e+" is not well formed url.");return e.scheme||(t=s.url(t||String(location)),e.scheme=t.scheme(),e.authority=t.authority(),e.query=e.path||e.query?e.query:t.query(),e.path=e.path||"","/"!==e.path.charAt(0)&&(e.path=t.folder()+e.path)),new n(e)}}),extend(a,s.Object,function(u,e){this._maxKey=0,this._isArray=null,this.property("isArray",{set:function(e){this._isArray=Boolean(e)}});var i={true:!0,false:!1,null:null};function p(e){var t=[],r=0,i=0,s=0;if(/\S/.test(e))for(e=e.replace(/[\+\s]/g,"_");r=e.indexOf("[",s),i=e.indexOf("]",r),0!==r&&(!s||r===s&&-1!==i);){if(-1===r||-1===i){t.push(e.replace("[","_"));break}s||t.push(e.substr(s,r)),t.push(e.substring(r+1,i)),s=i+1}return t}this.add=function(e,t){var r;return""===e||" "===e?e=this._maxKey++:e===String(parseInt(e,10))?(this.isArray(0<=e),this._maxKey=Math.max(e+1,this._maxKey)):this.isArray(!1),null==t?this._values[e]instanceof u||(this._values[e]=new u):this._values[e]=(r=t,i.hasOwnProperty(r)?i[r]:""===r||isNaN(r)?r.replace(/\+/g," "):+r),this._values[e]},this.values=function(){var e=this._isArray?[]:{},t=null;for(var r in this._values)t=this._values[r],e[r]=t instanceof u?t.values():t;return e},u.parse=function(e){for(var t,r,i,s,n=String(null==e?"":e).split("&"),a=new u,o=0,c=n.length;o<c;o++){t=n[o].split("="),r=[],i="";try{r=p(decodeURIComponent(t.shift())),i=decodeURIComponent(t.join("="))}catch(e){continue}if(r.length){s=a;for(var l=0,h=r.length-1;l<h;l++)s=s.add(r[l]);s.add(r[h],i)}}return a.isArray(!1).values()},u.stringify=function(e){return $.param(e)}})}),namespace("utils"),utils.bet={LABEL_PLACED_SHORT:"P",LABEL_WIN_SHORT:"W",LABEL_VOID_SHORT:"V",LABEL_EACHWAY_SHORT:"E",LABEL_EACHWAY_ABBR:"EW",LABEL_PLACED_FULL:"Placed",LABEL_WIN_FULL:"Win",LABEL_WON_FULL:"Won",LABEL_LOST_FULL:"Lost",LABEL_VOID_FULL:"Void",LABEL_EACHWAY_FULL:"EachWay",LABEL_GBP:"&pound;",LABEL_EUR:"&euro;",LABEL_USD:"$",LABEL_SEK:"Kr",LABEL_SP:"SP",LABEL_EVS:"Evs",detectLabel:function(e){var t="";if(e instanceof rp.betting.Bet){var r=e.returns(),i=e.selection().price(),s=e.isEachWay();if(0<r)if(e.label()===utils.bet.LABEL_VOID_FULL)t=utils.bet.LABEL_VOID_SHORT;else if(e.isSingle()&&!e.selection().isSP())if(s){if(s&&e.isSingle()){var n=i.den(),a=i.num();t=e.stake()*a/n<r?utils.bet.LABEL_WIN_SHORT:utils.bet.LABEL_PLACED_SHORT}}else t=utils.bet.LABEL_WIN_SHORT;else t=utils.bet.LABEL_WIN_SHORT}return t},formatSelectionPrice:function(e,t){var r=utils.bet.LABEL_SP;return e.isSP()||(r=t?e.getPrice(t).toFixed(2):e.price().fractional()),r},replaceEncodings:function(e){return utils.string.replaceByCharCodes(e,[65533],[39])},convertCurrencyCodeToHtml:function(e,t){var r={GBP:this.LABEL_GBP,EUR:this.LABEL_EUR,USD:this.LABEL_USD,SEK:this.LABEL_SEK};r[this.LABEL_GBP]=this.LABEL_GBP,r[this.LABEL_EUR]=this.LABEL_EUR,r[this.LABEL_USD]=this.LABEL_USD,r[this.LABEL_SEK]=this.LABEL_SEK;var i=t||this.LABEL_GBP;return r[e]&&(i=r[e]),i},isStraight:function(e){for(var t={},r=0;r<e.length;r++){if(t[e[r].data().raceId])return!1;t[e[r].data().raceId]=1}return!0},getNumberOfCombinations:function(e,t){var r=0;return e<t?r:r=utils.numbers.factorial(e)/(utils.numbers.factorial(t)*utils.numbers.factorial(e-t))},getCombinations:function(e,o,c){var t=e.length;return o=Math.max(+o||0,1),c=Math.min(Math.max(+c||t,o),t),function e(t,r,i){for(var s,n=0,a=r.length;n<a;n++)(s=(i||[]).concat([r[n]])).length>=o&&t.push(s),s.length<c&&e(t,r.slice(n+1),s);return t}([],e)},getBetTypeName:function(e,t,r){var i="",s=rp.betting.Bet.TYPE,n=e.type(),a=this.totalAccumulators;for(var o in s){if(s[o]===e.type()){i=o;break}}if(!i&&r)i=r;else if(i){var c=i.split("_"),l=[];$.map($.makeArray(c),function(e,t){l.push(utils.string.capitalize(e))}),i=l.join(" ")}return e.isAccumulator()&&(4===a&&n==s.FOURFOLD||5===a&&n==s.FIVEFOLD||6===a&&n==s.SIXFOLD||7===a&&n==s.SEVENFOLD||8===a&&n==s.EIGHTFOLD||9===a&&n==s.NINEFOLD||10===a&&n==s.TENFOLD?1<e.betCounter()?i+=" accumulators":i+=" accumulator":1<e.betCounter()&&t&&(i+="s"),n===s.SINGLE&&(i+=" Bet")),i},totalAccumulators:0,accumulatorsCounter:function(e){var t=1;betLength=e.length||0;for(var r=0;r<betLength;r++){var i=e[r].type();258<=i&&i<=268&&t++}return this.totalAccumulators=t,""},getPermutations:function(e){for(var t=1,r=0;r<e.length;r++)t*=e[r].length;for(var i=[],s=0;s<t;s++){var n=[],a=1;for(r=0;r<e.length;r++){var o=Math.floor(s/a)%e[r].length;a*=[e[r].length],n.push(e[r][o])}i.push(n)}return i}},namespace("rp.betting"),rp.betting.Bet=function(){this._selections=[],this._freeBets=[],arguments.callee.$super.apply(this,arguments)},extend(rp.betting.Bet,rp.EventTarget,function(e,t){e.EVENT_CHANGE="change",this.event(e.EVENT_CHANGE);var r=8,i=1<<r++,s=1<<r++,n=1<<r++,a=1<<r++;function l(e,t){return utils.bet.getCombinations(e,t?1:2)}function E(e,t){for(var r=e,i=0,s=t.length;i<s;i++)r=t[i].returns(r);return r}function m(e,t){for(var r=e,i=0,s=t.length;i<s;i++)r*=(t[i].price().decimal()-t[i].eachWay().num())/t[i].eachWay().den()+1;return r}function f(e,t){for(var r=!0,i=0;i<e.length;i++)if(-1==t.indexOf(parseInt(e[i].id()))){r=!1;break}return r}function g(e){var t=[];T(e);for(var r=0,i=e.length;r<i;r++){var s=e[r][0].eachWay().numberOfPlaces();e[r]=e[r].splice(e[r],s);for(var n=0;n<e[r].length;n++)t.push(parseInt(e[r][n].id()))}return t}function T(e){for(var t=0;t<e.length;t++)e[t].sort(function(e,t){return t.price().decimal()-e.price().decimal()})}function o(e,t,r,i){var s=S(t),n=function(e){var t=[];T(e);for(var r=0,i=e.length;r<i;r++){e[r]=e[r].splice(e[r],1);for(var s=0;s<e[r].length;s++)t.push(parseInt(e[r][s].id()))}return t}(s),a=0,o=255&r;if(o>s.length)throw new Error("Can not calculate "+o+"-fold accumulator on selections from "+s.length+" races");for(var c=utils.bet.getCombinations(s,o,o),l=[],h=0;h<c.length;h++)for(var u=utils.bet.getPermutations(c[h]),p=0;p<u.length;p++)l.push(u[p]);h=0;for(var d=l.length;h<d;h++)if(f(l[h],n)&&(a+=E(e,l[h])),i){var _=g(s);f(l[h],_)&&(a+=m(e,l[h]))}return a}function S(e){for(var t={},r=0,i=e.length;r<i;r++)t[e[r].data().raceId]=t[e[r].data().raceId]||[],t[e[r].data().raceId].push(e[r]);var s=[];for(var n in t)s.push(t[n]);return s}e.TYPE={},e.TYPE.SINGLE=n|i|1,e.TYPE.DOUBLE=2|i,e.TYPE.TREBLE=3|i,e.TYPE.FOURFOLD=4|i,e.TYPE.FIVEFOLD=5|i,e.TYPE.SIXFOLD=6|i,e.TYPE.SEVENFOLD=7|i,e.TYPE.EIGHTFOLD=8|i,e.TYPE.NINEFOLD=9|i,e.TYPE.TENFOLD=10|i,e.TYPE.ACCUMULATOR=i,e.TYPE.TRIXIE=3|s,e.TYPE.YANKEE=4|s,e.TYPE.SUPER_YANKEE=e.TYPE.CANADIAN=5|s,e.TYPE.HEINZ=6|s,e.TYPE.SUPER_HEINZ=7|s,e.TYPE.GOLIATH=8|s,e.TYPE.PATENT=n|e.TYPE.TRIXIE,e.TYPE.LUCKY_15=n|e.TYPE.YANKEE,e.TYPE.LUCKY_31=n|e.TYPE.CANADIAN,e.TYPE.LUCKY_63=n|e.TYPE.HEINZ,e.TYPE.TOTE_WIN=1|a,e.TYPE.TOTE_PLACE=2|a,e.TYPE.TOTE_EXACTA=3|a,e.TYPE.TOTE_TRIFECTA=4|a,e.TYPE.TOTE_QUADPOT=5|a,e.TYPE.TOTE_PLACEPOT=6|a,e.TYPE.TOTE_JACKPOT=7|a,e.TYPE.TOTE_SCOOP6=8|a,e.TYPE.TOTE_SWINGER=9|a,this._label="",this.property("label",{set:!0}),this._betReference="",this.property("betReference",{set:!0}),this._betDate="",this.property("betDate",{set:!0}),this._receiptId="",this.property("receiptId",{set:!0}),this._type=e.TYPE.SINGLE,this.property("type",{set:!0}),this._typeName=null,this.property("typeName",{set:!0}),this._betHistoryEW=!1,this.property("betHistoryEW",{set:!0,get:function(){return!!this._betHistoryEW}}),this.betCounter=function(){var e=0;if(this.isSingle())e=1;else if(this.isAccumulator()){for(var t=S(this._selections),r=255&this._type,i=utils.bet.getCombinations(t,r,r),s=[],n=0;n<i.length;n++)for(var a=utils.bet.getPermutations(i[n]),o=0;o<a.length;o++)s.push(a[o]);e=s.length}else{e=l(this._selections,this.hasSingles()).length}return this._isEachWay?2*e:e},this._selections=null,this.property("selections",{set:function(e){this._selections=[],this.selection.apply(this,e)}}),this.property("selection",{get:function(){return this._selections[0]},set:function(e){for(var t=0,r=arguments.length;t<r;t++)(e=arguments[t])instanceof rp.betting.Selection||(e=rp.betting.Selection.create(e)),e.bind(rp.betting.Selection.EVENT_CHANGE,this.triggerChangeEvent,this),this._selections.push(e);this.triggerChangeEvent()}}),this.triggerChangeEvent=function(){this.trigger(e.EVENT_CHANGE)},this._stake=0,this.property("stake",{set:function(e){if((e=parseFloat(e)||0)<0)throw new TypeError("Invalid stake value.");this._stake!==e&&(this._stake=Math.round(100*e)/100,this.triggerChangeEvent())}}),this._minStake=0,this.property("minStake",{set:function(e){if((e=+e||0)<0)throw new TypeError("Invalid stake value.");this._minStake=e}}),this._maxStake=Number.POSITIVE_INFINITY,this.property("maxStake",{set:function(e){if(_maxStake=+e,!(0<=_maxStake)||isNaN(_maxStake))throw this._maxStake=Number.POSITIVE_INFINITY,new TypeError("Invalid stake value.");this._maxStake=_maxStake}}),this._totalStake=null,this.property("totalStake",{get:function(){var e=this._totalStake;if(null==e)if(this.isFullCover()){var t=this._selections;e=this._stake*l(t,this.hasSingles()).length*(this.isEachWay()?2:1)}else e=this._stake*this.betCounter();return e},set:!0}),this._returns=null,this.property("returns",{get:function(){var e=this._returns;if(null==e&&(e=NaN,this.isValidCount())){var t=this._stake,r=this._selections;(function(e){for(var t=!1,r=0;r<e.length;r++)if(e[r].isSP()){t=!0;break}return t})(r)||(e=this.isSingle()?r[0].returns(t,this.isEachWay()):this.isAccumulator()?o(t,r,this._type,this.isEachWay()):function(e,t,r,i){for(var s=l(t,r),n=0,a=0,o=0,c=s.length;o<c;o++)a+=E(e,s[o]),i&&(n+=m(e,s[o]));return n+a}(t,r,this.hasSingles(),this.isEachWay()))}return utils.numbers.toFloatMoney(e)},set:!0}),this._isEachWay=!1,this.property("isEachWay",{get:function(){return this._isEachWay&&this.isEachWayAllowed()},set:function(e){e=!!e,this._isEachWay!==e&&(this._isEachWay=e,this.triggerChangeEvent())}}),this._freeBets=null,this.property("freeBets",{set:function(e){this._freeBets=[],this.freeBet.apply(this,e)}}),this.freeBet=function(e){for(var t=0,r=arguments.length;t<r;t++)(e=arguments[t])instanceof rp.betting.FreeBet||(e=new rp.betting.FreeBet(e)),this._freeBets.push(e);return this.triggerChangeEvent(),this},this.freeBetsAmount=function(){for(var e,t=0,r=0,i=this._freeBets.length;r<i;r++)(e=this._freeBets[r]).selected()&&(t+=e.amount());return t},this._isSettled=!1,this.property("isSettled",{set:!0}),this.count=function(){return this._selections.length},this.isSingle=function(){return this._type===e.TYPE.SINGLE},this.isMultiple=function(){return this._type!==e.TYPE.SINGLE},this.isAccumulator=function(){return!!(this._type&i)},this.isFullCover=function(){return!!(this._type&s)},this.hasSingles=function(){return this.isFullCover()&&!!(this._type&n)},this.isOpened=function(){return!this.isSettled()},this.hasSelections=function(){return!!this.count()},this.isValidCount=function(){return(255&this._type||1)<=this.count()},this.isValid=function(){return this.isValidCount()&&this._stake>=this._minStake&&this._stake<=this._maxStake},this.isEachWayAllowed=function(){for(var e=!0,t=0,r=this._selections.length;e&&t<r;t++)e=e&&this._selections[t].hasEachWay();return e},this.reset=function(){return this._selections=[],this._freeBets=[],this._stake=0,this._isEachWay=!1,this._betHistoryEW=!1,this._receiptId="",this._betReference="",this._type=e.TYPE.SINGLE,this._typeName="",this._minStake=0,this._maxStake=Number.POSITIVE_INFINITY,this._returns=null,this._totalStake=null,this._isSettled=null,this.triggerChangeEvent(),this},this.combinations=function(e,t,r){return utils.bet.getCombinations(e,t,r)},this.toJSON=function(){return this.get("betDate","receiptId","betReference","type","typeName","selections","stake","minStake","maxStake","freeBets","isEachWay","label")},e.create=function(e,t){$.type(e);return(t=t instanceof this?t:new this).set(e)}}),namespace("rp.betting"),rp.betting.FreeBet=function(){arguments.callee.$super.apply(this,arguments)},extend(rp.betting.FreeBet,rp.EventTarget,function(e,t){this._id="",this.property("id",{set:!0}),this._name="",this.property("name",{set:!0}),this._expires=null,this.property("expires",{set:function(e){this._expires=new Date(e)}}),this._amount=0,this.property("amount",{set:!0}),this._selected=!1,this.property("selected",{set:!0}),this.toJSON=function(){return this.get("id","name","expires","amount","selected")}}),namespace("rp.betting"),rp.betting.User=function(){arguments.callee.$super.apply(this,arguments)},extend(rp.betting.User,rp.EventTarget,function(t,e){t.EVENT_BALANCE_CHANGED="balanceChanged",this.event(t.EVENT_BALANCE_CHANGED),this._login="",this.property("login",{set:!0}),this._token="",this.property("token",{set:!0}),this._title="",this.property("title",{set:!0}),this._firstName="",this.property("firstName",{set:!0}),this._currency="",this.property("currency",{set:!0}),this._balance=NaN,this.property("balance",{set:function(e){e=+e,this._balance!==e&&(this._balance=e,this.trigger(t.EVENT_BALANCE_CHANGED,this._balance))}}),this._userIdentifier="",this.property("userIdentifier",{set:!0}),this._refreshToken="",this.property("refreshToken",{set:!0}),this._flags=null,this.property("flags",{set:!0}),this.toJSON=function(){return this.get("login","token","title","firstName","balance","currency","userIdentifier","refreshToken","flags")}}),namespace("rp.betting"),rp.betting.SearchCriteria=function(){arguments.callee.$super.apply(this,arguments)},extend(rp.betting.SearchCriteria,rp.Object,function(e,t){this._fromDate=null,this.property("fromDate",{set:!0}),this._toDate=null,this.property("toDate",{set:!0}),this._blockSize=null,this.property("blockSize",{set:!0}),this._minimumBets=null,this.property("minimumBets",{set:!0}),this._blockNumber="",this.property("blockNumber",{set:!0}),this.toJSON=function(){return this.get("fromDateTime","toDateTime","blockSize","blockNumber")},this.reset=function(){this.blockNumber(null)}}),namespace("rp.betting"),rp.betting.BetHistory=function(){arguments.callee.$super.apply(this,arguments)},extend(rp.betting.BetHistory,rp.EventTarget,function(t,e){t.EVENT_ADDED_BET="betHistoryAddedBet",this.event(t.EVENT_ADDED_BET),this._totalBlocks=null,this.property("totalBlocks",{set:!0}),this._lastBetId=null,this.property("lastBetId",{set:!0}),this._searchCriteria=null,this.property("searchCriteria",{set:function(e){!e||e instanceof rp.betting.SearchCriteria||(e=new rp.betting.SearchCriteria(e)),this._searchCriteria=e}}),this._bets=[],this.property("bets",{set:!0,get:!0}),this.addBet=function(e){this._bets.push(e),e.isSettled()?this._settled.push(e):this._opened.push(e),this.trigger(t.EVENT_ADDED_BET,e)},this.addBets=function(e){for(var t in e)this.addBet(e[t])},this._opened=[],this.property("opened",{get:!0,set:!0}),this._settled=[],this.property("settled",{get:!0,set:!0}),this.clearBets=function(){this._bets=[],this._opened=[],this._settled=[]},this.reset=function(){this.clearBets(),this.totalBlocks(null),this.searchCriteria()&&this.searchCriteria().reset()},this.find=function(e){var t=[];if(!$.isEmptyObject(e))for(var r in this._bets){var i=this._bets[r];e.receiptId&&e.receiptId==i.receiptId()&&t.push(i)}return t}}),namespace("rp.betting"),rp.betting.Selection=function(){arguments.callee.$super.apply(this,arguments)},extend(rp.betting.Selection,rp.EventTarget,function(t,e){t.EVENT_CHANGE="change",this.event(t.EVENT_CHANGE),this._id="",this.property("id",{set:!0}),this._data=null,this.property("data",{set:!0}),this._price=null,this.property("price",{set:function(e){!(e=e||null)||e instanceof rp.betting.Price||(e=rp.betting.Price.create(e)),String(this._price)!==String(e)&&(this._price=e,this.trigger(t.EVENT_CHANGE))}}),this._oldPrice=null,this.property("oldPrice",{set:!0}),this.getPrice=function(e,t){return this.isSP()?"SP":this.getPriceReal(e,t)},this.getPriceReal=function(e,t){var r;return this.price()?(t&&1===this.price().num()&&1===this.price().den()&&(r=rp.betting.Price.EVS),r||(r=this.price().toString(e,t))):r="SP",r},this.getOldPrice=function(e,t){return this.isSP()?"SP":this.getOldPriceReal(e,t)},this.getOldPriceReal=function(e,t){var r;return this.oldPrice()?(t&&1===this.oldPrice().num()&&1===this.oldPrice().den()&&(r=rp.betting.Price.EVS),r||(r=this.oldPrice().toString(e))):r="SP",r},this._eachWay=null,this.property("eachWay",{set:function(e){!(e=e||null)||e instanceof rp.betting.EachWay||(e=rp.betting.EachWay.create(e)),String(this._eachWay)!==String(e)&&(this._eachWay=e,this.trigger(t.EVENT_CHANGE))}}),this._isSP=!1,this.property("isSP",{get:function(){return this._isSP||null==this._price},set:function(e){e=!!e,this._isSP!==e&&(this._isSP=e,this.trigger(t.EVENT_CHANGE))}}),this.hasPrice=function(){return null!=this._price},this.isTrapChallengePrice=function(){return this._data.isTrapChallengePrice},this.hasEachWay=function(){var e=!!this._eachWay;return e&&this._eachWay.numberOfPlaces()<2&&(e=!1),e},this.winReturns=function(e){var t=NaN;return this.isSP()||(t=e*this.price().num()/this.price().den()+e),t},this.eachWayReturns=function(e){var t=0,r=this.price();return this.hasEachWay()&&r&&(t=e*r.num()*this.eachWay().num()/r.den()/this.eachWay().den()+e),t},this.returns=function(e,t){var r=this.winReturns(e);return t&&(""!=this.eachWay().get("places").places?r+=this.eachWayReturns(e):r="N/A"),r},this.toJSON=function(){return this.get("id","price","eachWay","isSP","data")},t.create=function(e,t){var r=$.type(e);return"string"!==r&&"number"!==r||(e={price:e}),(t=t instanceof this?t:new this).set(e)}}),namespace("rp.betting"),rp.betting.Price=function(){arguments.callee.$super.apply(this,arguments)},extend(rp.betting.Price,rp.Object,function(i,e){i.EVS="Evs",this._num=1,this.property("num",{set:function(e){if((e=parseInt(e,10)||1)<0)throw new TypeError("Invalid numerator value.");this._num=e}}),this._den=1,this.property("den",{set:function(e){if(e=parseInt(e,10),(e=isFinite(e)?e:1)<1)throw new TypeError("Invalid denumerator value.");this._den=e}}),this.odds=function(){return this._num/this._den},this.decimal=function(){return 1+this.odds()},this.fractional=function(e){return e&&this._num==this._den==1?i.EVS:this._num+"/"+this._den},this.toString=function(e,t){return e?Math.floor(100*this.decimal())/100:this.fractional(t)},this.toJSON=function(){return this.get("num","den")},i.create=function(e,t){var r=$.type(e);return t=t instanceof this?t:new this,"string"!==r&&"number"!==r||((e=String(e)).toLowerCase()===i.EVS.toLowerCase()&&(e="1"),e=e.split("/")),$.isArray(e)&&(e={num:e[0],den:e[1]}),t.set(e)}}),namespace("rp.betting"),rp.betting.EachWay=function(){arguments.callee.$super.apply(this,arguments)},extend(rp.betting.EachWay,rp.betting.Price,function(i,t){this._places="",this.property("places",{set:!0}),this.numberOfPlaces=function(){var e=1;return this.places()&&(e=parseInt(this.places().split("-")[1])),e},this.toString=function(e){return t.toString.call(this,e)+" "+this.places()},this.toJSON=function(){return $.extend(this.get("places"),t.toJSON.call(this))},i.create=function(e,t){var r=$.type(e);return t=t instanceof this?t:new this,"string"===r&&(e=e.split(/[\s+\|]/g)),$.isArray(e)&&(i.$super.create.call(this,$.trim(e[0]),t),e={places:$.trim(e[1])}),t.set(e)}}),namespace("rp.betting"),rp.betting.BetSlip=function(){arguments.callee.$super.apply(this,arguments)},extend(rp.betting.BetSlip,rp.EventTarget,function(e,t){e.EVENT_CHANGE="change",this.event(e.EVENT_CHANGE),this.triggerChangeEvent=function(){this.trigger(e.EVENT_CHANGE)},this._bets=null,this.property("bets",{get:function(){return this._bets},set:function(e){this._bets=[];for(var t=0,r=e.length;t<r;t++){var i=e[t];i instanceof rp.betting.Bet||(i=rp.betting.Bet.create(i)),i.bind(rp.betting.Bet.EVENT_CHANGE,this.triggerChangeEvent,this),this._bets.push(i)}this.triggerChangeEvent()}}),this.getBetsWithStake=function(){for(var e=[],t=0;t<this.bets().length;t++)0<this.bets()[t].stake()&&e.push(this.bets()[t]);return e},this.getActiveBets=function(){for(var e=[],t=0;t<this.bets().length;t++)this.bets()[t].selections()[0].data().isSuspended||e.push(this.bets()[t]);return e},this.getBetsWithReceiptId=function(){for(var e=[],t=0;t<this.bets().length;t++)this.bets()[t].receiptId()&&e.push(this.bets()[t]);return e},this.totalStake=function(){for(var e=0,t=0;t<this.bets().length;t++)e+=this.bets()[t].totalStake();return e},this.estimatedReturns=function(){for(var e=0,t=this.getBetsWithStake(),r=0;r<t.length;r++)e+=t[r].returns();return e},this.getBetBySelectionId=function(e){for(var t=0;t<this.bets().length;t++)if(this.bets()[t].type()==rp.betting.Bet.TYPE.SINGLE&&this.bets()[t].selections()[0].id()==e)return this.bets()[t];return{}},this.getBetByType=function(e){for(var t=0;t<this.bets().length;t++)if(this.bets()[t].type()==e)return this.bets()[t];return{}},this.getSingleBets=function(){for(var e=[],t=0;t<this.bets().length;t++)this.bets()[t].type()==rp.betting.Bet.TYPE.SINGLE&&e.push(this.bets()[t]);return e},this.removeOldPrices=function(){for(var e,t=this.getSingleBets(),r=0;r<t.length;r++)(e=t[r].selections()[0]).data().oldNum&&e.data().oldDen&&(delete e.data().oldNum,delete e.data().oldDen)},this.hasOldPrices=function(){for(var e,t=this.getSingleBets(),r=!1,i=0;i<t.length;i++)(e=t[i].selections()[0]).data().oldNum&&e.data().oldDen&&(r=!0);return r},this.toJSON=function(){return this.get("bets")},e.create=function(e,t){var r=$.type(e);t=t instanceof this?t:new this;var i=JSON.parse(e),s=null==i?[]:i.bets;return"string"===r&&(e={bets:s}),t.set(e)}}),namespace("rp.betting",function(e){e.BetSlipBuilder=function(){e.BetSlipBuilder.$super.apply(this,arguments)},extend(e.BetSlipBuilder,rp.EventTarget,function(c,e){var l=new rp.betting.BetSlip;function h(e){for(var t=0,r=0;r<e.length;r++){for(var i=1,s=0;s<e[r].length;s++)i*=e[r][s];t+=i}return t}c.buildBetSlip=function(e,t){if(!(e instanceof rp.betting.SelectionsCollection))throw new Error("Instance of rp.betting.SelectionsCollection expected.");for(var r=e.selections(),i=[],s=0;s<r.length;++s){var n=new rp.betting.Bet({type:rp.betting.Bet.TYPE.SINGLE});n.selection(r[s]),i.push(n)}var a=function(e){for(var t=[],r=0;r<e.length;++r)e[r].data().includeInMultiple&&!e[r].data().isSuspended&&t.push(e[r]);return t}(r),o=function(e){var t={3:{515:4,1539:7},4:{516:11,1540:15},5:{517:26,1541:31},6:{518:57,1542:63},7:{519:120},8:{520:247}},r={},i=e.length;if(i<=1)return r;if(utils.bet.isStraight(e)){for(var s=2;s<i+1;++s)r[rp.betting.Bet.TYPE.ACCUMULATOR|s]=utils.bet.getNumberOfCombinations(i,s);t[i]&&jQuery.extend(r,t[i])}else for(var n=function(e){for(var t={},r=[],i=0;i<e.length;i++){var s=e[i].data().raceId;t[s]=(t[s]||0)+1}for(var i in t)r.push(t[i]);return r}(e),a=2;a<n.length+1;++a){var o=utils.bet.getCombinations(n,a,a),c=h(o);r[rp.betting.Bet.TYPE.ACCUMULATOR|a]=c}return r}(a);return $.each(o,function(e,t){var r=new rp.betting.Bet({type:parseInt(e)});r.selections(a),i.push(r)}),l.bets(i),t instanceof rp.betting.BetSlip&&c.mergeBetslips(t,l),l},c.mergeBetslips=function(e,t){var r=e.bets(),i=t.bets();function s(e,t){for(var r=0;r<t.length;r++)if(!e.selections()[0].data().isSuspended&&e.selections()[0].id()===t[r].selections()[0].id()){e.stake(t[r].stake()),e.isEachWay(t[r].isEachWay()),e.minStake(t[r].minStake()),e.maxStake(t[r].maxStake());break}}function n(e,t){for(var r=0;r<t.length;r++)if(t[r].type()===e.type()){e.isEachWay(t[r].isEachWay()),t[r].betCounter()===e.betCounter()?(e.stake(t[r].stake()),e.minStake(t[r].minStake()),e.maxStake(t[r].maxStake())):e.isEachWay(!1);break}}for(var a=0;a<i.length;a++)i[a].isSingle()?s(i[a],r):n(i[a],r)}})}),namespace("rp.betting",function(e){var t=null;e.SelectionsCollection=function(){if(t)return t;t=this,e.SelectionsCollection.$super.apply(this,arguments),this._restoreSelections()},extend(e.SelectionsCollection,rp.EventTarget,function(o,e){o.EVENT_SELECTION_ADDED="added_selection",o.EVENT_SELECTION_REMOVED="removed_selection",o.EVENT_SELECTION_UPDATED="status_selection",this.event(o.EVENT_SELECTION_ADDED).event(o.EVENT_SELECTION_REMOVED).event(o.EVENT_SELECTION_UPDATED),this.STORAGE_KEY="selections",this.property("storage",{get:function(){var e=window.webApp.prefBookmaker.get();return this._storage=new rp.Storage({name:e+"_selectionsCollection"}),this._storage}}),this._selections=new Array,this.property("selections"),this._restoreSelections=function(){for(var e=new Array,t=this.storage().getValue(this.STORAGE_KEY)||new Array,r=0;r<t.length;r++)e.push(new rp.betting.Selection(t[r]));this._selections=e},this.add=function(e){return this._throwExceptionIfNotSelectionInstance(e),e.data().isTrapChallengePrice||(e.data().includeInMultiple=!0),this._selections.push(e),this.storage().setValue(this.STORAGE_KEY,this._selections),this.trigger(o.EVENT_SELECTION_ADDED,{selectionAmount:this._selections.length}),this},this.remove=function(e){this._throwExceptionIfNotSelectionInstance(e);for(var t=this._selections||[],r=0;r<t.length;r++){if(this._selections[r].id()===e.id()){this._selections.splice(r,1);break}}return this.storage().setValue(this.STORAGE_KEY,this._selections),this.trigger(o.EVENT_SELECTION_REMOVED,{selectionAmount:this._selections.length}),this},this.removeById=function(e){var t=new rp.betting.Selection({id:e});return this.remove(t)},this.exists=function(e){for(var t=!1,r=this._selections||[],i=0;i<r.length;i++){if(this._selections[i].id()===e.id()){t=!0;break}}return t},this.updateStatus=function(e,t,r){for(var i=this._selections||[],s=0;s<i.length;s++){var n=i[s];if(n.id()===e.id()){var a=n.data()||{};a[t]=r,n.data(a);break}}return this.storage().setValue(this.STORAGE_KEY,this._selections),this.trigger(o.EVENT_SELECTION_UPDATED,{selection:e,propertyName:t,status:r}),this},this.updateStatusById=function(e,t,r){for(var i=0;i<this._selections.length;i++)if(this._selections[i].id()==e)return this.updateStatus(this._selections[i],t,r)},this.getSuspendedSelections=function(){for(var e=[],t=0;t<this._selections.length;t++)this._selections[t].data().isSuspended&&e.push(this._selections[t]);return e},this.getSPSelections=function(){for(var e=[],t=0;t<this._selections.length;t++)this._selections[t].isSP()&&e.push(this._selections[t]);return e},this.clear=function(){this._selections=new Array,this.storage().setValue(this.STORAGE_KEY,null)},this.update=function(e){this._throwExceptionIfNotSelectionInstance(e);for(var t=this._selections||[],r=0;r<t.length;r++){if(this._selections[r].id()===e.id()){this._selections[r]=e;break}}return this.storage().setValue(this.STORAGE_KEY,this._selections),this},this._throwExceptionIfNotSelectionInstance=function(e){if(!(e instanceof rp.betting.Selection))throw new Error("Invalid argument type, instance of rp.betting.Selection expected")},o.instance=function(e){return new o(e)}})}),(webApp=webApp||{}).selectionsAlert=function(){var r,t=$("#betSlipCounter"),i=$(".betSlipMainCounter"),e=function(e,t){s(t.selectionAmount)},s=function(e){0!=e?webApp.HorseDetailsController?t.html(e).show():($(".betSlipSideCounter").html(e).show(),i.html(e).show()):n()},n=function(){webApp.HorseDetailsController?t.hide():($(".betSlipSideCounter").hide(),i.hide())};return{init:function(){rp.betting.SelectionsCollection.instance().bind(rp.betting.SelectionsCollection.EVENT_SELECTION_ADDED,e,this),rp.betting.SelectionsCollection.instance().bind(rp.betting.SelectionsCollection.EVENT_SELECTION_REMOVED,e,this)},showTextMessage:function(e){this.hideAlert();var t='<div id="selectionsAlert" data-test-selector="selectionsAlert">'+e+"</div>";webApp.HorseDetailsController?$("body").append(t):$("#webApp").append(t),r=setTimeout($.proxy(function(){this.hideAlert()},this),1500)},show:function(e){if(void 0!==e){this.hideAlert();var t='<h5 data-test-selector="selectionsAlertCount">'+e+"</h5><h6>Selections in<br/>your Bet Slip</h6>";this.showTextMessage(t)}},hideAlert:function(){$("#selectionsAlert").length&&(clearTimeout(r),$("#selectionsAlert").remove())},hideCounter:function(){n()},setCounter:function(e){s(e)}}}(),namespace("rp.betting"),rp.betting.Error=function(e,t,r){this._code=e,this._message=String(t||""),this._data=r},extend(rp.betting.Error,rp.Object,function(e,t){e.MESSAGE_INSUFFICIENT_FUNDS="Unfortunately we are unable to place your bet as you have insufficient funds in your account. Simply visit the Account tab on the Bet Slip to top up.",this._code=null,this.property("code",{set:!0}),this._message="",this.property("message",{set:!0}),this._data=null,this.property("data",{set:!0})}),namespace("rp.betting"),rp.betting.Command=function(e,t){this._name=e,this._data=t,this._settings={}},extend(rp.betting.Command,rp.EventTarget,function(e,t){this.EVENT_CALL="call",this.EVENT_SUCCESS="success",this.EVENT_ERROR="error",this.EVENT_ABORT="abort",this.EVENT_COMPLETE="complete",this.EVENT_TIMEOUT="timeout",this.STATUS_CALL="call",this.STATUS_ABORT="abort",this.STATUS_TIMEOUT="timeout",this.STATUS_SUCCESS="success",this.STATUS_ERROR="error",this._xhr=null,this.property("xhr",{set:!0}),this._name=null,this.property("name"),this._data=null,this.property("data",{set:!0}),this._settings=null,this.property("settings",{set:function(e){$.extend(this._settings,e)}}),this._status=null,this.property("status",{set:!0}),this._result=null,this.property("result",{set:!0}),this.event(this.EVENT_SUCCESS),this.event(this.EVENT_TIMEOUT).event(this.EVENT_ERROR).event(this.EVENT_COMPLETE),this._success=function(e,t){this.status(t||this.STATUS_SUCCESS).result(e).success(this.result())},this._error=function(e,t,r){this.status(t||this.STATUS_ERROR),this.isTimeout()?this.timeout():this.isAborted()||(t=e.status||t,this.result(new rp.betting.Error(t,r)).error(this.result(),e))},this._complete=function(){this._xhr=null,this.complete()},this.event(this.EVENT_CALL,{get:function(){var e=this.data();if(this.trigger(this.EVENT_CALL,e)){$.extend(this._settings,{success:$.proxy(this._success,this),error:$.proxy(this._error,this),complete:$.proxy(this._complete,this)});var t=$.extend({},this.settings()),r=String(t.type||"get").toLowerCase(),i=t.proxy?t.proxy:jQuery;"post"!==r||jQuery.isEmptyObject(e)||(e=JSON.stringify(e)),t.data=e,delete t.proxy,this.status(this.STATUS_CALL).result(null),this._xhr=i.ajax(t)}}}),this.event(this.EVENT_ABORT,{get:function(){this.status(this.STATUS_ABORT),this.trigger(this.EVENT_ABORT)&&this._xhr&&this._xhr.abort&&this._xhr.abort()}}),this.isCalled=function(){return this._status===this.STATUS_CALL},this.isAborted=function(){return this._status===this.STATUS_ABORT},this.isTimeout=function(){return this._status===this.STATUS_TIMEOUT},this.isSuccess=function(){return this._status===this.STATUS_SUCCESS}}),namespace("rp.betting"),rp.betting.Queue=function(e){this._commands=[];for(var t=0,r=arguments.length;t<r;t++)this.add(arguments[t])},extend(rp.betting.Queue,rp.betting.Command,function(e,t){function r(e){var t=e.target;this.status(t.status()).result(t.result()).progress(this.result()).next()}function i(e){var t=e.target;this.status(t.status()).result(t.result()).error()}function s(e){var t=e.target;this.status(t.status()).timeout()}function n(e){var t=e.target;t.unbind(t.EVENT_SUCCESS,r,this).unbind(t.EVENT_ERROR,i,this).unbind(t.EVENT_TIMEOUT,s,this).unbind(t.EVENT_COMPLETET,n,this)}this.EVENT_PROGRESS="progress",this.property("count",{get:function(){return this._commands.length}}),this._settings=null,this.property("settings",{set:!0}),this._current=null,this.property("current",{get:function(){return this._commands[this._current]},set:function(e){e instanceof rp.betting.Command&&this._commands.splice(this._current,0,e)}}),this.event(this.EVENT_PROGRESS),this.event(this.EVENT_CALL,{get:function(){this.trigger(this.EVENT_CALL)&&(this._current=-1,this.result(null).next())}}),this.event(this.EVENT_ABORT,{get:function(){this.trigger(this.EVENT_ABORT,this)&&(this.status(this.STATUS_ABORT),this.current().abort())}}),this.add=function(e){if(!(e instanceof rp.betting.Command))throw new TypeError("Instance of rp.betting.Command expected.");return this._commands.push(e),this},this.proceed=function(){var e=this.current();this.status(this.STATUS_CALL),e&&e.settings(this.settings()).success(r,this).error(i,this).timeout(s,this).complete(n,this).call()},this.next=function(){if(this._current++,this._current<this.count())this.proceed();else{var e=this.result();this.status(this.STATUS_SUCCESS).success(e).complete(e)}}}),namespace("rp.betting"),rp.betting.Provider=function(){if(this.constructor===rp.betting.Provider)throw new Error("Can not instantiate abstract class rp.betting.Provider.");rp.betting.Provider.$super.apply(this,arguments),this.init()},extend(rp.betting.Provider,rp.EventTarget,function(e,t){e.PROVIDER_NAME="abstract",e.EVENT_USER_HAS_SELECTED_ACTIVE_PROVIDER="eventUserHasSelectedActiveProvider",this.EVENT_LOGIN="login",this.EVENT_LOGOUT="logout",this.KEY_USER="user",this.event("login").event("logout"),this.id=function(){return this.constructor.PROVIDER_NAME};var r=rp.betting.Bet.TYPE;for(var i in this.BET_TYPES={SGL:r.SINGLE,DBL:r.DOUBLE,TBL:r.TREBLE,ACC4:r.FOURFOLD,ACC5:r.FIVEFOLD,ACC6:r.SIXFOLD,ACC7:r.SEVENFOLD,ACC8:r.EIGHTFOLD,ACC9:r.NINEFOLD,AC10:r.TENFOLD,TRX:r.TRIXIE,GOL:r.GOLIATH,PAT:r.PATENT,YAN:r.YANKEE,HNZ:r.HEINZ,SHNZ:r.SUPER_HEINZ,CAN:r.CANADIAN,L15:r.LUCKY_15,L31:r.LUCKY_31,L63:r.LUCKY_63},this.BET_CODES={},this.BET_TYPES)this.BET_CODES[this.BET_TYPES[i]]=i;this.getBetType=function(e){var t=0;return e=String(e),this.BET_TYPES.hasOwnProperty(e)&&(t=this.BET_TYPES[e]),t},this.getBetTypeCode=function(e){var t=this.BET_CODES;return t[e.type()]||t[r.SINGLE]},this._isReady=!1,this.property("isReady",{set:!0}),this._proxy=null,this.property("proxy",{set:function(e){e instanceof rp.betting.AbstractProxy&&(this._proxy=e)},get:function(){return this._proxy}}),this._timeout=36e5,this.property("timeout",{set:function(e){0<e&&(this._timeout=+e)},get:function(){return this._timeout}}),this._storage=null,this.property("storage",{get:function(){return this._storage||(this._storage=new rp.Storage({name:this.id()+".provider"})),this._storage}}),this.store=function(e,t){var r=this.storage();return 2===arguments.length&&(null!==t?r.setValue(e,t):r.unsetValue(e)),r.getValue(e)},this._user=null,this.property("user",{set:function(e){e instanceof rp.betting.User||(e=null),this._user=e,this.store(this.KEY_USER,this._user)}}),this.property("token",{get:function(){return this._user&&this._user.token()},set:function(e){this._user?this._user.token(e):this.user(new rp.betting.User({token:e})),this.store(this.KEY_USER,this._user)}}),this._settings=null,this.property("settings",{set:!0}),this.isLoggedIn=function(){return null!=this._user},this.init=function(){var e=this.store(this.KEY_USER);e?this.user(new rp.betting.User(e)):this.isReady(!0)},this.login=function(e){},this.getBetSlip=function(e){},this.placeBet=function(e){},this.getBetHistory=function(e){},this.getPaymentDetails=function(){},this.makePayment=function(e){},this.getBookmakerId=function(){return this.settings().bookmakerId||null},this.logout=function(){},this.refreshToken=function(){},this.getBalance=function(){}}),namespace("rp.betting"),rp.betting.PaymentDetails=function(){arguments.callee.$super.apply(this,arguments)},extend(rp.betting.PaymentDetails,rp.Object,function(e,t){this._csc="",this.property("csc",{set:!0}),this._amount=0,this.property("amount",{set:!0}),this._payMethodId=null,this.property("payMethodId",{set:!0}),this._cardNumber=null,this.property("cardNumber",{set:!0}),this._maxDepositAmount=1e3,this.property("maxDepositAmount",{set:!0}),this._minDepositAmount=0,this.property("minDepositAmount",{set:!0}),this.cardNumberWithStars=function(){return String(this._cardNumber||"").replace(/\s/g,"").replace(/(\d+)?(\D+)(\d+)/g,function(e,t,r,i){for(var s=(t=t||"").length+i.length,n=t,a=0;a<16-s;a++)n+="#";var o=(n+=i).split("");return o.splice(12,0," "),o.splice(8,0," "),o.splice(4,0," "),o.join("").replace(/\s/g,"&nbsp;").replace(/#/g,"&bull;")})},e.parse=function(e){var t={};return e&&(t={payMethodId:e.payMethodId,cardNumber:e.cardNumber}),new rp.betting.PaymentDetails(t)},this.toJSON=function(){return this.get("csc","amount","amount","payMethodId","cardNumber")}}),namespace("rp.betting.ladbrokes"),rp.betting.ladbrokes.Error=function(){arguments.callee.$super.apply(this,arguments)},extend(rp.betting.ladbrokes.Error,rp.betting.Error,function(e,t){e.GENERIC_ERROR=-500,e.INVALID_SESSION_TOKEN=1026,e.EXPIRED_SESSION_TOKEN=1027,e.EXPIRED_OR_INVALID_SESSION_TOKEN=1028,e.STATUS_CHANGED=1024,e.PRICE_CHANGED=1025,e.GENERIC_BETSLIP_ERROR=70,e.INSUFFICIENT_FUNDS=1030,e.STAKE_TOO_LOW=1031,e.STAKE_TOO_HIGH=1032,e.CLIENT_UNAUTHORISED=1029,e.API_CLIENT_QUOTA_EXCEEDED=2e3,e.FAKE_SUSPENDED=2,e.NO_RECENT_BETS=3}),namespace("rp.betting.ladbrokes",function(c){c.Command=function(e,t){arguments.callee.$super.call(this,e,t||{})},extend(c.Command,rp.betting.Command,function(a,o){a.CUSTOMER_API="customer-api",a.BETTING_API="betting-api",a.BANKING_API="banking-api",a.SPORTSBOOK_API="sportsbook-api",a.CUSTOMERS=a.CUSTOMER_API+"/customers",a.SPORTSBOOK=a.BETTING_API+"/sportsbook",a.CUSTOMER=a.CUSTOMER_API+"/customer",a.CUSTOMER_LOGOUT=a.CUSTOMER+"/logout",a.CUSTOMER_REFRESH_TOKEN=a.CUSTOMERS,a.CHECK_BETSLIP=a.SPORTSBOOK+"/betslips/check",a.BUILD_BETSLIP=a.SPORTSBOOK+"/build-betslip",a.SUBMIT_BETSLIP=a.SPORTSBOOK+"/submit-betslip",a.BETS=a.SPORTSBOOK+"/bets",a.GET_BALANCE=a.BANKING_API+"/wallets/sportsbook-wallet",a.SELECTIONS_STATUS=a.SPORTSBOOK_API+"/classes/0/types/0/events/0/markets/0/selections/",a.STATUS_LADB_ERROR="ladberror";var t={"BETTING-SELECTION-SUSPENDED":c.Error.STATUS_CHANGED,"LIVE-PRICE-NOT-AVAILABLE":c.Error.STATUS_CHANGED,"BETTING-EVENT-STARTED":c.Error.STATUS_CHANGED,"BETTING-PRICE-CHANGED":c.Error.PRICE_CHANGED,"BETTING-BETSLIP-PROBLEM":c.Error.STATUS_CHANGED,"EXPIRED-OR-MISSING-OR-INVALID-ACCESS-TOKEN":c.Error.EXPIRED_OR_INVALID_SESSION_TOKEN,"EXPIRED-OR-INVALID-ACCESS-TOKEN":c.Error.EXPIRED_OR_INVALID_SESSION_TOKEN,"API-CLIENT-UNAUTHORISED":c.Error.CLIENT_UNAUTHORISED,"SOMETHING-WENT-WRONG":c.Error.GENERIC_ERROR,"INSUFFICIENT-FUNDS":c.Error.INSUFFICIENT_FUNDS,"BETTING-STAKE-TOO-LOW":c.Error.STAKE_TOO_LOW,"BETTING-STAKE-TOO-HIGH":c.Error.STAKE_TOO_HIGH,"API-CLIENT-QUOTA-EXCEEDED":c.Error.API_CLIENT_QUOTA_EXCEEDED};a.getErrorCode=function(e){return t[e]||c.Error.GENERIC_ERROR},this.property("token",{get:function(){return this._xhr&&this._xhr.getResponseHeader("x-update-access-token")}}),this.event(this.EVENT_ERROR,{get:function(e,t){var r,i,s,n=t.responseText;if($.browser?$.browser.msie&&0==t.status&&!n:navigator.userAgent.match(/MSIE/)&&0==t.status&&!n)i={errorCode:"API-CLIENT-QUOTA-EXCEEDED"};else try{i=(r=JSON.parse(n))&&(r.apiError||r.apiWarning)}catch(e){}i&&(s=function(e){var t;$.isArray(e)||(e=[e]);var r=$.map(e,function(e){return a.getErrorCode(e.errorCode)}),i=$.map(e,function(e){return e.errorDescription});return t=0<=$.inArray(c.Error.STATUS_CHANGED,r)?c.Error.STATUS_CHANGED:0<=$.inArray(c.Error.PRICE_CHANGED,r)?c.Error.PRICE_CHANGED:0<=$.inArray(c.Error.INSUFFICIENT_FUNDS,r)?c.Error.INSUFFICIENT_FUNDS:0<=$.inArray(c.Error.STAKE_TOO_LOW,r)?c.Error.STAKE_TOO_LOW:0<=$.inArray(c.Error.STAKE_TOO_HIGH,r)?c.Error.STAKE_TOO_HIGH:r[0],new c.Error(t,i[r.indexOf(t)])}(i))&&this.status(a.STATUS_LADB_ERROR).result(s.data(i)),o.error.call(this,this.result())}}),this.isLadbError=function(){return this._status===a.STATUS_LADB_ERROR},a.create=function(e,t){return new a(e,t)}})}),namespace("rp.betting.ladbrokes",function(v){var e=null,t=0;v.Provider=function(){if(e)return e;e=this,v.Provider.$super.apply(this,arguments)},extend(v.Provider,rp.betting.Provider,function(f,i){rp.betting.Bet.TYPE;var c={};function e(e){var t=e.originalEvent,r={};try{r=JSON.parse(t.data)}catch(e){}var i=r.params||{},s=i.error||i.error_code||"",n=r.event,a=r.namespace||void 0;if(a&&a!=f.PROVIDER_NAME)return!1;switch(n){case this.EVENT_REGISTER:case this.EVENT_ADD_PAYMENT_METHOD:case this.EVENT_PROCESS_LOGIN:case this.EVENT_AUTHENTICATE:s||void 0===i.token?(this.logout(),this.trigger(this.EVENT_LOGOUT,i)):(this.user(new rp.betting.User({login:i.username,token:i.token})),this.token(i.token,1),this.initUser());break;case this.EVENT_DEPOSIT_FUNDS:this.getBalance(),this.trigger(this.EVENT_DEPOSIT_FUNDS,i);break;default:null!=n&&(this.logout(),this.trigger(this.EVENT_LOGOUT,i))}}f.PROVIDER_NAME="LADB",f.FORM_AUTHENTICATE="/forms/authorise-client",f.FORM_DEPOSIT="/forms/deposit-funds",f.FORM_REGISTER="/forms/register-customer",this.EVENT_DEPOSIT_FUNDS="deposit-funds",this.EVENT_ADD_PAYMENT_METHOD="add-payment-method",this.EVENT_AUTHENTICATE="authorise-client",this.EVENT_REGISTER="register-customer",this.EVENT_PROCESS_LOGIN="processLogin",this.event(this.EVENT_DEPOSIT_FUNDS),this.event(this.EVENT_AUTHENTICATE),this.event(this.EVENT_REGISTER),this._url=null,this.property("url",{set:!0}),this._apiVersions=null,this.property("apiVersions",{set:!0}),this._params=null,this.property("params",{set:!0});var s=null;function n(e){var t,r,i=f.instance(),s=e.settings(),n=e.name();$.extend(s,function(e){var t=f.instance(),r=e.name(),i=c[r],s=r,n=t.user(),a=t.apiVersions();if(0===r.indexOf(v.Command.CUSTOMER_API)&&n&&(s=v.Command.CUSTOMERS+"/"+n.login(),r!==v.Command.CUSTOMER&&(s+="/access-tokens/"+n.token())),a)for(var o in a)a.hasOwnProperty(o)&&0===r.indexOf(o)&&(s=a[o]+s);return i||(i={url:String(rp.url(s,t.url()))},r===v.Command.CUSTOMER_LOGOUT&&(i.type="delete")),i}(e)),r=(s.type||"get").toLowerCase(),(t=rp.url(s.url)).params(i.params()),n!==v.Command.BETTING_API&&n!==v.Command.SPORTSBOOK&&n!==v.Command.BANKING_API&&t.param("no-links",1),n===v.Command.CUSTOMER_REFRESH_TOKEN&&t.param("access-token",i.token()),s.headers=$.extend({},s.headers,{Accept:"application/json"}),"get"!==r&&(s.headers=$.extend({},s.headers,{"X-Client-Request-ID":i.getXClientRequestId(),"Content-Type":"application/json;charset=UTF-8"}),i.token()&&(s.headers.Authorization="Bearer "+i.token())),s.url=String(t),s.type=r,e.settings(s)}function a(e,t,r){var i=f.instance();return r=r||{},v.Command.create(e,t).settings({type:r.type||"get",dataType:"json",timeout:i.timeout(),proxy:i.proxy()}).call(function(e){n(e.target)},i).success(function(e){var t=e.target,r=t.result();r.links&&r.links.link&&function(e,t){for(var r,i,s=0,n=t.length;s<n;s++)i=e,"self"!==(r=t[s]).rel&&(i+="/"+r.rel),c[i]={url:r.href,type:r.method}}(t.name(),r.links.link||[])},i)}function g(){return function(e){var t,r=f.instance();t=new rp.betting.Queue;for(var i=0,s=arguments.length;i<s;i++)t.add(arguments[i]);return t.timeout(function(e){e.stopImmediatePropagation(),e.target.proceed()},r).error(function(e){var t=e.target.current();if(t.isLadbError())switch(t.result().code()){case v.Error.INVALID_SESSION_TOKEN:case v.Error.EXPIRED_SESSION_TOKEN:case v.Error.EXPIRED_OR_INVALID_SESSION_TOKEN:case v.Error.API_CLIENT_QUOTA_EXCEEDED:if(t.name()!==v.Command.CUSTOMER_LOGOUT){this.isReady(!0),this.logout();break}}},r),t}.apply(this,arguments).call()}function o(e){var t=f.instance(),o=function(e){for(var t,r,i=[],s=e.getSingleBets(),n=0,a=s.length;n<a;n++)t=s[n],(r=t.selections()[0]).data().isSuspended||i.push(r.id());return i.join()}(e);return a(v.Command.SELECTIONS_STATUS+o).error(function(e){var t=e.target.result();t.code()==v.Error.GENERIC_ERROR&&(t.data(o.split(",")),t.code(v.Error.STATUS_CHANGED))},t).success(function(e){var t,r=e.target,i=r.result(),s=[],n=i&&(i.selection||i.resource.selections.selection);$.isArray(n)||(n=[n]),$.each(n,function(e,t){"Active"==t.selectionStatus&&s.push(t.selectionKey.toString())}),t=$(o.split(",")).not(s).get();var a=new v.Error(v.Error.STATUS_CHANGED,"suspended selections or market suspended");a.data(t),e.stopImmediatePropagation(),r.result(a).error(r,r.result())},t)}function T(i){var e=f.instance();return a(v.Command.GET_BALANCE,{"access-token":i.token(),"no-links":1}).success(function(e){var t=e.target,r=t.result().wallet;i.balance(r.balance).currency(r.currency),t.result(i)},e)}function E(e){for(var t,r=e.freeBets(),i=[],s=0,n=r.length;s<n;s++)(t=r[s]).selected()&&i.push(t.id());return i}function l(e,t){for(var r,i,s,n,a,o,c,l=f.instance(),h=[],u=t?e.getActiveBets():e.getBetsWithStake(),p=0,d=u.length;p<d;p++){s=u[p],r=[];for(var _=0;_<s.selections().length;_++)c={selectionPriceTypeCode:(a=s.selections()[_]).isSP()?"SP":"LP"},a.isSP()||$.extend(c,{numPrice:a.price().num(),denPrice:a.price().den()}),o={selectionKey:a.id(),partNo:1,selectionPrice:c},s.isEachWay()&&a.hasEachWay()&&$.extend(o,{eachWayDetail:{eachWayPlaces:a.eachWay().numberOfPlaces(),eachWayNum:a.eachWay().num(),eachWayDen:a.eachWay().den()}}),i={legSortCode:"SS",part:o,legNo:_+1},r.push(i);n={stakePerLine:t?.12:s.stake(),betTypeCode:l.getBetTypeCode(s),legTypeCode:s.isEachWay()?"E":"W",leg:1==r.length?r[0]:r,redeemPromoKey:t?"":E(s).join(","),betNo:p+1},h.push(n)}return{betslip:{bet:1==h.length?h[0]:h}}}function h(e,t){return $.isArray(e)||(e=[e]),$.map(e,function(e){if(v.Command.getErrorCode(e.errorCode)==t)return e&&e.failureResponseObject&&e.failureResponseObject.failedBetslip&&e.failureResponseObject.failedBetslip.failedBet})}function u(e,t,r){var i,s,n={};$.each(t,function(e,t){n[t.selectionKey]={den:t.denPrice,num:t.numPrice}});for(var a=r?e.getActiveBets():e.getSingleBets(),o=0,c=a.length;o<c;o++){i=a[o];for(var l=0;l<i.selections().length;l++)s=i.selections()[l],n[s.id()]&&(s.data().oldNum=s.price().num(),s.data().oldDen=s.price().den(),s.oldPrice(s.price()),s.price({den:n[s.id()].den,num:n[s.id()].num}))}return e}function p(e,t,r){var i=r?e.getActiveBets():e.getBetsWithStake();return $.each(t,function(e,t){i[t.betNo-1].set({minStake:t.betMinStake,maxStake:t.betMaxStake})}),e}function d(S,e){var t=f.instance();return a(v.Command.CHECK_BETSLIP,l(e||S,!0),{type:"post"}).success(function(e){var t,r,i=e.target,s=i.result().betslip,n=S.getActiveBets(),a=[],o=utils.moment.getSynchronizedToServerNow(this.settings().serverDateDelta,!1),c=s.bet;if($.isArray(c)||(c=[c]),c)for(var l=0,h=c.length;l<h;l++){var u=c[l];n[l].set({minStake:u.betMinStake,maxStake:u.betMaxStake}),t=n[l].freeBets(),r=u.redeemablePromos?u.redeemablePromos.promotion:[],$.isArray(r)||(r=[r]);for(var p=0;p<r.length;p++){var d=r[p],_=moment(d.expiry,utils.moment.FORMAT_FULL_DATETIME_WITH_T),E=d.key,m=!1;if(t)for(var f=0,g=t.length;f<g;f++){var T=t[f];E==T.id()&&(m=T.selected())}o.valueOf()<_.valueOf()&&a.push({id:E,name:d.name,amount:parseFloat(d.amount)||0,expires:_,selected:m})}0<a.length&&n[l].freeBets(a)}i.result(S)},t).error(function(e){var t=e.target.result(),r=t.code();r===v.Error.PRICE_CHANGED&&t.data(u(new rp.betting.BetSlip(S.toJSON()),h(t.data(),r),!0)),r===v.Error.STATUS_CHANGED?t.code(v.Error.FAKE_SUSPENDED):r!==v.Error.STAKE_TOO_LOW&&r!==v.Error.STAKE_TOO_HIGH||t.data(p(S,h(t.data(),r),!0))},t)}function _(S,b){var A=f.instance();function n(e){S.searchCriteria().set({blockNumber:S.searchCriteria().blockNumber()-1});var t=e.bets.bet;if($.isArray(t)||(t=[t]),t&&t.length){var r=[];for(var i in t){var s=t[i],n=new rp.betting.Bet,a=A.getBetType(s.betTypeCode),o=moment(s.betPlacedDateTime,utils.moment.FORMAT_FULL_DATETIME_WITH_T).add("ms",utils.date.timeZoneDiff(A.settings().timeZone));if(n.set({receiptId:s.betReceipt,totalStake:s.totalBetStake,type:a,isEachWay:s.isEachWay,betHistoryEW:s.isEachWay,betReference:s.betKey,betDate:o,isSettled:b,stake:s.stakePerLine}),n.typeName(utils.bet.getBetTypeName(n)),s.betSettlement){var c=parseFloat(s.betSettlement.winnings);n.set({returns:c})}else s.isEachWay&&n.returns(NaN);var l=s.leg,h=[];for(var u in $.isArray(l)||(l=[l]),l){var p=l[u].part;for(var d in $.isArray(p)||(p=[p]),p){var _=p[d],E=new rp.betting.Selection,m=!_.selectionPrice,f=null,g=s.isEachWay?new rp.betting.EachWay:null,T=moment(_.eventName,utils.moment.FORMAT_TIME_24_HOURS).isValid()?moment(_.eventName,utils.moment.FORMAT_TIME_24_HOURS).format(utils.moment.FORMAT_TIME_12_HOURS):moment(_.eventStartDateTime,utils.moment.FORMAT_FULL_ISO_DATE).format(utils.moment.FORMAT_TIME_12_HOURS);m||(f={num:_.selectionPrice.numPrice,den:_.selectionPrice.denPrice}),E.set({id:_.selectionKey,data:{eventDesc:T,marketDesc:_.marketName,selectionDesc:_.selectionName,eventTypeName:_.eventTypeName,eventTime:_.eventStartDateTime,raceId:utils.string.hashCode(_.eventName)+moment(_.eventStartDateTime).unix()},price:f,isSP:m,eachWay:g}),h.push(E)}}n.selections(h),n.isSettled()&&(0<n.returns()?n.label(utils.bet.LABEL_WIN_FULL):n.label(utils.bet.LABEL_LOST_FULL)),r.unshift(n)}S.addBets(r)}}var e=S.searchCriteria(),t={startdate:b?moment.utc().subtract("days",1).format(utils.moment.FORMAT_FULL_ISO_DATE):moment.utc(e.fromDate()).format(utils.moment.FORMAT_FULL_ISO_DATE),enddate:b?moment.utc().format(utils.moment.FORMAT_FULL_ISO_DATE):moment.utc(e.toDate()).format(utils.moment.FORMAT_FULL_ISO_DATE),howmany:e.blockSize(),pagenumber:null!=e.blockNumber()?e.blockNumber():1,select:"default,betReceipt,leg.part.eventTypeName,betTypeCode,leg.part.eventStartDateTime,isEachWay,totalBetStake","access-token":A.token(),"no-links":1};return b&&$.extend(t,{decorator:"settled"}),a(v.Command.BETS,t).success(function(e,t){var r=$.isEmptyObject(t.bets)?0:t.bets.totalBets,i=0!=r&&r<S.searchCriteria().blockSize()+1;if(null==S.totalBlocks()||void 0===S.totalBlocks().settled)if(b){var s=0==S.totalBlocks().opened;$.extend(S.totalBlocks(),{settled:r}),s&&i&&n(t)}else S.set({totalBlocks:{opened:r}}),i&&n(t);else n(t);e.target.result(S)},A).error(function(e){var t=e.target;t.result().code()==rp.betting.ladbrokes.Error.GENERIC_ERROR&&(b?$.extend(S.totalBlocks(),{settled:0}):S.set({totalBlocks:{opened:0}}),e.target.result(S),t.status(1))},A)}function m(S,b){var A=f.instance();var e=S.searchCriteria(),t={startdate:moment.utc(e.fromDate()).format(utils.moment.FORMAT_FULL_ISO_DATE),enddate:moment.utc(e.toDate()).format(utils.moment.FORMAT_FULL_ISO_DATE),howmany:e.blockSize(),pagenumber:null!=e.blockNumber()?e.blockNumber():1,select:"default,betReceipt,leg.part.eventTypeName,betTypeCode,leg.part.eventStartDateTime,isEachWay,totalBetStake","access-token":A.token(),"sort-order":"desc","sort-by":"betPlacedDateTime","no-links":1};return b&&$.extend(t,{decorator:"settled"}),a(v.Command.BETS,t).success(function(e,t){var r=$.isEmptyObject(t.bets)?0:t.bets.totalBets;b?($.extend(S.totalBlocks(),{settled:r}),1===S.searchCriteria().blockNumber()&&(S.totalBlocks().hasOwnProperty("totalSettled")?S.totalBlocks().totalSettled+=r:S.totalBlocks().totalSettled=r)):S.set({totalBlocks:{opened:r}}),0!==r?function(e){var t=e.bets.bet;if($.isArray(t)||(t=[t]),t&&t.length){var r=[];for(var i in t){var s=t[i],n=new rp.betting.Bet,a=A.getBetType(s.betTypeCode),o=moment(s.betPlacedDateTime,utils.moment.FORMAT_FULL_DATETIME_WITH_T).add("ms",utils.date.timeZoneDiff(A.settings().timeZone));if(n.set({receiptId:s.betReceipt,totalStake:s.totalBetStake,type:a,isEachWay:s.isEachWay,betHistoryEW:s.isEachWay,betReference:s.betKey,betDate:o,isSettled:b,stake:s.stakePerLine}),n.typeName(utils.bet.getBetTypeName(n)),s.betSettlement){var c=parseFloat(s.betSettlement.winnings);n.set({returns:c})}else s.isEachWay&&n.returns(NaN);var l=s.leg,h=[];for(var u in $.isArray(l)||(l=[l]),h=[],l){var p=l[u].part;for(var d in $.isArray(p)||(p=[p]),p){var _=p[d],E=new rp.betting.Selection,m=!_.selectionPrice,f=null,g=s.isEachWay?new rp.betting.EachWay:null,T=moment(_.eventName,utils.moment.FORMAT_TIME_24_HOURS).isValid()?moment(_.eventName,utils.moment.FORMAT_TIME_24_HOURS).format(utils.moment.FORMAT_TIME_12_HOURS):moment(_.eventStartDateTime,utils.moment.FORMAT_FULL_ISO_DATE).format(utils.moment.FORMAT_TIME_12_HOURS);m||(f={num:_.selectionPrice.numPrice,den:_.selectionPrice.denPrice}),E.set({id:_.selectionKey,data:{eventDesc:T,marketDesc:_.marketName,selectionDesc:_.selectionName,eventTypeName:_.eventTypeName,eventTime:_.eventStartDateTime,raceId:utils.string.hashCode(_.eventName)+moment(_.eventStartDateTime).unix()},price:f,isSP:m,eachWay:g}),h.push(E)}}n.selections(h),n.isSettled()&&(0<n.returns()?n.label(utils.bet.LABEL_WIN_FULL):n.label(utils.bet.LABEL_LOST_FULL)),r.push(n)}S.addBets(r)}}(t):e.target.status(1),e.target.result(S)},A).error(function(e){var t=e.target;t.result().code()===rp.betting.ladbrokes.Error.GENERIC_ERROR&&(b?$.extend(S.totalBlocks(),{settled:0}):S.set({totalBlocks:{opened:0}}),e.target.result(S),t.status(1))},A)}this.property("token",{set:function(e,t){var r;i.token.call(this,e),this.token()&&t&&(r=t||this.settings().tokenRefreshTime)&&s.interval(r).start()}}),this.init=function(){i.init.call(this),$(window).bind("message.ladbrokes-provider",$.proxy(e,this)),s=rp.timeout().tick(this.refreshToken,this),this.user()&&this.refreshToken().success(function(){this.initUser()},this)},this.getFormApiLink=function(e,t){var r=this.settings(),i=rp.url(e,this.url()),s=e.split("/").pop();return i.params(t).params({locale:"en-GB",client_id:r.apiKey,redirect_uri:r.redirectUrl,state:s}),String(i)},this.getXClientRequestId=function(){return(Number(new Date)+ ++t).toString(36)},this.initUser=function(){var i,e,t=f.instance(),r=t.user();return g(a(v.Command.BETTING_API),a(v.Command.SPORTSBOOK),a(v.Command.BANKING_API),(i=r,e=f.instance(),a(v.Command.CUSTOMER,{"access-token":i.token(),"no-links":1}).success(function(e){var t=e.target,r=t.result().customer;t.result(i.set({title:r.title,firstName:r.firstName,userIdentifier:r.customerKey,currency:r.preferredCurrency}))},e)),T(r)).success(function(e){this.isReady(!0),this.user(e.target.result()).trigger(this.EVENT_LOGIN,r)},t)},this.getBetSlip=function(s){if(s instanceof rp.betting.BetSlip){return g(d(s)).error(function(e){var t=e.target,r=t.result(),i=r.code();i===v.Error.PRICE_CHANGED&&(e.stopImmediatePropagation(),t.add(d(s,r.data())).next()),i===v.Error.FAKE_SUSPENDED&&(e.stopImmediatePropagation(),t.add(o(s)).next())},this)}throw new Error("Instance of rp.betting.BetSlip expected.")},this.getSuspendedSelections=function(e){if(e instanceof rp.betting.BetSlip)return g(o(e));throw new Error("Instance of rp.betting.BetSlip expected.")},this.placeBet=function(r){if(r instanceof rp.betting.BetSlip){return g((m=r,e=f.instance(),a(rp.betting.ladbrokes.Command.SUBMIT_BETSLIP,l(m)).success(function(e){var t,r,i=e.target,s=i.result().betslip,n=m.getBetsWithStake(),a=s.bet;if($.isArray(a)||(a=[a]),a)for(var o=0,c=a.length;o<c;o++){var l=a[o];n[o].set({receiptId:l.betReceipt,betDate:(t=l.betPlacedDateTime,r=void 0,r=f.instance(),moment(t,utils.moment.FORMAT_FULL_DATETIME_WITH_T).add("ms",utils.date.timeZoneDiff(r.settings().timeZone)).format(utils.moment.FORMAT_FULL_DATETIME)),betReference:l.betKey,returns:l.potentialPayout}),n[o].typeName(utils.bet.getBetTypeName(n[o]));var h=n[o].selections(),u=a[o].leg;$.isArray(u)||(u=[u]);for(var p=0,d=h.length;p<d;p++){var _=h[p].data(),E=u[p].part.selectionPrice;h[p].data($.extend(_,{selectionDesc:_.selectionDesc||_.horseName,eventTypeName:_.eventTypeName||_.courseName,eventDesc:_.eventDesc||moment(_.time,utils.moment.FORMAT_TIME_24_HOURS).format(utils.moment.FORMAT_TIME_12_HOURS),eventTime:_.eventTime||moment(_.raceDate,utils.moment.FORMAT_DATETIME_STRAIGHT).format(utils.moment.FORMAT_FULL_DATETIME)})),E.denPrice&&E.numPrice&&h[p].price({den:E.denPrice,num:E.numPrice})}}i.result(m),g(T(this.user()))},e).error(function(e){var t=e.target.result(),r=t.code();r===v.Error.PRICE_CHANGED&&t.data(u(m,h(t.data(),r))),r===v.Error.STATUS_CHANGED?t.code(v.Error.FAKE_SUSPENDED):r!==v.Error.STAKE_TOO_LOW&&r!==v.Error.STAKE_TOO_HIGH||t.data(p(m,h(t.data(),r)))},e))).error(function(e){var t=e.target;t.result().code()===v.Error.FAKE_SUSPENDED&&(e.stopImmediatePropagation(),t.add(o(r)).next())},this)}throw new Error("Instance of rp.betting.Bet or rp.betting.BetSlip expected.");var m,e},this.logout=function(){if(s.stop(),this.isLoggedIn())return g((this.user(),e=f.instance(),a(v.Command.CUSTOMER_LOGOUT).complete(function(e){this.user(null),this.trigger(this.EVENT_LOGOUT)},e)));var e},this.logoutLite=function(){s.stop(),this.user(null),this.trigger(this.EVENT_LOGOUT)},this.getBalance=function(){if(this.isLoggedIn())return g(T(this.user()))},this.refreshToken=function(){if(this.isLoggedIn())return g((this.user(),e=f.instance(),a(v.Command.CUSTOMER_REFRESH_TOKEN).success(function(e){var t,r=e.target.result(),i=r&&r.accessToken;i&&(t=1e3*(i.expiresIn-120),this.token(i.token,0<t?t:0))},e)));var e},this.getBetHistory=function(h){if(!(h instanceof rp.betting.BetHistory))throw new Error("Instance of rp.betting.BetHistory expected.");function u(e){e=parseInt(e),isNaN(e)&&(e=1),h.searchCriteria().set({blockNumber:e})}var t=h.searchCriteria().blockSize();function p(e){return Math.ceil(e/t)}var e=[];if(h.totalBlocks()&&h.totalBlocks().hasOwnProperty("settled")&&h.totalBlocks().hasOwnProperty("opened")){var r=h.opened(),i=h.totalBlocks().opened,s=h.settled(),n=h.totalBlocks().settled,a=h.searchCriteria().minimumBets();r.length<i?e.push(_(h,!1)):s.length<n&&(0==s.length?(u(p(n)),e.push(_(h,!0)),n%t<a&&(u(p(n)-1),e.push(_(h,!0)),u(p(n)))):e.push(_(h,!0)))}else e.push(_(h,!1),_(h,!0));return g.apply(null,e).success(function(e){var i=e.target,t=0==h.bets().length,s=h.searchCriteria().blockSize(),r=h.totalBlocks()&&h.totalBlocks().hasOwnProperty("settled")&&h.totalBlocks().hasOwnProperty("opened"),n=h.searchCriteria().minimumBets();function a(e,t){var r=e%s;u(p(e)),i.add(_(h,t)),r<n&&0<r&&(u(p(e)-1),i.add(_(h,t)),u(p(e)))}if(r&&t){var o=h.totalBlocks().opened,c=h.totalBlocks().settled;0==o&&0==c?i.complete():(e.stopImmediatePropagation(),0!=o?a(o,!1):a(c,!0),i.proceed())}else{var l=h.bets().length;o=h.totalBlocks().opened,c=h.totalBlocks().settled;l<n&&c&&(e.stopImmediatePropagation(),u(l==o?p(c):p(c)-1),i.add(_(h,!0)),i.proceed())}}).error(function(e){var t=e.target;t.result()instanceof rp.betting.Error||(e.stopImmediatePropagation(),t.next())})},this.getBetHistoryChunks=function(i){if(!(i instanceof rp.betting.BetHistory))throw new Error("Instance of rp.betting.BetHistory expected.");var e=[],s=0;if(i.totalBlocks()&&i.totalBlocks().hasOwnProperty("opened")){var t=i.opened().length;i.bets().length;if(t<i.totalBlocks().opened)i.searchCriteria().set({blockNumber:i.searchCriteria().blockNumber()+1}),e.push(m(i,!1));else{if(i.totalBlocks()&&i.totalBlocks().hasOwnProperty("settled"))i.settled().length<i.totalBlocks().totalSettled?i.searchCriteria().set({blockNumber:i.searchCriteria().blockNumber()+1}):i.searchCriteria().set({toDate:moment(i.searchCriteria().toDate()).subtract("days",this.settings().settledBetsChunksPeriodDays).format(utils.moment.FORMAT_FULL_ISO_DATE),fromDate:moment(i.searchCriteria().fromDate()).subtract("days",this.settings().settledBetsChunksPeriodDays).format(utils.moment.FORMAT_FULL_ISO_DATE),blockNumber:1});else i.searchCriteria().set({toDate:moment().format(utils.moment.FORMAT_FULL_ISO_DATE),fromDate:moment().subtract("days",this.settings().settledBetsChunksPeriodDays).format(utils.moment.FORMAT_FULL_ISO_DATE),blockNumber:1});e.push(m(i,!0))}}else i.searchCriteria().set({fromDate:moment().subtract("months",this.settings().openBetsPeriodMonths).format(utils.moment.FORMAT_FULL_ISO_DATE),toDate:moment().format(utils.moment.FORMAT_FULL_ISO_DATE),blockNumber:1}),e.push(m(i,!1));return g.apply(null,e).success(function(e){}).error($.proxy(function(e){var t=e.target,r=t.current();t.result()instanceof rp.betting.BetHistory&&("settled"!==r.data().decorator?(r._result.searchCriteria().set({toDate:moment().format(utils.moment.FORMAT_FULL_ISO_DATE),fromDate:moment().subtract("days",this.settings().settledBetsChunksPeriodDays).format(utils.moment.FORMAT_FULL_ISO_DATE),blockNumber:1}),t.add(m(i,!0)),e.stopImmediatePropagation(),t.next()):s<this.settings().settledBetsRetryLimit?(r._result.searchCriteria().set({toDate:moment(i.searchCriteria().toDate()).subtract("days",this.settings().settledBetsChunksPeriodDays).format(utils.moment.FORMAT_FULL_ISO_DATE),fromDate:moment(i.searchCriteria().fromDate()).subtract("days",this.settings().settledBetsChunksPeriodDays).format(utils.moment.FORMAT_FULL_ISO_DATE),blockNumber:1}),s++,t.add(m(i,!0)),e.stopImmediatePropagation(),t.next()):t.result(new v.Error(v.Error.NO_RECENT_BETS,"No recent bets")))},this))},f.instance=function(e){return new f(e)},this.checkConnection=function(){return g(a(v.Command.BETTING_API))}})}),namespace("rp.betting"),rp.betting.AbstractProxy=function(){if(this.constructor===arguments.callee)throw new Error("Unable to create instance of abstract class rp.betting.AbstractProxy");$(window).bind("message.proxy",$.proxy(this._handleWindowMessage,this)),this._ajaxes={}},extend(rp.betting.AbstractProxy,rp.Object,function(e,t){this.MESSAGE_READY="ready",this.MESSAGE_REQUEST="request",this.MESSAGE_ABORT="abort",this.MESSAGE_SUCCESS="success",this.MESSAGE_ERROR="error",this.MESSAGE_COMPLETE="complete",this.TEXT_FATAL="Fatal error!",this._ajaxes=null,this._targetWindow=null,this.property("targetWindow",{set:!0}),this.postMessage=function(t,r){var i,e=this.targetWindow();try{i=JSON.stringify({type:t,data:r})}catch(e){t===this.MESSAGE_ERROR&&r.xhr.responseXML&&(delete r.xhr.responseXML,r.xhr.responseText='{"error": "'+this.TEXT_FATAL+'"}'),i=JSON.stringify({type:t,data:r})}e&&e.postMessage(i,"*")},this.getMessageFromEvent=function(e){var t=e.originalEvent,r={};try{r=JSON.parse(t.data)}catch(e){}return r},this._handleWindowMessage=function(e){throw new Error("Unable to call abstract method [object rp.betting.AbstractProxy]._handleWindowMessage.")}}),namespace("rp.betting"),rp.betting.LocalProxy=function(e){arguments.callee.$super.call(this,utils.string.url(e).origin),this._proxyUrl=e},extend(rp.betting.LocalProxy,rp.betting.AbstractProxy,function(e,t){var r=!1;this.property("targetWindow",{get:function(){if(!this._targetWindow){var e=$("<iframe />").appendTo($("<div />").appendTo(document.body).width(0).height(0).attr("id","rp-betting-proxy-container").css("overflow","hidden")).attr("src",this._proxyUrl);this._targetWindow=e[0].contentWindow}return this._targetWindow}}),this._sendRequestMessage=function(e,t){this.postMessage(this.MESSAGE_REQUEST,{id:e,settings:t})},this._sendAbortMessage=function(e){this.postMessage(this.MESSAGE_ABORT,{id:e})},this._handleReadyMessage=function(){for(var e in r=!0,this._ajaxes)this._sendRequestMessage(e,this._ajaxes[e])},this._handleSuccessMessage=function(e){var t=this._ajaxes[e.id];t&&$.isFunction(t.success)&&t.success(e.data,e.textStatus,e.xhr)},this._handleErrorMessage=function(e){var t=this._ajaxes[e.id];t&&$.isFunction(t.error)&&t.error(e.xhr,e.textStatus)},this._handleCompleteMessage=function(e){var t=this._ajaxes[e.id];t&&$.isFunction(t.complete)&&t.complete(e.xhr,e.textStatus),delete this._ajaxes[e.id]},this._handleWindowMessage=function(e){var t=this.getMessageFromEvent(e);switch(t.type){case this.MESSAGE_READY:this._handleReadyMessage();break;case this.MESSAGE_SUCCESS:this._handleSuccessMessage(t.data);break;case this.MESSAGE_ERROR:this._handleErrorMessage(t.data);break;case this.MESSAGE_COMPLETE:this._handleCompleteMessage(t.data)}},this._abort=function(e){e in this._ajaxes&&this._sendAbortMessage(e)},this._getAbort=function(e){return $.proxy(function(){this._abort(e)},this)},this.ajax=function(e){var t=rp.Object.uid();return this.targetWindow(),this._ajaxes[t]=e,r&&this._sendRequestMessage(t,e),{abort:this._getAbort(t)}}}),namespace("rp.betting"),rp.betting.RemoteProxy=function(e){if(arguments.callee._instance)return arguments.callee._instance;arguments.callee._instance=this,arguments.callee.$super.call(this),this._targetWindow=e},extend(rp.betting.RemoteProxy,rp.betting.AbstractProxy,function(e,t){this._sendReadyMessage=function(){this.postMessage(this.MESSAGE_READY)},this._sendSuccessMessage=function(e,t,r,i){this.postMessage(this.MESSAGE_SUCCESS,{id:e,xhr:t,textStatus:r,data:i})},this._sendErrorMessage=function(e,t,r){this.postMessage(this.MESSAGE_ERROR,{id:e,xhr:t,textStatus:r})},this._sendCompleteMessage=function(e,t,r){this.postMessage(this.MESSAGE_COMPLETE,{id:e,xhr:t,textStatus:r})},this._requestAjax=function(e,t){var r=$.extend({},e,t);return $.ajax(r)},this._handleRequestMessage=function(i){i&&i.id&&(this._ajaxes[i.id]=this._requestAjax(i.settings,{success:$.proxy(function(e,t,r){this._sendSuccessMessage(i.id,r,t,e)},this),error:$.proxy(function(e,t){this._sendErrorMessage(i.id,e,t)},this),complete:$.proxy(function(e,t){this._sendCompleteMessage(i.id,e,t),delete this._ajaxes[i.id]},this)}))},this._handleAbortMessage=function(e){var t=e.id;this._ajaxes.hasOwnProperty(t)&&this._ajaxes[t].abort()},this._handleWindowMessage=function(e){var t=this.getMessageFromEvent(e);switch(t.type){case this.MESSAGE_REQUEST:this._handleRequestMessage(t.data);break;case this.MESSAGE_ABORT:this._handleAbortMessage(t.data)}},this.ready=function(){this._sendReadyMessage()}}),namespace("rp.betting"),rp.betting.ServerProxy=function(e){if(arguments.callee._instance)return arguments.callee._instance;arguments.callee._instance=this,arguments.callee.$super.call(this),this._targetWindow=e},extend(rp.betting.ServerProxy,rp.betting.RemoteProxy,function(e,i){this._url=null,this.property("url",{set:!0}),this._requestAjax=function(e,t){var r=$.extend({},{type:"POST",url:this.url(),dataType:"json",data:{request:e}});return i._requestAjax.apply(this,[r,t])}}),namespace("rp.betting.mint"),rp.betting.mint.Error=function(){arguments.callee.$super.apply(this,arguments)},extend(rp.betting.mint.Error,rp.betting.Error,function(e,t){e.GENERIC_ERROR=-100,e.INVALID_BACK_END_REQUEST=-3,e.INVALID_SESSION_TOKEN=10071,e.EXPIRED_SESSION_TOKEN=-21,e.EXPIRED_OR_INVALID_SESSION_TOKEN=106,e.USERNAME_NOT_FOUND=21,e.INCORRECT_PASSWORD=22,e.MONTH_6_SELF_EXCLUSION=23,e.HOUR_24_SELF_EXCLUSION=24,e.ACCOUNT_NOT_ACTIVE=25,e.ACCOUNT_LOCKED=27,e.NO_BETS_FOUND=35,e.PAYMENT_AUTHORISATION_FAILED=51,e.TOP_UP_AMOUNT_LESS_THAN_MINIMUM=52,e.INVALID_CSC_CV2_NUMBER=53,e.DAILY_DEPOSIT_LIMIT=54,e.NO_CARD_DETAILS_REGISTERED=67,e.PAYMENT_AUTHORISATION_FAILED_2=24005,e.POCF_NOT_ACCEPTED=24015,e.GENERIC_BETSLIP_ERROR=70,e.BETSLIP_CONTAINS_DELAYS=71,e.INSUFFICIENT_FUNDS=63,e.STAKE_TOO_LOW=64,e.STAKE_TOO_HIGH=66,e.STATUS_CHANGED=1024,e.PRICE_CHANGED=1025,e.MISSING_REQUEST_PARAMETER=10070,e.INVALID_REQUEST_PARAMETER=10071,e.NONE_DOC_OXI_XML_ERROR="Call to OxiXml failed."}),namespace("rp.betting.mint"),rp.betting.mint.Command=function(e,t){arguments.callee.$super.call(this,e,t||{})},extend(rp.betting.mint.Command,rp.betting.Command,function(s,n){var a=rp.betting.mint;function o(e){var t=0,r=$.map(e,function(e){if("10071"!==e.faultCode)return s.determineErrorCode(e.faultCode);switch(e.faultName){case"who-ticket":return s.determineErrorCode(e.faultCode);case"status":return a.Error.INVALID_REQUEST_PARAMETER;default:return a.Error.GENERIC_ERROR}}),i=$.map(e,function(e){return e.faultString});return t=0<=$.inArray(a.Error.STATUS_CHANGED,r)?a.Error.STATUS_CHANGED:0<=$.inArray(a.Error.PRICE_CHANGED,r)?a.Error.PRICE_CHANGED:0<=$.inArray(a.Error.INSUFFICIENT_FUNDS,r)?a.Error.INSUFFICIENT_FUNDS:0<=$.inArray(a.Error.STAKE_TOO_LOW,r)?a.Error.STAKE_TOO_LOW:0<=$.inArray(a.Error.STAKE_TOO_HIGH,r)?a.Error.STAKE_TOO_HIGH:0<=$.inArray(a.Error.PAYMENT_AUTHORISATION_FAILED_2,r)?a.Error.PAYMENT_AUTHORISATION_FAILED_2:r[0],new a.Error(t,i[r.indexOf(t)])}MINT_SUCCESS=1,s.SESSIONS_API="sessions",s.ACCOUNTS_API="accounts",s.BETSLIPS_API="betslips",s.BETS_API="bets",s.WALLETS_API="wallets",s.AUTHENTICATE_ACCOUNT=s.SESSIONS_API+"/tickets",s.LOGOUT=s.SESSIONS_API+"/tickets/",s.GET_ACCOUNT_DETAILS=s.ACCOUNTS_API+"/me",s.GET_BALANCE=s.ACCOUNTS_API+"/me/balance",s.GET_BET_SLIP=s.BETSLIPS_API+"/me",s.PLACE_BET=s.BETS_API+"/me/multiples",s.VIEW_BET_HISTORY=s.BETS_API+"/me",s.GET_CARD_PAYMENT_DETAILS=s.WALLETS_API+"/me/methods",s.MAKE_CARD_PAYMENT=s.WALLETS_API+"/me",s.ACCEPT_POCF=s.ACCOUNTS_API+"/me/flags",this.STATUS_MINT_ERROR="minterror",s.ERROR_CODES={25023:a.Error.GENERIC_ERROR,23023:a.Error.GENERIC_ERROR,25020:a.Error.PRICE_CHANGED,23020:a.Error.PRICE_CHANGED,25022:a.Error.STATUS_CHANGED,23022:a.Error.STATUS_CHANGED,25021:a.Error.STATUS_CHANGED,23021:a.Error.STATUS_CHANGED,25024:a.Error.STATUS_CHANGED,23024:a.Error.STATUS_CHANGED,23011:a.Error.STAKE_TOO_LOW,23012:a.Error.STAKE_TOO_HIGH,23010:a.Error.INSUFFICIENT_FUNDS,10071:a.Error.INVALID_SESSION_TOKEN,2e4:a.Error.USERNAME_NOT_FOUND,20010:a.Error.INCORRECT_PASSWORD,24e3:a.Error.NO_CARD_DETAILS_REGISTERED,10070:a.Error.MISSING_REQUEST_PARAMETER,24015:a.Error.POCF_NOT_ACCEPTED,24005:a.Error.PAYMENT_AUTHORISATION_FAILED_2},s.determineErrorCode=function(e){return s.ERROR_CODES[e]||a.Error.GENERIC_ERROR},this.property("token",{get:function(){if(this.isSuccess())return this.result().token||null},set:function(e){var t=this.name(),r=this.data();t===s.VIEW_BET_HISTORY&&r&&r.searchCriteria?r.searchCriteria.token=e:t!==s.AUTHENTICATE_ACCOUNT&&t!==s.ADDRESS_LOOKUP&&r&&(r.token=e)}}),this.event(this.EVENT_SUCCESS,{get:function(){var e,t=this.result();t&&1!==t.statusCode&&(e=t.whoFaults||!!t.whoBetslips&&t.whoBetslips.whoFaults||!!t.whoBets&&t.whoBets.whoFaults||!1),e?this.status(this.STATUS_MINT_ERROR).result(o(e).data(t)).error(t):n.success.apply(this,arguments)}}),this.event(this.EVENT_ERROR,{get:function(e,t){if(t){var r=t.responseText,i=!1,s=null;r&&(s=JSON.parse(r))&&1!==s.statusCode&&(i=s.whoFaults||!1),this.status(this.STATUS_MINT_ERROR).result(o(i).data(s))}n.error.apply(this,this.result())}}),this.isMintError=function(){return this._status===this.STATUS_MINT_ERROR},s.create=function(e,t){return new s(e,t)}}),namespace("rp.betting.mint"),rp.betting.mint.Provider=function(){if(arguments.callee._instance)return arguments.callee._instance;arguments.callee._instance=this,arguments.callee.$super.apply(this,arguments)},extend(rp.betting.mint.Provider,rp.betting.Provider,function(l,e){var p=rp.betting.mint,s=(rp.betting.Bet.TYPE,p.Command);l.PROVIDER_NAME="WH_OXI",l.ACCEPTED_POCF_URL_PARAMS="?pocf=A",this._url=null,this.property("url",{set:!0}),this._params=null,this.property("params",{set:!0}),this.property("user",{set:function(e){e instanceof rp.betting.User||(e=null),this._user=e,this.store(this.KEY_USER,this._user)}});function n(e,t){var r=l.instance();new Date;return s.create(e,$.extend({},t,r.params())).settings({url:r.url()+e,proxy:r.proxy(),type:"POST",dataType:"json",jsonp:null,jsonpCallback:null,timeout:r.timeout(),cache:!1}).call(function(e){!function(e){var t,r,i=l.instance(),s=e.settings(),n=e.name();switch(r=s.type.toLowerCase(),t=rp.url(s.url),n){case p.Command.GET_ACCOUNT_DETAILS:case p.Command.GET_BALANCE:case p.Command.VIEW_BET_HISTORY:case p.Command.GET_CARD_PAYMENT_DETAILS:r="get";break;case p.Command.LOGOUT:r="delete",t.path(t.path()+i.token());break;case p.Command.ACCEPT_POCF:r="put",t.path(t.path()+l.ACCEPTED_POCF_URL_PARAMS)}if(n==p.Command.FLAG&&(r="PUT"),s.headers=$.extend({},s.headers,{Accept:"application/json"}),i.token()&&n!==p.Command.LOGOUT&&(s.headers=$.extend({},s.headers,{"who-ticket":i.token()})),"get"!==r){var a="application/json";n!==p.Command.AUTHENTICATE_ACCOUNT&&n!=p.Command.MAKE_CARD_PAYMENT||(a="application/x-www-form-urlencoded"),s.headers=$.extend({},s.headers,{"Content-Type":a})}s.url=String(t),s.type=r,e.settings(s)}(e.target)},r)}function a(e){for(var t=l.instance(),r=new rp.betting.Queue,i=0,s=arguments.length;i<s;i++)r.add(arguments[i]);return r.error(function(e){var t=e.target.current();if(t.isMintError())switch(t.result().code()){case p.Error.INVALID_BACK_END_REQUEST:if(t.result().message()!=p.Error.NONE_DOC_OXI_XML_ERROR)break;case p.Error.INVALID_SESSION_TOKEN:case p.Error.EXPIRED_SESSION_TOKEN:case p.Error.EXPIRED_OR_INVALID_SESSION_TOKEN:t.name()!==p.Command.LOGOUT&&(this.isReady(!0),this.logout())}},t).timeout(function(e){e.stopImmediatePropagation(),e.target.proceed()},t),r}function f(){return a.apply(this,arguments).call()}function o(r,i){var e=l.instance();var t={username:r.login(),password:encodeURIComponent(i)};return n(s.AUTHENTICATE_ACCOUNT,t).success(function(e){i;var t=e.target.result();this.token(t.whoSessions.ticket),r.token(t.whoSessions.ticket),e.target.result(r)},e)}function c(a){var e=l.instance();return n(s.GET_ACCOUNT_DETAILS).success(function(e){var t=e.target,r=t.result().whoAccounts.account,i=null;if(r.flags&&0<r.flags.length)for(var s=0;s<r.flags.length;s++){var n=r.flags[s];n.hasOwnProperty("pocf")&&(i=n.pocf)}t.result(a.set({title:r.title,firstName:r.firstName,userIdentifier:r.accountId,pocf:i}))},e)}function g(i){var e=l.instance();return n(s.GET_BALANCE).success(function(e){var t=e.target,r=t.result().whoAccounts.account;t.result(i.set({balance:r.balance,currency:r.currencyCode})),l.instance().user(i)},e)}function h(){var e=l.instance();return n(s.LOGOUT).success(function(e){this.token(null),this.user().token(null)},e)}function r(p,d){var _=l.instance(),e=p.searchCriteria();return n(s.VIEW_BET_HISTORY,{fromDateTime:moment(e.fromDate()).sod().format(utils.moment.FORMAT_FULL_DATETIME),toDateTime:moment(e.toDate()).eod().format(utils.moment.FORMAT_FULL_DATETIME),blockSize:e.blockSize(),blockNum:null!=e.blockNumber()?e.blockNumber():0,sortOrder:d?"A":"D",settled:"A"}).success(function(e,t){!function(e){if(0!=($.isEmptyObject(e.whoBets)?0:e.whoBets.bet.length))if(d)p.lastBetId(e.whoBets.bet[0].betId);else{var t=p.searchCriteria().blockNumber()+1;p.searchCriteria().set({blockNumber:t});var r=[];for(var i in e.whoBets.bet){var s=e.whoBets.bet[i],n=new rp.betting.Bet,a=s.leg[0].legType==utils.bet.LABEL_EACHWAY_SHORT,o=_.getBetType(s.betTypeCode),c=(s.betTypeName,null);for(var l in n.set({betReference:s.betId,betDate:moment(s.transDateTime,utils.moment.FORMAT_FULL_DATETIME).format(utils.moment.FORMAT_FULL_DATETIME),receiptId:s.receipt,isSettled:"Y"===s.settled,totalStake:parseFloat(s.stake),stake:parseFloat(s.stakePerLine),type:o,isEachWay:a,betHistoryEW:a}),n.typeName(utils.bet.getBetTypeName(n)),n.isSettled()?c=parseFloat(s.winnings):0<parseFloat(s.estimatedReturns)&&(c=parseFloat(s.estimatedReturns)),null!=c&&n.returns(c),a&&null==c&&n.returns(NaN),s.leg){var h=s.leg[l].part[0],u=a?new rp.betting.EachWay:null;n.selection(new rp.betting.Selection({id:h.outcomeId,data:{eventTypeDesc:h.eventTypeDescription,eventDesc:h.eventDescription,marketDesc:h.eventMarketDescription,selectionDesc:h.description,startDateTime:moment(h.startDateTime,utils.moment.FORMAT_FULL_DATETIME).format(utils.moment.FORMAT_TIME_12_HOURS),raceId:("r"+h.eventTypeDescription+h.startDateTime).replace(/\W/g,"")},isSP:"S"==h.priceType,price:"S"!==h.priceType&&{num:h.priceNum,den:h.priceDen},eachWay:u}))}n.isSettled()&&(0<n.returns()?n.label(utils.bet.LABEL_WIN_FULL):n.label(utils.bet.LABEL_LOST_FULL)),r.push(n)}p.addBets(r)}}(t),e.target.result(p)},_)}function t(A){var v=l.instance();return n(s.GET_BET_SLIP,{whoBetslips:{leg:function(e){for(var t,r,i,s=[],n=e.getSingleBets(),a=0,o=n.length;a<o;a++)if(t=n[a],!(r=t.selections()[0]).data().isSuspended){var c={outcomeId:r.id(),status:"A",priceType:r.isSP()?"S":"L",includeInMultiple:r.data().includeInMultiple};if(!r.isSP()){var l=r.price();$.extend(c,{priceNum:l.num(),priceDen:l.den()})}i={legType:t.isEachWay()?utils.bet.LABEL_EACHWAY_SHORT:utils.bet.LABEL_WIN_SHORT,part:c},s.push(i)}return s}(A)}}).success(function(e){var t,r,i,s=e.target,n=s.result().whoBetslips.bet,a=[],o=utils.moment.getSynchronizedToServerNow(v.settings().serverDateDelta);if(n){for(var c=0,l=n.length;c<l;c++)if(t=n[c],i=v.getBetType(t.betTypeCode),a.push(i),0!==i){(r=i==rp.betting.Bet.TYPE.SINGLE?A.getBetBySelectionId(t.leg[0].part[0].outcomeId):A.getBetByType(i)).set({minStake:t.minStake,maxStake:t.maxStake});for(var h=t.freeBet||[],u=[],p=r.freeBets(),d=0;d<h.length;d++){var _=h[d],E=moment(_.expiryDateTime,utils.moment.FORMAT_FULL_DATETIME),m=!1,f=_.freebetId;if(o.valueOf()<E.format(utils.moment.FORMAT_FULL_DATETIME)){if(p)for(var g=0,T=p.length;g<T;g++){var S=p[g];f==S.id()&&(m=S.selected())}u.push({id:f,name:_.offerName,amount:parseFloat(_.value)||0,expires:E,selected:m})}}r.freeBets(u)}var b=[];$.each(A.bets(),function(e,t){$.inArray(t.type(),a)<0&&b.unshift(e)}),$.each(b,function(e,t){A.bets().splice(t,1)})}s.result(A)},v).error(function(e){var t=e.target,r=t.result(),i=r.code(),s=r.data();i!==p.Error.PRICE_CHANGED&&i!==p.Error.STATUS_CHANGED||(s.statusCode=1,e.stopImmediatePropagation(),t.result(s).success(s))},v)}function i(E){var m=l.instance();var e={whoBets:{bet:function(e){for(var t,r,i,s=[],n=e.getBetsWithStake(),a=0,o=n.length;a<o;a++){var c=n[a];s.push((t=c,r=a+1,i=void 0,i=l.instance(),{betNum:r,betTypeCode:i.getBetTypeCode(t),stake:parseFloat(t.stake()).toFixed(2),freeBetId:function(e){for(var t,r=e.freeBets(),i="",s=0,n=r.length;s<n;s++)(t=r[s]).selected()&&(i=t.id());return i}(t),leg:function(e){for(var t,r,i=e.selections(),s=[],n=0,a=i.length;n<a;n++){var o={outcomeId:(t=i[n]).id(),status:"A",priceType:t.isSP()?"S":"L",includeInMultiple:t.data().includeInMultiple};if(!t.isSP()){var c=t.price();$.extend(o,{priceNum:c.num(),priceDen:c.den()})}r={legType:e.isEachWay()?utils.bet.LABEL_EACHWAY_SHORT:utils.bet.LABEL_WIN_SHORT,part:o},s.push(r)}return s}(t)}))}return s}(E)}};return n(s.PLACE_BET,e).success(function(e){var t=e.target.result().whoBets.betPlaced,r=E.getBetsWithStake();if(t)for(var i=0;i<t.length;i++){var s=t[i],n=r[i],a=n.selections(),o=s.betReceipt,c=s.betId,l=s.totalStake,h=moment().add("ms",utils.date.timeZoneDiff(m.settings().timeZone)).format(utils.moment.FORMAT_FULL_DATETIME);s.placedDateTime&&(h=moment(s.placedDateTime,utils.moment.FORMAT_FULL_DATETIME).add("ms",utils.date.timeZoneDiff(m.settings().timeZone)).format(utils.moment.FORMAT_FULL_DATETIME)),n.set({receiptId:o,betReference:c,betDate:h,totalStake:parseFloat(l),typeName:utils.bet.getBetTypeName(n)});for(var u=0,p=a.length;u<p;u++){data=a[u].data();var d=data.courseName,_=(data.time?moment(data.time,utils.moment.FORMAT_TIME_24_HOURS).format(utils.moment.FORMAT_TIME_12_HOURS):"")+" "+d;a[u].data($.extend(data,{selectionDesc:data.selectionDesc||data.horseName,eventDesc:data.eventDesc||_}))}}e.target.result(E),f(g(this.user()))},m).error(function(e){var t,r,s,n,a,i,o,c,l=e.target.result(),h=l.code(),u=l.data();h===p.Error.PRICE_CHANGED&&l.data(function(e,t,r){var i,s,n=$.map(t,function(e){if(r.faultCode===e.faultCode)return e.solution}),a={};$.each(n,function(e,t){a[t.outcomeId]={den:t.priceDen,num:t.priceNum}});for(var o=e.getSingleBets(),c=0,l=o.length;c<l;c++){i=o[c];for(var h=0;h<i.selections().length;h++)s=i.selections()[h],a[s.id()]&&(s.data().oldNum=s.price().num(),s.data().oldDen=s.price().den(),s.oldPrice(s.price()),s.price({den:a[s.id()].den,num:a[s.id()].num}))}return e}(E,u.whoBets.whoFaults,{faultCode:"23020"})),h===p.Error.STATUS_CHANGED?l.data((i=u.whoBets.whoFaults,o=["23021","23022","23024"],c=[],$.each(i,function(e,t){-1<$.inArray(t.faultCode.toString(),o)&&$.inArray(t.solution.outcomeId,c)<0&&c.push(t.solution.outcomeId)}),c)):h!==p.Error.STAKE_TOO_LOW&&h!==p.Error.STAKE_TOO_HIGH||l.data((t=E,r=u.whoBets.whoFaults,s=["23011","23012"],a=t.getBetsWithStake(),$.each(r,function(e,t){if(-1<$.inArray(t.faultCode.toString(),s)){n=a[t.solution.betNum-1];var r=t.solution.minStake||0,i=t.solution.maxStake||Number.POSITIVE_INFINITY;n.set({minStake:n.minStake()||r,maxStake:n.maxStake()!=Number.POSITIVE_INFINITY?n.maxStake():i})}}),t))},m)}this.init=function(){var e=this.store(this.KEY_USER);if(e){var t=!1;for(var r in e){t=!0;break}t&&(void 0!==e.pocf?(this.user(new rp.betting.mint.User(e)),this.getBalance()):(this.store(this.KEY_USER,{}),this.init()))}this.isReady(!0)},this.login=function(e,t){function r(e){this.user(e.target.result()).trigger(this.EVENT_LOGIN,this.user())}var i=new rp.betting.mint.User({login:e});return this.user()?a(h(),o(i,t),c(i),g(i)).success(r,this).call():a(o(i,t),c(i),g(i)).success(r,this).call()},this.logout=function(){return a(h()).success(function(e){this.user(null).trigger(this.EVENT_LOGOUT)},this).call()},this.logoutLite=function(){this.logout()},this.getBetSlip=function(e){if(e instanceof rp.betting.BetSlip)return a(t(e)).call();throw new Error("Instance of rp.betting.BetSlip expected.")},this.placeBet=function(e){if(e instanceof rp.betting.BetSlip)return a(i(e)).call();throw new Error("Instance of rp.betting.BetSlip expected.")},this.getBetHistory=function(e){if(!(e instanceof rp.betting.BetHistory))throw new Error("Instance of rp.betting.BetHistory expected.");var t=[];return null==e.lastBetId()&&t.push(r(e,!0)),t.push(r(e)),f.apply(null,t)},this.getPaymentDetails=function(){var i,e,t=new rp.betting.PaymentDetails;return f((i=t,e=l.instance(),n(s.GET_CARD_PAYMENT_DETAILS,{}).success(function(e,t){var r=t.whoWallets.paymentMethods[0];i.set({payMethodId:r.id,cardNumber:r.card.number,maxDepositAmount:r.limits.maxDeposit,minDepositAmount:r.limits.minDeposit}),e.target.result(i)},e)))},this.makePayment=function(e){if(!(e instanceof rp.betting.PaymentDetails))throw new Error("Instance of rp.betting.PaymentDetails expected.");return f((r=e,t=l.instance(),n(s.MAKE_CARD_PAYMENT,{transactionType:"deposit",id:r.payMethodId(),cv2:r.csc(),amount:r.amount()}).success(function(e,t){r.set(t),e.target.result(r)},t)),g(this.user()));var r,t},this.updateUserPocfFlag=function(){return f(function(r){var i=l.instance();return n(s.FLAG,{pocf:"A"}).success(function(){if(r.flags()){for(var e=0,t=r.flags().length;e<t;e++)if(r.flags()[e].pocf){r.flags()[e].pocf="Y";break}i.user(r)}},this)}(this.user()))},this.getBalance=function(){return f(g(this.user()))},l.instance=function(e){return new l(e)},this.addressSearch=function(e){return n(s.ADDRESS_LOOKUP,e).call()},this.acceptPocf=function(){var t=this.user(),r=l.instance();return n(s.ACCEPT_POCF).success(function(e){t.set({pocf:"Y"}),r.user(t)},this).call()}}),namespace("rp.betting.mint"),rp.betting.mint.User=function(){arguments.callee.$super.apply(this,arguments)},extend(rp.betting.mint.User,rp.betting.User,function(e,t){this._pocf=null,this.property("pocf",{set:!0}),this.toJSON=function(){return this.get("login","token","title","firstName","balance","currency","userIdentifier","refreshToken","pocf")}});var wh=wh||{};wh.Utils={MONTHS:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],AMPM:["am","pm"],getPriceType:function(){return utils.stat.getCookie("userPrefOdds")},toDayStart:function(e){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e},toDayEnd:function(e){return(e=this.toDayStart(e)).setDate(e.getDate()+1),e.setMilliseconds(-1),e},formatNumber:function(e,t){for(var r=Number(e).toString();r.length<t;)r="0"+r;return r},formatDate:function(e){return[[this.formatNumber(e.getFullYear(),4),this.formatNumber(e.getMonth()+1,2),this.formatNumber(e.getDate(),2)].join("-"),[this.formatNumber(e.getHours(),2),this.formatNumber(e.getMinutes(),2),this.formatNumber(e.getSeconds(),2)].join(":")].join(" ")},dateFromString:function(e){var t=String(e).split(/\D/),r=Number(t[0])||0,i=t[1]-1||0,s=Number(t[2])||0,n=Number(t[3])||0,a=Number(t[4])||0,o=Number(t[5])||0;return new Date(r,i,s,n,a,o)},formatUserDate:function(e){var t=this.dateFromString(e),r=t.getDate(),i=t.getMonth(),s=t.getFullYear(),n=t.getHours()%12,a=this.formatNumber(t.getMinutes(),2),o=this.AMPM[Math.floor(t.getHours()/12)];return[r,this.MONTHS[i],s,n+":"+a+o].join(" ")},formatDateForBetsHistory:function(e){var t=this.dateFromString(e),r=t.getHours();return[(r=12<r?r%12:r)+":"+this.formatNumber(t.getMinutes(),2)+this.AMPM[Math.floor(t.getHours()/12)]+", ",t.getDate(),this.MONTHS[t.getMonth()]+", ",t.getFullYear()].join(" ")},formatFloat:function(e){return(Number(e)||0).toFixed(2)},formatCardNumber:function(e){return String(e||"").replace(/(\d+)?(\D+)(\d+)/g,function(e,t,r,i){return[t||"",$.trim(r.replace(/./g,"*").replace(/(.{4})/g,"$1 ")),i].join(" ")})},getUrlScheme:function(e){var t=String(e).match(/^([a-z][a-z0-9\+\-\.]+):/);return t?t[1]:""},getUrlOrigin:function(e){var t=String(e).match(/^([a-z][a-z0-9\+\-\.]+:\/\/[^\/]+)/);return t?t[1]:""},capitalizeName:function(e){for(var t=e.split("_"),r=0;r<t.length;r++)t[r]=t[r].charAt(0).toUpperCase()+t[r].slice(1).toLowerCase();return t.join(" ")}},function(i){var e="id-"+Number(new Date).toString(36),t=1;wh.Utils.getUID=function(){return e+(t++).toString(36)};var r="wh_checkbox";function s(){var e=i(this);if(!e.data(r)){var t={};e.data(r,t).bind("click",s.handleCheckboxClick).hide(),t.$label=i("<label>").insertAfter(e).bind("click",s.handleLabelClick).addClass(e.attr("type")).data(r,{$checkbox:e})}}s.handleCheckboxClick=function(){i(this).data(r).$label.toggleClass("checked",!this.checked)},s.handleLabelClick=function(){i(this).data(r).$checkbox.click()};var n="wh_placeholder";function a(){var e=i(this);if(e.attr("placeholder")&&!e.data(n)){var t={},r=e.attr("placeholder");e.wrap('<div class="placeholder-wrapper" />').data(n,t).bind("focus",a.handleFocus).bind("blur change",a.handleBlur).attr("id",e.attr("id")||wh.Utils.getUID()),t.$label=i("<label/>").insertAfter(e).attr("for",e.attr("id")).bind("mousedown",a.handleMouseDown).addClass("placeholder"),t.$label.text(r),e.change(),e.removeAttr("placeholder")}}a.handleFocus=function(){i(this).data(n).$label.hide()},a.handleBlur=function(){var e=i(this);e.data(n).$label.toggle(""==e.val())},a.handleMouseDown=function(e){e.preventDefault()},i.fn.wh_transformInputs=function(){return this.each(function(){i("input[type=checkbox].styled",this).each(s),i('input[placeholder!=""]',this).each(a)})}}(jQuery);
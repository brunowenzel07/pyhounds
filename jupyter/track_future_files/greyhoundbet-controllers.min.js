(webApp=webApp||{}).blocksToLeaveCached=[],webApp.isFirstCall=!0,webApp.AbstractController=function(e,t){var r;webApp.AbstractController.superclass.constructor.call(this),this.THROW_NAME_PARAM_ERROR="ParamError",this.THROW_MESSAGE_FIRST_PARAMETER="Controller`s name should be passed as first parameter of constructor",this.THROW_MESSAGE_SECOND_PARAMETER="Controller`s config should be passed as second parameter of constructor",this.THROW_MESSAGE_CONFIG_NOT_EMPTY="Controller`s config should be non-empty object",this.THROW_MESSAGE_BLOCK_MISS_CONFIG="Blocks configuration has been missed",this.THROW_MESSAGE_BLOCK_NOT_CONFIG="Blocks configuration should be non-empty plain-object",this._processError=function(e,t){throw webApp.ErrorHandler.process(e+": "+t,{name:e}),{name:e,message:t}},this._checkName=function(e){return e||this._processError(this.THROW_NAME_PARAM_ERROR,this.THROW_MESSAGE_FIRST_PARAMETER),e},this._checkConfig=function(e){var t=null,r=null;switch(!0){case!e:r=this.THROW_MESSAGE_SECOND_PARAMETER,t=this.THROW_NAME_PARAM_ERROR;break;case $.isEmptyObject(e):r=this.THROW_MESSAGE_CONFIG_NOT_EMPTY,t=this.THROW_NAME_PARAM_ERROR;break;case $.isEmptyObject(e.blocks):r=this.THROW_MESSAGE_MISS_BLOCK_CONFIG,t=this.THROW_NAME_PARAM_ERROR;break;case!$.isPlainObject(e.blocks)||$.isEmptyObject(e.blocks):r=this.THROW_MESSAGE_BLOCK_NOT_CONFIG,t=this.THROW_NAME_PARAM_ERROR}return t&&r&&this._processError(t,r),e},this._name=this._checkName(e),this._parentName="",this._config=this._checkConfig(t),this._isFirstCall=!0,this._isPostExecuteCall=!1,this._cacheLifetime=(r=this)._config&&(r._config.cacheLifetime||0===r._config.cacheLifetime)?r._config.cacheLifetime:864e5,this.CALLBACK_SUFFIX_AFTER_RENDER="AfterRender",this.CALLBACK_SUFFIX_BEFORE_RENDER="BeforeRender",this.CALLBACK_SUFFIX_ON_DESTROY="OnDestroy",this.cacheManager=webApp.cacheManager,this.viewManager=webApp.viewManager,this.ajaxManager=webApp.ajaxManager,this.urlManager=webApp.urlManager,this._requestParams={},this._blocksToRender=[],this._blocksToRenderHaveData=[],this._blocksToLoad=[],this.isRedirect=!1,this.stopExecute=!1,this.getName=function(){return this._name},this.setRequestParams=function(e){return this._requestParams=e,this},this.getRequestParams=function(){return $.extend({},this._requestParams)},this.getBlockConfig=function(e){return this._config.blocks[e]||{}},this._getBlockCacheKeys=function(e,t){var r={},i=this.getBlockConfig(e),s=this.getRequestParams(),n=t&&i.renderCacheBy?i.renderCacheBy:i.cacheBy;if(!n)return r;for(var a in n){var o=n[a];o in s&&(r[o]=s[o])}return r},this._getBlockCacheLifetime=function(e){var t=this.getBlockConfig(e);return t.cacheLifetime||0==t.cacheLifetime?t.cacheLifetime:this._cacheLifetime},this._setCache=function(e,t){var r=this._getBlockCacheKeys(e),i=this._getBlockCacheLifetime(e),s=this._getBlockCacheId(e);this.cacheManager.setCache(s,t,r,i)},this._getCache=function(e){var t=this._getBlockCacheKeys(e),r=this._getBlockCacheId(e);return this.cacheManager.getCache(r,t)},this._isCached=function(e){var t=this._getBlockCacheKeys(e),r=this._getBlockCacheId(e);return this.cacheManager.isCached(r,t)},this._clearCache=function(e,t){var r=!1;if($.isArray(e))for(var i in e)t&&(r=this._getBlockCacheKeys(e[i])),this.cacheManager.clearCache(this._getBlockCacheId(e[i]),r),this.viewManager.removeBlock(this._name,e[i]);else t&&(r=this._getBlockCacheKeys(e)),this.cacheManager.clearCache(this._getBlockCacheId(e),r),this.viewManager.removeBlock(this._name,e)},this._findBlocksToRender=function(){var e=[];for(var t in this._config.blocks)e.push(t);return e},this._findBlocksToLoad=function(e){var t=[];for(var r in this._blocksToRenderHaveData=[],e){var i=e[r];if(this.getBlockConfig(i).noCache||!this._isCached(i))t.push(i);else{this._blocksToRenderHaveData.push(i);var s="",n=this._getBlockCacheKeys(i,!0);for(var a in n)s+=n[a];s=s?" | "+s:" | ";var o="cache "+this._getBlockCacheId(i)+s;webApp.blocksToLeaveCached.push(o)}}return t},this.getBlocksToLoad=function(){var e={};for(var t in this._blocksToLoad){var r=this._blocksToLoad[t];e[r]=this.getBlockConfig(r),e[r].keys=this._getBlockCacheKeys(r,!0)}return e},this.execute=function(){try{if(this.isRedirect=!1,this.stopExecute=!1,"function"==typeof this._preExecute&&this._preExecute(),this.stopExecute)return;webApp.blocksToLeaveCached=[],this._blocksToRender=this._findBlocksToRender(),this._blocksToRenderLength=this._blocksToRender.length,webApp.HorseDetailsController||webApp.cacheManager.clearAllCache(),this._blocksToLoad=this._findBlocksToLoad(this._blocksToRender),this._blocksToRenderHaveData.length&&(webApp.isTablet&&this.render(),this._blocksToLoad.length&&!this._isFirstCall&&this.viewManager.showBlocksPreloader(this._name,this.getBlocksToLoad())),webApp.HorseDetailsController||(this._blocksToLoad.length||this._blocksToRenderHaveData.length||this.viewManager.showBlocksPreloader(this._name,this.getBlocksToLoad()),webApp.dataLoading.showContentLoading()),this.ajaxManager.process(this)}catch(e){webApp.ErrorHandler.process(this.getName()+"->execute: "+e.name+": "+e.message,e)}},this.pushData=function(e){for(var t in this._blocksToLoad){var r=this._blocksToLoad[t];if(e[r])if(void 0!==e[r].errorCode&&"404"==e[r].errorCode){var i={errorMessage:e[r].errorMessage||"",referer:this._name,errorHash:window.location.hash};this._deligate("error404",i)}else this._setCache(r,e[r]);else this.getBlockConfig(r).cacheId||this._setCache(r,{})}return this},this.render=function(e){if(webApp.isTablet)var t=e?this._blocksToLoad:this._blocksToRenderHaveData;else t=this._blocksToRender;this._isFirstCall&&this.viewManager.pageReady(this._name);var r=!0;for(var i in t){var s=t[i];try{if(this.isRedirect){r=this.isRedirect=!1;break}this._renderBlock(s),this._blocksToRenderLength&&this._blocksToRenderLength--}catch(e){webApp.ErrorHandler.process(this.getName()+"["+s+"]: "+e.name+": "+e.message,e)}}r&&!this.isRedirect&&(this._isFirstCall&&(webApp.currentControllerName=this._parentName||this._name,this._isFirstCall=!1),this._blocksToRenderLength||this._isPostExecuteCall?setTimeout($.proxy(function(){this.viewManager.setFrameSize()},this),800):("function"==typeof this._postExecute&&this._postExecute(),this._isPostExecuteCall=!0,setTimeout($.proxy(function(){this.viewManager.hideUrlBar(this._name)},this),0),setTimeout($.proxy(function(){if(void 0!==webApp.configs.ad){var e=webApp.isTablet?webApp.configs.ad.rubicon.tablet:webApp.configs.ad.rubicon.phone;void 0!==e[this._name]&&webApp.rubiconAds.display(this._name,e[this._name])}this.viewManager.switchPage(this._name,this._parentName)},this),10)),setTimeout($.proxy(function(){this.viewManager.setScrollSize(this._name)},this),100)),webApp.isFirstCall=!1,webApp.HorseDetailsController||webApp.dataLoading.hideContentLoading()},this._renderBlock=function(t){var e=this.getBlockConfig(t),r=this._getBlockCacheKeys(t,!0),i=this._getCache(t),s=this;i&&(e.beforeRenderClb=function(e){return s.beforeRenderCallback(t,e)},e.afterRenderClb=function(e){s.afterRenderCallback(t,e)},e.onDestroyClb=function(e){s.onDestroyCallback(t,e)},this.viewManager.renderBlock(this._name,t,e,i,r))},this._getCallbackName=function(e,t){var r=e.split("-"),i=[];for(var s in r){var n=r[s];0!=s?i.push(n.charAt(0).toUpperCase()+n.slice(1)):i.push(n)}return i.join("")+t},this.beforeRenderCallback=function(e,t){var r=this.getBlockConfig(e);if(!(r.beforeRender&&r.beforeRender in this)){var i=this._getCallbackName(e,this.CALLBACK_SUFFIX_BEFORE_RENDER);i in this&&(r.beforeRender=i)}return r.beforeRender in this?t=this[r.beforeRender](t):t},this.afterRenderCallback=function(e,t){var r=this.getBlockConfig(e);if(!(r.afterRender&&r.afterRender in this)){var i=this._getCallbackName(e,this.CALLBACK_SUFFIX_AFTER_RENDER);i in this&&(r.afterRender=i)}t&&r.afterRender in this&&this[r.afterRender](t)},this.onDestroyCallback=function(t,e){var r=this.getBlockConfig(t);if(!(r.onDestroy&&r.onDestroy in this)){var i=this._getCallbackName(t,this.CALLBACK_SUFFIX_ON_DESTROY);i in this&&(r.onDestroy=i)}if(e&&r.onDestroy in this)try{this[r.onDestroy](e)}catch(e){webApp.ErrorHandler.process(this.getName()+"["+t+"]: "+e.name+": "+e.message,e)}},this._redirect=function(e,t,r){this.viewManager.flash(e);var i,s=[];s[0]=e,s[1]=t,i=this.urlManager.createHash(s),r&&this.urlManager.setBackBtnClicked(),this._name==e?this.urlManager.replaseHash(i):this.urlManager.setHash(i),this.isRedirect=!0},this._redirectAndExit=function(e,t){throw this._redirect(e,t),{name:"Redirect",message:'Controller "'+this.getName()+'" has made redirect'}},this._deligate=function(e,t){throw this._core().dispatch([e,t]),{name:"Deligate",message:'Controller "'+this.getName()+'" deligated processing to "'+e+'"'}},this.destroy=function(){},this._getBlockCacheId=function(e){var t=this.getBlockConfig(e);return t.cacheId?t.cacheId:this._getBlockDefaultCacheId(this.getName(),e)},this._getBlockDefaultCacheId=function(e,t){return e+"_"+t},this.setSelectionsOnAddAlertCount=function(){webApp.SelectionsManager.setOnAddMultModeCallback(function(){webApp.selectionsAlert.show(webApp.SelectionsManager.getSelections().length)})},this.setSelectionsOnAddConfirmDialog=function(){var t=this._helper("eventTracker");webApp.SelectionsManager.setOnAddMultModeCallback($.proxy(function(){var e=this;webApp.selectionsConfirm(webApp.SelectionsManager.getSelections().length,{okCallback:function(){return e._redirect("bet-slip"),t.trackEventById("cards_view_betslip"),!1},cancelCallback:function(){t.trackEventById("cards_dismiss")}})},this))},this.isTodaysDateRequested=function(){var e=utils.date.toString(utils.date.getSynchronizedToServerNow());return this.getRequestParams().r_date==e},this.isPastDateRequested=function(){var e=new Date(utils.date.toString(utils.date.getSynchronizedToServerNow()));return new Date(this.getRequestParams().r_date)<e},this.accessedFromBookmark=function(){return!sessionStorage.getItem("prevControllerName")}},webApp.extend(webApp.AbstractController,webApp.Component),(webApp=webApp||{}).AbstractNodataController=function(e,t){webApp.AbstractNodataController.superclass.constructor.call(this,e,t),this.currency=webApp.userSettings.get("currency")||"GBP",this.selectionsCollection=rp.betting.SelectionsCollection.instance(),this.betslip=null,this._isCached=function(){return!0},this._getCache=function(){return{}},this.saveBetslip=function(){this.betslip&&localStorage.setItem("betslip",JSON.stringify(this.betslip.toJSON()))},this.loadBetslip=function(){var e=null;return localStorage.getItem("betslip")&&(e=rp.betting.BetSlip.create(localStorage.getItem("betslip"))),e},this.forgetBetslip=function(){this.betslip=null,localStorage.removeItem("betslip")},this.restoreBetslip=function(){this.betslip=rp.betting.BetSlipBuilder.buildBetSlip(this.selectionsCollection,this.loadBetslip())},this.restoreDefaultIncludeInMultiple=function(){$.each(this.selectionsCollection.selections(),$.proxy(function(e,t){this.selectionsCollection.updateStatus(t,"includeInMultiple",!0)},this))},this.restoreDefaultSP=function(){$.each(this.selectionsCollection.selections(),$.proxy(function(e,t){t.hasPrice()&&t.isSP(!1)},this))}},webApp.extend(webApp.AbstractNodataController,webApp.AbstractController);var wh=wh||{};(webApp=webApp||{}).AbstractNodataCredentialsController=function(e,t){webApp.AbstractNodataCredentialsController.superclass.constructor.call(this,e,t);var r=null;this.CURRENCY_UK_POUND="GBP",this.CURRENCY_EURO="EUR",this.CURRENCY_US_DOLLAR="USD",this.currenciesWithSigns=[this.CURRENCY_UK_POUND,this.CURRENCY_EURO,this.CURRENCY_US_DOLLAR],this.isLoggedIn=function(e){var t=webApp.bookieCollection.getProvider(e);return Boolean(t.isLoggedIn())&&Boolean(t.user())&&Boolean(t.user().userIdentifier())},this.addBookieCredentialsToView=function(e,t){var r;switch(t){case"wh":r="http://www.williamhill.com/";break;case"ladb":r="http://sports.ladbrokes.com"}if($.extend(e,{bookie:{name:webApp.bookieCollection.getProviderName(t),index:t,terms:webApp.bookiesCollection[t].terms,openAccountUrl:webApp.bookiesCollection[t].openAccountUrl,website:r}}),this.isLoggedIn(t)){var i=webApp.bookieCollection.getProvider(t).user();$.extend(e,{userName:i.login(),balance:this.balanceString(i.balance(),i.currency())}),this.currency=i.currency()}return e.isLoggedIn=this.isLoggedIn(t),e},this.addCredentialsToView=function(e){var t=webApp.prefBookmaker.get();return this.addBookieCredentialsToView(e,t)},this.balanceString=function(e,t){var r=this.currencyView(t),i=-1<this.currenciesWithSigns.indexOf(t);return e=isNaN(+e)?"N/A":e,/^[0-9]+\.[\d]{1}$/gi.test(parseFloat(e))?e+="0":parseInt(e,10)===parseFloat(e)&&(e+=".00"),i?r+e:e+" "+r},this.currencyView=function(e){return e===this.CURRENCY_UK_POUND?"&pound;":e===this.CURRENCY_EURO?"&euro;":e===this.CURRENCY_US_DOLLAR?"$":e},this.bindLogout=function(){var e=webApp.prefBookmaker.get();this.bindProviderLogout(e)},this.handleLogout=function(e){switch(webApp.currentControllerName){case"bet-slip":case"price-changed-error":var t=e+"-home";this._redirect(t,{"from-betslip":1});break;case e+"-home":break;case e+"-account-home":webApp.dataLoading.hide(),this._redirect("account-home");break;case e+"-open-bets":case e+"-top-up":this._redirect(e+"-home");break;case"account-home":webApp.dataLoading.hide(),$("#bookie-"+e+" .colB").html('<a href="#'+e+'-home" data-eventid = "account_login" data-eventlabel = "'+webApp.bookieCollection.getProviderName(e)+'"><div>Log In</div><div>Open Account</div></a>');break;default:console.log("Not recognised current controller: %s",webApp.currentControllerName)}},this.bindProviderLogout=function(e){r=function(){this.handleLogout(e)};var t=webApp.bookieCollection.getProvider(e);t.bind(t.EVENT_LOGOUT,r,this)},this.unbindLogout=function(){var e=webApp.prefBookmaker.get();this.unbindProviderLogout(e)},this.unbindProviderLogout=function(e){var t=webApp.bookieCollection.getProvider(e);t.unbind(t.EVENT_LOGOUT,r,this)}},webApp.extend(webApp.AbstractNodataCredentialsController,webApp.AbstractNodataController),(webApp=webApp||{}).Error404Controller=function(e,t){webApp.Error404Controller.superclass.constructor.call(this,e,t),this.headerAfterRender=function(){webApp.HorseDetailsController||this._applyGreyhoundbetErrorHandler()},this.mainBeforeRender=function(e){var t=this.getRequestParams();if(t.hasOwnProperty("errorHash")){var r=this._helper("eventTracker"),i=webApp.isTablet?t.errorHash:"Requested hash: "+t.errorHash;r.trackEventById("error_404",i)}return e.errorMessage=t.errorMessage||"",e.secondLink=this._findSecondLink(t.referer||""),e.showButtons=!0,webApp.HorseDetailsController||(e.showButtons=!1),e},this._findSecondLink=function(e){if(!e)return!1;e=e.replace("#","");var t,r=this._config.secondLinks;for(t in r)if(r.hasOwnProperty(t)&&r[t].referers&&-1!==$.inArray(e,r[t].referers))return{controller:r[t].controller,text:r[t].text,hideMainSiteLink:r[t].hideMainSiteLink};return!1},this._applyGreyhoundbetErrorHandler=function(){var e,t,r,i,s=!!webApp.urlManager.error404BackCollection.length;e=webApp.urlManager.getPreviousCollectionName(),t=webApp.urlManager.getPreviousCollectionHomeUrl(),s&&(i=webApp.urlManager.error404BackCollection[0]!==webApp.urlManager.error404BackCollection[1]),r=s&&i?webApp.urlManager.error404BackCollection[0]:t,$(".btnBack").each(function(){this.href=r}),webApp.urlManager.error404BackCollection=[],webApp.urlManager.rewriteMainTabLink(e,t)}},webApp.extend(webApp.Error404Controller,webApp.AbstractNodataController);var webApp=webApp||{};wh=wh||{};(greyhoundbet=greyhoundbet||{}).AccountHomeController=function(e,t){greyhoundbet.AccountHomeController.superclass.constructor.call(this,e,t);var r=webApp.bookieCollection.getAllProviders();this.mainAfterRender=function(){this._helper("eventTracker");var i=this;for(var e in webApp.accountSettingsList("prefBookieList","bookie",".colA"),r)$.proxy(this.bindProviderLogout(e),this),r[e].user()&&$.proxy(t(r[e].user(),e),this);function t(t,r){t.bind(rp.betting.User.EVENT_BALANCE_CHANGED,function(e){$("#bookie-"+r+" .colB").html('<a href="#'+r+'-account-home"><div>'+t.login()+"</div><div>"+i.balanceString(t.balance(),t.currency())+"</div></a>")},this)}},this.destroy=function(){for(var e in r)this.unbindProviderLogout(e),r[e].user()&&r[e].user().unbind(rp.betting.User.EVENT_BALANCE_CHANGED)},this.mainBeforeRender=function(e){var t=webApp.userSettings,r=webApp.sortByCollection[t.get("sortBy")||"number"];return $.extend({},{sortBy:r,odds:webApp.oddsCollection[t.get("odds")],bookies:this.getOrderedBookies()})},this.getOrderedBookies=function(){var e=webApp.userSettings,i=webApp.bookiesCollection,t=$.map(i,function(e,t){return t}),s=this,n=(e.get("bookiesOrder")||"").split(","),a=webApp.prefBookmaker.get();$.map(i,function(e,t){if(i[t].isLoggedIn=s.isLoggedIn(t),i[t].isLoggedIn){var r=webApp.bookieCollection.getProvider(t).user();i[t].user=r,i[t].userName=r.login(),i[t].balance=s.balanceString(r.balance(),r.currency())}}),n.slice().sort().join("")!=t.slice().sort().join("")&&(n=[]);var r=$.map(i,function(e,t){if(t!=a||n.length)if(n.length)r=n.indexOf(t);else r=Math.floor(100*Math.random());else var r=-1;return $.extend(e,{index:t,order:r})}).sort(function(e,t){return e.order-t.order});return n.length||(n=$.map(r,function(e,t){return e.index}),e.set("bookiesOrder",n.join(","))),r}},webApp.extend(greyhoundbet.AccountHomeController,webApp.AbstractNodataCredentialsController),(webApp=webApp||{}).AccountSortByController=function(e,t){webApp.AccountSortByController.superclass.constructor.call(this,e,t),this.mainAfterRender=function(){webApp.accountSettingsList("cardSortByList","sortBy")}},webApp.extend(webApp.AccountSortByController,webApp.AbstractNodataCredentialsController),(webApp=webApp||{}).AccountOddsController=function(e,t){webApp.AccountOddsController.superclass.constructor.call(this,e,t),this.mainAfterRender=function(){webApp.accountSettingsList("cardOddsList","odds")}},webApp.extend(webApp.AccountOddsController,webApp.AbstractNodataCredentialsController);wh=wh||{};(webApp=webApp||{}).WhHomeController=function(e,t){webApp.WhHomeController.superclass.constructor.call(this,e,t);var s=webApp.userSettings,n=null,a=null,i=s.get("saveUserName"),o=s.get("saveUserPass");this.destroy=function(){this.unbindProviderLogout("wh")},this.mainAfterRender=function(){var r=this._helper("eventTracker");this.bindProviderLogout("wh");var e=function(){return $("#userName, #password").blur(),t.login(),r.trackEventById("account_login",webApp.bookieCollection.getCurrentProviderName()),!1},t=this;$("#loginBtn, #topLogIn").click(function(){return e(),!1}),$("#loginForm").bind("submit.login",e),n=$("#saveUserName"),a=$("#saveUserPass"),n.switchButton({enableText:"Save",disableText:"Save?",checked:i,callback:function(e){s.set("saveUserName",e),a.switchButton(e?"enabled":"disabled");var t=e?"On":"Off";r.trackEventById("account_save_name",t)}}),a.switchButton({enableText:"Save",disableText:"Save?",disabled:!i,checked:i&&o,callback:function(e){s.set("saveUserPass",e);var t=e?"On":"Off";r.trackEventById("account_save_pass",t)}})},this.mainBeforeRender=function(e){return e=this.addBookieCredentialsToView(e,"wh"),i&&(e.userName=s.get("username")),i&&o&&(e.password=s.get("password")),e.currency=s.get("currency"),e},this.headerBeforeRender=function(e){return e=this.addBookieCredentialsToView(e,"wh"),i&&(e.userName=s.get("username")),i&&o&&(e.password=s.get("password")),e.currency=s.get("currency"),this.isFromBetslip()&&(e.backUrlHash="bet-slip"),e},this.login=function(){var t=$("#userName").val(),r=$("#password").val(),i=this;if(this.saveCredentials(t,r),t&&r){webApp.bookieCollection.getProvider("wh").login(t,r).success(function(e){i.loginSuccess(e,t,r),webApp.dataLoading.hide()}).error(function(e){webApp.genericWhErrorHandler(e.target.result()),webApp.dataLoading.hide()}),webApp.dataLoading.show()}else alert("Fields are empty")},this.loginSuccess=function(e,t,r){this.saveCredentials(t,r),webApp.userSettings.set("currency",e.target.result().currency());var i=this.assembleParamsForAfterLoginRedirect();webApp.registry.set("justLogin",!0),this._redirect(i[0],i[1],i[2])},this.assembleParamsForAfterLoginRedirect=function(){return this.shouldBeRedirectedToBetslip()?["bet-slip",null,!0]:["wh-account-home",null,null]},this.shouldBeRedirectedToBetslip=function(){return!this.getRequestParams().hasOwnProperty("just-login")&&this.isFromBetslip()},this.isFromBetslip=function(){var e=this.getRequestParams();return!!e.hasOwnProperty("from-betslip")&&e["from-betslip"]},this.saveCredentials=function(e,t){var r=!!n.attr("checked"),i=!!a.attr("checked");r?s.set("username",e):s.remove("username"),r&&i?s.set("password",t):s.remove("password")}},webApp.extend(webApp.WhHomeController,webApp.AbstractNodataCredentialsController);wh=wh||{};(webApp=webApp||{}).WhAccountHomeController=function(e,t){webApp.WhAccountHomeController.superclass.constructor.call(this,e,t);var i=webApp.bookieCollection.getProvider("wh");this.mainBeforeRender=function(e){return i.isLoggedIn()||this._redirect("wh-home"),(e=this.addBookieCredentialsToView(e,"wh")).headline="William Hill",e.headlineClass="whHeadline",e.trackingId=webApp.eventTracker.getTrackingId(),e},this.mainHeaderBeforeRender=function(e){return this.getRequestParams().hasOwnProperty("from-betslip")&&(e.backUrlHash="bet-slip"),e},this.destroy=function(){this.unbindProviderLogout("wh")},this.mainAfterRender=function(){$("#wh-logout").click(function(){webApp.dataLoading.show("Logging out"),i.logout(),setTimeout($.proxy(function(){var e="You are now logged out of "+webApp.bookieCollection.getProviderName("wh");webApp.confirmMessage.show(e)},this),1e3)}),this.bindProviderLogout("wh");var e=webApp.bookieCollection,t=e.getCurrentProviderName()!=e.getProviderName("wh")&&webApp.registry.get("justLogin");if(webApp.registry.remove("justLogin"),t){var r=this.addBookieCredentialsToView({},"wh");r.btnClass="whBtn",r.logoClass="whLogo",webApp.landing.show({full:!0,template:"landing-change-price",templateData:r,callback:function(){$("#setNewBookiePrices").bind("click",function(){webApp.prefBookmaker.setWithMessage(r.bookie.index,"Prices now set to "+r.bookie.name),webApp.landing.hide()})}})}}},webApp.extend(webApp.WhAccountHomeController,webApp.AbstractNodataCredentialsController);wh=wh||{};(webApp=webApp||{}).WhOpenBetsController=function(e,t){webApp.WhOpenBetsController.superclass.constructor.call(this,e,t),this.betsBlockSize=10,this.startDate="2000-01-01 00:00:00",this.currentPage=0,this.totalPages=0,this.totalBets=0,this.betsShown=0,this.$settledBetsHeader=null,this.$openBetsHeader=null,this.$openBetsContainer=null,this.$settledBetsContainer=null,this.MESSAGE_BET_LOST="Lost",this.MESSAGE_BET_WON="Won",this.MESSAGE_BET_PLACED="Placed",this.MIN_BETS_QTY=5;var n,r=webApp.bookieCollection.getCurrentProvider().settings().serverDateDelta;this.betHistory=new rp.betting.BetHistory({searchCriteria:{fromDate:moment(this.startDate).sod(),toDate:utils.moment.getSynchronizedToServerNow(r,!1).eod(),blockSize:this.betsBlockSize,blockNumber:null,minimumBets:this.MIN_BETS_QTY}}),this.betsShown=0,this.destroy=function(){this.unbindProviderLogout("wh")},this.mainBeforeRender=function(e){if(this.betHistory.set({bets:[],opened:[],settled:[]}),(e=this.addBookieCredentialsToView(e,"wh")).trackingId=webApp.eventTracker.getTrackingId(),webApp.bookieCollection.getProvider("wh").isLoggedIn())return e;this._redirectAndExit("wh-home")},this.getBetHistory=function(){this.bindProviderLogout("wh");var i=this;webApp.bookieCollection.getProvider("wh").getBetHistory(this.betHistory).success(function(e){var t=i.betHistory.bets().length;if(0===t)$("#noBets").show(),i.hidePreloader(),webApp.dataLoading.hide();else{var r=i.betHistory.bets()[t-1];0<t%i.betsBlockSize||r.betReference()===i.betHistory.lastBetId()?$("#showMore").hide():$("#showMore").show()}webApp.viewManager.getScroll(i._name).refresh()})},this.mainAfterRender=function(e){var t=this;this.$settledBetsHeader=$("#settledBetsHeader"),this.$openBetsHeader=$("#openBetsHeader"),this.$openBetsContainer=$("#openBetsList"),this.$settledBetsContainer=$("#settledBetsList"),this.betHistory.betHistoryAddedBet(this.handleBetHistoryAddedBet,this),this.getBetHistory(),$("#showMore").unbind("click").bind("click.showNext",function(e){webApp.dataLoading.show("Loading Bet History list"),t.mainAfterRender(),e.preventDefault()}),$("#showMore").hide(),webApp.viewManager.getScroll(this._name).refresh()},this.handleBetHistoryAddedBet=function(e,t){var r=this._core().getViewManager(),i=webApp.userSettings.get("odds");$.extend(t,{isDecimalOdds:"decimal"==i});var s=$(r.renderTpl("wh-bet-row",t));t.isSettled()?(this.$settledBetsHeader.show(),this.$settledBetsContainer.append(s)):(this.$openBetsHeader.show(),this.$openBetsContainer.append(s)),this.betsShown++,$("#betsQty").html("1 to "+this.betsShown),clearTimeout(n);n=setTimeout($.proxy(function(){webApp.viewManager.getScroll(this.getName()).refresh()},this),20),this.hidePreloader(),webApp.dataLoading.hide(),$("#betList").show()},this.hidePreloader=function(){$("div.loading").hide()}},webApp.extend(webApp.WhOpenBetsController,webApp.AbstractNodataCredentialsController),(webApp=webApp||{}).WhBetDetailController=function(e,t){webApp.WhBetDetailController.superclass.constructor.call(this,e,t),this.mainBeforeRender=function(){var e=webApp.registry.get("betDetail");return e.currency=this.currencyView(webApp.userSettings.get("currency")),e}},webApp.extend(webApp.WhBetDetailController,webApp.AbstractNodataCredentialsController),(webApp=webApp||{}).WhTermsController=function(e,t){webApp.WhTermsController.superclass.constructor.call(this,e,t)},webApp.extend(webApp.WhTermsController,webApp.AbstractNodataController),(webApp=webApp||{}).WhRegisterController=function(e,t){webApp.WhRegisterController.superclass.constructor.call(this,e,t),this.headerBeforeRender=function(e){return this.getRequestParams().hasOwnProperty("from-betslip")&&(e.backUrlHash="bet-slip"),e},this.headerAfterRender=function(){this.getRequestParams().hasOwnProperty("from-betslip")&&$(".btnBack").attr("href","#bet-slip")},this.registrationBeforeRender=function(e){return e.trackingId=webApp.eventTracker.getTrackingId(),e.bookie=webApp.bookieCollection.getProviderName("wh"),e},this.registrationAfterRender=function(){var r=this._helper("eventTracker");$("#whPhone").bind(r.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var t=webApp.bookieCollection.getProviderName("wh");r.trackEventById("account_wh_phone",t);setTimeout(function(){document.location=$("#whPhone").attr("href")},1e3)}),webApp.isTablet&&$("#whPhone-outside").bind(r.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var t=webApp.bookieCollection.getProviderName("wh");r.trackEventById("account_wh_phone",t);setTimeout(function(){window.location=$("#whPhone").attr("href")},1e3)})}},webApp.extend(webApp.WhRegisterController,webApp.AbstractNodataController),(webApp=webApp||{}).WhHelpInfoController=function(e,t){webApp.WhHelpInfoController.superclass.constructor.call(this,e,t),this.mainBeforeRender=function(e){return(e=this.addCredentialsToView(e)).trackingId=webApp.eventTracker.getTrackingId(),e}},webApp.extend(webApp.WhHelpInfoController,webApp.AbstractNodataCredentialsController),(webApp=webApp||{}).WhForgottenPasswordController=function(e,t){webApp.WhForgottenPasswordController.superclass.constructor.call(this,e,t),this.mainBeforeRender=function(e){return(e=this.addCredentialsToView(e)).trackingId=webApp.eventTracker.getTrackingId(),e},this.mainAfterRender=function(){var r=this._helper("eventTracker");$("#whPhone").bind(r.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var t=webApp.bookieCollection.getProviderName("wh");r.trackEventById("account_wh_phone",t);setTimeout(function(){window.location=$("#whPhone").attr("href")},1e3)}),webApp.isTablet&&$("#whPhone-outside").bind(r.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var t=webApp.bookieCollection.getProviderName("wh");r.trackEventById("account_wh_phone",t);setTimeout(function(){window.location=$("#whPhone").attr("href")},1e3)})}},webApp.extend(webApp.WhForgottenPasswordController,webApp.AbstractNodataCredentialsController),(webApp=webApp||{}).WhWithdrawController=function(e,t){webApp.WhWithdrawController.superclass.constructor.call(this,e,t),this.mainBeforeRender=function(e){return(e=this.addCredentialsToView(e)).trackingId=webApp.eventTracker.getTrackingId(),e},this.mainAfterRender=function(){var r=this._helper("eventTracker");$("#whPhone").bind(r.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var t=webApp.bookieCollection.getProviderName("wh");r.trackEventById("account_wh_phone",t);setTimeout(function(){window.location=$("#whPhone").attr("href")},1e3)}),webApp.isTablet&&$("#whPhone-outside").bind(r.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var t=webApp.bookieCollection.getProviderName("wh");r.trackEventById("account_wh_phone",t);setTimeout(function(){window.location=$("#whPhone").attr("href")},1e3)})}},webApp.extend(webApp.WhWithdrawController,webApp.AbstractNodataCredentialsController),(webApp=webApp||{}).WhFreeBetsOfferController=function(e,t){webApp.WhFreeBetsOfferController.superclass.constructor.call(this,e,t)},webApp.extend(webApp.WhFreeBetsOfferController,webApp.AbstractNodataController),(webApp=webApp||{}).WhTopUpController=function(e,t){webApp.WhTopUpController.superclass.constructor.call(this,e,t),this.$elements={},this._provider=webApp.bookieCollection.getProvider("wh"),this.pocfAccepted,this.pocfFlagExists,this.destroy=function(){this.unbindProviderLogout("wh")},this._preExecute=function(){this.pocfAccepted=this.checkUserPocfAlreadyAccepted(),this.pocfFlagExists=this.checkUserPocfFlagExists()},this.mainAfterRender=function(t){this.bindProviderLogout("wh"),this._provider.isLoggedIn()||this._redirectAndExit("wh-home");var r=this;this._provider.getPaymentDetails().success(function(e){r.acceptPaymentDetails(e.target.result(),t)}).error(function(e){var t=e.target.result();t.code()&&t.code()==rp.betting.mint.Error.NO_CARD_DETAILS_REGISTERED?r.renderNoCardScreen():webApp.genericWhErrorHandler(t)})},this.renderNoCardScreen=function(){var e=this._core().getViewManager(),t=this.addCredentialsToView({});t.trackingId=webApp.eventTracker.getTrackingId(),$("div.loading").replaceWith(e.renderTpl("wh-top-up-without-card",t));var r=this.getName();webApp.viewManager.getScroll(r).refresh()},this.checkUserPocfAlreadyAccepted=function(){return"Y"===webApp.bookieCollection.getProvider("wh").user().pocf()},this.checkUserPocfFlagExists=function(){return!!webApp.bookieCollection.getProvider("wh").user().pocf()},this.acceptPaymentDetails=function(e,t){var r=t.filter("div.loading"),i=this._core().getViewManager(),s=e,n=this;if("cardNumber"in s){var a=s.cardNumber();s.cardNumberStart=a.substring(0,a.indexOf("X")),s.cardNumberEnd=a.substring(a.lastIndexOf("X")+1),s.currency=this.currencyView(webApp.userSettings.get("currency")),s.bookie=webApp.bookieCollection.getProviderName("wh"),s.showPocfMessage=this.pocfFlagExists&&!this.pocfAccepted,r.replaceWith(i.renderTpl("wh-top-up-with-card",s));var o=this._helper("eventTracker");$("#whPhone").bind(o.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var t=webApp.bookieCollection.getProviderName("wh");o.trackEventById("account_wh_phone",t);setTimeout(function(){document.location=$("#whPhone").attr("href")},1e3)}),webApp.isTablet&&$("#whPhone-outside").bind(o.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var t=webApp.bookieCollection.getProviderName("wh");o.trackEventById("account_wh_phone",t);setTimeout(function(){window.location=$("#whPhone").attr("href")},1e3)});var c={btnPay:$("#btn-top-up-pay"),form:$("#top-up-form"),inputDepo:$("#top-up-deposit"),inputCv2:$("#top-up-cv2"),balance:$("#top-up-balance"),checkBox:$(".check")},l=!1;(this.$elements=c).inputCv2.limitMaxLength(3),$(c.balance).html(this.balanceString(this._provider.user().balance(),this._provider.user().currency())),this.setupValidation();var d=function(){return n.deposit(s.payMethodId()),!1};c.btnPay.click(function(){l||!n.pocfFlagExists||n.pocfAccepted?d():alert("You need to read and accept the Protection of Customer Funds statement to make a deposit")}),c.form.bind("submit.login",d),webApp.isAndroid_4_x||(c.inputDepo.keyup(function(){n.restrictPositive(this)}),c.inputCv2.keyup(function(){n.restrictInteger(this)})),c.checkBox.click(function(){l=!1===l?(c.checkBox.addClass("selected"),!0):(c.checkBox.removeClass("selected"),!1)}),webApp.viewManager.getScroll(this.getName()).refresh()}else this.renderNoCardScreen()},this.restrictPositive=function(e){var t=$(e),r=t.val();(isNaN(r)||r<0||r.length>="0.01".length&&r<"0.01")&&t.val(r.substring(0,r.length-1))},this.restrictInteger=function(e){var t=$(e),r=t.val();new RegExp("^[0-9]*$").test(r)||t.val(r.substring(0,r.length-1))},this.setupValidation=function(){var e="The CV2 should contain 3 digits",t="Deposit Amount must be a number";this.$elements.form.validate({rules:{deposit:{required:!0,number:!0,min:.01},cv2:{required:!0,digits:!0}},showErrors:function(e){var t=[];for(var r in e)t.push(e[r]);t.length&&alert(t.join(", "))},messages:{deposit:{required:"Deposit Amount field is empty",number:t,min:t},cv2:{required:"CV2 Security Code field is empty",maxlength:e,minlength:e}},onfocusout:!1,onkeyup:!1,onsubmit:!1})},this.deposit=function(e){var t=this.$elements;if(t.form.valid()){var r=this,i=t.inputDepo.val(),s=new rp.betting.PaymentDetails({payMethodId:e,csc:t.inputCv2.val(),amount:i}),n=function(){r._provider.makePayment(s).error(function(e){webApp.genericWhErrorHandler(e.target.result(),"topUpController"),webApp.dataLoading.hide()}).success(function(){r.paymentAccepted(webApp.userSettings.get("currency"),i),webApp.dataLoading.hide()})};if(webApp.dataLoading.show(),this.pocfFlagExists&&!this.pocfAccepted){r=this;this._provider.acceptPocf().success(function(){$(".pcf").hide(),r.pocfAccepted=!0,n()})}else n()}},this.paymentAccepted=function(e,t){this.$elements.balance.after('<span class="addedTick">'+this.balanceString(t,e)+" top up added</span>"),this.$elements.form.each(function(){this.reset()}),webApp.viewManager.getScroll(this.getName()).refresh();webApp.registry.get("betInfo");$(this.$elements.balance).html(this.balanceString(this._provider.user().balance(),this._provider.user().currency()))}},webApp.extend(webApp.WhTopUpController,webApp.AbstractNodataCredentialsController),(webApp=webApp||{}).LadbHomeController=function(e,t){webApp.LadbHomeController.superclass.constructor.call(this,e,t),this.ACTION_REGISTRATION="registration",this.ACTION_AUTHORIZATION="authorization";var r=this,i=!1,s=webApp.bookieCollection.getProvider("ladb");this._currActionType=null,this._preExecute=function(){var e=this.getRequestParams().action;e!==this.ACTION_REGISTRATION&&(e=this.ACTION_AUTHORIZATION),this._currActionType=e},this.handleUserLogin=function(e,t){i?r._redirect("bet-slip",null,!0):(webApp.registry.set("justLogin",!0),r._redirect("ladb-account-home"))},this.handleError=function(e,t){if(void 0!==t)switch(t.error){case"server_error":alert("Server error"),r._redirect("account-home");break;case"access_denied":r._redirect("account-home");break;case"invalid_request":s.unbind(s.EVENT_LOGOUT),r._redirect("ladb-home",{invalid_request:Math.random()});break;default:(t.error||t.error_code)&&(console.warn('Not recognised error: "%s"',error),alert("Something went wrong. Please try logging in again."),r._redirect("account-home"))}},this.ladbHomeAfterRender=function(){s.bind(s.EVENT_LOGIN,this.handleUserLogin,this),s.bind(s.EVENT_LOGOUT,this.handleError,this),this.getRequestParams().hasOwnProperty("invalid_request")&&alert("Login failed. Please try again")},this.ladbHomeBeforeRender=function(e){return e.actionType=this._currActionType,e.apiKey=s.settings().apiKey,e.redirectUrl=s.settings().redirectUrl,e.backUrlHash=this._getBackUrlHash(),i=this.shouldBeRedirectedToBetslip(),e},this.headerBeforeRender=function(e){return e.actionType=this._currActionType,e.backUrlHash=this._getBackUrlHash(),e},this._getBackUrlHash=function(){return!!this.getRequestParams().hasOwnProperty("from-betslip")&&"bet-slip"},this.shouldBeRedirectedToBetslip=function(){var e=this.getRequestParams();return!e.hasOwnProperty("just-login")&&e.hasOwnProperty("from-betslip")},this.destroy=function(){s.unbind(s.EVENT_LOGIN,this.handleUserLogin,this),s.unbind(s.EVENT_LOGOUT,this.handleError,this)}},webApp.extend(webApp.LadbHomeController,webApp.AbstractNodataController),(webApp=webApp||{}).LadbOpenBetsController=function(e,t){var r;webApp.LadbOpenBetsController.superclass.constructor.call(this,e,t),this.previousSettledBets=0,this.destroy=function(){this.unbindProviderLogout("ladb")},this.mainBeforeRender=function(e){return this.betHistory.set({bets:[],opened:[],settled:[]}),e=this.addBookieCredentialsToView(e,"ladb"),webApp.bookieCollection.getProvider("ladb").isLoggedIn()?(e.trackingId=webApp.eventTracker.getTrackingId(),e):(this._redirectAndExit("ladb-home"),!1)},this.getBetHistory=function(){this.bindProviderLogout("ladb");var r=this;webApp.bookieCollection.getProvider("ladb").getBetHistoryChunks(this.betHistory).success(function(e){var t=r.betHistory.totalBlocks().opened+r.betHistory.totalBlocks().totalSettled;r.previousSettledBets=r.betHistory.totalBlocks().totalSettled,0===t?($("#noBets").show(),r.hidePreloader(),webApp.dataLoading.hide()):($("#showMore").show(),$("#betsQty").html("1 to "+r.betHistory.bets().length)),webApp.viewManager.getScroll(r._name).refresh()}).error(function(e){(r.hidePreloader(),webApp.dataLoading.hide(),e.target.result().code()===rp.betting.ladbrokes.Error.NO_RECENT_BETS)&&(0===r.betHistory.totalBlocks().opened+r.betHistory.totalBlocks().settled&&0===r.previousSettledBets?$("#noBets").show():($("#showMore").hide(),$("#noRecentBets").show()),webApp.viewManager.getScroll(r._name).refresh())})},this.handleBetHistoryAddedBet=function(e,t){var r=this._core().getViewManager(),i=webApp.userSettings.get("odds");$.extend(t,{isDecimalOdds:"decimal"==i});var s=$(r.renderTpl("ladb-bet-row",t));t.isSettled()?(this.$settledBetsHeader.is(":visible")||this.$settledBetsHeader.show(),this.$settledBetsContainer.append(s)):(this.$openBetsHeader.is(":visible")||this.$openBetsHeader.show(),this.$openBetsContainer.append(s)),this.hidePreloader(),webApp.dataLoading.hide(),$("#betList").show(),this.updatePageScroll()},this.updatePageScroll=function(){clearTimeout(r);var t=this.getName();r=setTimeout(function(){webApp.viewManager.getScroll(t).refresh(),$(".toggleBetDetails").unbind(".toggleBetClick").bind("click.toggleBetClick",function(){var e=$(this).closest("li");e.hasClass("minifyBetDetail")?(e.removeClass("minifyBetDetail"),$(this).text("Close")):(e.addClass("minifyBetDetail"),$(this).text("Expand")),webApp.viewManager.getScroll(t).refresh()})},20)}},webApp.extend(webApp.LadbOpenBetsController,webApp.WhOpenBetsController);wh=wh||{};(webApp=webApp||{}).LadbAccountHomeController=function(e,t){webApp.LadbAccountHomeController.superclass.constructor.call(this,e,t);var i=webApp.bookieCollection.getProvider("ladb"),s=!1;this.mainBeforeRender=function(e){return i.isLoggedIn()?((e=this.addBookieCredentialsToView(e,"ladb")).headline="Ladbrokes",e.headlineClass="ladbHeadline",e.trackingId=webApp.eventTracker.getTrackingId(),e):(this._redirect("ladb-home"),{})},this.destroy=function(){s||this.unbindProviderLogout("ladb")},this.mainHeaderBeforeRender=function(e){return this.getRequestParams().hasOwnProperty("from-betslip")&&(e.backUrlHash="bet-slip"),e},this.mainAfterRender=function(){this.bindProviderLogout("ladb"),$("#ladb-logout").click(function(){s=!0,webApp.dataLoading.show("Logging out"),i.logout(),setTimeout($.proxy(function(){var e="You are now logged out of "+webApp.bookieCollection.getProviderName("ladb");webApp.confirmMessage.show(e)},this),1e3)});var e=webApp.bookieCollection,t=e.getCurrentProviderName()!=e.getProviderName("ladb")&&webApp.registry.get("justLogin");if(webApp.registry.remove("justLogin"),t){var r=this.addBookieCredentialsToView({},"ladb");r.btnClass="ladbBtn",r.logoClass="ladbLogo",webApp.landing.show({full:!0,template:"landing-change-price",templateData:r,callback:function(){$("#setNewBookiePrices").bind("click",function(){webApp.prefBookmaker.setWithMessage(r.bookie.index,"Prices now set to "+r.bookie.name),webApp.landing.hide()})}})}}},webApp.extend(webApp.LadbAccountHomeController,webApp.AbstractNodataCredentialsController),(webApp=webApp||{}).LadbWithdrawController=function(e,t){webApp.LadbWithdrawController.superclass.constructor.call(this,e,t),this.mainBeforeRender=function(e){return(e=this.addCredentialsToView(e)).trackingId=webApp.eventTracker.getTrackingId(),e},this.mainAfterRender=function(){var r=this._helper("eventTracker");$("#ladbPhone").bind(r.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var t=webApp.bookieCollection.getProviderName("ladb");r.trackEventById("account_ladb_phone",t);setTimeout(function(){window.location=$("#ladbPhone").attr("href")},1e3)})}},webApp.extend(webApp.LadbWithdrawController,webApp.AbstractNodataCredentialsController),(webApp=webApp||{}).LadbTopUpController=function(e,t){webApp.LadbTopUpController.superclass.constructor.call(this,e,t);var r=this,i=webApp.bookieCollection.getProvider("ladb");this.listener=function(e){i.user().bind(rp.betting.User.EVENT_BALANCE_CHANGED,function(e){r._redirect("ladb-account-home")},r)},this.mainBeforeRender=function(e){return i.isLoggedIn()||this._redirect("ladb-home"),e.apiKey=i.settings().apiKey,e.token=i.token(),e.redirectUrl=i.settings().redirectUrl,e},this.mainAfterRender=function(){i.bind(i.EVENT_DEPOSIT_FUNDS,this.listener,this)},this.destroy=function(){i.unbind(i.EVENT_DEPOSIT_FUNDS)}},webApp.extend(webApp.LadbTopUpController,webApp.AbstractNodataController),(webApp=webApp||{}).BetSlipController=function(e,t){webApp.BetSlipController.superclass.constructor.call(this,e,t),this.MAX_STAKE=99999.99,this.MIN_STAKE=webApp.bookieCollection.getCurrentProvider().settings().minStake,this.postponeBetSlipUpdateAfterEdit=!1,this._scrollInstance=null,this.setScroll=function(){this._scrollInstance=new webApp.blockScroll({blockId:"whBetslipScroll",contentHeight:!0})},this.getTemplate=function(){var e=this.selectionsCollection.selections().length;return e?1<e?"wh-betslip-multiples":"wh-betslip-main":"wh-betslip-empty"},this._preExecute=function(){this._config.blocks.main.template=this.getTemplate(),this.restoreBetslip()},this._postExecute=function(){this.setScroll()},this.destroy=function(){this.unbindLogout(),this.saveBetslip()},this.mainBeforeRender=function(e){if((e=this.addCredentialsToView(e)).currency=this.currencyView(this.currency),e.currencyCode=this.currency,0===this.selectionsCollection.selections().length)return e;e.bets=this.betslip.bets();var t=this._core().getCacheManager();if(t.isCached("card_title")){var r=t._findCache("card_title");e.crsId=r.keys.crs_id,e.raceDate=r.keys.r_date,e.raceId=r.keys.race_id}e.addSelectionsUrl=webApp.isTablet?"#full-card/race_id=next":"#cards-home";var i=webApp.urlManager.getBackUrl(this._name),s=webApp.urlManager.parseHash(i);return"card"==s[0]||"full-card"==s[0]||"cards-horse"==s[0]?e.addSelectionsUrl=i:"predictor"==s[0]&&(s[0]=webApp.isTablet?"full-card":"card",e.addSelectionsUrl=webApp.urlManager.createHash(s)),e},this.hideKeyboardAndCallback=function(e){$(".stake:focus").length&&$(".stake").blur(),setTimeout(e,150)},this.numDenTitle=function(e){var t,r=webApp.userSettings.get("odds");"Evs"===e?t="Evs":r&&"fractional"===r.toString()?(t=e.num(),e.num().toString().match("^(0|[1-9][0-9]*)$")&&(t=t+"/"+e.den())):t=parseFloat(e.decimal()).toFixed(2);return t},this.addMainMenuOverlay=function(){$(".mainMenuOverlay").addClass("mainMenuOverlayShown")},this.mainAfterRender=function(e){this.bindLogout(),webApp.UserBalanceHelper.init(e);var t=this.selectionsCollection.selections().length,r=this._helper("eventTracker"),i=this;if($(".openAccount, #loginBtn").click(function(e){e.preventDefault();var t=$(this).attr("href"),r=webApp.urlManager.parseHash(t);i._redirect(r[0],$.extend({"from-betslip":1,"just-login":1},r[1]))}),0!==t){if(1<t){$("#multiplesEditButton").click($.proxy(function(){r.trackEventById("betslip_edit_selections"),this.switchToEditMode()},this));$("#multiplesEditModeDoneButton").click($.proxy(function(){r.trackEventById("betslip_done"),this.switchFromEditMode()},this));$("#multiplesEditModeDiscardButton").click($.proxy(function(){r.trackEventById("betslip_discard_slip"),this.discardBetslipAndGoToCards()},this))}this._$returns=$("#estimatedReturns"),this._$totalStake=$("#totalStake"),this.initializeDom();var s=$("#betslip-form");$("#addSelectionsBtn").click($.proxy(function(){r.trackEventById("betslip_add_selections")},this)),$(".betSlipHeader > a.btnBack").click(function(){webApp.SelectionsManager.getSelections().length<2&&i.discardBetslip()});var n,a=this;if(webApp.bookieCollection.getCurrentProvider().isLoggedIn())1===this.selectionsCollection.selections().length&&this.selectionsCollection.selections()[0].data().isSuspended&&this._redirect("market-suspend-error",{selectionName:this.selectionsCollection.selections()[0].data().selectionName}),n=function(){a.addMainMenuOverlay(),i.hideKeyboardAndCallback(function(){i.placeBetClick()});var e=webApp.bookieCollection.getCurrentProviderName();return webApp.eventTracker.trackEventById("betslip_place_bet",e),!1},0<this.selectionsCollection.selections().length&&setTimeout(function(){i.checkBetslip(),i.$placeBetButton.click(n)},750),s.bind("submit.bet",function(e){e.preventDefault()});else{var o=webApp.prefBookmaker.get();n=function(){return a.addMainMenuOverlay(),i.hideKeyboardAndCallback(function(){var e=o+"-home";i._redirect(e,{"from-betslip":1})}),!1},$("#logInPlaceBetBtn").click(n),s.bind("submit.bet",function(e){e.preventDefault()})}}},this.checkBetslip=function(){if(webApp.bookieCollection.getCurrentProvider().isLoggedIn()){var r=this;1<this.betslip.bets().length?webApp.dataLoading.show("Calculating available bet types",!0):webApp.dataLoading.show("Validating bet slip",!0),this.getBetSlip(function(e){if(webApp.dataLoading.hide(),r.betslip=e.target.result(),r.redrawBetslip(),r.initValidation(r.betslip.bets()),1===r.betslip.bets().length){var t=r.betslip.bets()[0];r.drawFreeBets(t)}},function(e){webApp.dataLoading.hide(),r.initValidation(r.betslip.bets()),console.log("here we can find errors")})}},this.saveSuspendedSelections=function(e){$.each(e,$.proxy(function(e,t){this.selectionsCollection.updateStatusById(t,"isSuspended",!0)},this)),this.restoreBetslip(),"bet-slip"===webApp.currentControllerName&&this.redrawBetslip(),this.updateTotalAndEstReturns()},this.restoreSuspendedSelections=function(){var r=[];$.each(this.selectionsCollection.selections(),$.proxy(function(e,t){t.data().isSuspended&&r.push(t.id())},this)),this.switchToNoBettingMode(r)},this.switchToNoBettingMode=function(e){var t=this.selectionsCollection.getSuspendedSelections(),r=webApp.registry.get("nobetting");(0<t.length||r)&&(this.$noBettingMessage.show(),r&&webApp.registry.remove("nobetting")),t.length===this.selectionsCollection.selections().length&&(this.$placeBetButton.addClass("placeBetDisabled"),this.$placeBetButton.unbind("click")),$.each(e,$.proxy(function(e,t){var r=$("#selectionRow"+t);r.addClass("multiSelectionBrickNoBet").addClass("noBettingMode"),r.find(this.$includeInMultiples).switchButton("uncheck").switchButton("disabled").addClass("disabledForEdit")},this))},this.switchToEditMode=function(){this.postponeBetSlipUpdateAfterEdit=!0,this.saveBetslip(),$("#betslip-form").addClass("editMode"),this._disableForEdit(this.$sp,this.$includeInMultiples,this.$eachWay),this.$stake.prop("disabled",!0),$("#webApp a").off("click"),this._disableAllLinks(),$(".betSlipHeader a").addClass("btnDisabled")},this._disableAllLinks=function(){$("#webApp a").bind("click.disableBetting",function(e){e.preventDefault()})},this._disableForEdit=function(){$(arguments).each(function(e,t){t.each(function(e,t){var r=$(t);r.is(":disabled")||r.switchButton("disabled").addClass("disabledForEdit")})})},this.switchSelectionRowToEditMode=function(e){if($("#betslip-form").hasClass("editMode"))return!1;this.postponeBetSlipUpdateAfterEdit=!1,e.addClass&&setTimeout(function(){e.addClass("editMode")},1);var t=this._findButtonsInSelectionRow(e);this._disableForEdit(t),this._helper("eventTracker").trackEventById("betslip_swipe_editing",webApp.bookieCollection.getCurrentProviderName())},this._findButtonsInSelectionRow=function(e){return e.find("input[type=checkbox]")},this._leaveSelectionRowEditMode=function(e){this._findButtonsInSelectionRow(e).each(function(e,t){var r=$(t);r.is(":disabled")&&r.hasClass("disabledForEdit")&&r.switchButton("enabled").removeClass("disabledForEdit")}),e.removeClass("editMode")},this.switchFromEditMode=function(){this.restoreBetslip(),1<this.selectionsCollection.selections().length&&this.checkBetslip(),1===this.selectionsCollection.selections().length&&this.selectionsCollection.selections()[0].data().isSuspended&&this._redirect("market-suspend-error",{selectionName:this.selectionsCollection.selections()[0].data().selectionName}),this.redrawBetslip(),$("#betslip-form").removeClass("editMode"),$("#webApp a").unbind("click.disableBetting"),$(".betSlipHeader a").removeClass("btnDisabled")},this.discardBetslipAndGoToCards=function(){this.discardBetslip();var e=webApp.urlManager.parseHash(webApp.configs.defaultHash);this._redirect(e[0],e[1])},this.discardBetslip=function(){webApp.SelectionsManager.removeAllSelections(),this.forgetBetslip()},this.drawFreeBets=function(i){var s=i.freeBets(),n=this.currency,a=l._core().getViewManager(),o=this.getCurrencySign(n)?this.getCurrencySign(n):"";if(s&&0<s.length){var c=webApp.bookieCollection.getCurrentBookieParams();$.each(s,function(r,e){var t={position:r,tokenId:e.id(),amount:e.amount().toFixed(2),currency:l.currencyView(n)};$("#freeBetsBlock").append(a.renderTpl("wh-free-bet-row",t)),$("#link"+r).click(function(){return alert(e.name()+"\n\nAmount: "+o+e.amount().toFixed(2)+"\nExpires: "+moment(e.expires()).format(utils.moment.FORMAT_FULL_DATETIME)+"\nSee "+c.webSite+" for Ts & Cs"),!1}),$("#freeBet"+r).switchButton({checked:e.selected(),enableText:"Yes",callback:$.proxy(function(e,t){l._handleFreeBetChange(e,i,s[r],t)},this),disableText:"No"}).data({pos:r})})}this.$freeBets=$(".freeBet"),this._scrollInstance.setSize()},this._handleFreeBetChange=function(r,e,i,s){this.$freeBets.each($.proxy(function(e,t){var r=$(t);r.data("switchButton").$button!==s&&r.attr("checked")&&r.switchButton("uncheck")},this)),$.each(e.freeBets(),$.proxy(function(e,t){t!==i?t.selected(!1):i.selected(r)},this)),webApp.eventTracker.trackEventById("betslip_bet_offer",webApp.bookieCollection.getCurrentProviderName()+(r?" Yes":" No"));var t=webApp.prefBookmaker.get();if(1==$(".betField").length)var n=$(".betField");r?(n.addClass("color"),this.$stake.addClass("useFreeBetOffer-"+t),setTimeout(function(){alert("Your total stake will now include this bet offer")},1)):(n.removeClass("color"),this.$stake.removeClass("useFreeBetOffer-"+t))},this.initializeDom=function(){var s=this._helper("eventTracker");this.$stake=$("input.stake"),this.$eachWay=$("input.winOrEw"),this.$sp=$("input.betPrice"),this.$includeInMultiples=$("input.includeInMult"),this.$removeSelection=$("span.removeSelection"),this.$noBettingMessage=$(".messageBrick"),this.$placeBetButton=$("#placeBetBtn"),this.$betSlipForm=$("#betslip-form"),null===this.$stake||webApp.isAndroid_4_x||this.$stake.keyup(this.restrictStake);var n=this.betslip.bets();if(1===n.length){var e=n[0].selections()[0];e.data().isBOG?($("#oddsTitle").hide(),$("#oddsTitleImg").show(),$("#oddsTitleImg").click(function(){alert("Best Odds Guaranteed \n\n Best Odds Guaranteed is our way of ensuring that you get the best possible price for your bets. If you placed a bet in a Best Odds Guaranteed race and take the price available at the time, if the SP (Starting Price) is a better price, we’ll settle your bet at that better price! \n\nThis means no more disappointment if the price gets better and better, you’re guaranteed whichever is higher - the SP or the price you took.")})):e.hasPrice()||$("#oddsTitle").text("Starting Price Only")}this.$sp.each($.proxy(function(r,e){$(e).switchButton({checked:!0,enableText:"&nbsp;",disableText:"SP",callback:$.proxy(function(e){var t=e?"Disable":"Enable";s.trackEventById("bets_starting_price",t),this._handleSPChange(e,n[r])},this)});var t=n[r].selections()[0],i=$(e).next();t.hasPrice()?(i.html(this.numDenTitle(t.price())),$(e).switchButton("check"),t.isSP()&&$(e).switchButton("uncheck"),t.isTrapChallengePrice()&&($(e).switchButton("disabled"),$(e).switchButton("highlightPrice"))):(i.html("Odds"),$(e).switchButton("uncheck").switchButton("disabled"))},this)),this.$eachWay.each($.proxy(function(i,e){$(e).switchButton({checked:!0,enableText:"Win",disableText:"EW",callback:$.proxy(function(e,t){var r=e?"Disable":"Enable";s.trackEventById("bets_each_way",r),this._handleEachWayChange(e,n[i],this.$stake[i],t)},this)}),1<n.length&&$(e).parent().addClass("txtSwitcher");var t=n[i];t.isEachWayAllowed()?($(e).switchButton("enabled"),t.isEachWay()&&$(e).switchButton("uncheck")):$(e).switchButton("check").switchButton("disabled")},this)),this.$stake.each($.proxy(function(e,t){$(t).change($.proxy(function(){this._handleStakeChange(t,n[e])},this));var r=n[e].stake();0!==parseFloat(r)&&$(t).val(r.toFixed(2)).addClass("change")},this)),this.$includeInMultiples.each($.proxy(function(t,e){var r=n[t].selections()[0];r.isTrapChallengePrice()?$(e).remove():($(e).switchButton({checked:!0,extraClass:"customCheck",enableText:"",disableText:"",callback:$.proxy(function(e){this._handleIncludeInMultiples(e,n[t])},this)}),r.data().includeInMultiple?$(e).switchButton("check"):$(e).switchButton("uncheck"))},this));var r=new webApp.SwipeToEditPlugin(".multiSelectionBrick");r.init(),r.beforeEditModeOn=$.proxy(this.switchSelectionRowToEditMode,this),r.onLeaveEditMode=$.proxy(this._leaveSelectionRowEditMode,this),this.$removeSelection.each($.proxy(function(t,e){$(e).click($.proxy(function(e){this._handleSelectionRemove(n[t].selections()[0],e),r.leaveEditMode()},this))},this)),1==$(".betField").length&&$(".betField").addClass("border"),$(".betField").bind("blur.hightlight",function(){$(this).val()?$(this).addClass("change"):$(this).removeClass("change")}),this.restoreSuspendedSelections(),this.initValidation(n),this.saveBetslip(),this.updateTotalAndEstReturns()},this.updateTotalAndEstReturns=function(){if(!this._$returns)return!1;$.each(this.betslip.bets(),$.proxy(function(e,t){var r=this.betslip.bets()[e];if(!r.isSingle()){var i=this.$stake[e];if(""===$(this.$stake[e]).val())$(i).closest(".innerCont").find(".multEstReturns").html("").removeClass("show");else{var s="N/A";isNaN(r.returns())||(s=r.returns()),$(i).closest(".innerCont").find(".multEstReturns").html("Est Return "+this.currencyView(this.currency)+s).addClass("show")}}},this));var e="N/A";this.selectionsCollection.selections().length===this.selectionsCollection.getSPSelections().length||isNaN(this.betslip.estimatedReturns())||(e=this.betslip.estimatedReturns().toFixed(2)),this._$returns.html(this.getCurrencySign(this.currency)+e),this._$totalStake.html(this.getCurrencySign(this.currency)+this.betslip.totalStake().toFixed(2))},this.redrawBetslip=function(){var e={};1<this.selectionsCollection.selections().length?(e.bets=this.betslip.bets(),e.currency=this.currencyView(this.currency),e.currencyCode=this.currency,$("#single-bets").empty().append(this.viewManager.renderTpl("multiples-single-bet-row",e)),$("#multiple-bets").empty().append(this.viewManager.renderTpl("multiples-multiple-bet-row",e)),this.initializeDom(),this._scrollInstance.setSize()):this._config.blocks.main.template!==this.getTemplate()&&(this.viewManager.flash(this._name),this.execute(),this.setScroll())},this._handleStakeChange=function(e,t){var r=this._normalizeStake(e.value),i=Math.max(parseFloat(r)||0,0);$(e).val(r),t.stake(i),1<this.selectionsCollection.selections().length&&this.$betSlipForm.data("validator")&&$(e).valid(),this.updateTotalAndEstReturns(),this._scrollInstance.refresh()},this._normalizeStake=function(e){var t=e.replace(",",".");return(t=Math.max(parseFloat(t)||0,0))?t.toFixed(2):e},this.validateBetSlip=function(e){var t=!0;return(t=this.$betSlipForm.valid())&&0===this.betslip.getBetsWithStake().length&&(!0!==e&&alert("No Stake Entered\nPlease enter a valid stake"),t=!1),t},this.initValidation=function(e){if(webApp.bookieCollection.getCurrentProvider().isLoggedIn()){var o=this.getCurrencySign(this.currency),c=1<this.selectionsCollection.selections().length;this.$betSlipForm.removeData("validator"),this.$betSlipForm.validate({showErrors:function(e,t){var r="";$.each(t,$.proxy(function(e,t){r+=t.message+"\n"},this)),1===t.length?r+="Please enter a valid stake":1<t.length&&(r+="Please enter valid stakes"),0<t.length&&(r=$("<textarea />").html(r).text(),alert(r))},onfocusout:!1,onkeyup:!1,onsubmit:!1}),$.each(e,$.proxy(function(e,t){var r=0===t.minStake()?this.MIN_STAKE:t.minStake(),i=t.maxStake()===1/0?this.MAX_STAKE:t.maxStake(),s="";if(c){var n=utils.bet.getBetTypeName(t),a=t.selections()[0].data().selectionName;s+="Stake for "+(t.isSingle()?a:n)+" is incorrect\n"}$(this.$stake[e]).rules("add",{min:r,max:i,messages:{number:s,min:s+"Min Stake: "+o+r+"\n",max:s+"Max Stake: "+o+i+"\n"}})},this)),webApp.registry.get("invalidstake")&&(this.validateBetSlip(),webApp.registry.remove("invalidstake"))}},this._handleEachWayChange=function(e,t,r,i){t.isEachWay(!e),1<this.selectionsCollection.selections().length&&(i.closest(".innerCont").find(".colB > span.betCounter").html(t.betCounter()),i.closest(".innerCont").find(".colB > span.betName").html(utils.bet.getBetTypeName(t,!0))),this.updateTotalAndEstReturns()},this._handleSPChange=function(e,t){t.hasSelections()&&1===t.selections().length&&t.selections()[0].isSP(!e),this.updateTotalAndEstReturns()},this._handleIncludeInMultiples=function(e,t){this.saveBetslip(),t.hasSelections()&&1===t.selections().length&&this.selectionsCollection.updateStatus(t.selections()[0],"includeInMultiple",e),this.restoreBetslip(),this.checkBetslip(),this.redrawBetslip()},this._handleSelectionRemove=function(e,t){if(this.selectionsCollection.remove(e),$(t.target).closest(".bricks").remove(),!$(".noBettingMode").length){this.$noBettingMessage.hide();var r=this.selectionsCollection.selections().length;if(0===r||1===r&&!this.selectionsCollection.selections()[0].data().isSuspended)return void this.redrawBetslip()}this._scrollInstance.setSize(),this.postponeBetSlipUpdateAfterEdit||this.switchFromEditMode()},this.placeBetClick=function(){var e=webApp.dataLoading.hide;this.validateBetSlip()?(this.saveBetslip(),webApp.placeBet(this.betslip,e,e),webApp.dataLoading.show("Sending Bet Details")):e()};var l=this;this.restrictStake=function(){var e=$(this),t=e.val(),r=t.indexOf("."),i=3<t.substr(r).length;(isNaN(t)||i)&&0<t.length&&"."!==t&&(e.val(t.substring(0,t.length-1)),e.trigger("change"))},this.getCurrencySign=function(e){var t={},r=null;return t[this.CURRENCY_UK_POUND]="£",t[this.CURRENCY_EURO]="€",t[this.CURRENCY_US_DOLLAR]="$",t.hasOwnProperty(e)&&(r=t[e]),r},webApp.placeBet=function(r,i,t){webApp.bookieCollection.getCurrentProvider().placeBet(r).error(function(e){s(e),"function"==typeof t&&t(e)}).success(function(t){webApp.bookieCollection.getCurrentProvider().getBalance().success(function(e){l.betslip=t.target.result(),l.saveBetslip(),"function"==typeof i&&i(),l.saveBetsForBetToWatch(r),l._redirect("receipt",{})})})},this.saveBetsForBetToWatch=function(e){for(var t=e.getBetsWithStake(),r=0;r<t.length;r++)for(var i=t[r].selections(),s=0;s<i.length;s++){var n=i[s];webApp.openBets.saveOpenBets({selectionId:n.id(),race_id:n.data().raceId,race_ts:n.data().raceTs,unitStake:e.totalStake()})}},this.getBetSlip=function(t,r){webApp.bookieCollection.getCurrentProvider().getBetSlip(this.betslip).error(function(e){s(e,!0),"function"==typeof r&&r(e)}).success(function(e){"function"==typeof t&&t(e)})};var s=function(e,t){var r=e.target.result(),i=r.code(),s=webApp.prefBookmaker.get(),n=webApp.bookieCollection.getCurrentErrorClassName();switch(i){case n.INVALID_BACK_END_REQUEST:webApp.genericWhErrorHandler(r);break;case n.INVALID_SESSION_TOKEN:case n.EXPIRED_SESSION_TOKEN:case n.EXPIRED_OR_INVALID_SESSION_TOKEN:break;case n.GENERIC_ERROR:t||l._redirect("generic-error",{});break;case n.STATUS_CHANGED:if(!t){var a=r.data();1==l.betslip.bets().length?l._redirect("market-suspend-error",{selectionName:l.betslip.bets()[0].selections()[0].data().selectionName}):(l.saveSuspendedSelections(a),"bet-slip"==webApp.currentControllerName?(l.$noBettingMessage.show(),l._scrollInstance.setSize(),l.checkBetslip()):(webApp.registry.set("nobetting",!0),l._redirect("bet-slip",{})))}break;case n.PRICE_CHANGED:l._redirect("price-changed-error",{r:Math.random()});break;case n.INSUFFICIENT_FUNDS:t||(webApp.bookieCollection.getCurrentProvider().getBalance(),l._redirect(s+"-top-up",{}));break;case n.STAKE_TOO_LOW:case n.STAKE_TOO_HIGH:if(r.data()instanceof rp.betting.BetSlip)if("bet-slip"===webApp.currentControllerName){l.initValidation(r.data().bets());l.validateBetSlip(!0)}else webApp.registry.set("invalidstake",!0),l._redirect("bet-slip",{});break;default:l._redirect("generic-error",{})}};$(window).bind(webApp.EVENT_BETSLIP_EMPTIED,$.proxy(this.discardBetslip,this))},webApp.extend(webApp.BetSlipController,webApp.AbstractNodataCredentialsController),(webApp=webApp||{}).ReceiptController=function(e,t){webApp.ReceiptController.superclass.constructor.call(this,e,t),this.reuseSelections=null,this.genericGAEventLabel="",this._postExecute=function(){new webApp.blockScroll({blockId:"whBetslipReceiptScroll",contentHeight:!0})},this.getBackUrl=function(){var e="price-changed-error"==webApp.urlManager.findBackCollection("bet-slip")[1].controller,t=webApp.urlManager.getBackUrl("bet-slip",2);return e?webApp.urlManager.getBackUrl("bet-slip",3):"#account-home/"==t?webApp.urlManager.getBackUrl("bet-slip",5):0<=t.indexOf("card")?webApp.urlManager.getBackUrl("bet-slip",2):"#card"},this.addMainMenuOverlay=function(){$(".mainMenuOverlay").addClass("mainMenuOverlayShown")},this.destroy=function(){!1===this.reuseSelections&&webApp.SelectionsManager.removeAllSelections(),this.addMainMenuOverlay()},this.mainAfterRender=function(e){webApp.UserBalanceHelper.init(e);var t=$("#reuseSelections");1<this.selectionsCollection.selections().length?t.switchButton({checked:!0,enableText:"No",disableText:"Yes",callback:$.proxy(function(e){webApp.eventTracker.trackEventById("bet_receipt_reuse_selections",this.genericGAEventLabel),this.reuseSelections=!e,this.updateDoneButton(this.reuseSelections)},this)}):t.closest(".panels").hide(),this.reuseSelections=!1},this.mainBeforeRender=function(e){var t=this.addCredentialsToView(e);if(this.betslip=this.loadBetslip(),!this.betslip){var r=webApp.urlManager.parseHash(webApp.configs.defaultHash);return this._redirect(r[0],r[1]),!1}var i=this.betslip.getBetsWithReceiptId();if(0===i.length){r=webApp.urlManager.parseHash(webApp.configs.defaultHash);return this._redirect(r[0],r[1]),!1}var s=webApp.userSettings.get("odds");return t.isDecimalOdds="decimal"===s,t.currencySymbol=this.currencyView(this.currency),t.backUrl=this.getBackUrl(),t.bets=i,this.genericGAEventLabel=this.makeGenericGAEventLabel(i),t.genericGAEventLabel=this.genericGAEventLabel,this.forgetBetslip(),this.restoreDefaultIncludeInMultiple(),this.restoreDefaultSP(),t},this.replaceSlashInUrl=function(e){var t=e.length;return e=e.substr(0,t-1)},this.makeGenericGAEventLabel=function(e){for(var t=[],r=[],i=0,s=e.length;i<s;i++)t.push(e[i].receiptId()),r.push(e[i].typeName());var n=t.join(", "),a=r.join(", ");return n+" - "+webApp.bookieCollection.getCurrentProviderName()+" - "+a},this.updateDoneButton=function(e){var t=$("#receiptDone");e?t.text("Return to Slip").attr("href","#bet-slip").attr("data-eventid","bet_receipt_return_to_slip"):t.text("Done").attr("href","#meeting-list").attr("data-eventid","bet_receipt_done")}},webApp.extend(webApp.ReceiptController,webApp.AbstractNodataCredentialsController),(greyhoundbet=greyhoundbet||{}).ReceiptController=function(e,t){greyhoundbet.ReceiptController.superclass.constructor.call(this,e,t)},webApp.extend(greyhoundbet.ReceiptController,webApp.ReceiptController),(webApp=webApp||{}).BetsExplainedController=function(e,t){webApp.BetsExplainedController.superclass.constructor.call(this,e,t);var a="";this.mainBeforeRender=function(e){a=this.getRequestParams();var t=parseInt(a.anchor),r=new rp.betting.Bet({type:t}),i=utils.bet.getBetTypeName(r);-1!=i.indexOf("fold")&&(i="Accumulator"),a=i.replace(" ","").toLowerCase()},this.mainAfterRender=function(){var i,s=webApp.viewManager.getScroll("bets-explained"),n=$(".whAdContainer");if(""!=a){i=n.is(":visible")?n.outerHeight(!0):0;var e=$("#"+a).offset().top;s.scrollTo(0,-e+i+65,0)}$("ul > a").click(function(e){e.preventDefault(),$(this).addClass("noHighlight"),i=n.is(":visible")?n.outerHeight(!0):0;var t=$(this).attr("href"),r=$(""+t).offset().top;s.scrollTo(0,-r+i+65,0)})}},webApp.extend(webApp.BetsExplainedController,webApp.AbstractNodataCredentialsController),(webApp=webApp||{}).GenericErrorController=function(e,t){webApp.GenericErrorController.superclass.constructor.call(this,e,t),this._scrollInstance=null,this._postExecute=function(){this._scrollInstance=new webApp.blockScroll({blockId:"betslipErrorScroll",contentHeight:!0})},this._preExecute=function(){var e=webApp.prefBookmaker.get();this._config.blocks.main.template=e+"-generic-error"},this.errorRedirect=function(){this._redirectAndExit("cards-home")},this.destroy=function(){this.unbindLogout()},this.mainBeforeRender=function(e){webApp.bookieCollection.getCurrentProvider().isLoggedIn()||this.errorRedirect();var t=this.addCredentialsToView(e);return $.extend(t,this.getRequestParams()),t.currency=webApp.bookieCollection.getCurrentProvider().user().currency(),t.backUrl=webApp.registry.get("backUrlHash")||!1,t.backUrl&&(t.backUrl=t.backUrl.replace("predictor","card")),t},this.mainAfterRender=function(e){this.bindLogout();var t=webApp.prefBookmaker.get();webApp.UserBalanceHelper.init(e),$("#"+t+"HomeRedirect").click($.proxy(function(){return webApp.bookieCollection.getCurrentProvider().isLoggedIn()?this._redirect(t+"-account-home"):this._redirect(t+"-home"),!1},this))}},webApp.extend(webApp.GenericErrorController,webApp.AbstractNodataCredentialsController),(webApp=webApp||{}).MarketSuspendErrorController=function(e,t){webApp.MarketSuspendErrorController.superclass.constructor.call(this,e,t),this._scrollInstance=null,this._postExecute=function(){this._scrollInstance=new webApp.blockScroll({blockId:"betslipMarketSuspendErrorScroll",contentHeight:!0})},this._preExecute=function(){var e=webApp.prefBookmaker.get();this._config.blocks.main.template=e+"-market-suspend-error"},this.errorRedirect=function(){this._redirectAndExit("cards-home")},this.destroy=function(){this.unbindLogout()},this.mainAfterRender=function(e){this.bindLogout(),webApp.UserBalanceHelper.init(e),$(".btnError").click(function(e){webApp.SelectionsManager.removeAllSelections()})},this.mainBeforeRender=function(e){webApp.bookieCollection.getCurrentProvider().isLoggedIn()||this.errorRedirect(),e=this.addCredentialsToView(e),$.extend(e,this.getRequestParams());var t=webApp.bookieCollection.getCurrentProvider().user().currency();return e.currency=this.currencyView(t),e.backUrl=this.getBackUrl(),e.backUrl&&(e.backUrl=e.backUrl.replace("predictor","card")),e},this.getBackUrl=function(){return webApp.registry.get("backUrlHash")||!1}},webApp.extend(webApp.MarketSuspendErrorController,webApp.AbstractNodataCredentialsController),(webApp=webApp||{}).PriceChangedErrorController=function(e,t){webApp.PriceChangedErrorController.superclass.constructor.call(this,e,t),this._scrollInstance=null,this._preExecute=function(){var e=webApp.prefBookmaker.get();this._config.blocks.main.template=e+"-price-changed-error"},this.destroy=function(){this.unbindLogout()},this.mainAfterRender=function(e){this.bindLogout(),this._scrollInstance=new webApp.blockScroll({blockId:"betslipPriceChangedErrorScroll",contentHeight:!0}),webApp.UserBalanceHelper.init(e),this.betslip.removeOldPrices(),$("#placeBet").click($.proxy(function(e){e.preventDefault(),webApp.placeBet(this.betslip,function(){webApp.dataLoading.hide()},function(){webApp.dataLoading.hide()}),webApp.dataLoading.show("Sending Bet Details")},this))},this.errorRedirect=function(){this._redirectAndExit("cards-home")},this.mainBeforeRender=function(e){if(webApp.bookieCollection.getCurrentProvider().isLoggedIn()||this.errorRedirect(),e=this.addCredentialsToView(e),this.restoreBetslip(),e.betslip=this.betslip,e.betslip.hasOldPrices())return e.backUrl=this.getBackUrl(),e.currency=this.currencyView(this.currency),e;this._redirectAndExit("bet-slip")},this.getBackUrl=function(){return!1}},webApp.extend(webApp.PriceChangedErrorController,webApp.AbstractNodataCredentialsController);wh=wh||{};(webApp=webApp||{}).ConnectivityCheckController=function(e,t){webApp.ConnectivityCheckController.superclass.constructor.call(this,e,t),webApp.ConnectivityCheckController.CHECK_XML_SERVER="",webApp.ConnectivityCheckController.CHECK_DIFFUSION="",webApp.ConnectivityCheckController.CHECK_AD_SERVER="",webApp.ConnectivityCheckController.CHECK_WH="",webApp.ConnectivityCheckController.CHECK_GOOGLE="",webApp.ConnectivityCheckController.CHECK_TYPE_IMG="image",webApp.ConnectivityCheckController.CHECK_TYPE_METHOD="method",webApp.ConnectivityCheckController.checkData={xmlServer:{checkType:webApp.ConnectivityCheckController.CHECK_TYPE_METHOD,method:function(){webApp.ConnectivityCheckController.checkXmlServer()},displayName:"Connect to Web server"},diffusion:{checkType:webApp.ConnectivityCheckController.CHECK_TYPE_METHOD,method:function(){webApp.ConnectivityCheckController.checkDiffusion()},displayName:"Connect to Diffusion"},adServer:{checkType:webApp.ConnectivityCheckController.CHECK_TYPE_IMG,url:"http://images.racingpost.com/2008/Nov/tb1760.jpg",displayName:"Connect to Images server"},google:{checkType:webApp.ConnectivityCheckController.CHECK_TYPE_IMG,url:"https://www.google.com/images/swxa.gif",displayName:"Connect to Internet"},whServer:{checkType:webApp.ConnectivityCheckController.CHECK_TYPE_METHOD,method:function(){webApp.ConnectivityCheckController.checkWh()},displayName:"Connect to William Hill"},ladbServer:{checkType:webApp.ConnectivityCheckController.CHECK_TYPE_METHOD,method:function(){webApp.ConnectivityCheckController.checkLadb()},displayName:"Connect to Ladbrokes"}},this.mainBeforeRender=function(e){return e.checkData=webApp.ConnectivityCheckController.checkData,e},this.mainAfterRender=function(){for(var e in webApp.ConnectivityCheckController.checkData)webApp.ConnectivityCheckController.checkData[e].checkType==webApp.ConnectivityCheckController.CHECK_TYPE_METHOD&&webApp.ConnectivityCheckController.checkData[e].method()},webApp.ConnectivityCheckController.checkDiffusion=function(){if(DiffusionConnector.isConnected){var e=$("#diffusionStatus");e.closest("li").append("<em>"+DiffusionConnector.getClient().diffusionTransport.clientID+"</em>"),e.addClass("ok")}},webApp.ConnectivityCheckController.checkXmlServer=function(){$.get(webApp.URL_SELF_CHECK,function(e){var t=e;if(t.raceId){var r=$("#xmlServerStatus");r.closest("li").append("<em>"+t.serverIP+"</em>"),r.addClass("ok")}})},webApp.ConnectivityCheckController.checkWh=function(){var e=webApp.bookieCollection.getProvider("wh"),t=$("#whServerStatus");t.closest("li").append("<em>Host: "+e.url()+"</em><em>Prices: "+webApp.bookiesCollection.wh.diffName+"</em>"),e.getBalance().error(function(e){e.target.result().data()&&t.addClass("ok")}).success(function(){t.addClass("ok")})},webApp.ConnectivityCheckController.checkLadb=function(){webApp.bookieCollection.getProvider("ladb").checkConnection().success(function(){$("#ladbServerStatus").addClass("ok")})},webApp.ConnectivityCheckController.checkImage=function(e,t){$("#"+e).attr("id");t&&$("#"+e+"Status").addClass("ok")}},webApp.extend(webApp.ConnectivityCheckController,webApp.AbstractNodataCredentialsController);var utils=utils||{};webApp=webApp||{};(greyhoundbet=greyhoundbet||{}).MeetingListController=function(e,t){greyhoundbet.MeetingListController.superclass.constructor.call(this,e,t),this._$orderMenuItems=null,this.meetingsAvailable=!0,this._preExecute=function(){var e,t,r,i,s,n,a,o;if(i=(t=(e=this.getRequestParams()).r_date)||"",s=(r=utils.date.toString(utils.date.getSynchronizedToServerNow())).split("-"),n=i.split("-"),a=new Date(parseInt(s[0]),parseInt(s[1])-1,parseInt(s[2])),o=new Date(parseInt(n[0]),parseInt(n[1])-1,parseInt(n[2])),"trapDraws"!=t&&(!t||!utils.date.isDate(t)||o.getTime()<a.getTime()))return e.r_date=r,void this._redirectAndExit(this.getName(),e);webApp.registry.get("meetingRacesTime")&&webApp.registry.set("meetingRacesTime",!1),e.view=e.view||webApp.userSettings.get("cardsListBy"),this.setRequestParams(e);var c="trapDraws"!=t?e.view:"trap";this._setupCardsListTemplate(c)};var s={};this.headerBeforeRender=function(e){var t=this.getRequestParams();s=e,(e={}).raceDate=t.r_date;var r=new Date(t.r_date.replace(/(\d+)-(\d+)-(\d+)/,"$2/$3/$1"));return e.listDate=r.format("ddd dd mmm"),e},this.headerAfterRender=function(e){var t=this.getRequestParams(),r=this,i=t.view;"trapDraws"==t.r_date?$("#cardsListOrderButtons").hide():($("#cardsListOrderButtons").show(),this._$orderMenuItems=$("#cardsListOrderButtons li"),this._setActiveOrderItem(i),this._$orderMenuItems.click(function(){var e=$(this).attr("id").split("-");r._setActiveOrderItem(e[1]),webApp.userSettings.set("cardsListBy",e[1]);var t="cards_by_"+e[1];webApp.eventTracker.trackEventById(t)})),webApp.BottomMenuControl.init({btnSelector:"#meetingsDateBtn",urlParam:"r_date",items:{date:{days:s},trapDraws:{urlParamValue:"trapDraws",text:"Trap Draws",btnText:'<span class="trapDrawsBtn">&nbsp;</span>'}},callback:function(e){}}),webApp.Calendar.init({$appendTo:$("body"),orientation:webApp.orientation.toLowerCase(),maxYearsBack:5})},this.setupNextRace=function(e){var t=this,r=this._getCache("list");r.hasOwnProperty("next_race")&&r.next_race?this.isTodaysDateRequested()?$("#nextRaceOff").bind("click.nextRace",function(){webApp.viewManager.animationType="own",webApp.eventTracker.trackEventById("cards_next_race"),webApp.registry.set("processingNextRace",!0),webApp.isTablet?webApp.urlManager.changeParams(r.next_race):t._redirect("card",r.next_race)}):$("#nextRaceOff").addClass("hideNextRaceOff"):$("#nextRaceOff").addClass("nextRaceOffDisabled")},this._getNextRace=function(){var e=this._getCache("list"),t=this._orderRacesByTime(e.items),r=utils.date.getSynchronizedToServerNow().getTime(),i=null;return $.each(t,function(){var e=parseInt(utils.date.fromString(this.raceDate,0).getTime(),10);if(r<e&&"IRE"!==this.country)return i=this,!1}),i},this._setActiveOrderItem=function(e){this._$orderMenuItems.removeClass("active"),"meetings"===e?this._$orderMenuItems.eq(0).addClass("active"):this._$orderMenuItems.eq(1).addClass("active")},this._setupCardsListTemplate=function(e){var t=this._config.blocks.list;t.template="trap"===e?"trap-draws-meetings-list":"time"===e?"meeting-list-by-time":"meeting-list-by-meeting"},this.pushData=function(e){for(var t in this._blocksToLoad){var r=this._blocksToLoad[t];if(e[r])if(void 0!==e[r].errorCode&&"404"==e[r].errorCode)if("list"==r)this._setCache(r,e[r]),this._setCache("empty-list",{});else{var i={errorMessage:e[r].errorMessage||"",referer:this._name,errorHash:window.location.hash};this._deligate("error404",i)}else this._setCache(r,e[r]);else this.getBlockConfig(r).cacheId||this._setCache(r,{})}return this},this.renderEmpty=!1,this._findBlocksToRender=function(){var e=[];return this.renderEmpty?(e=["header","empty-list"],this.renderEmpty=!1):e=["header","list"],e},this.listBeforeRender=function(e){var t=this.getRequestParams(),r=t.view;if(this.renderEmpty=!1,this.meetingsAvailable=e.meetingsAvailable||"trapDraws"===t.r_date,this.meetingsAvailable)if("trapDraws"!=t.r_date)this.isTodaysDateRequested()?e.cardTab=webApp.userSettings.get("cardTab"):e.cardTab="form",e.isIos=webApp.isIDevice,"time"===r?(e.items=e.items.filter(function(e){return e.races=e.races.filter(function(e){var t=-1!==["1","5","11","18","98"].indexOf(e.trackId),r=Boolean(e.tvId),i="S"===e.actBagsCde||"B"===e.actBagsCde;return t||r||i}),0<e.races.length}),e.items=this._orderRacesByTime(e.items),this.addDateAndTime(e.items,function(){return this.raceDate})):(e.items.sort(this._sortTrackByFirstRace),this.addDateAndTime(e.items,function(){return this.races[0].raceDate}));else for(var i in e){var s=utils.date.fromString(i+" 00:00",0);e[i].d=s.format("dddd dd mmmm")}return e},this.addDateAndTime=function(e,t){for(var r=0,i=e.length;r<i;r++){var s=e[r],n=t.call(e[r]);s.raceYYYYMMDD=n.split(" ")[0],s.raceHHMM=n.split(" ")[1],s.isTodaysDateRequested=this.isTodaysDateRequested()}},this.listAfterRender=function(e){"trapDraws"!=this.getRequestParams().r_date&&this.meetingsAvailable&&this.setupNextRace(e),webApp.searchFormInit(),webApp.isDesktop||webApp.viewManager.getScroll(this._name).scrollTo(0,-44,0),0<$(".raceListTime li ").length&&$(".irish-races-only").removeClass("irish-races-only")},this._orderRacesByTime=function(r){var i,s=[];return $.each(r,function(t){$.each(r[t].races,function(e){"R"!=r[t].races[e].raceStatus&&((i=r[t].races[e]).track=r[t].track,i.racesCount=r[t].racesCount,i.firstRace=r[t].firstRace,i.lastRace=r[t].lastRace,i.tvShortName=r[t].tvShortName,i.isNonBetting=r[t].isNonBetting,s.push(i))})}),s.sort(this._sortRacesByTimestamp),s},this._sortRacesByTimestamp=function(e,t){var r=utils.date.fromString(e.raceDate,0),i=utils.date.fromString(t.raceDate,0);return r<i?-1:i<r?1:0},this._sortTrackByFirstRace=function(e,t){var r=utils.date.fromString(e.firstRace,0),i=utils.date.fromString(t.firstRace,0);return r<i?-1:i<r?1:0}},webApp.extend(greyhoundbet.MeetingListController,webApp.AbstractController);var greyhoundbet=greyhoundbet||{};webApp.currentRace=0,greyhoundbet.MeetingRacesController=function(e,t){greyhoundbet.MeetingRacesController.superclass.constructor.call(this,e,t),this._preExecute=function(){(!webApp.isDesktop&&this.isPastDateRequested()||!webApp.isDesktop&&this.accessedFromBookmark())&&this._redirectAndExit("meeting-list")},this.data={},this.tipsBeforeRender=function(e){if(e.hasOwnProperty("tips")){for(var t,r,i=e.tips,s=i.length,n=0;n<s;n++)0===n?r=0:i[t=n].race_id===i[r].race_id?(i.splice(r,1),s=i.length):r=t;$.extend(this.data,{tips:i,tipsAvailable:"true"})}else $.extend(this.data,{tips:{},tipsAvailable:"false"})},this.listBeforeRender=function(e){var t=this.getRequestParams().r_time;webApp.registry.set("meetingRacesTime",t);var r=new Date(e.items[0].firstRace.replace(/(\d+)-(\d+)-(\d+)/,"$2/$3/$1"));$("#meetingHeaderTitle").html(e.items[0].track),$("#meetingBack").html(r.format("mmm dd")),$("#meetingBack ").parent().attr("href","#meeting-list/view=meetings&r_date="+e.items[0].firstRace.split(" ")[0]),$("#meetingBack").click(function(){webApp.eventTracker.trackEventById("cards_back")});var i="",s=e.items[0].firstRace.split(" ")[0];i=utils.moment.getSynchronizedToServerNow(0,"YYYY-MM-DD")!=s?"form":webApp.userSettings.get("cardTab"),webApp.raceDistances=e.items[0].races;var n=e.items[0].races,a=n.length,o=this.data.tips,c=[];if(o.length&&a!==o.length){for(var l=0,d=0;l<a;l++)o[d]?n[l].raceId!==o[d].race_id?c.push({}):(c.push(o[d]),d++):c.push({});this.data.tips=c}return $.extend(this.data,{list:e.items[0],cardTab:i}),this.data},this.headerBeforeRender=function(e){return{}},this.listAfterRender=function(e){for(var t=$(".appList.raceList.raceListTime").children(),r=0;r<t.length;r++)$(t[r]).on("click",function(){for(var e=0;e<t.length;e++)this===t[e]&&(webApp.currentRace=e)})}},webApp.extend(greyhoundbet.MeetingRacesController,webApp.AbstractController);webApp=webApp||{};(greyhoundbet=greyhoundbet||{}).TrapDrawsRacesController=function(e,t){greyhoundbet.TrapDrawsRacesController.superclass.constructor.call(this,e,t),this.trapDrawsHeaderBeforeRender=function(e){var t=this.getRequestParams().r_date,r=utils.date.fromString(t+" 00:00",0);return e.date=r.format("ddd dd mmm"),e},this.trapDrawsRacesBeforeRender=function(t){var r,i,s;return t.cName=t.races[0].race.TRACK_NAME,$.each(t.races,function(e){r=t.races[e].race.RACE_TIME,i=((i=+r.split(":")[0])+11)%12+1,s=r.split(":")[1],t.races[e].race.RACE_TIME=i+":"+s}),t}},webApp.extend(greyhoundbet.TrapDrawsRacesController,webApp.AbstractController),(greyhoundbet=greyhoundbet||{}).MeetingController=function(e,t){greyhoundbet.MeetingController.superclass.constructor.call(this,e,t)},webApp.extend(greyhoundbet.MeetingController,webApp.AbstractController);greyhoundbet=greyhoundbet||{};(webApp=webApp||{}).raceInfo=webApp.raceInfo||[],greyhoundbet.CardController=function(t,r){greyhoundbet.CardController.superclass.constructor.call(this,t,r);var d=webApp.EVENT_CHANGE_ORIENTATION+".horseCardOrientation";this._diffusionListeners={},this.isRadionPlaying=!1;var l={},h=null,a=webApp.userSettings.get("sortBy");this._eachWay=null,this._$tabsLinks=$([]);var p=$([]),o="",u=!1,i=["1","2"];this.raceData={},this.courseId=null,this.videoPageUrl="#video",this.RP_VIDEO_SHOWN_NAME="RP_VIDEO_SHOWN",this._BOG=!1,this.setBOG=function(e){this._BOG="1"===e.data[0]},this._isRaceStatusUpdated=!1,this._raceTitleCircle=null,this._preExecute=function(){if(this.isPastDateRequested()||!webApp.isDesktop&&this.accessedFromBookmark())this._redirectAndExit("meeting-list");else{var e=this.getRequestParams();if(e.tab){-1===$.inArray(e.tab,["card","form","stats","tips"])&&(e.tab="card")}else e.tab="card";this.setRequestParams(e),this._cachedDogs=null,this._diffusionSisRaceSession=new window.rpDiffusion.default({onDataFunction:this.onRaceSisStatusReceived.bind(this)}),this._diffusionPriceSession=new window.rpDiffusion.default({onDataFunction:this.onPriceReceived.bind(this)}),this._diffusionRaceInfoSession=new window.rpDiffusion.default({onDataFunction:this.onRaceInfoReceived.bind(this)})}},this.onRaceSisStatusReceived=function(e){this.acceptRaceInfo(this.transformToLegacyRaceInfo(e))},this.onRaceInfoReceived=function(e){var t=new rp.models.EachWay(this.transformToLegacyRaceInfo(e));this.setEachWay(t);var r=this.transformToLegacyBOG(e);this.setBOG(r)},this.transformToLegacyRaceInfo=function(e){return{data:e.getRecords()[0]}},this.transformToLegacyBOG=function(e){return{data:["Y"===e.getRecords()[0][1]?"1":"0"]}},this.onPriceReceived=function(e){this.acceptPrice(this.transformToLegacyPrice(e)),this.acceptPriceHistory(this.transformToLegacyPriceHistory(e))},this.transformToLegacyPrice=function(e){var t=e.getFields(0),r=e.getTopic().split("/"),i=r[3],s=r[5];return{selectionId:t[1],selectionName:s.replace(/ /g,"_"),hours:Number(i.split(":")[0]),minutes:Number(i.split(":")[1]),numerator:Number(t[7].split("/")[0]),denominator:Number(t[7].split("/")[1]),fractional:t[7],decimal:t[8],isSuspended:"H"===t[6]}},this.transformToLegacyPriceHistory=function(e){var t=e.getFields(0),r=e.getTopic();return{topic:Array.prototype.concat("",r.split("/")).map(function(e){return e.replace(/ /g,"_")}),data:Array.prototype.concat(t[1]+"||"+t[3]+"|"+t[4]+"|","H"===t[6]?"1":"0",t.slice(9,19))}},this.destroy=function(){this._diffusionSisRaceSession&&(this._diffusionSisRaceSession.unsubscribeAll(),delete this._diffusionSisRaceSession),this._diffusionRaceInfoSession&&(this._diffusionRaceInfoSession.unsubscribeAll(),delete this._diffusionRaceInfoSession),this._diffusionPriceSession&&(this._diffusionPriceSession.unsubscribeAll(),delete this._diffusionPriceSession),$(window).unbind(".horseCardOrientation")},this._findBlocksToRender=function(){var e=[],t=this.getRequestParams();return t.hasOwnProperty("race_id")&&"next"!==t.race_id?((e=["card-header","card-pager","card-tabs","card-title"]).push(t.tab),this._config.blocks["card-header"].template="card-header",this._config.blocks["card-pager"].template="card-pager",this._config.blocks.form.template="tab-form",e):["next-race"]},this.nextRaceBeforeRender=function(e){""===e.race_id?this._redirectAndExit("cards-home"):this._redirectAndExit("card",e)},this.cardTabsBeforeRender=function(r){var e=this.getRequestParams(),t=this._getCache("card-header").races[this.courseId].races;return r.tab=e.tab,r.race_id=e.race_id,r.r_date=e.r_date,r.racesIds=[],$.each(t,function(e,t){r.racesIds.push(t.raceId)}),r.tabs=this.isTodaysDateRequested()?[{tabName:"card"},{tabName:"form"},{tabName:"stats"},{tabName:"tips",queryParamsHashString:"&races_ids="+r.racesIds.join()}]:[{tabName:"form"}],r},this.cardTabsAfterRender=function(e){var t=this,r=this.getRequestParams();this._$tabsLinks=e.find("a").bind("click.cardTabClick",function(){t._setActiveTab($(this)),t._checkCardTitle(),!1===webApp.isMobile&&$(document).trigger("resize.viewm")}),this._setActiveTab(r.tab)},this._setActiveTab=function(e){var t,r;(r=e instanceof jQuery?(t=e).attr("id").split("-")[1]:(t=$("#cardTab-"+e),e))!==o&&(o=r,this._$tabsLinks.removeClass("active"),t.addClass("active"),setTimeout($.proxy(function(){var e={tab:o};"tips"==o&&(e.races_ids=this.getRequestParams().races_ids),this._pager.setButtonsHrefParam(e)},this),110))},this.cardTitleBeforeRender=function(e){(this.titleData=e).shouldShowTv=0,e.videoPageUrl=this.videoPageUrl,e.isLoggedIn=webApp.bookieCollection.getCurrentProvider().isLoggedIn(),e.hasOwnProperty("tvId")&&"2"==e.tvId&&(e.shouldShowTv=1);var t=webApp.bookieCollection.getCurrentBookieParams();return webApp.isRadioDisplayed&&(e.hasOwnProperty("bagsCode")&&"B"==e.bagsCode||-1<i.indexOf(e.tvId))&&(u="LADB"!==t.diffName),e},this.cardTitleAfterRender=function(e){var t,r,i={},s=null,n=[],a="";if(i=this._getCache("card-title"),p=e,webApp.isDesktop&&$(".b2v.button.buttonIcon").attr("target","_blank"),$("#toggleCardBtn").bind("click.toggleCardClick",function(){$("#card-page").toggleClass("collapseCard")}),this._raceTitleCircle&&delete this._raceTitleCircle,(s=$("#btnPredictor")).unbind(".showPredictor"),r='<p class="p1" ><span class="titleColumn1" style="padding-right:'+(6*(t=i.raceGrade+" - "+i.distance+"m "+i.raceTypeDesc).length+"px")+'">'+i.raceTitle+'&nbsp;</span><span class="titleColumn2">'+t+"</span></p>",n.push({raceInfo:r}),!i.reserved&&this.isTodaysDateRequested()?(""!=i.postPick&&(a='<p class="p2">&nbsp;POST PICK: '+i.postPick+" "+i.napNum+"</p>",n.push({postPick:a})),s.show()):(s.hide(),s.bind("click.showPredictor",function(e){e.preventDefault()})),this._raceTitleCircle=new webApp.SimpleCircle({id:"title-circle-container",data:n},!0),i.raceSisStatusTopicD5){var o={topic:i.raceSisStatusTopicD5.replace("PREFERRED_BOOKMAKER",webApp.PREFERRED_BOOKMAKER)};this._diffusionSisRaceSession.subscribe(o)}this._setRaceStatusWithoutDiffusion(),"Portrait"===webApp.orientation?this._checkCardTitle():this._checkCardTitle("form");var c=$("#whRadio"),l=$("#raceTitleBox");u&&(("Portrait"===webApp.orientation||webApp.isDesktop)&&l.addClass("showWHRadio"),webApp.radioSupport?this._initRadioPlayerHandling(c):webApp.isDesktop?this._initDesktopRadioPlayerHandling(c):this._initUsingExternalAppAsRadioProvider(c),$(window).bind(d,function(e,t){"Portrait"===t.orientation||webApp.isDesktop?l.addClass("showWHRadio"):l.removeClass("showWHRadio")})),webApp.isDesktop&&u&&!webApp.whRadio.mediaelementPlayerCreated&&($(".webApp").append('<div id="desktopRadioContainer"></div>'),webApp.whRadio.initDesktopRadio($("#desktopRadioContainer")),webApp.whRadio.mediaelementPlayerCreated=!0),u&&"Landscape"!==webApp.orientation||webApp.isDesktop||l.removeClass("showWHRadio"),$("#title-circle-container").css("max-width","98%"),$(".b2v").bind("click",{RP_VIDEO_SHOWN_NAME:this.RP_VIDEO_SHOWN_NAME},function(e){utils.localStorage.set(e.data.RP_VIDEO_SHOWN_NAME,1)})},this._initRadioPlayerHandling=function(t){context=this,webApp.whRadio.isPlaying()&&t.addClass("pause");var r;webApp.whRadio.setOnPlayingCallBack(function(){clearTimeout(r)}),t.bind("click.radioPlay",function(){if(webApp.isIOS_7&&context.isRadionPlaying)return e.preventDefault(),!1;webApp.whRadio.isPlaying()?(webApp.whRadio.stop(),t.removeClass("pause")):(webApp.whRadio.play($(".appleRadioContainer")),t.addClass("pause"),context.isRadionPlaying=!0,setTimeout(function(){context.isRadionPlaying=!1},4e3),r=setTimeout(function(){webApp.whRadio.stop(),t.removeClass("pause")},45e3))})},this._initDesktopRadioPlayerHandling=function(t){context=this,webApp.whRadio.isPlaying()&&t.addClass("pause"),t.on("click",function(e){if(context.isRadionPlaying)return e.preventDefault(),!1;try{webApp.whRadio.isPlaying()?(webApp.whRadio.stopDesktopRadio(),t.removeClass("pause")):(webApp.whRadio.playDesktopRadio(),t.addClass("pause"),context.isRadionPlaying=!0,setTimeout(function(){context.isRadionPlaying=!1},4e3))}catch(e){isFlashPluginAvailable=navigator.plugins["Shockwave Flash"],isFlashPluginAvailable?alert("Something went wrong"):alert("Please install Adobe Flash Plug-in to access this functionality")}})},this._initUsingExternalAppAsRadioProvider=function(e){e.bind("click.radioPlay",function(){webApp.confirmPopup({tpl:"radio-popup"})})},this.cardTitleOnDestroy=function(){this._unsubscribeSisTopics(),this._raceTitleCircle&&delete this._raceTitleCircle,this._clearRaceStatusTimeout()},this._unsubscribeSisTopics=function(){this._diffusionSisRaceSession&&this._diffusionSisRaceSession.unsubscribeAll()},this._clearRaceStatusTimeout=function(){this._checkRaceStatusTimeout&&clearTimeout(this._checkRaceStatusTimeout)},this._setRaceStatusWithoutDiffusion=function(){var e=this._getCache("card-title");if(!this._isRaceStatusUpdated){var t=this,r=utils.date.getSynchronizedToServerNow(),i="Race Status: "+(parseInt(Date.parse(r.toUTCString()),10)<(e?1e3*parseInt(e.raceDatetime,10):1e3*parseInt(this.titleData.raceDatetime,10))?"Upcoming":"Betting Closed");this._raceTitleCircle&&(i='<p class="p3"> &nbsp;'+i+"</p>",this._raceTitleCircle.setVal("status",i).displayDesktop()),this._checkRaceStatusTimeout=setTimeout(function(){t._setRaceStatusWithoutDiffusion()},1e4)}},this.acceptRaceInfo=function(e){var t={A:"Parading",B:"",C:"Approaching Traps",D:"Start Delay",E:"Going in Traps",H:"Hare Running",J:"Hare Stopped",K:"Traps Failed",N:"No Race",O:"Off",X:""},r=e.data[0],i="";void 0!==t[r]&&""!==t[r]&&(this._isRaceStatusUpdated=!0,this._raceTitleCircle&&(i='<p class="p3">&nbsp;Race Status: '+t[r]+"</p>",this._raceTitleCircle.setVal("status",i).displayDesktop()))},this._checkCardTitle=function(e){e=e||o;var t=$("#sortContainer"),r=$(".statusBox"),i=$("#statsList"),s=$("#toggleCardBtn"),n=$("#formeEplainedBtn"),a=$(".tipsGrid");$cardTabContainer=$(".cardTabContainer"),$formTabContainer=$(".formTabContainer"),"card"===e?(p.show(),s.show(),n.hide(),a.hide(),i.hide(),$formTabContainer.hide(),!0===webApp.isDesktop&&r.removeClass(" enablePrint")):"form"===e?(p.show(),n.show(),s.hide(),a.hide(),i.hide(),$cardTabContainer.hide(),!0===webApp.isDesktop&&r.addClass(" enablePrint")):("stats"===e?(p.hide(),t.hide(),a.hide()):(p.hide(),t.hide(),i.hide()),!0===webApp.isDesktop&&r.removeClass(" enablePrint"))},this.cardHeaderBeforeRender=function(e){var t,r,i=this.getRequestParams(),s=i.race_id;for(t in e.races){for(r in e.races[t].races)if(e.races[t].races[r].raceId===s){this.courseId=t;break}if(null!==this.courseId)break}return e.courseName=e.races[this.courseId].track,e.raceDate=i.r_date,e},this.cardPagerAfterRender=function(){var e=this._getCache("card-header").races[this.courseId].races,i=null;e=e.filter(function(e,t,r){return i!==e.raceId&&(i=e.raceId,!0)}),this._pager=new greyhoundbet.racePager({data:e,urlParams:this.getRequestParams(),callback:$.proxy(this.changeCardLinks,this)})},this.cardHeaderAfterRender=function(){var e=this.getRequestParams(),t={race_id:e.race_id,r_date:e.r_date};webApp.urlManager.changeLink($("#btnPredictor"),t)},this.makeBackButton=function(){var e,t=this.getRequestParams(),r=webApp.registry.get("meetingRacesTime");e=r?"#meeting-races/track_id="+t.track_id+"&r_time="+r:"#meeting-list/r_date="+t.r_date,$(".btnBack").attr("href",e)},this.changeCardLinks=function(e){var t={race_id:e.raceId,r_date:e.raceDate},r=this._getCache("card-header").races[this.courseId].track+" "+e.raceTime+" "+e.raceDate;this._$tabsLinks.each(function(){webApp.urlManager.changeLink($(this),t),$(this).attr("data-eventlabel",r)}),webApp.urlManager.changeLink($("#btnPredictor"),t)},this.cardBeforeRender=function(e){var t=this.getRequestParams(),r=this._getCache("card-header");return this.saveRaceData(),l={},this._fillDiffusionData(e.dogs),e.dogs=this._sortDogs(e.dogs,a),e.courseName=r.races[this.courseId].track,e.courseCountry=r.country,e.raceId=t.race_id,e.raceDate=t.r_date,e.bookie=webApp.bookieCollection.getCurrentProviderName(),e},this.formBeforeRender=function(e){var t=this.getRequestParams(),r=this._getCache("card-header"),i=this._getCache("card-title"),s=this._getCache("card-tabs");return webApp.raceInfo=[],webApp.raceInfo.push(i),webApp.raceInfo.push(s),this.saveRaceData(),l={},this._fillDiffusionData(e.dogs),e.dogs=this._sortDogs(e.dogs,a),e.courseName=r.races[this.courseId].track,e.raceId=t.race_id,e.raceDate=t.r_date,webApp.raceInfo.push(e.raceDate),e.courseId=t.track_id,e.courseCountry=r.country,e.track_id=t.track_id,webApp.printHeader=e.courseName,e},this.saveRaceData=function(){var e,t=this._getCache("card-header"),r=this.getRequestParams().race_id,i=t.races[this.courseId].races;for(e in i)if(i[e].raceId===r){this.raceData=i[e];break}},this.statsBeforeRender=function(e){a(e.dogPerformance),a(e.trapRecord),a(e.recordAtThisGrade),a(e.trapTrackRecords);var t,r=e.dogPerformance.length,i=e.reservedTraps,s=e.vacantTraps,n=this._getCache("card-header");for(t=0;t<r;t++)e.dogPerformance[t].isVisible=!this.isReservedOrVacant(e.dogPerformance[t].num,i,s),e.recordAtThisGrade[t].isVisible=!this.isReservedOrVacant(e.recordAtThisGrade[t].num,i,s),e.trapRecord[t].isVisible=!this.isReservedOrVacant(e.trapRecord[t].num,i,s),e.trapTrackRecords[t].isVisible=!this.isReservedOrVacant(e.trapTrackRecords[t].num,i,s);return e.courseName=n.races[this.courseId].track,e;function a(e){for(record in e)e[record].vacant&&e.splice(record,1)}},this.statsAfterRender=function(){this._setActiveTab("stats"),this._checkCardTitle("stats");function e(e){var t=$("#statsList"),r=t.find("> ul"),i=r.find("> li"),s={activeStep:0,isStartAnimate:!1,$swipe:t,$list:r,$items:i,lastItemOffset:20,prevItemOffset:10,onSwipe:null,onAnimationEnd:null};this.opts={},$.extend(this.opts,s,e),this.activeStep=this.opts.activeStep,this.maxStepIndex=this.opts.$items.length-1,this.listOversizeWindow=null,this.isLastSticked=!1,this.calculateSizes(),this.bindCarouselEvents()}if(e.prototype.calculateSizes=function(){this.windowWidth=$(window).width(),this.listOversizeWindow=$(this.opts.$list).width()-$(window).width()},e.prototype.animateOnPos=function(e){this.opts.$list.css(webApp.cssVendor+"transform","translate("+e+"px, 0px) translateZ(0px)")},e.prototype.bindCarouselEvents=function(){var e=this;e.opts.$list.bind("swipe.statsSwipe",e._swipeHandler.bind(e)),e.opts.$list.bind("webkitTransitionEnd transitionend",e._animationEndHandler.bind(e)),$(window).resize(e.windowResizeHandler.bind(e))},e.prototype.windowResizeHandler=function(e){var t=this,r=t.listOversizeWindow+t.opts.lastItemOffset,i=t.opts.$items.eq(t.activeStep)[0].offsetLeft,s=t.opts.$items.eq(t.maxStepIndex)[0].offsetLeft;t.isLastSticked=!1,t.calculateSizes(),r<0?(t.scrollToActiveItem(0,"right"),t.activeStep=0):r<s&&r+t.opts.prevItemOffset<i&&(t.isLastSticked=!0,t.scrollToActiveItem(t.maxStepIndex,"right"))},e.prototype.scrollToActiveItem=function(e,t){var r=this;if(r.transitionSize=r.opts.$items.eq(e)[0].offsetLeft,r.listOversizeWindow<r.transitionSize){if("left"===t)return e=r.maxStepIndex,r.animateOnPos(-r.listOversizeWindow-r.opts.lastItemOffset),e;if(e<r.maxStepIndex){for(var i=e;0<=i;i--){var s=r.opts.$items.eq(i)[0].offsetLeft;if(r.listOversizeWindow>s){r.transitionSize=s,e=i;break}}return r.animateOnPos(-r.transitionSize+(0===e?0:r.opts.prevItemOffset)),e}return r.animateOnPos(-r.listOversizeWindow-r.opts.lastItemOffset),e}return r.animateOnPos(-r.transitionSize+(0===e?0:r.opts.prevItemOffset)),e},e.prototype._swipeHandler=function(e,t){this.opts.isStartAnimate||this.listOversizeWindow<=0||(this.opts.isStartAnimate=!0,"left"===t?this.activeStep===this.maxStepIndex||this.isLastSticked?this.activeStep=0:this.activeStep++:"right"===t&&(0===this.activeStep?this.activeStep=this.maxStepIndex:this.activeStep--),this.activeStep=this.scrollToActiveItem(this.activeStep,t),this.isLastSticked=!1,this.opts.onSwipe&&this.opts.onSwipe())},e.prototype._animationEndHandler=function(){this.opts.isStartAnimate=!1,webApp.eventTracker.trackEventById("cards_stats_swipe",this.opts.$items.eq(this.activeStep).attr("data-eventlabel")),this.opts.onAnimationEnd&&this.opts.onAnimationEnd()},webApp.isDesktop)new IScroll("#statsList",{fadeScrollbars:!1,mouseWheel:!1,scrollbars:!0,scrollX:!0,scrollY:!1,mouseWheelSpeed:100,interactiveScrollbars:!0,preventDefault:!1,useTransition:!1,freeScroll:!0,useTransform:!0,scrollbars:"custom",click:!1,tap:!1,disableMouse:!0});else new e},this.tipsBeforeRender=function(e){var t,r=this.getRequestParams();for(t in e.tips)if(r.race_id===e.tips[t].race_id)break;return e.currentRace=e.tips.splice(t,1)[0],e},this.tipsAfterRender=function(){this._setActiveTab("tips"),this._checkCardTitle("tips"),$(".tipsGrid a").bind("click.showOtherRace",function(){webApp.viewManager.flash()}),webApp.registry.set("cardController",this.getName()),webApp.registry.set("cardParams",this.getRequestParams())},this.formAfterRender=function(){this._setActiveTab("form"),this._checkCardTitle("form");var e=this._getCache("card-title");this._subscribePrices(e.priceTopicD5);var t={topic:e.infoTopicD5.replace("PREFERRED_BOOKMAKER",webApp.PREFERRED_BOOKMAKER)};this._diffusionRaceInfoSession.subscribe(t),$(document).on("click",".formGrid a",function(e){var t=webApp.urlManager,r=$(e.target).attr("href");t.setHash(t.addParamToHash(r,"back",1)),e.preventDefault()}),!0===webApp.isDesktop&&($("#doPrint").off(),webApp.printForm.init($("#doPrint")));var r=$(".printRaceName");webApp.printHeader&&0<r.length&&""===r[0].innerHTML&&r.html(webApp.printHeader)},this.setEachWay=function(e){this._eachWay=e},this.formOnDestroy=function(){this._unsubscribePrices(),this._unsubscribeRaceInfo(),webApp.printForm.remove()},this.cardAfterRender=function(){var e=this,t=$(window),r=t.height(),i=t.width();this._setActiveTab("card"),this._checkCardTitle("card"),$("#toggleCardBtn").click(function(){webApp.viewManager.getScroll(e._name).refresh()});var s=this._getCache("card-title");this._subscribePrices(s.priceTopicD5);var n={topic:s.infoTopicD5.replace("PREFERRED_BOOKMAKER",webApp.PREFERRED_BOOKMAKER)};this._diffusionRaceInfoSession.subscribe(n),webApp.isDesktop&&webApp.googleTagAds.proccessAds(i,r)},this.cardOnDestroy=function(){this._unsubscribePrices(),this._unsubscribeRaceInfo();var e=$(window),t=e.height(),r=e.width(),i={isCardTabDestroyed:!0};webApp.googleTagAds.proccessAds(r,t,i)},this._cachedDogs=null,this._getCachedDogs=function(){var e;return null===this._cachedDogs&&(e=this._getCache("card")||this._getCache("form"),this._cachedDogs=e.dogs),this._cachedDogs},this._findDogInCacheByDiffusionName=function(e){var t=null,r=this._getCachedDogs();for(var i in r)if(r[i].diffusionName&&r[i].diffusionName==e){t=r[i];break}return t},this.acceptPrice=function(r){var e=this._core().getViewManager(),i=($("#price-history-"+r.selectionName),this._helper("eventTracker")),t=this._findDogInCacheByDiffusionName(r.selectionName),s=t&&t.dogName,n="#bet-"+r.selectionName,a=$(n),o=n;if(s)if(r.isSuspended)$(n).empty();else{var c=webApp.bookieCollection.getCurrentBookieParams();"decimal"===webApp.userSettings.get("odds")?"SP"===r.fractional?r.price=r.fractional:r.price=(Math.floor(100*parseFloat(r.decimal))/100).toString():r.price=r.fractional;var l=e.renderTpl("price-button",{price:r,bookie:c}),d=this._getCache("card-header"),h=new rp.betting.Selection({id:r.selectionId,price:"SP"===r.fractional?null:{num:r.numerator,den:r.denominator},isSP:!("SP"!==r.fractional),data:{selectionName:s,courseName:d.races[this.courseId].track,courseNameAbbr:d.trackAbbrName,raceId:this.raceData.raceId,raceTs:moment.utc(this.raceData.raceDate+"T"+this.raceData.raceTime).unix()}}),p=this;r.isSuspended||(l.bind("click.betClick",function(){webApp.registry.set({backUrlHash:window.location.hash});var e=p.getRequestParams().tab;e.charAt(0).toUpperCase(),e.slice(1);h.eachWay(p._eachWay),h.data().isBOG=p._BOG;webApp.SelectionsManager.setOnAddMultModeCallback(function(){webApp.selectionsAlert.show(webApp.SelectionsManager.getSelections().length)}),webApp.SelectionsManager.processPriceClick(h,o+" span",p,c.name)}),l.bind(i.EVENT_CLICK_TRACK_EVENT,function(){var e=p.getRequestParams().tab||"card";e=e.charAt(0).toUpperCase()+e.slice(1);var t=d.races[p.courseId].track+" "+r.hours+":"+r.minutes+", "+s+" - "+c.name+" - Card - "+e;i.trackEventById("bets_price_click",t)})),a.html(l),webApp.SelectionsManager.getSelections().length&&webApp.SelectionsManager.isSelected(h)&&webApp.SelectionsManager.highlightSelectionPrice(o+" span")}},this.acceptPriceHistory=function(e){if(void 0!==e.topic){var t={templates:"",callbacks:"",data:e,isShowDenominatorOne:!0},r=new diffusion.types.PriceHistory;r.init(t);var i=r._isSuspended(),s=$("#price-history-"+r._getOutcomeName()),n=[],a=webApp.userSettings.get("odds");r._getOutcomeName(),r._getOutcomeUcFirstName(),r._getPriceDecimal(),r._getPriceFractional(),e.data[0].split("|")[0],r._getPriceFractional();if(n="decimal"===a?r._getHistoryDecimal():r._getHistoryFractional(),l[r._getOutcomeName()]=r._getPriceDecimal(),s){var o,c=[];for(o=0;o<4&&!(void 0===n[o]||"decimal"===a&&isNaN(n[o]));o++)"decimal"===a?c.push((Math.floor(100*parseFloat(n[o]))/100).toString()):c.push(n[o]);c.reverse(),s.html(c.join(" <b>&gt;</b> ")),i?s.hide():s.show()}clearTimeout(h),h=setTimeout(function(e){void 0!==e&&e.hasOwnProperty("sortByOdds")&&"function"==typeof e.sortByOdds?e.sortByOdds():console.log("context.sortByOdds is not a function")},300,this)}},this._subscribePrices=function(t){var r,i=this;t&&this._getCachedDogs().forEach(function(e){r={topic:t.replace("PREFERRED_DOG",e.dogName.toUpperCase()).replace("PREFERRED_BOOKMAKER",webApp.PREFERRED_BOOKMAKER)},i._diffusionPriceSession.subscribe(r)})},this._unsubscribePrices=function(){this._diffusionPriceSession&&this._diffusionPriceSession.unsubscribeAll()},this._unsubscribeRaceInfo=function(){this._diffusionRaceInfoSession&&this._diffusionRaceInfoSession.unsubscribeAll()},this._fillDiffusionData=function(e){var t;for(t in e)l[e[t].diffusionName]=9999},this._sortDogs=function(e,s){return"topSpeed"!==s&&"trapNum"!==s||e.sort(function(e,t){var r=parseInt(e[s],10),i=parseInt(t[s],10);return r<i?1:i<r?-1:0}),e},this.sortByOdds=function(){var e=$("#sortContainer");if("odds"===a&&e){var t,r=[],i=0;for(t in l)r[i]=[t,l[t]],i++;r=this._arrayToSort(r);var s=null;for(t in r){var n=$("#runner-"+r[t][0]);s?s.after(n):(s=n).prependTo(e),s=n}}},this._arrayToSort=function(e){var t;for(t in e)"string"==typeof e[t][1]&&(e[t][1]=e[t][1].replace(/[^\d\.]/g,""));return e.sort(function(e,t){return 0<e[1]-t[1]?1:e[1]-t[1]<0?-1:0}),e},greyhoundbet.CardController.isShowLocation=function(e,t,r){return(-1===[21,40,41,43,44,45,47,49,51,52,53,54,55,56,88,58,46,72,59,48,57,42,71,50].indexOf(+r)||"IRELAND"!==e.toUpperCase())&&(""!==e&&t.toLowerCase()!=e.toLowerCase())},this.isReservedOrVacant=function(e,t,r){return-1!==$.inArray(e,t)||-1!==$.inArray(e,r)}},webApp.extend(greyhoundbet.CardController,webApp.AbstractController),(greyhoundbet=greyhoundbet||{}).PredictorController=function(e,t){greyhoundbet.PredictorController.superclass.constructor.call(this,e,t);var d=this,h=null;this.raceData={},this._eachWay=null,this._BOG=!1,this._preExecute=function(){this.setSelectionsOnAddConfirmDialog(),this._diffusionRaceInfoSession=new window.rpDiffusion.default({onDataFunction:this.onRaceInfoReceived.bind(this)}),this._diffusionPriceSession=new window.rpDiffusion.default({onDataFunction:this.onPriceReceived.bind(this)})},this.onRaceInfoReceived=function(e){var t=new rp.models.EachWay(this.transformToLegacyRaceInfo(e));this.setEachWay(t);var r=this.transformToLegacyBOG(e);this.setBOG(r)},this.transformToLegacyRaceInfo=function(e){return{data:e.getRecords()[0]}},this.transformToLegacyBOG=function(e){return{data:["Y"===e.getRecords()[0][1]?"1":"0"]}},this.onPriceReceived=function(e){this.acceptPrice(this.transformToLegacyPrice(e))},this.transformToLegacyPrice=function(e){var t=e.getFields(0),r=e.getTopic().split("/"),i=r[1],s=r[3],n=r[5];return{selectionId:t[1],selectionName:n.replace(/ /g,"_"),raceTs:moment.utc(i+"T"+s).unix(),numerator:Number(t[7].split("/")[0]),denominator:Number(t[7].split("/")[1]),fractional:t[7],decimal:t[8],isSuspended:"H"===t[6]}},this._postExecute=function(){$(window).bind(webApp.EVENT_CHANGE_ORIENTATION+".predictorOrientation",function(){webApp.isMobile&&(d._core().getViewManager().flash(d.getName()),d.execute())})},this.destroy=function(){$(window).unbind(".predictorOrientation"),$(window).off("resize.predictor")},this.simulatorBeforeRender=function(e){return this._runnersData=e.data,this.raceData=e.raceInfo,this._diffusion5InfoTopic=e.raceInfo.diffusion5InfoTopic,this._diffusion5PriceTopic=e.raceInfo.diffusion5PriceTopic,e.height=webApp.windowHeight+"px",e.orientation=webApp.orientation,e.isMobile=webApp.isMobile,e.windowWidth=$(window).width(),e.raceId=e.raceInfo.raceId,e.rDate=e.raceInfo.raceDate.split(" ")[0],e},this.simulatorAfterRender=function(){var i,s=320,n=650,a=75,o=this,c=$("#predictorList .gh");c.length;function e(){var e=$(window).width(),t=$(window).height(),r=$(".whAdContainer").is(":visible")?$(".whAdContainer").outerHeight(!0):0;webApp.isDesktop&&(t-=r),$(".dogPredictor").length&&$(".dogPredictor").height()!=t?($(".dogPredictor").height(t),$("#webApp").height(t)):$(".predictorPortrait").length&&$(".predictorPortrait").height()!=t&&($(".predictorPortrait").height(t),$("#webApp").height(t)),s<e&&0<$(".dogPredictor").length?((i=1-n/$(window).width()+1)<.5&&(i=.5),c.each(function(e,t){$(t).css(webApp.cssVendor+"transform","scale("+i+")"),$(t).closest("li").css("paddingRight",a*i)})):(0<$(".dogPredictor").length||s<e&&0===$(".dogPredictor").length)&&(o._core().getViewManager().flash(o.getName()),o.execute())}if(!1===webApp.isMobile?($("#predictorList").addClass("big-dogs-size"),e(),$(window).on("resize.predictor",e)):void 0===this.rerendered&&($(window).trigger("orientationchange"),this.rerendered=!0),"Landscape"===webApp.orientation||$(window).width()>s&&!webApp.isMobile&&!webApp.isTablet){clearTimeout(h);for(var r=parseFloat(this.raceData.minPrediction),t=parseFloat(this.raceData.maxPrediction)-r,l=greyhoundbet.predictorSettings.scale;t*l>greyhoundbet.predictorSettings.raceLineLength;)l-=.1;h=setTimeout(function(){$("#predictorList .gh").each(function(e){var t=Math.round((o._runnersData[e].prediction-r)*l*greyhoundbet.predictorSettings.dogSize);78<t&&(t=78),$(this).animate({right:t+"%"},3e3)})},300);var d={topic:this._diffusion5InfoTopic.replace("PREFERRED_BOOKMAKER",webApp.PREFERRED_BOOKMAKER)};this._diffusionRaceInfoSession.subscribe(d),this._subscribePrices(this._diffusion5PriceTopic)}},this._subscribePrices=function(t){var r,i=this;t&&this._runnersData.forEach(function(e){r={topic:t.replace("PREFERRED_DOG",e.dogName.toUpperCase()).replace("PREFERRED_BOOKMAKER",webApp.PREFERRED_BOOKMAKER)},i._diffusionPriceSession.subscribe(r)})},this.simulatorOnDestroy=function(){this._diffusionRaceInfoSession.unsubscribeAll(),this._diffusionPriceSession.unsubscribeAll(),delete this._diffusionRaceInfoSession,delete this._diffusionPriceSession},this.setBOG=function(e){this._BOG="1"===e.data[0]},this.acceptPrice=function(e){var t=this._core().getViewManager(),r=webApp.userSettings.get("odds"),i="predictor-bet-"+e.selectionName,s=this._findRunner("diffusionName",e.selectionName).dogName||"",n="#"+i+" span";this._helper("eventTracker");if(e.price="decimal"==r?"SP"===e.fractional?"SP":(Math.floor(100*parseFloat(e.decimal))/100).toString():e.fractional,s)if(e.isSuspended)$(n).empty();else{var a=webApp.bookieCollection.getCurrentBookieParams(),o=t.renderTpl("price-button",{price:e,bookie:a}),c=$("#"+i),l=new rp.betting.Selection({id:e.selectionId,price:"SP"===e.fractional?null:{num:e.numerator,den:e.denominator},isSP:!("SP"!==e.fractional),data:{selectionName:s,courseName:this.raceData.normalizedName,courseNameAbbr:this.raceData.normalizedAbbrName,raceId:this.raceData.raceId,raceTs:e.raceTs}});e.isSuspended||o.bind("click.betClick",function(){webApp.registry.set("backUrlHash",window.location.hash),l.eachWay(d._eachWay),l.data().isBOG=d._BOG,webApp.SelectionsManager.processPriceClick(l,n,d)}),c.html(o),webApp.SelectionsManager.getSelections().length&&webApp.SelectionsManager.isSelected(l)&&webApp.SelectionsManager.highlightSelectionPrice(n)}},this.setEachWay=function(e){this._eachWay=e},this._findRunner=function(e,t){var r={},i=this._runnersData;for(var s in i)if(i[s][e]&&i[s][e]==t){r=i[s];break}return r}},webApp.extend(greyhoundbet.PredictorController,webApp.AbstractController),(greyhoundbet=greyhoundbet||{}).FormExplainedController=function(e,t){greyhoundbet.FormExplainedController.superclass.constructor.call(this,e,t)},webApp.extend(greyhoundbet.FormExplainedController,webApp.AbstractNodataCredentialsController);webApp=webApp||{},utils=utils||{};(greyhoundbet=greyhoundbet||{}).ResultsListController=function(e,t){greyhoundbet.ResultsListController.superclass.constructor.call(this,e,t),this._preExecute=function(){!webApp.isDesktop&&this.accessedFromBookmark()&&this._redirectAndExit("meeting-list");var e=this.getRequestParams(),t=e.r_date,r=utils.date.toString(utils.date.getSynchronizedToServerNow()),i=t||"",s=new Date(t),n=r.split("-"),a=i.split("-"),o=new Date(n[0],n[1]-1,n[2]),c=new Date(a[0],a[1]-1,a[2]);if(!t||!utils.date.isDate(t)||c.getTime()>o.getTime())return e.r_date=r,void this._redirectAndExit(this.getName(),e);var l=$("#resultsDateBtn"),d="";d=+t.substring(0,4)<(new Date).getFullYear()?s.format("dd mmm")+" "+s.format("yyyy").substring(2,4):s.format("mmm dd"),l.html(d),$(window).bind(webApp.EVENT_CHANGE_ORIENTATION,function(){webApp.Calendar.setOrientation(webApp.orientation.toLowerCase())})},this.headerAfterRender=function(e){var t=$("#resultsDateBtn"),r=new Date(webApp.urlManager.getParams()[1].r_date),i="";i=r.getFullYear()<(new Date).getFullYear()?r.format("dd mmm")+" "+r.format("yyyy").substring(2,4):r.format("mmm dd"),t.html(i).on("click",function(){webApp.Calendar.show(),setTimeout(function(){$(".calendarControll").focus()},0)})},this.meetingsAfterRender=function(e){var t=this,r=this.getRequestParams();function i(e){var t=e.replace(" ","").split(":");return{"01":1,"02":2,"03":3,"04":4,"05":5,"06":6,"07":7,"08":8,"09":9,10:10,11:11,12:12,13:1,14:2,15:3,16:4,17:5,18:6,19:7,20:8,21:9,22:10,23:11}[t[0]]+":"+t[1]}webApp.isMobile||($.each($(".results-race-list-row div"),function(e,t){$(t).html(i($(t).html()))}),$.each($(".results-race-list-row > a"),function(e,t){$(t).html(i($(t).html()))})),$("#latestResults").click(function(e){return webApp.eventTracker.trackEventById("results_latest"),t._redirect("results-latest",{r_date:r.r_date}),e.preventDefault(),!1}),webApp.searchFormInit(),webApp.isDesktop||webApp.viewManager.getScroll(this._name).scrollTo(0,-44,0)},this.meetingsBeforeRender=function(a){var o=this;return $.each(a.tracks,function(e){if(null!=a.tracks[e].races){a.tracks[e].races.sort(o._sortTrackByFirstRace);for(var t=0,r=a.tracks[e].races.length;t<r;t++)for(var i=0,s=a.tracks[e].races[t].races.length;i<s;i++){a.tracks[e].races[t].videoAvailable=!1;var n=a.tracks[e].races[t].races[i];if(n.videoid&&n.clipId){a.tracks[e].races[t].videoAvailable=!0;break}}}}),a},this._sortTrackByFirstRace=function(e,t){var r=utils.date.fromString(e.firstRace,0),i=utils.date.fromString(t.firstRace,0);return r<i?-1:i<r?1:0}},webApp.extend(greyhoundbet.ResultsListController,webApp.AbstractController),(greyhoundbet=greyhoundbet||{}).ResultMeetingController=function(e,t){greyhoundbet.ResultMeetingController.superclass.constructor.call(this,e,t),this._preExecute=function(){!webApp.isDesktop&&this.accessedFromBookmark()&&this._redirectAndExit("meeting-list")},this.listBeforeRender=function(e){$(".pageHeader #headerTitle").html(e.track.track);var t=this.getRequestParams(),r=0;e.rDate=t.r_date,e.rTime=t.r_time;var i=[];for(var s in e.deadHeats)for(r=0;r<e.deadHeats[s].length;r++)"1st"===e.deadHeats[s][r]&&i.push({deadheatRace:s,deadheatPosition:"1st"}),"2nd"===e.deadHeats[s][r]&&i.push({deadheatRace:s,deadheatPosition:"2nd"}),"3rd"===e.deadHeats[s][r]&&i.push({deadheatRace:s,deadheatPosition:"3rd"});var n=[],a=[];for(var o in e.track.results)e.track.results[o].forEach(function(e,t,r){"1"===e.position&&n.push({raceId:e.raceId,position:1,distances:e.rpDistDesc}),"2"===e.position&&n.push({raceId:e.raceId,position:2,distances:e.rpDistDesc}),"3"===e.position&&n.push({raceId:e.raceId,position:3,distances:e.rpDistDesc})});for(r=0;r<i.length;r++)"3rd"===i[r].deadheatPosition&&a.push(i[r].deadheatRace);var c="";for(r=0;r<a.length;r++)c+=a[r]+" ";var l=[];for(r=0;r<n.length;r++)n[r+1]&&2===n[r].position&&3===n[r+1].position&&""!==n[r].distances&&""!==n[r+1]&&n[r].raceId===n[r+1].raceId||n[r+1]&&2===n[r].position&&3===n[r+1].position&&-1!==c.search(n[r].raceId)?l.push({raceId:n[r].raceId,distance:n[r].distances+", "+n[r+1].distances}):n[r+1]&&2===n[r].position&&3===n[r+1].position&&""!==n[r].distances&&""===n[r+1]&&n[r].raceId===n[r+1].raceId?l.push({raceId:n[r].raceId,distance:n[r].distances}):n[r+1]&&2===n[r].position&&3===n[r+1].position&&""===n[r].distances&&""!==n[r+1]&&n[r].raceId===n[r+1].raceId?l.push({raceId:n[r+1].raceId,distance:n[r+1].distances}):!n[r+1]||"dht"!==n[r].distances&&"dht"!==n[r+1].distances||""===n[r].distances||""===n[r+1]||n[r].raceId!==n[r+1].raceId||-1!==c.search(n[r].raceId)?!n[r+1]||"dht"!==n[r].distances&&"dht"!==n[r+1].distances||n[r].distances||""===n[r+1]||n[r].raceId!==n[r+1].raceId||-1!==c.search(n[r].raceId)||l.push({raceId:n[r+1].raceId,distance:n[r+1].distances}):l.push({raceId:n[r].raceId,distance:n[r].distances+", "+n[r+1].distances}),!n[r+1]||"dht"!==n[r].distances&&"dht"!==n[r+1].distances||n[r+1].distances||""===n[r]||n[r].raceId!==n[r+1].raceId||-1!==c.search(n[r].raceId)||l.push({raceId:n[r].raceId,distance:n[r].distances});for(o in e.distancesResults=l,e.track.results)for(r=0;r<e.track.results[o].length;r++)for(var d=0;d<l.length;d++)if(e.track.results[o][r].raceId===l[d].raceId){e.track.results[o][r].distancesResults=l[d].distance;for(var h=0;h<i.length;h++)i[h].deadheatRace===e.track.results[o][r].raceId&&(e.track.results[o][r].deadheatPosition=i[h].deadheatPosition)}return e},this.listAfterRender=function(e){var t=$(".is-deadheat-1st.deadheat-time").filter(":odd"),r=$(".is-deadheat-1st.deadheat-distance").filter(":even"),i=$(".is-deadheat-2nd").filter(":even");return 1<$(".is-deadheat-1st").length&&($(t).addClass("deadheat-hide"),$(r).addClass("deadheat-hide")),1<$(".is-deadheat-2nd").length&&$(i).addClass("deadheat-hide"),e},this.headerBeforeRender=function(e){var t=this.getRequestParams();return e.rDate=t.r_date,e.trackId=t.track_id,e.rTime=t.r_time,e.href="#result-meeting/track_id="+t.track_id+"&r_date="+t.r_date+"&r_time="+t.r_time,e},this.headerAfterRender=function(e){var t=this.getRequestParams(),r=this,i=utils.date.fromString(t.r_date+" 00:00",0),s="";s=i.getFullYear()<(new Date).getFullYear()?i.format("dd mmm")+" "+i.format("yyyy").substring(2,4):i.format("mmm dd"),$(".btnBack").attr("href","#results-list/r_date="+t.r_date).html("<span>"+s+"</span>").click(function(){webApp.eventTracker.trackEventById("results_back_to_list",i.format("yyyy-mm-dd"))}),$(".btnRefresh").click(function(){webApp.eventTracker.trackEventById("results_refresh"),r._refreshList()})},this._refreshList=function(){this._clearCache("list"),this.execute()}},webApp.extend(greyhoundbet.ResultMeetingController,webApp.AbstractController),(greyhoundbet=greyhoundbet||{}).ResultsLatestController=function(e,t){greyhoundbet.ResultsLatestController.superclass.constructor.call(this,e,t),this.latestHeaderBeforeRender=function(e){var t=this.getRequestParams().r_date;return e.rDate=t||"",e.href="#results-latest/r_date="+t,e},this.latestHeaderAfterRender=function(e){var t=this.getRequestParams(),r=this;e.find("#headerTitle").html("Latest results"),$(".btnBack").html("<span>"+utils.date.fromString(t.r_date+" 00:00",0).format("mmm dd")+" </span>").click(function(){webApp.eventTracker.trackEventById("results_back_to_list",utils.date.fromString(t.r_date+" 00:00",0).format("yyyy-mm-dd"))}),$(".btnRefresh").click(function(){webApp.eventTracker.trackEventById("results_refresh"),r._refreshList()})},this._refreshList=function(){this._clearCache("latestList"),this.execute()},this.latestListBeforeRender=function(e){var t,r=[];if(!e.results)return e;for(var i in e.deadHeats)for(t=0;t<e.deadHeats[i].length;t++)"1st"===e.deadHeats[i][t]&&r.push({deadheatRace:i,deadheatPosition:"1st"}),"2nd"===e.deadHeats[i][t]&&r.push({deadheatRace:i,deadheatPosition:"2nd"}),"3rd"===e.deadHeats[i][t]&&r.push({deadheatRace:i,deadheatPosition:"3rd"});var s=[],n=[];for(var a in e.results)e.results[a].forEach(function(e,t,r){"1"===e.position&&s.push({raceId:e.raceId,position:1,distances:e.rpDistDesc}),"2"===e.position&&s.push({raceId:e.raceId,position:2,distances:e.rpDistDesc}),"3"===e.position&&s.push({raceId:e.raceId,position:3,distances:e.rpDistDesc})});for(t=0;t<r.length;t++)"3rd"===r[t].deadheatPosition&&n.push(r[t].deadheatRace);var o="";for(t=0;t<n.length;t++)o+=n[t]+" ";var c=[];for(t=0;t<s.length;t++)s[t+1]&&2===s[t].position&&3===s[t+1].position&&""!==s[t].distances&&""!==s[t+1]&&s[t].raceId===s[t+1].raceId||s[t+1]&&2===s[t].position&&3===s[t+1].position&&-1!==o.search(s[t].raceId)?c.push({raceId:s[t].raceId,distance:s[t].distances+", "+s[t+1].distances}):s[t+1]&&2===s[t].position&&3===s[t+1].position&&""!==s[t].distances&&""===s[t+1]&&s[t].raceId===s[t+1].raceId?c.push({raceId:s[t].raceId,distance:s[t].distances}):s[t+1]&&2===s[t].position&&3===s[t+1].position&&""===s[t].distances&&""!==s[t+1]&&s[t].raceId===s[t+1].raceId?c.push({raceId:s[t+1].raceId,distance:s[t+1].distances}):!s[t+1]||"dht"!==s[t].distances&&"dht"!==s[t+1].distances||""===s[t].distances||""===s[t+1]||s[t].raceId!==s[t+1].raceId||-1!==o.search(s[t].raceId)?!s[t+1]||"dht"!==s[t].distances&&"dht"!==s[t+1].distances||s[t].distances||""===s[t+1]||s[t].raceId!==s[t+1].raceId||-1!==o.search(s[t].raceId)||c.push({raceId:s[t+1].raceId,distance:s[t+1].distances}):c.push({raceId:s[t].raceId,distance:s[t].distances+", "+s[t+1].distances}),!s[t+1]||"dht"!==s[t].distances&&"dht"!==s[t+1].distances||s[t+1].distances||""===s[t]||s[t].raceId!==s[t+1].raceId||-1!==o.search(s[t].raceId)||c.push({raceId:s[t].raceId,distance:s[t].distances});for(a in e.distancesResults=c,e.results)for(t=0;t<e.results[a].length;t++)for(var l=0;l<c.length;l++)if(e.results[a][t].raceId===c[l].raceId){e.results[a][t].distancesResults=c[l].distance;for(var d=0;d<r.length;d++)r[d].deadheatRace===e.results[a][t].raceId&&(e.results[a][t].deadheatPosition=r[d].deadheatPosition)}return e},this.latestListAfterRender=function(e){var t=$(".is-deadheat-1st.deadheat-time").filter(":odd"),r=$(".is-deadheat-1st.deadheat-distance").filter(":even"),i=$(".is-deadheat-2nd").filter(":even"),s=this;return 1<$(".is-deadheat-1st").length&&($(t).addClass("deadheat-hide"),$(r).addClass("deadheat-hide")),1<$(".is-deadheat-2nd").length&&$(i).addClass("deadheat-hide"),this.refreshTimer=setInterval(function(){s._refreshList()},3e4),e},this.latestListOnDestroy=function(){clearInterval(this.refreshTimer)}},webApp.extend(greyhoundbet.ResultsLatestController,webApp.AbstractController);webApp=webApp||{};(greyhoundbet=greyhoundbet||{}).ResultMeetingResultController=function(e,t){greyhoundbet.ResultMeetingResultController.superclass.constructor.call(this,e,t);this.playerParams={},this._preExecute=function(){!webApp.isDesktop&&this.accessedFromBookmark()&&this._redirectAndExit("meeting-list")},this._postExecute=function(){$(".btnRefresh").hide()},this.meetingHeaderBeforeRender=function(e){var t=this.getRequestParams();return e.searchDog=!!t.search&&t.search,(t.back||e.searchDog)&&(e.displayBack=!0),e},this.listBeforeRender=function(r){var i,s=this.getRequestParams(),n=this;r.collectionJorney=n.collectionJorney,r.rDate=s.r_date,r.trackId=s.track_id,r.raceId=s.race_id,r.raceInstanceId=s.race_id,this.races=[],$.each(r.track.races,function(e,t){r.track.results.hasOwnProperty(t.raceId)&&(t.raceTime=t.raceDate.split(" ")[1],i=+t.racePrize,t.racePrize=i.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),n.races.push(t)),t.raceId===r.raceId&&(r.r_Time=t.raceDate.split(" ")[1],t.clipId?n.playerParams={videoIsAvailable:!0,videoId:t.videoid,startSec:t.startSec,endSec:t.endSec,streamDate:s.r_date.slice(0,7).replace("-","_")}:n.playerParams={videoIsAvailable:!1}),t.goTypeNum=n.decorateGoing(t.goTypeNum)});var e=this.processDate(s.r_date);return $(".pageHeader #headerTitle").html('<span class="rTitle">'+r.track.track+" "+e+"</span>"),$(".pageHeader #headerTitle").width()<$(".pageHeader #headerTitle > .rTitle").width()&&$(".pageHeader #headerTitle").html('<span class="rTitle">'+r.track.trackShortName+" "+e+"</span>"),r},this.decorateGoing=function(e){var t=parseInt(e);return isNaN(t)?"":0<t?"+"+e:0==t?"N":e},this.processDate=function(e){var t=[(e=new Date(e.replace(/(\d+)-(\d+)-(\d+)/,"$2/$3/$1"))).getDate(),e.getMonth()+1];for(var r in t)t[r]=t[r].toString().replace(/^([0-9])$/,"0$1");return t[0]+"/"+t[1]+"/"+String(e.getFullYear()).slice(2)},this.initResultPager=function(e){var r=this._getCache("list"),t=this.getRequestParams();r.rDate=t.r_date,r.trackId=t.track_id,r.raceId=t.race_id;var i=[];$.each(r.track.races,function(e,t){r.track.results.hasOwnProperty(t.raceId)&&r.track.results[t.raceId]&&"18"!=r.track.results[t.raceId][0].finalROutcomeId&&(t.raceTime=t.raceDate.split(" ")[1],i.push(t)),t.raceId===r.raceId&&(r.rTime=t.raceDate.split(" ")[1])}),pager=new greyhoundbet.racePager({data:i,urlParams:t,prevSelector:"#pagerPrevResult",nextSelector:"#pagerNextResult",timeSelector:"#pagerResultTime"})},this.listAfterRender=function(e){if(!1===webApp.isMobile&&($.each($(".dog-result-details .dog-color"),function(e,t){$(t).html($(t).html().replace(/\s/g,""))}),$.each($(".dog-result-details .dog-sex"),function(e,t){$(t).html($(t).html().toLowerCase())}),$.each($(".dog-result-details .dog-sire-dam"),function(e,t){var s=$(t).html().toLowerCase().split(" ");$.each(s,function(e,t){var r=t.substr(0,1),i=t.substr(1);t=r.toUpperCase().concat(i),s[e]=t}),$(t).html(s.join(" ").replace(/\s-\s/,"-"))}),$.each($(".dog-result-details .dog-date-of-birth"),function(e,t){var r,i,s,n=$(t).html().split(" ")[1].split("-");$(t).html((i=(r=n)[1],s=(s=r[0]).replace(/\b\d\d/,""),-1!==i.search(/0\d/)&&(i=i.replace(/0/,"")),{1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"}[i]+" "+s))})),webApp.isAndroid&&this.playerParams.videoIsAvailable){var t="rtmp://greyh.fod.performgroup.com/fod/mp4:arc/flv/323/"+this.playerParams.streamDate+"/"+this.playerParams.videoId+".mp4",r="/fod/mp4:arc/flv/323/"+this.playerParams.streamDate+"/"+this.playerParams.videoId+".mp4",i=(this.playerParams.startSec,this.playerParams.startSec%60),s={url:t,host:"greyh.fod.performgroup.com",pathName:r,protocol:"rtmp",message:"The race will starts at "+(this.playerParams.startSec-i)/60+":"+i+" of this video"};$(".androidArchiveVideo").on("click",function(){webApp.confirmPopup({tpl:"video-popup",urlParams:s})})}},this.collectionJorney="results"},webApp.extend(greyhoundbet.ResultMeetingResultController,webApp.AbstractController),(greyhoundbet=greyhoundbet||{}).CardMeetingResultController=function(e,t){greyhoundbet.CardMeetingResultController.superclass.constructor.call(this,e,t),this._preExecute=function(){!webApp.isDesktop&&this.accessedFromBookmark()&&this._redirectAndExit("meeting-list")},this.collectionJorney="cards"},webApp.extend(greyhoundbet.CardMeetingResultController,greyhoundbet.ResultMeetingResultController),(greyhoundbet=greyhoundbet||{}).ResultsFormExplainedController=function(e,t){greyhoundbet.ResultsFormExplainedController.superclass.constructor.call(this,e,t)},webApp.extend(greyhoundbet.ResultsFormExplainedController,webApp.AbstractNodataCredentialsController),(greyhoundbet=greyhoundbet||{}).ResultsDogController=function(e,t){greyhoundbet.ResultsDogController.superclass.constructor.call(this,e,t),this.resultsDogHeaderBeforeRender=function(e){var t=this.getRequestParams();return e.raceTime=t.r_time,e},this.resultsDogHeaderAfterRender=function(){webApp.eventTracker=new webApp.GaEventTracker,webApp.eventTracker.setEventsConfig(webApp.gaEvents),webApp.eventTracker.setDeviceOrientation(webApp.core.getOrientation());this.getRequestParams();$("#dogResultBack").click(function(){webApp.eventTracker.trackEventById("results_back_to_result")});var e=this._prepareDataForPager(this._getCache("results-dog-header"));this._pager=new webApp.simplePager({data:e,urlParams:this.getRequestParams(),urlValue:"dog_id",loop:!0,countSelector:"#serialPos"})},this.resultsDogDetailsBeforeRender=function(e){e.isResult=!0,e.collectionJorney=this.collectionJorney,webApp.dogCareerDataForSort=e;for(var t=0;t<webApp.dogCareerDataForSort.forms.length;t++)webApp.dogCareerDataForSort.forms[t].index=t;return e},this.resultsDogDetailsAfterRender=function(){$(document).on("click.formMeetingLink",".formGrid a",function(e){var t=webApp.urlManager,r=$(e.target).attr("href");t.getHash();t.setHash(t.addParamToHash(r,"back",1)),e.preventDefault()}),webApp.sortableColumns.init($("#sortableTable"))},this._prepareDataForPager=function(e){var t=[],r=e;return r.hasOwnProperty("dogs")&&$.each(r.dogs,function(e){t.push(r.dogs[e].dogId)}),t},this.collectionJorney="results",this.destroy=function(){$(document).unbind(".formMeetingLink")}},webApp.extend(greyhoundbet.ResultsDogController,webApp.AbstractController),(greyhoundbet=greyhoundbet||{}).CardDogController=function(e,t){greyhoundbet.CardDogController.superclass.constructor.call(this,e,t),this._preExecute=function(){!webApp.isDesktop&&this.accessedFromBookmark()&&this._redirectAndExit("meeting-list")},this.collectionJorney="cards",this.resultsDogDetailsBeforeRender=function(e){e.isResult=!1,e.collectionJorney=this.collectionJorney,webApp.dogCareerDataForSort=e;for(var t=0;t<webApp.dogCareerDataForSort.forms.length;t++)webApp.dogCareerDataForSort.forms[t].index=t;return e}},webApp.extend(greyhoundbet.CardDogController,greyhoundbet.ResultsDogController),(greyhoundbet=greyhoundbet||{}).ResultVideoController=function(e,t){greyhoundbet.ResultVideoController.superclass.constructor.call(this,e,t),this.clipStartSec=null,this.clipEndSec=null,this.hideRaceDetails=!1,this._preExecute=function(){!webApp.isDesktop&&this.accessedFromBookmark()&&this._redirectAndExit("meeting-list")},this.playerDataBeforeRender=function(){var e,t={},r=0,i=webApp.isIE;return t=this.getRequestParams(),this.clipStartSec=t.start_sec,this.clipEndSec=t.end_sec,e="rtmp://greyh.fod.performgroup.com/fod/mp4:arc/flv/323/"+t.r_date.slice(0,7).replace("-","_")+"/"+t.video_id+".mp4",-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&(r=1),{clipId:t.clip_id,streamUrl:e,isFireFox:r,isIE:i}},this.listBeforeRender=function(r){var i,e=this.getRequestParams(),s=this;return r.collectionJorney=s.collectionJorney,r.rDate=e.r_date,r.trackId=e.track_id,r.raceId=e.race_id,r.raceInstanceId=e.race_id,this.races=[],$.each(r.track.races,function(e,t){r.track.results.hasOwnProperty(t.raceId)&&(t.raceTime=t.raceDate.split(" ")[1],i=+t.racePrize,t.racePrize=i.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),s.races.push(t)),t.raceId===r.raceId&&(r.r_Time=t.raceDate.split(" ")[1]),t.goTypeNum=s.decorateGoing(t.goTypeNum)}),r},this.playerDataAfterRender=function(){var e,i=this;(-1!==navigator.userAgent.toLowerCase().indexOf("firefox")||webApp.isIE)&&(webApp.dataLoading.show("Loading Video"),this.player=new MediaElementPlayer("#video-tag",{features:["volume"],clickToPlayPause:!1,success:function(t,e){var r=!1;t.addEventListener("play",function(e){r||(r=!0,t.setCurrentTime(i.clipStartSec))},!1),t.addEventListener("timeupdate",function(e){e.currentTime>i.clipEndSec&&(t.stop(),r=!1)},!1),t.addEventListener("progress",function(e){webApp.dataLoading.hide()},!1)},error:function(){webApp.dataLoading.hide(),console.log("OPTS: Video player error")}})),e=navigator.plugins["Shockwave Flash"],!webApp.isDesktop||webApp.isIE10||e||(alert("Please install Adobe Flash Plug-in to access this functionality"),$(".playerContainer").hide(),this.hideRaceDetails=!0)},this.listAfterRender=function(){this.hideRaceDetails&&$(".archiveDetails").hide()},this.onDestroyCallback=function(){document.querySelector("#video-tag")&&(document.querySelector("#video-tag").onerror=function(e){return e.preventDefault(),!0});var r=this;webApp.isIE&&function(){if(r.player&&0<$(".mejs-shim").length){var e=$(".mejs-shim").attr("id");r.player.remove(),$("#video-tag").remove(),$("#"+e).remove();var t=document.createElement("div");t.id=e,t.SetReturnValue=function(){return!0},$("body").append(t)}}()},this.decorateGoing=function(e){var t=parseInt(e);return isNaN(t)?"":0<t?"+"+e:0==t?"N":e}},webApp.extend(greyhoundbet.ResultVideoController,webApp.AbstractController),(greyhoundbet=greyhoundbet||{}).CardVideoController=function(e,t){greyhoundbet.CardVideoController.superclass.constructor.call(this,e,t),this._preExecute=function(){!webApp.isDesktop&&this.accessedFromBookmark()&&this._redirectAndExit("meeting-list")}},webApp.extend(greyhoundbet.CardVideoController,greyhoundbet.ResultVideoController),(greyhoundbet=greyhoundbet||{}).NewsHomeController=function(e,t){greyhoundbet.NewsHomeController.superclass.constructor.call(this,e,t),this._preExecute=function(){this._setCache("header",{})},this.bindRefresh=function(){var e=this;webApp.eventTracker=new webApp.GaEventTracker,webApp.eventTracker.setEventsConfig(webApp.gaEvents),webApp.eventTracker.setDeviceOrientation(webApp.core.getOrientation()),$("#refreshNewsList").click(function(){webApp.eventTracker.trackEventById("news_refresh"),e._refreshNewsList()})},this._refreshNewsList=function(){this._clearCache("news-list"),this._core().getCacheManager().clearCache(this._getBlockDefaultCacheId("news-story","top-nav")),this.execute()}},webApp.extend(greyhoundbet.NewsHomeController,webApp.AbstractController),(greyhoundbet=greyhoundbet||{}).NewsStoryController=function(e,t){greyhoundbet.NewsStoryController.superclass.constructor.call(this,e,t);this.topNavAfterRender=function(){webApp.eventTracker=new webApp.GaEventTracker,webApp.eventTracker.setEventsConfig(webApp.gaEvents),webApp.eventTracker.setDeviceOrientation(webApp.core.getOrientation()),$("#newsBackToAll").click(function(){webApp.eventTracker.trackEventById("news_back_to_all")});var e=this._prepareDataForPager(this._getCache("top-nav")),t=this.getRequestParams();this._pager=new webApp.simplePager({data:e,urlParams:t,loop:!1})},this._prepareDataForPager=function(e){var t=[],r=e;return r.hasOwnProperty("topNews")&&$.each(r.topNews,function(e){t.push(r.topNews[e].id)}),t},this.contentBeforeRender=function(e){return this._pager&&this._pager.renew(e.id),e}},webApp.extend(greyhoundbet.NewsStoryController,webApp.AbstractController),(greyhoundbet=greyhoundbet||{}).BetSlipController=function(e,t){greyhoundbet.BetSlipController.superclass.constructor.call(this,e,t),this.headerBeforeRender=function(e){var t=this._core().getCacheManager();if(t.isCached("card_title")){var r=t._findCache("card_title");e.crsId=r.keys.crs_id,e.raceDate=r.keys.r_date,e.raceId=r.keys.race_id}return(e=this.addCredentialsToView(e)).currency=this.currencyView(this.currency),e.currencyCode=this.currency,e.bets=this.betslip.bets(),e},this.mainBeforeRender=function(e){if((e=this.addCredentialsToView(e)).currency=this.currencyView(this.currency),e.currencyCode=this.currency,0===this.selectionsCollection.selections().length)return e;e.bets=this.betslip.bets(),webApp.bet=e.bets[0]||"",webApp.selection=webApp.bet.selections()[0]||"";var t=this._core().getCacheManager();if(t.isCached("card_title")){var r=t._findCache("card_title");e.crsId=r.keys.crs_id,e.raceDate=r.keys.r_date,e.raceId=r.keys.race_id}e.addSelectionsUrl="#meeting-list";var i=webApp.urlManager.getBackUrl(this._name),s=webApp.urlManager.parseHash(i);return"card"==s[0]||"advanced-video"==s[0]?e.addSelectionsUrl=i:"predictor"==s[0]&&(e.addSelectionsUrl=webApp.urlManager.createHash(s)),0<=i.indexOf("receipt")?e.backUrl="#card":e.backUrl=i,e}},webApp.extend(greyhoundbet.BetSlipController,webApp.BetSlipController),(greyhoundbet=greyhoundbet||{}).GenericErrorController=function(e,t){greyhoundbet.GenericErrorController.superclass.constructor.call(this,e,t),this.errorRedirect=function(){this._redirectAndExit("meeting-list")},this.mainBeforeRender=function(e){webApp.bookieCollection.getCurrentProvider().isLoggedIn()||this.errorRedirect();var t=this.addCredentialsToView(e);return $.extend(t,this.getRequestParams()),t.currency=webApp.bookieCollection.getCurrentProvider().user().currency(),t.backUrl=webApp.registry.get("backUrlHash")||!1,t.backUrl?t.backUrl=t.backUrl.replace("predictor","card"):t.backUrl="#meeting-list",t}},webApp.extend(greyhoundbet.GenericErrorController,webApp.GenericErrorController),(greyhoundbet=greyhoundbet||{}).MarketSuspendErrorController=function(e,t){greyhoundbet.MarketSuspendErrorController.superclass.constructor.call(this,e,t),this.errorRedirect=function(){this._redirectAndExit("meeting-list")},this.getBackUrl=function(){return"#meeting-list"}},webApp.extend(greyhoundbet.MarketSuspendErrorController,webApp.MarketSuspendErrorController),(greyhoundbet=greyhoundbet||{}).PriceChangedErrorController=function(e,t){greyhoundbet.PriceChangedErrorController.superclass.constructor.call(this,e,t),this._preExecute=function(){var e=webApp.prefBookmaker.get();this._config.blocks.main.template=e+"-price-changed-error",$("#price-changed-error-scroll").height(0)},this.errorRedirect=function(){this._redirectAndExit("meeting-list")},this.getBackUrl=function(){return"#bet-slip"}},webApp.extend(greyhoundbet.PriceChangedErrorController,webApp.PriceChangedErrorController),(greyhoundbet=greyhoundbet||{}).DogController=function(e,t){greyhoundbet.DogController.superclass.constructor.call(this,e,t),this.stats={},this._preExecute=function(){(!webApp.isDesktop&&this.isPastDateRequested()||!webApp.isDesktop&&this.accessedFromBookmark())&&this._redirectAndExit("meeting-list")},this.headerBeforeRender=function(e){return this.stats=e},this.headerAfterRender=function(){var e=this.getRequestParams(),t=[],r=this.isTodaysDateRequested()?"card":"form",i=e.track_id?"&track_id="+e.track_id:"";for(var s in $(".btnBack").attr("href","#card/race_id="+e.race_id+"&r_date="+e.r_date+"&tab="+r+i),this.stats.trapTrackRecords)t.push(this.stats.trapTrackRecords[s].dogId);this._pager=new webApp.simplePager({data:t,countSelector:"#serialPos",urlParams:e,urlValue:"dog_id"})},this.detailsBeforeRender=function(e){var t=e.dogInfo.trapNum,r=this.stats,i={};if(this.isTodaysDateRequested()){var s=this.getStatsByTrap(t,r.dogPerformance),n=this.getStatsByTrap(t,r.trapRecord),a=this.getStatsByTrap(t,r.recordAtThisGrade),o=[s.total,n.total,a.total];i={dogPerformance:s,trapRecord:n,recordAtThisGrade:a,trackName:r.trackName,raceGrade:r.raceGrade,max:o.sort(function(e,t){return t-e})[0],isStatisticsAvailable:!0}}else i={isStatisticsAvailable:!1};webApp.dogCareerDataForSort=e;for(var c=0;c<webApp.dogCareerDataForSort.forms.length;c++)webApp.dogCareerDataForSort.forms[c].index=c;var l=$.extend(e,i);return l.collectionJorney=this.collectionJorney,l},this.detailsAfterRender=function(){$(document).on("click.formMeetingLink",".formGrid a",function(e){var t=webApp.urlManager,r=$(e.target).attr("href");t.getHash();t.setHash(t.addParamToHash(r,"back",1)),e.preventDefault()}),webApp.sortableColumns.init($("#sortableTable"))},this.getStatsByTrap=function(e,t){var r;for(r in t)if(t[r].num===e)return t[r];return{}},this.collectionJorney="cards",this.destroy=function(){$(document).unbind(".formMeetingLink")}},webApp.extend(greyhoundbet.DogController,webApp.AbstractController),(greyhoundbet=greyhoundbet||{}).VideoController=function(e,t){greyhoundbet.VideoController.superclass.constructor.call(this,e,t),this.RP_VIDEO_SHOWN_NAME="RP_VIDEO_SHOWN";var n=parseInt(utils.localStorage.get(this.RP_VIDEO_SHOWN_NAME),10);this._preExecute=function(){0!=n?webApp.isDesktop&&$("body").addClass("hideMainTabs rpgTVPage"):this._redirectAndExit("meeting-list")},this._postExecute=function(){webApp.isDesktop&&$("body").addClass("hideMainTabs")};var a={};this.videoUrlsBeforeRender=function(e){return a=e},this.videoUrlsAfterRender=function(){var e,t="",r=[];if(isFlashPluginAvailable=!1,(e=$("#video-tag")).hide(),webApp.isDesktop)if($("#videoLoadBox").hide(),t=a.androidlortmp,1==n&&t){utils.localStorage.set(this.RP_VIDEO_SHOWN_NAME,0),e.show(),webApp.dataLoading.show("Loading Video"),r=["fullscreen","volume"],webApp.isIE&&(r=["volume"]);new MediaElementPlayer("#video-tag",{features:r,clickToPlayPause:!1,enableAutosize:!0,success:function(e,t){e.addEventListener("progress",function(e){webApp.dataLoading.hide()},!1)},error:function(){webApp.dataLoading.hide(),$(".rpgtvPlayerContainer").hide(),isFlashPluginAvailable=navigator.plugins["Shockwave Flash"],isFlashPluginAvailable?alert("Something went wrong"):alert("Please install Adobe Flash Plug-in to access this functionality")}})}else $("#videoLoadBox").hide(),$("#videoHolderBox").show();else if(webApp.isIDevice)t=a.iPhone,1==n&&t?(utils.localStorage.set(this.RP_VIDEO_SHOWN_NAME,0),window.location=t):($("#videoLoadBox").hide(),$("#videoHolderBox").show(),webApp.viewManager.getScroll(this._name).refresh());else if(webApp.isAndroid){$("#videoLoadBox").hide(),$("#videoHolderBox").show();var i,s;t=a.androidhirtmp;t=a.androidlortmp,i={url:(s=new RegExp("^(([^:/\\?#]+):)?(//(([^:/\\?#]*)(?::([^/\\?#]*))?))?([^\\?#]*)(\\?([^#]*))?(#(.*))?$").exec(t))[0],host:s[4],pathName:s[7]+s[8],protocol:"rtmp"},1==n&&t&&(webApp.confirmPopup({tpl:"video-popup",urlParams:i}),utils.localStorage.set(this.RP_VIDEO_SHOWN_NAME,0))}}},webApp.extend(greyhoundbet.VideoController,webApp.AbstractController),(greyhoundbet=greyhoundbet||{}).AdvancedVideoController=function(e,t){greyhoundbet.AdvancedVideoController.superclass.constructor.call(this,e,t),this.RP_VIDEO_SHOWN_NAME="RP_VIDEO_SHOWN",this.isRpgtvDay=!1,this.videoDetailsDataLength=0,this.isVideoPlaying=!1,this.serverTime="",this.serverFullTime="",this.serverFullTimeLondon="",this.shouldShowVideo=!1,this.tracksShortNames="",this.state=4,this._preExecute=function(){this._diffusionPriceSession=new window.rpDiffusion.default({onDataFunction:this.onPriceReceived.bind(this)})},this.onPriceReceived=function(e){this.acceptPrice(this.transformToLegacyPrice(e))},this.transformToLegacyPrice=function(e){var t=e.getFields(0),r=e.getTopic().split("/"),i=r[3],s=r[5];return{selectionId:t[1],selectionName:s.replace(/ /g,"_"),name:s.replace("TRAP","Trap"),hours:Number(i.split(":")[0]),minutes:Number(i.split(":")[1]),numerator:Number(t[7].split("/")[0]),denominator:Number(t[7].split("/")[1]),fractional:t[7],decimal:t[8],isSuspended:"H"===t[6]}};var n={},a={};this.videoUrlsBeforeRender=function(e){return n=e,this.isRpgtvDay=!n.isNonRpgtvDay,this.serverTime=n.dayTime,this.serverFullTime=n.serverFullTime,this.serverFullTimeLondon=n.serverFullTimeLondon,e},this.videoUrlsAfterRender=function(){},this.contentBeforeRender=function(e){return this.isRpgtvDay=this.isRpgtvDay&&!!e.meetingsCount,this.isRpgtvDay&&(a=e.data,this.createHeader(e),this.checkTimeDifferenceToFirstRace()),this.setState(),e},this.contentAfterRender=function(){var e=this;this.isRpgtvDay&&(this.refreshDetails=setInterval(function(){e.requestDetails()},6e4))},this._postExecute=function(){var e=$(window),t=e.height(),r=e.width();webApp.googleTagAds.proccessAds(r,t)},this.contentOnDestroy=function(){var e=$(window),t=e.height(),r=e.width();webApp.googleTagAds.proccessAds(r,t),clearInterval(this.refreshDetails),this._diffusionPriceSession.unsubscribeAll(),delete this._diffusionPriceSession},this.checkTimeDifferenceToFirstRace=function(){var r,e,t,i=[],s=0;a[0].hasOwnProperty("firstRaceTime")&&($.each(a,function(e,t){r=t.firstRaceTime.replace(/-/g,"/"),i[e]=new Date(r).getTime()}),s=Math.min.apply(Math,i),e=this.serverFullTimeLondon.replace(/-/g,"/"),t=new Date(e).getTime(),this.shouldShowVideo=s-t<=18e5)},this.initVideoPlayer=function(){var e,t,r=this,i=[],s=$(".advancedVideoTag").find("source")[0];(t=$(".advancedVideoTag")).hide(),$("#videoLoadBox").hide(),(e=n.androidlortmp)&&this.shouldShowVideo?(s.src=e,t.show(),i=["fullscreen","volume"],webApp.isIE&&(i=["volume"]),this.advancedVideoPlayer=new MediaElementPlayer("#video-tag",{features:i,clickToPlayPause:!1,enableAutosize:!0,success:function(e,t){e.addEventListener("progress",function(e){r.isVideoPlaying=!0},!1)},error:function(){$(".rpgtvPlayerContainer").hide(),navigator.plugins["Shockwave Flash"]?alert("Something went wrong"):alert("Please install Adobe Flash Plug-in to access this functionality")}})):($("#videoLoadBox").hide(),$("#videoHolderBox").show())},this.requestDetails=function(){var s=this;webApp.ajaxManager.makeRequest("/video/blocks.sd",{blocks:"video-urls,content"},function(e){var t=e.content,r=e["video-urls"];n=r,a=t.data,s.serverTime=r.dayTime,s.serverFullTime=r.serverFullTime,s.serverFullTimeLondon=r.serverFullTimeLondon,s.checkTimeDifferenceToFirstRace(),s.setState();var i=JSON.stringify(t).length;s.videoDetailsDataLength!==i&&t&&(s.renderDetails(t),s.createHeader(t),s.videoDetailsDataLength=i)},function(e){console.log(e)},function(){})},this.renderDetails=function(e){var t=this._core().getViewManager();$(".content").empty().append(t.renderTpl("video-details",e)),t.refreshAllScrolls()},this.createHeader=function(e){var t=$(".headerTitle")[0],r="RPGTV Trap Challenge",i="";1===e.meetingsCount?(r=e.tracksNames[0]+" RPGTV Trap Challenge",i=e.tracksShortNames[0]):2===e.meetingsCount&&(r=e.tracksNames[0]+" and "+e.tracksNames[1]+" RPGTV Combined Trap Challenge",i=e.tracksShortNames[0]+" and "+e.tracksShortNames[1]),t.innerText=r,this.tracksShortNames=i},this.removeVideoPlayer=function(){var e=$(".rpgtvPlayerContainer");this.advancedVideoPlayer&&(this.advancedVideoPlayer.remove(),this.advancedVideoPlayer=!1),e.empty().append('<video class="videoTag advancedVideoTag" autoplay="" width="100%" height="100%" id="video-tag" preload="auto" style="display: none;"><source type="video/rtmp" src=""></video>')},this.setState=function(){var e=!!n.androidlortmp,t=this.state;this.isRpgtvDay||(this.state=0),this.isRpgtvDay&&(this.serverTime<"21:30"&&!this.shouldShowVideo&&(this.state=1),e&&this.shouldShowVideo&&(this.state=2),"21:29"<this.serverTime&&!e&&(this.state=3),e&&!this.isVideoPlaying&&2===t&&this.processState()),this.state!=t&&this.processState()},this.processState=function(){var e=$("#videoHolderBox"),t=$(".videoHolder"),r=$(".rpgtvPlayerContainer"),i=$(".trapChallengeContainer"),s=$(".trapChallengesFooter"),n=$(".presentersInfo"),a=$(".rpgtvDetails ");0==this.state&&(i.hide(),s.hide(),r.hide(),a.hide(),e.show(),t.show(),n.show(),clearInterval(this.refreshDetails),this.removeVideoPlayer(),this.isVideoPlaying=!1),1==this.state&&(e.hide(),t.hide(),i.show(),s.show(),a.show(),r.hide(),this.subscribeToPrices(),this.removeVideoPlayer(),this.isVideoPlaying=!1),2==this.state&&(e.hide(),t.hide(),i.hide(),this.removeVideoPlayer(),s.show(),r.show(),a.show(),this.isVideoPlaying||this.initVideoPlayer()),3==this.state&&(r.hide(),e.show(),t.show(),a.show(),n.hide(),i.hide(),s.show(),this.removeVideoPlayer(),this.isVideoPlaying=!1)},this.subscribeToPrices=function(){var t,r=this,i=n.priceTopicD5;i&&[1,2,3,4,5,6].forEach(function(e){t={topic:i.replace("PREFERRED_BOOKMAKER",webApp.PREFERRED_BOOKMAKER).replace("TRAP_NUMBER","TRAP "+e)},r._diffusionPriceSession.subscribe(t)})},this.acceptPrice=function(e){var t=this._core().getViewManager(),r=(this._helper("eventTracker"),e.name),i="#bet-"+e.selectionName,s=$(i),n=i+" span";if(r)if(e.isSuspended)$(i).empty();else{var a=webApp.bookieCollection.getCurrentBookieParams();"decimal"===webApp.userSettings.get("odds")?"SP"===e.fractional?e.price=e.fractional:e.price=(Math.floor(100*parseFloat(e.decimal))/100).toString():e.price=e.fractional;var o=t.renderTpl("price-button",{price:e,bookie:a}),c=new rp.betting.Selection({id:e.selectionId,price:"SP"===e.fractional?null:{num:e.numerator,den:e.denominator},isSP:!("SP"!==e.fractional),data:{selectionName:r,courseName:"RPGTV - Trap Challenge",courseNameAbbr:this.tracksShortNames,isTrapChallengePrice:!0,includeInMultiple:!1}}),l=this;e.isSuspended||o.bind("click.betClick",function(){webApp.registry.set({backUrlHash:window.location.hash}),c.eachWay(l._eachWay),c.data().isBOG=l._BOG;webApp.SelectionsManager.setOnAddMultModeCallback(function(){webApp.selectionsAlert.show(webApp.SelectionsManager.getSelections().length)}),webApp.SelectionsManager.processPriceClick(c,n,l,a.name)}),s.html(o),webApp.SelectionsManager.getSelections().length&&webApp.SelectionsManager.isSelected(c)&&webApp.SelectionsManager.highlightSelectionPrice(n)}}},webApp.extend(greyhoundbet.AdvancedVideoController,webApp.AbstractController),(greyhoundbet=greyhoundbet||{}).WhHomeController=function(e,t){greyhoundbet.WhHomeController.superclass.constructor.call(this,e,t)},webApp.extend(greyhoundbet.WhHomeController,webApp.WhHomeController),(greyhoundbet=greyhoundbet||{}).WhTopUpController=function(e,t){greyhoundbet.WhTopUpController.superclass.constructor.call(this,e,t),this.headerAfterRender=function(e){$(".btnBack").click(function(){webApp.eventTracker.trackEventById("deposit_account")})}},webApp.extend(greyhoundbet.WhTopUpController,webApp.WhTopUpController),(webApp=webApp||{}).WhGamblingDetailsController=function(e,t){webApp.WhGamblingDetailsController.superclass.constructor.call(this,e,t)},webApp.extend(webApp.WhGamblingDetailsController,webApp.AbstractNodataCredentialsController),(webApp=webApp||{}).LadbGamblingDetailsController=function(e,t){webApp.LadbGamblingDetailsController.superclass.constructor.call(this,e,t)},webApp.extend(webApp.LadbGamblingDetailsController,webApp.AbstractNodataCredentialsController),(greyhoundbet=greyhoundbet||{}).SearchController=function(e,t){greyhoundbet.SearchController.superclass.constructor.call(this,e,t),this._preExecute=function(){},this._postExecute=function(){},this.destroy=function(){},this.searchBeforeRender=function(e){return e},this.searchAfterRender=function(){var r=this.getRequestParams(),e=$("#search-page");e.find(".searchField").val(r.search_text).parent().addClass("changed"),webApp.searchFormInit(),e.find(".pagerBtn").on("click",function(){if(!$(this).hasClass("disabled")){var e=parseInt(r.page),t=$(this).hasClass("leftBtn")?e-1:e+1;webApp.urlManager.changeParams({page:t})}});e.find(".engagements").on("click",function(e){if(e.preventDefault(),!this.getAttribute("data-complete")){var i=this.parentElement.parentElement.parentElement;$(this).attr("data-complete",!0),$(i).find(".engagementsList").remove();var t={dog_id:this.getAttribute("data-dog-id"),blocks:"engagements"};$.ajax({url:"/search/blocks.sd",data:t,type:"GET",dataType:"json",cache:!1,timeout:6e4,success:function(e){var t,r;t=e,r=i,$.tmpl("dog-engagements",t).appendTo(r),$(window).trigger("resize")},error:function(e){console.log(e)},complete:function(){}})}})}},webApp.extend(greyhoundbet.SearchController,webApp.AbstractController),(greyhoundbet=greyhoundbet||{}).SearchDogController=function(e,t){greyhoundbet.SearchDogController.superclass.constructor.call(this,e,t),this.searchDogDetailsBeforeRender=function(e){var t=this.getRequestParams();if(e.hasOwnProperty("dogInfo")){var r=e.dogInfo.dogName;$("#dogHeaderTitle").html(r)}e.searchDog=t.dog_id,e.collectionJorney=this.collectionJorney,webApp.dogCareerDataForSort=e;for(var i=0;i<webApp.dogCareerDataForSort.forms.length;i++)webApp.dogCareerDataForSort.forms[i].index=i;return e},this.searchDogDetailsAfterRender=function(){webApp.sortableColumns.init($("#sortableTable"))},this.collectionJorney="cards"},webApp.extend(greyhoundbet.SearchDogController,webApp.AbstractController),(greyhoundbet=greyhoundbet||{}).SearchFormExplainedController=function(e,t){greyhoundbet.SearchFormExplainedController.superclass.constructor.call(this,e,t)},webApp.extend(greyhoundbet.SearchFormExplainedController,webApp.AbstractNodataCredentialsController),(webApp=webApp||{}).searchFormInit=function(){$(".searchField").on("focus",function(){$(this).parent().addClass("changed")}),$(".searchField").on("blur",function(){$.trim($(this).val())||$(this).parent().removeClass("changed")}),$(".searchForm").on("submit",function(){var e=$(this).find(".searchField").val();if(""==e||e.length<=2||16<e.length)return!1;var t=webApp.urlManager.createHash(["search",{page:1,search_text:$(this).find(".searchField").val()}]);return webApp.urlManager.setHash(t),!1})};
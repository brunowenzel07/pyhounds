
var webApp=webApp||{};webApp.blocksToLeaveCached=[];webApp.isFirstCall=true;webApp.AbstractController=function(name,config){webApp.AbstractController.superclass.constructor.call(this);this.THROW_NAME_PARAM_ERROR="ParamError";this.THROW_MESSAGE_FIRST_PARAMETER="Controller`s name should be passed as first parameter of constructor";this.THROW_MESSAGE_SECOND_PARAMETER="Controller`s config should be passed as second parameter of constructor";this.THROW_MESSAGE_CONFIG_NOT_EMPTY="Controller`s config should be non-empty object";this.THROW_MESSAGE_BLOCK_MISS_CONFIG="Blocks configuration has been missed";this.THROW_MESSAGE_BLOCK_NOT_CONFIG="Blocks configuration should be non-empty plain-object";this._processError=function(name,message){webApp.ErrorHandler.process(name+': '+message,{'name':name});throw{'name':name,'message':message};};this._checkName=function(name){if(!name){this._processError(this.THROW_NAME_PARAM_ERROR,this.THROW_MESSAGE_FIRST_PARAMETER);}
return name;};this._checkConfig=function(config){var name=null;var message=null;switch(true){case!config:message=this.THROW_MESSAGE_SECOND_PARAMETER;name=this.THROW_NAME_PARAM_ERROR;break;case $.isEmptyObject(config):message=this.THROW_MESSAGE_CONFIG_NOT_EMPTY;name=this.THROW_NAME_PARAM_ERROR;break;case $.isEmptyObject(config.blocks):message=this.THROW_MESSAGE_MISS_BLOCK_CONFIG;name=this.THROW_NAME_PARAM_ERROR;break;case(!$.isPlainObject(config.blocks)||$.isEmptyObject(config.blocks)):message=this.THROW_MESSAGE_BLOCK_NOT_CONFIG;name=this.THROW_NAME_PARAM_ERROR;break;}
if(name&&message){this._processError(name,message);}
return config;};this._name=this._checkName(name);this._parentName='';this._config=this._checkConfig(config);this._isFirstCall=true;this._isPostExecuteCall=false;this._cacheLifetime=(function(context){if(context._config&&(context._config.cacheLifetime||context._config.cacheLifetime===0)){return context._config.cacheLifetime;}else{return(1000*60*60*24);}})(this);this.CALLBACK_SUFFIX_AFTER_RENDER='AfterRender';this.CALLBACK_SUFFIX_BEFORE_RENDER='BeforeRender';this.CALLBACK_SUFFIX_ON_DESTROY='OnDestroy';this.cacheManager=webApp.cacheManager;this.viewManager=webApp.viewManager;this.ajaxManager=webApp.ajaxManager;this.urlManager=webApp.urlManager;this._requestParams={};this._blocksToRender=[];this._blocksToRenderHaveData=[];this._blocksToLoad=[];this.isRedirect=false;this.stopExecute=false;this.getName=function(){return this._name;};this.setRequestParams=function(requestParams){this._requestParams=requestParams;return this;};this.getRequestParams=function(){return $.extend({},this._requestParams);};this.getBlockConfig=function(blockName){return this._config.blocks[blockName]||{};};this._getBlockCacheKeys=function(blockName,isView){var result={};var config=this.getBlockConfig(blockName);var params=this.getRequestParams();var cacheArr=isView&&config.renderCacheBy?config.renderCacheBy:config.cacheBy;if(!cacheArr){return result;}
for(var i in cacheArr){var key=cacheArr[i];if(key in params){result[key]=params[key];}}
return result;};this._getBlockCacheLifetime=function(blockName){var config=this.getBlockConfig(blockName);if(config.cacheLifetime||config.cacheLifetime==0){return config.cacheLifetime;}
return this._cacheLifetime;};this._setCache=function(blockName,data){var keys=this._getBlockCacheKeys(blockName),cacheLifetime=this._getBlockCacheLifetime(blockName),cacheId=this._getBlockCacheId(blockName);this.cacheManager.setCache(cacheId,data,keys,cacheLifetime);};this._getCache=function(blockName){var keys=this._getBlockCacheKeys(blockName),cacheId=this._getBlockCacheId(blockName);return this.cacheManager.getCache(cacheId,keys);};this._isCached=function(blockName){var keys=this._getBlockCacheKeys(blockName),cacheId=this._getBlockCacheId(blockName);return this.cacheManager.isCached(cacheId,keys);};this._clearCache=function(blockName,isRequest){var keys=false;if($.isArray(blockName)){for(var key in blockName){if(isRequest){keys=this._getBlockCacheKeys(blockName[key]);}
this.cacheManager.clearCache(this._getBlockCacheId(blockName[key]),keys);this.viewManager.removeBlock(this._name,blockName[key]);}}else{if(isRequest){keys=this._getBlockCacheKeys(blockName);}
this.cacheManager.clearCache(this._getBlockCacheId(blockName),keys);this.viewManager.removeBlock(this._name,blockName);}};this._findBlocksToRender=function(){var result=[];for(var i in this._config.blocks){result.push(i);}
return result;};this._findBlocksToLoad=function(blocksToRender){var result=[];this._blocksToRenderHaveData=[];for(var i in blocksToRender){var blockName=blocksToRender[i];if(this.getBlockConfig(blockName).noCache||!this._isCached(blockName)){result.push(blockName);}else{this._blocksToRenderHaveData.push(blockName);var keysString='';var keys=this._getBlockCacheKeys(blockName,true);for(var key in keys){keysString=keysString+keys[key];}
if(!keysString){keysString=' | '}
else{keysString=' | '+keysString;}
var blockCacheConfig='cache '+this._getBlockCacheId(blockName)+keysString;webApp.blocksToLeaveCached.push(blockCacheConfig);}}
return result;};this.getBlocksToLoad=function(){var result={};for(var i in this._blocksToLoad){var blockName=this._blocksToLoad[i];result[blockName]=this.getBlockConfig(blockName);result[blockName].keys=this._getBlockCacheKeys(blockName,true);}
return result;};this.execute=function(){try{this.isRedirect=false;this.stopExecute=false;if(typeof this._preExecute=='function'){this._preExecute();}
if(this.stopExecute){return;}
webApp.blocksToLeaveCached=[];this._blocksToRender=this._findBlocksToRender();this._blocksToRenderLength=this._blocksToRender.length;if(!webApp.HorseDetailsController){webApp.cacheManager.clearAllCache();}
this._blocksToLoad=this._findBlocksToLoad(this._blocksToRender);if(this._blocksToRenderHaveData.length){if(webApp.isTablet){this.render();}
if(this._blocksToLoad.length&&!this._isFirstCall){this.viewManager.showBlocksPreloader(this._name,this.getBlocksToLoad());}}
if(!webApp.HorseDetailsController){if(!this._blocksToLoad.length&&!this._blocksToRenderHaveData.length){this.viewManager.showBlocksPreloader(this._name,this.getBlocksToLoad());}
webApp.dataLoading.showContentLoading();}
this.ajaxManager.process(this);}catch(e){webApp.ErrorHandler.process(this.getName()+'->'+'execute'+': '+e.name+': '+e.message,e);}};this.pushData=function(blocksData){for(var i in this._blocksToLoad){var name=this._blocksToLoad[i];if(blocksData[name]){if(typeof(blocksData[name].errorCode)!='undefined'&&blocksData[name].errorCode=='404'){var params={errorMessage:blocksData[name].errorMessage||'',referer:this._name,errorHash:window.location.hash};this._deligate('error404',params);}else{this._setCache(name,blocksData[name]);}}else{var config=this.getBlockConfig(name);if(!config.cacheId){this._setCache(name,{});}}}
return this;};this.render=function(isLoad){if(webApp.isTablet){var renderArr=isLoad?this._blocksToLoad:this._blocksToRenderHaveData;}else{var renderArr=this._blocksToRender;}
if(this._isFirstCall){this.viewManager.pageReady(this._name);}
var isAllRender=true;for(var i in renderArr){var blockName=renderArr[i];try{if(this.isRedirect){this.isRedirect=false;isAllRender=false;break;}else{this._renderBlock(blockName);if(this._blocksToRenderLength){this._blocksToRenderLength--;}}}catch(e){webApp.ErrorHandler.process(this.getName()+'['+blockName+']: '+e.name+': '+e.message,e);}}
if(isAllRender&&!this.isRedirect){if(this._isFirstCall){webApp.currentControllerName=this._parentName||this._name;this._isFirstCall=false;}
if(!this._blocksToRenderLength&&!this._isPostExecuteCall){if(typeof this._postExecute=='function'){this._postExecute();}
this._isPostExecuteCall=true;setTimeout($.proxy(function(){this.viewManager.hideUrlBar(this._name);},this),0);setTimeout($.proxy(function(){if(typeof(webApp.configs.ad)!='undefined'){var adArr=webApp.isTablet?webApp.configs.ad.rubicon.tablet:webApp.configs.ad.rubicon.phone;if(typeof(adArr[this._name])!='undefined'){webApp.rubiconAds.display(this._name,adArr[this._name]);}}
this.viewManager.switchPage(this._name,this._parentName);},this),10);}else{setTimeout($.proxy(function(){this.viewManager.setFrameSize();},this),800);}
setTimeout($.proxy(function(){this.viewManager.setScrollSize(this._name);},this),100);}
webApp.isFirstCall=false;if(!webApp.HorseDetailsController){webApp.dataLoading.hideContentLoading();}};this._renderBlock=function(blockName){var config=this.getBlockConfig(blockName),keys=this._getBlockCacheKeys(blockName,true),data=this._getCache(blockName),context=this;if(!data){return;}
config.beforeRenderClb=function(data){return context.beforeRenderCallback(blockName,data);};config.afterRenderClb=function($block){context.afterRenderCallback(blockName,$block);};config.onDestroyClb=function($block){context.onDestroyCallback(blockName,$block);};this.viewManager.renderBlock(this._name,blockName,config,data,keys);};this._getCallbackName=function(blockName,suffix){var parts=blockName.split('-');var result=[];for(var i in parts){var str=parts[i];if(i==0){result.push(str);continue;}
result.push(str.charAt(0).toUpperCase()+str.slice(1));}
return result.join('')+suffix;};this.beforeRenderCallback=function(blockName,data){var config=this.getBlockConfig(blockName);if(!config.beforeRender||!(config.beforeRender in this)){var magicCallback=this._getCallbackName(blockName,this.CALLBACK_SUFFIX_BEFORE_RENDER);if(magicCallback in this){config.beforeRender=magicCallback;}}
if(!(config.beforeRender in this)){return data;}
data=this[config.beforeRender](data);return data;};this.afterRenderCallback=function(blockName,$block){var config=this.getBlockConfig(blockName);if(!config.afterRender||!(config.afterRender in this)){var magicCallback=this._getCallbackName(blockName,this.CALLBACK_SUFFIX_AFTER_RENDER);if(magicCallback in this){config.afterRender=magicCallback;}}
if(!$block||!(config.afterRender in this)){return;}
this[config.afterRender]($block);};this.onDestroyCallback=function(blockName,$block){var config=this.getBlockConfig(blockName);if(!config.onDestroy||!(config.onDestroy in this)){var magicCallback=this._getCallbackName(blockName,this.CALLBACK_SUFFIX_ON_DESTROY);if(magicCallback in this){config.onDestroy=magicCallback;}}
if(!$block||!(config.onDestroy in this)){return;}
try{this[config.onDestroy]($block);}catch(e){webApp.ErrorHandler.process(this.getName()+'['+blockName+']: '+e.name+': '+e.message,e);}};this._redirect=function(controllerName,params,isBackBtnLogic){this.viewManager.flash(controllerName);var urlParams=[],hash;urlParams[0]=controllerName;urlParams[1]=params;hash=this.urlManager.createHash(urlParams);if(isBackBtnLogic){this.urlManager.setBackBtnClicked();}
if(this._name==controllerName){this.urlManager.replaseHash(hash);}else{this.urlManager.setHash(hash);}
this.isRedirect=true;};this._redirectAndExit=function(controllerName,params){this._redirect(controllerName,params);throw{name:'Redirect',message:'Controller "'+this.getName()+'" has made redirect'};};this._deligate=function(controllerName,params){this._core().dispatch([controllerName,params]);throw{name:'Deligate',message:'Controller "'+this.getName()+'" deligated processing to "'+controllerName+'"'};};this.destroy=function(){return;};this._getBlockCacheId=function(blockName){var config=this.getBlockConfig(blockName);var cacheId='';if(config.cacheId){cacheId=config.cacheId;}else{cacheId=this._getBlockDefaultCacheId(this.getName(),blockName);}
return cacheId;};this._getBlockDefaultCacheId=function(controllerName,blockName){return controllerName+'_'+blockName;};this.setSelectionsOnAddAlertCount=function(){var onAddMultModeCallback=function(){webApp.selectionsAlert.show(webApp.SelectionsManager.getSelections().length);};webApp.SelectionsManager.setOnAddMultModeCallback(onAddMultModeCallback);};this.setSelectionsOnAddConfirmDialog=function(){var eventTracker=this._helper('eventTracker');var onAddMultModeCallback=function(){var _context=this;webApp.selectionsConfirm(webApp.SelectionsManager.getSelections().length,{okCallback:function(){_context._redirect('bet-slip');eventTracker.trackEventById('cards_view_betslip');return false;},cancelCallback:function(){eventTracker.trackEventById('cards_dismiss');}});};webApp.SelectionsManager.setOnAddMultModeCallback($.proxy(onAddMultModeCallback,this));};this.isTodaysDateRequested=function(){var nowDate=utils.date.toString(utils.date.getSynchronizedToServerNow());return this.getRequestParams().r_date==nowDate;};this.isPastDateRequested=function(){var nowDate=new Date(utils.date.toString(utils.date.getSynchronizedToServerNow()));var requestedDate=new Date(this.getRequestParams().r_date);return requestedDate<nowDate;};this.accessedFromBookmark=function(){return!sessionStorage.getItem('prevControllerName');}};webApp.extend(webApp.AbstractController,webApp.Component);
var webApp=webApp||{};webApp.AbstractNodataController=function(name,config){webApp.AbstractNodataController.superclass.constructor.call(this,name,config);this.currency=webApp.userSettings.get('currency')||'GBP';this.selectionsCollection=rp.betting.SelectionsCollection.instance();this.betslip=null;this._isCached=function(){return true;};this._getCache=function(){return{};};this.saveBetslip=function(){if(this.betslip){localStorage.setItem('betslip',JSON.stringify(this.betslip.toJSON()));}};this.loadBetslip=function(){var loadedBetslip=null;if(localStorage.getItem('betslip')){loadedBetslip=rp.betting.BetSlip.create(localStorage.getItem('betslip'));}
return loadedBetslip;};this.forgetBetslip=function(){this.betslip=null;localStorage.removeItem('betslip');};this.restoreBetslip=function(){this.betslip=rp.betting.BetSlipBuilder.buildBetSlip(this.selectionsCollection,this.loadBetslip());};this.restoreDefaultIncludeInMultiple=function(){$.each(this.selectionsCollection.selections(),$.proxy(function(index,selection){this.selectionsCollection.updateStatus(selection,'includeInMultiple',true);},this));};this.restoreDefaultSP=function(){$.each(this.selectionsCollection.selections(),$.proxy(function(index,selection){if(selection.hasPrice()){selection.isSP(false);}},this));};};webApp.extend(webApp.AbstractNodataController,webApp.AbstractController);
var webApp=webApp||{},wh=wh||{};webApp.AbstractNodataCredentialsController=function(name,config){webApp.AbstractNodataCredentialsController.superclass.constructor.call(this,name,config);var _logoutHandlerReference=null;this.CURRENCY_UK_POUND='GBP';this.CURRENCY_EURO='EUR';this.CURRENCY_US_DOLLAR='USD';this.currenciesWithSigns=[this.CURRENCY_UK_POUND,this.CURRENCY_EURO,this.CURRENCY_US_DOLLAR];this.isLoggedIn=function(bookie){var provider=webApp.bookieCollection.getProvider(bookie);var isLoggedIn=Boolean(provider.isLoggedIn());return(isLoggedIn&&Boolean(provider.user())&&Boolean(provider.user().userIdentifier()));};this.addBookieCredentialsToView=function(data,bookie){var webSite;switch(bookie){case'wh':webSite='http://www.williamhill.com/';break;case'ladb':webSite='http://sports.ladbrokes.com';break;}
$.extend(data,{'bookie':{name:webApp.bookieCollection.getProviderName(bookie),index:bookie,terms:webApp.bookiesCollection[bookie].terms,openAccountUrl:webApp.bookiesCollection[bookie].openAccountUrl,website:webSite}});if(this.isLoggedIn(bookie)){var user=webApp.bookieCollection.getProvider(bookie).user();$.extend(data,{'userName':user.login(),'balance':this.balanceString(user.balance(),user.currency())});this.currency=user.currency();}
data.isLoggedIn=this.isLoggedIn(bookie);return data;};this.addCredentialsToView=function(data){var prefBookie=webApp.prefBookmaker.get();return this.addBookieCredentialsToView(data,prefBookie);};this.balanceString=function(balance,currency){var currencyView=this.currencyView(currency);var isWithSign=(this.currenciesWithSigns.indexOf(currency)>-1);var oneDigitAfterDot=/^[0-9]+\.[\d]{1}$/ig;balance=isNaN(+balance)?'N/A':balance;if(oneDigitAfterDot.test(parseFloat(balance))){balance=balance+'0';}else if(parseInt(balance,10)===parseFloat(balance)){balance=balance+'.00';}
return isWithSign?(currencyView+balance):(balance+' '+currencyView);};this.currencyView=function(currency){if(currency===this.CURRENCY_UK_POUND){return'&pound;';}else if(currency===this.CURRENCY_EURO){return'&euro;';}else if(currency===this.CURRENCY_US_DOLLAR){return'$';}
return currency;};this.bindLogout=function(){var prefBookie=webApp.prefBookmaker.get();this.bindProviderLogout(prefBookie);};this.handleLogout=function(bookie){switch(webApp.currentControllerName){case'bet-slip':case'price-changed-error':var redirectUrl=bookie+'-home';this._redirect(redirectUrl,{'from-betslip':1});break;case bookie+'-home':break;case bookie+'-account-home':webApp.dataLoading.hide();this._redirect('account-home');break;case bookie+'-open-bets':case bookie+'-top-up':this._redirect(bookie+'-home');break;case'account-home':webApp.dataLoading.hide();$('#bookie-'+bookie+' .colB').html('<a href="#'+bookie+'-home" data-eventid = "account_login" data-eventlabel = "'
+webApp.bookieCollection.getProviderName(bookie)
+'"><div>Log In</div><div>Open Account</div></a>');break;default:console.log('Not recognised current controller: %s',webApp.currentControllerName);break;}};this.bindProviderLogout=function(bookie){_logoutHandlerReference=function(){this.handleLogout(bookie);};var provider=webApp.bookieCollection.getProvider(bookie);provider.bind(provider.EVENT_LOGOUT,_logoutHandlerReference,this);};this.unbindLogout=function(){var prefBookie=webApp.prefBookmaker.get();this.unbindProviderLogout(prefBookie);};this.unbindProviderLogout=function(bookie){var provider=webApp.bookieCollection.getProvider(bookie);provider.unbind(provider.EVENT_LOGOUT,_logoutHandlerReference,this);};};webApp.extend(webApp.AbstractNodataCredentialsController,webApp.AbstractNodataController);
var webApp=webApp||{};webApp.Error404Controller=function(name,config){webApp.Error404Controller.superclass.constructor.call(this,name,config);this.headerAfterRender=function(){if(!webApp.HorseDetailsController){this._applyGreyhoundbetErrorHandler();}};this.mainBeforeRender=function(data){var request=this.getRequestParams();if(request.hasOwnProperty("errorHash")){var eventTracker=this._helper('eventTracker');var eventLabel=webApp.isTablet?request.errorHash:'Requested hash: '+request.errorHash;eventTracker.trackEventById('error_404',eventLabel);}
data.errorMessage=request.errorMessage||'';data.secondLink=this._findSecondLink(request.referer||'');data.showButtons=true;if(!webApp.HorseDetailsController){data.showButtons=false;}
return data;};this._findSecondLink=function(referer){if(!referer){return false;}
referer=referer.replace('#','');var secondLinks=this._config.secondLinks;var result=null,i;for(i in secondLinks){if(secondLinks.hasOwnProperty(i)&&secondLinks[i].referers&&$.inArray(referer,secondLinks[i].referers)!==-1){result={controller:secondLinks[i].controller,text:secondLinks[i].text,hideMainSiteLink:secondLinks[i].hideMainSiteLink};return result;}}
return false;};this._applyGreyhoundbetErrorHandler=function(){var prevCollection,prevCollectionHomeUrl,backButtonUrl,isAccessedDirectly,isBackUrlPresent=!!webApp.urlManager.error404BackCollection.length;prevCollection=webApp.urlManager.getPreviousCollectionName();prevCollectionHomeUrl=webApp.urlManager.getPreviousCollectionHomeUrl();if(isBackUrlPresent){isAccessedDirectly=webApp.urlManager.error404BackCollection[0]!==webApp.urlManager.error404BackCollection[1];}
backButtonUrl=(isBackUrlPresent&&isAccessedDirectly)?webApp.urlManager.error404BackCollection[0]:prevCollectionHomeUrl;$('.btnBack').each(function(){this.href=backButtonUrl;});webApp.urlManager.error404BackCollection=[];webApp.urlManager.rewriteMainTabLink(prevCollection,prevCollectionHomeUrl);};};webApp.extend(webApp.Error404Controller,webApp.AbstractNodataController);
var greyhoundbet=greyhoundbet||{},webApp=webApp||{},wh=wh||{};greyhoundbet.AccountHomeController=function(name,config){greyhoundbet.AccountHomeController.superclass.constructor.call(this,name,config);var providers=webApp.bookieCollection.getAllProviders();this.mainAfterRender=function(){var eventTracker=this._helper('eventTracker');var context=this;webApp.accountSettingsList('prefBookieList','bookie','.colA');for(var bookie in providers){$.proxy(this.bindProviderLogout(bookie),this);if(providers[bookie].user()){$.proxy(bindBalanceChange(providers[bookie].user(),bookie),this);}}
function bindBalanceChange(user,bookie){user.bind(rp.betting.User.EVENT_BALANCE_CHANGED,function(event){$('#bookie-'+bookie+' .colB').html('<a href="#'+bookie+'-account-home"><div>'
+user.login()+'</div><div>'
+context.balanceString(user.balance(),user.currency())
+'</div></a>');},this);}};this.destroy=function(){for(var bookie in providers){this.unbindProviderLogout(bookie);if(providers[bookie].user()){providers[bookie].user().unbind(rp.betting.User.EVENT_BALANCE_CHANGED);}}};this.mainBeforeRender=function(data){var settings=webApp.userSettings,sortBy=webApp.sortByCollection[settings.get('sortBy')||'number'];return $.extend({},{sortBy:sortBy,odds:webApp.oddsCollection[settings.get('odds')],bookies:this.getOrderedBookies()});};this.getOrderedBookies=function(){var settings=webApp.userSettings,allBookies=webApp.bookiesCollection,allBookiesIndexes=$.map(allBookies,function(value,key){return key;}),context=this,bookiesOrder=(settings.get('bookiesOrder')||'').split(','),prefBookie=webApp.prefBookmaker.get();$.map(allBookies,function(value,key){allBookies[key].isLoggedIn=context.isLoggedIn(key);if(allBookies[key].isLoggedIn){var user=webApp.bookieCollection.getProvider(key).user();allBookies[key].user=user;allBookies[key].userName=user.login();allBookies[key].balance=context.balanceString(user.balance(),user.currency());}});if(bookiesOrder.slice().sort().join('')!=allBookiesIndexes.slice().sort().join('')){bookiesOrder=[];}
var sortedBookies=$.map(allBookies,function(value,key){if(key==prefBookie&&!bookiesOrder.length){var order=-1;}else if(bookiesOrder.length){var order=bookiesOrder.indexOf(key);}else{var order=Math.floor(Math.random()*100);}
return $.extend(value,{index:key,order:order});}).sort(function(a,b){return a.order-b.order;});if(!bookiesOrder.length){bookiesOrder=$.map(sortedBookies,function(value,key){return value.index;});settings.set('bookiesOrder',bookiesOrder.join(','));}
return sortedBookies;};};webApp.extend(greyhoundbet.AccountHomeController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{};webApp.AccountSortByController=function(name,config){webApp.AccountSortByController.superclass.constructor.call(this,name,config);this.mainAfterRender=function(){webApp.accountSettingsList('cardSortByList','sortBy');};};webApp.extend(webApp.AccountSortByController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{};webApp.AccountOddsController=function(name,config){webApp.AccountOddsController.superclass.constructor.call(this,name,config);this.mainAfterRender=function(){webApp.accountSettingsList('cardOddsList','odds');};};webApp.extend(webApp.AccountOddsController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{},wh=wh||{};webApp.WhHomeController=function(name,config){webApp.WhHomeController.superclass.constructor.call(this,name,config);var context=this;var settings=webApp.userSettings;var $btnSaveName=null;var $btnSavePass=null;var isSaveUserName=settings.get('saveUserName');var isSaveUserPass=settings.get('saveUserPass');this.destroy=function(){this.unbindProviderLogout('wh');};this.mainAfterRender=function(){var eventTracker=this._helper('eventTracker');this.bindProviderLogout('wh');var doLogin=function(){$('#userName, #password').blur();context['login']();eventTracker.trackEventById('account_login',webApp.bookieCollection.getCurrentProviderName());return false;};var context=this;var loginBtnHandler=function(){doLogin();return false;};$('#loginBtn, #topLogIn').click(loginBtnHandler);$('#loginForm').bind('submit.login',doLogin);$btnSaveName=$('#saveUserName');$btnSavePass=$('#saveUserPass');$btnSaveName.switchButton({enableText:'Save',disableText:'Save?',checked:isSaveUserName,callback:function(flag){settings.set('saveUserName',flag);$btnSavePass.switchButton(flag?'enabled':'disabled');var eventLabel=(flag)?'On':'Off';eventTracker.trackEventById('account_save_name',eventLabel);}});$btnSavePass.switchButton({enableText:'Save',disableText:'Save?',disabled:!isSaveUserName,checked:isSaveUserName&&isSaveUserPass,callback:function(flag){settings.set('saveUserPass',flag);var eventLabel=(flag)?'On':'Off';eventTracker.trackEventById('account_save_pass',eventLabel);}});};this.mainBeforeRender=function(data){data=this.addBookieCredentialsToView(data,'wh');if(isSaveUserName){data.userName=settings.get('username');}
if(isSaveUserName&&isSaveUserPass){data.password=settings.get('password');}
data.currency=settings.get('currency');return data;};this.headerBeforeRender=function(data){data=this.addBookieCredentialsToView(data,'wh');if(isSaveUserName){data.userName=settings.get('username');}
if(isSaveUserName&&isSaveUserPass){data.password=settings.get('password');}
data.currency=settings.get('currency');if(this.isFromBetslip()){data.backUrlHash='bet-slip';}
return data;};this.login=function(){var $userNameInput=$('#userName');var userName=$userNameInput.val();var password=$('#password').val();var context=this;this.saveCredentials(userName,password);if(!userName||!password){alert('Fields are empty');return;}
var params={'userName':userName,'password':password};var successCallback=function(data){context.loginSuccess(data,userName,password);webApp.dataLoading.hide();};var errorCallback=function(event){webApp.genericWhErrorHandler(event.target.result());webApp.dataLoading.hide();};webApp.bookieCollection.getProvider('wh').login(userName,password).success(successCallback).error(errorCallback);webApp.dataLoading.show();};this.loginSuccess=function(data,userName,password){this.saveCredentials(userName,password);webApp.userSettings.set('currency',data.target.result().currency());var params=this.assembleParamsForAfterLoginRedirect();webApp.registry.set('justLogin',true);this._redirect(params[0],params[1],params[2]);};this.assembleParamsForAfterLoginRedirect=function(){if(this.shouldBeRedirectedToBetslip()){return['bet-slip',null,true];}
return['wh-account-home',null,null];};this.shouldBeRedirectedToBetslip=function(){var request=this.getRequestParams();if(request.hasOwnProperty('just-login')){return false;}
return this.isFromBetslip();};this.isFromBetslip=function(){var request=this.getRequestParams();if(request.hasOwnProperty('from-betslip')){return request['from-betslip'];}
return false;};this.saveCredentials=function(userName,password){var saveNaveChecked=!!$btnSaveName.attr('checked');var savePassChecked=!!$btnSavePass.attr('checked');if(saveNaveChecked){settings.set('username',userName);}else{settings.remove('username');}
if(saveNaveChecked&&savePassChecked){settings.set('password',password);}else{settings.remove('password');}};};webApp.extend(webApp.WhHomeController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{},wh=wh||{};webApp.WhAccountHomeController=function(name,config){webApp.WhAccountHomeController.superclass.constructor.call(this,name,config);var whProvider=webApp.bookieCollection.getProvider('wh');this.mainBeforeRender=function(data){if(!whProvider.isLoggedIn()){this._redirect('wh-home');}
data=this.addBookieCredentialsToView(data,'wh');data.headline='William Hill';data.headlineClass='whHeadline';data.trackingId=webApp.eventTracker.getTrackingId();return data;};this.mainHeaderBeforeRender=function(data){if(this.getRequestParams().hasOwnProperty('from-betslip')){data.backUrlHash='bet-slip';}
return data;};this.destroy=function(){this.unbindProviderLogout('wh');};this.mainAfterRender=function(){$('#wh-logout').click(function(){webApp.dataLoading.show('Logging out');whProvider.logout();setTimeout($.proxy(function(){var message='You are now logged out of '+webApp.bookieCollection.getProviderName('wh');webApp.confirmMessage.show(message);},this),1000);});this.bindProviderLogout('wh');var providers=webApp.bookieCollection;var showSelector=providers.getCurrentProviderName()!=providers.getProviderName('wh')&&webApp.registry.get('justLogin');webApp.registry.remove('justLogin');if(showSelector){var data=this.addBookieCredentialsToView({},'wh');data.btnClass='whBtn';data.logoClass='whLogo';webApp.landing.show({full:true,template:'landing-change-price',templateData:data,callback:function(){$('#setNewBookiePrices').bind('click',function(){webApp.prefBookmaker.setWithMessage(data.bookie.index,'Prices now set to '+data.bookie.name);webApp.landing.hide();});}});}};};webApp.extend(webApp.WhAccountHomeController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{},wh=wh||{};webApp.WhOpenBetsController=function(name,config){webApp.WhOpenBetsController.superclass.constructor.call(this,name,config);this.betsBlockSize=10;this.startDate='2000-01-01 00:00:00';this.currentPage=0;this.totalPages=0;this.totalBets=0;this.betsShown=0;this.$settledBetsHeader=null;this.$openBetsHeader=null;this.$openBetsContainer=null;this.$settledBetsContainer=null;this.MESSAGE_BET_LOST='Lost';this.MESSAGE_BET_WON='Won';this.MESSAGE_BET_PLACED='Placed';this.MIN_BETS_QTY=5;var dateDelta=webApp.bookieCollection.getCurrentProvider().settings().serverDateDelta;var scrollRefreshTimeId;this.betHistory=new rp.betting.BetHistory({searchCriteria:{fromDate:moment(this.startDate).sod(),toDate:utils.moment.getSynchronizedToServerNow(dateDelta,false).eod(),blockSize:this.betsBlockSize,blockNumber:null,minimumBets:this.MIN_BETS_QTY}});this.betsShown=0;this.destroy=function(){this.unbindProviderLogout('wh');};this.mainBeforeRender=function(data){this.betHistory.set({bets:[],opened:[],settled:[]});var data=this.addBookieCredentialsToView(data,'wh');data.trackingId=webApp.eventTracker.getTrackingId();if(!webApp.bookieCollection.getProvider('wh').isLoggedIn()){this._redirectAndExit('wh-home');return;}
return data;};this.getBetHistory=function(){this.bindProviderLogout('wh');var context=this;webApp.bookieCollection.getProvider('wh').getBetHistory(this.betHistory).success(function(data){var betsLength=context.betHistory.bets().length;if(betsLength===0){$('#noBets').show();context.hidePreloader();webApp.dataLoading.hide();}else{var lastBet=context.betHistory.bets()[betsLength-1];if(betsLength%context.betsBlockSize>0||lastBet.betReference()===context.betHistory.lastBetId()){$('#showMore').hide();}else{$('#showMore').show();}}
webApp.viewManager.getScroll(context._name).refresh();});};this.mainAfterRender=function($block){var context=this;this.$settledBetsHeader=$('#settledBetsHeader');this.$openBetsHeader=$('#openBetsHeader');this.$openBetsContainer=$('#openBetsList');this.$settledBetsContainer=$('#settledBetsList');this.betHistory.betHistoryAddedBet(this.handleBetHistoryAddedBet,this);this.getBetHistory();$('#showMore').unbind('click').bind('click.showNext',function(event){webApp.dataLoading.show('Loading Bet History list');context.mainAfterRender();event.preventDefault();});$('#showMore').hide();webApp.viewManager.getScroll(this._name).refresh();};this.handleBetHistoryAddedBet=function(event,bet){var view=this._core().getViewManager(),betData;var odds=webApp.userSettings.get('odds');$.extend(bet,{isDecimalOdds:(odds=='decimal')});var $row=$(view.renderTpl('wh-bet-row',bet));if(bet.isSettled()){this.$settledBetsHeader.show();this.$settledBetsContainer.append($row);}else{this.$openBetsHeader.show();this.$openBetsContainer.append($row);}
this.betsShown++;$('#betsQty').html('1 to '+this.betsShown);clearTimeout(scrollRefreshTimeId);var refreshFunc=function(){webApp.viewManager.getScroll(this.getName()).refresh();};scrollRefreshTimeId=setTimeout($.proxy(refreshFunc,this),20);this.hidePreloader();webApp.dataLoading.hide();$('#betList').show();};this.hidePreloader=function(){$('div.loading').hide();};};webApp.extend(webApp.WhOpenBetsController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{};webApp.WhBetDetailController=function(name,config){webApp.WhBetDetailController.superclass.constructor.call(this,name,config);this.mainBeforeRender=function(){var bet=webApp.registry.get('betDetail');bet.currency=this.currencyView(webApp.userSettings.get('currency'));return bet;};};webApp.extend(webApp.WhBetDetailController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{};webApp.WhTermsController=function(name,config){webApp.WhTermsController.superclass.constructor.call(this,name,config);};webApp.extend(webApp.WhTermsController,webApp.AbstractNodataController);
var webApp=webApp||{};webApp.WhRegisterController=function(name,config){webApp.WhRegisterController.superclass.constructor.call(this,name,config);this.headerBeforeRender=function(data){if(this.getRequestParams().hasOwnProperty('from-betslip')){data.backUrlHash='bet-slip';}
return data;};this.headerAfterRender=function(){if(this.getRequestParams().hasOwnProperty('from-betslip')){$('.btnBack').attr('href','#bet-slip');}};this.registrationBeforeRender=function(data){data.trackingId=webApp.eventTracker.getTrackingId();data.bookie=webApp.bookieCollection.getProviderName('wh');return data;};this.registrationAfterRender=function(){var eventTracker=this._helper('eventTracker');$('#whPhone').bind(eventTracker.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var eventLabel=webApp.bookieCollection.getProviderName('wh');eventTracker.trackEventById('account_wh_phone',eventLabel);var timeout=setTimeout(function(){document.location=$('#whPhone').attr('href');},1000);});if(webApp.isTablet){$('#whPhone-outside').bind(eventTracker.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var eventLabel=webApp.bookieCollection.getProviderName('wh');eventTracker.trackEventById('account_wh_phone',eventLabel);var timeout=setTimeout(function(){window.location=$('#whPhone').attr('href');},1000);});}};};webApp.extend(webApp.WhRegisterController,webApp.AbstractNodataController);
var webApp=webApp||{};webApp.WhHelpInfoController=function(name,config){webApp.WhHelpInfoController.superclass.constructor.call(this,name,config);this.mainBeforeRender=function(data){data=this.addCredentialsToView(data);data.trackingId=webApp.eventTracker.getTrackingId();return data;};};webApp.extend(webApp.WhHelpInfoController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{};webApp.WhForgottenPasswordController=function(name,config){webApp.WhForgottenPasswordController.superclass.constructor.call(this,name,config);this.mainBeforeRender=function(data){data=this.addCredentialsToView(data);data.trackingId=webApp.eventTracker.getTrackingId();return data;};this.mainAfterRender=function(){var eventTracker=this._helper('eventTracker');$('#whPhone').bind(eventTracker.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var eventLabel=webApp.bookieCollection.getProviderName('wh');eventTracker.trackEventById('account_wh_phone',eventLabel);var timeout=setTimeout(function(){window.location=$('#whPhone').attr('href');},1000);});if(webApp.isTablet){$('#whPhone-outside').bind(eventTracker.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var eventLabel=webApp.bookieCollection.getProviderName('wh');eventTracker.trackEventById('account_wh_phone',eventLabel);var timeout=setTimeout(function(){window.location=$('#whPhone').attr('href');},1000);});}};};webApp.extend(webApp.WhForgottenPasswordController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{};webApp.WhWithdrawController=function(name,config){webApp.WhWithdrawController.superclass.constructor.call(this,name,config);this.mainBeforeRender=function(data){data=this.addCredentialsToView(data);data.trackingId=webApp.eventTracker.getTrackingId();return data;};this.mainAfterRender=function(){var eventTracker=this._helper('eventTracker');$('#whPhone').bind(eventTracker.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var eventLabel=webApp.bookieCollection.getProviderName('wh');eventTracker.trackEventById('account_wh_phone',eventLabel);var timeout=setTimeout(function(){window.location=$('#whPhone').attr('href');},1000);});if(webApp.isTablet){$('#whPhone-outside').bind(eventTracker.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var eventLabel=webApp.bookieCollection.getProviderName('wh');eventTracker.trackEventById('account_wh_phone',eventLabel);var timeout=setTimeout(function(){window.location=$('#whPhone').attr('href');},1000);});}};};webApp.extend(webApp.WhWithdrawController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{};webApp.WhFreeBetsOfferController=function(name,config){webApp.WhFreeBetsOfferController.superclass.constructor.call(this,name,config);};webApp.extend(webApp.WhFreeBetsOfferController,webApp.AbstractNodataController);
var webApp=webApp||{};webApp.WhTopUpController=function(name,config){webApp.WhTopUpController.superclass.constructor.call(this,name,config);this.$elements={};this._provider=webApp.bookieCollection.getProvider('wh');this.pocfAccepted;this.pocfFlagExists;this.destroy=function(){this.unbindProviderLogout('wh');};this._preExecute=function(){this.pocfAccepted=this.checkUserPocfAlreadyAccepted();this.pocfFlagExists=this.checkUserPocfFlagExists();};this.mainAfterRender=function($blockContents){this.bindProviderLogout('wh');if(!this._provider.isLoggedIn()){this._redirectAndExit('wh-home');}
var context=this;var successCallback=function(data){context.acceptPaymentDetails(data.target.result(),$blockContents);};var errorCallback=function(data){var result=data.target.result();if(result.code()&&result.code()==rp.betting.mint.Error.NO_CARD_DETAILS_REGISTERED){context.renderNoCardScreen();return;}
webApp.genericWhErrorHandler(result);};this._provider.getPaymentDetails().success(successCallback).error(errorCallback);};this.renderNoCardScreen=function(){var view=this._core().getViewManager();var data=this.addCredentialsToView({});data.trackingId=webApp.eventTracker.getTrackingId();$('div.loading').replaceWith(view.renderTpl('wh-top-up-without-card',data));var controllerName=this.getName();webApp.viewManager.getScroll(controllerName).refresh();};this.checkUserPocfAlreadyAccepted=function(){return webApp.bookieCollection.getProvider('wh').user().pocf()==="Y";};this.checkUserPocfFlagExists=function(){return!!webApp.bookieCollection.getProvider('wh').user().pocf();};this.acceptPaymentDetails=function(serviceResponce,$blockContents){var $loader=$blockContents.filter('div.loading');var view=this._core().getViewManager();var card=serviceResponce;var context=this;if(!('cardNumber'in card)){this.renderNoCardScreen();return;}
var number=card.cardNumber();var placeholder='X';card.cardNumberStart=number.substring(0,number.indexOf(placeholder));card.cardNumberEnd=number.substring(number.lastIndexOf(placeholder)+1);card.currency=this.currencyView(webApp.userSettings.get('currency'));card.bookie=webApp.bookieCollection.getProviderName('wh');card.showPocfMessage=this.pocfFlagExists&&!this.pocfAccepted;$loader.replaceWith(view.renderTpl('wh-top-up-with-card',card));var eventTracker=this._helper('eventTracker');$('#whPhone').bind(eventTracker.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var eventLabel=webApp.bookieCollection.getProviderName('wh');eventTracker.trackEventById('account_wh_phone',eventLabel);var timeout=setTimeout(function(){document.location=$('#whPhone').attr('href');},1000);});if(webApp.isTablet){$('#whPhone-outside').bind(eventTracker.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var eventLabel=webApp.bookieCollection.getProviderName('wh');eventTracker.trackEventById('account_wh_phone',eventLabel);var timeout=setTimeout(function(){window.location=$('#whPhone').attr('href');},1000);});}
var $elements={btnPay:$('#btn-top-up-pay'),form:$('#top-up-form'),inputDepo:$('#top-up-deposit'),inputCv2:$('#top-up-cv2'),balance:$('#top-up-balance'),checkBox:$('.check')};var isPcfCheckboxSelected=false;this.$elements=$elements;$elements.inputCv2.limitMaxLength(3);$($elements.balance).html(this.balanceString(this._provider.user().balance(),this._provider.user().currency()));this.setupValidation();var makeDeposit=function(){context.deposit(card.payMethodId());return false;};$elements.btnPay.click(function(){if(!isPcfCheckboxSelected&&context.pocfFlagExists&&!context.pocfAccepted){alert('You need to read and accept the Protection of Customer Funds statement to make a deposit');}
else{makeDeposit();};});$elements.form.bind('submit.login',makeDeposit);if(!webApp.isAndroid_4_x){$elements.inputDepo.keyup(function(){context.restrictPositive(this);});$elements.inputCv2.keyup(function(){context.restrictInteger(this);});}
$elements.checkBox.click(function(){if(isPcfCheckboxSelected===false){$elements.checkBox.addClass('selected');isPcfCheckboxSelected=true;}
else{$elements.checkBox.removeClass('selected');isPcfCheckboxSelected=false;}});webApp.viewManager.getScroll(this.getName()).refresh();};this.restrictPositive=function(element){var $input=$(element);var minStake='0.01';var value=$input.val();if((isNaN(value)||value<0)||(value.length>=minStake.length&&(value<minStake))){$input.val(value.substring(0,value.length-1));}};this.restrictInteger=function(element){var $input=$(element);var value=$input.val();var cv2=new RegExp('^[0-9]*$');if(!cv2.test(value)){$input.val(value.substring(0,value.length-1));}};this.setupValidation=function(){var messageCv2='The CV2 should contain 3 digits';var messageDeposit='Deposit Amount must be a number';this.$elements.form.validate({rules:{deposit:{required:true,number:true,min:0.01},cv2:{required:true,digits:true}},showErrors:function(errors){var errorsArray=[];for(var key in errors){errorsArray.push(errors[key]);}
if(errorsArray.length){alert(errorsArray.join(', '));}},messages:{deposit:{required:'Deposit Amount field is empty',number:messageDeposit,min:messageDeposit},cv2:{required:'CV2 Security Code field is empty',maxlength:messageCv2,minlength:messageCv2}},onfocusout:false,onkeyup:false,onsubmit:false});};this.deposit=function(payMethod){var $elements=this.$elements;if(!$elements.form.valid()){return;}
var context=this;var amount=$elements.inputDepo.val();var paymentDetails=new rp.betting.PaymentDetails({payMethodId:payMethod,csc:$elements.inputCv2.val(),amount:amount});var performPayment=function(){context._provider.makePayment(paymentDetails).error(function(responce){webApp.genericWhErrorHandler(responce.target.result(),'topUpController');webApp.dataLoading.hide();}).success(function(){context.paymentAccepted(webApp.userSettings.get('currency'),amount);webApp.dataLoading.hide();});};webApp.dataLoading.show();if(this.pocfFlagExists&&!this.pocfAccepted){var context=this;var successHandler=function(){$('.pcf').hide();context.pocfAccepted=true;performPayment();}
this._provider.acceptPocf().success(successHandler);}else{performPayment();}};this.paymentAccepted=function(currency,amount){this.$elements.balance.after('<span class="addedTick">'+this.balanceString(amount,currency)+' top up added</span>');this.$elements.form.each(function(){this.reset();});webApp.viewManager.getScroll(this.getName()).refresh();var betInfo=webApp.registry.get('betInfo');$(this.$elements.balance).html(this.balanceString(this._provider.user().balance(),this._provider.user().currency()));};};webApp.extend(webApp.WhTopUpController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{};webApp.LadbHomeController=function(name,config){webApp.LadbHomeController.superclass.constructor.call(this,name,config);this.ACTION_REGISTRATION='registration';this.ACTION_AUTHORIZATION='authorization';var context=this;var isLoginAfterBetslip=false;var ladbProvider=webApp.bookieCollection.getProvider('ladb');this._currActionType=null;this._preExecute=function(){var actionType=this.getRequestParams().action;if(actionType!==this.ACTION_REGISTRATION){actionType=this.ACTION_AUTHORIZATION;}
this._currActionType=actionType;};this.handleUserLogin=function(event,user){if(isLoginAfterBetslip){context._redirect('bet-slip',null,true);}else{webApp.registry.set('justLogin',true);context._redirect('ladb-account-home');}};this.handleError=function(event,data){if(typeof(data)!=='undefined'){switch(data.error){case'server_error':alert('Server error');context._redirect('account-home');break;case'access_denied':context._redirect('account-home');break;case'invalid_request':ladbProvider.unbind(ladbProvider.EVENT_LOGOUT);context._redirect('ladb-home',{invalid_request:Math.random()});break;default:if(data.error||data.error_code){console.warn('Not recognised error: "%s"',error);alert('Something went wrong. Please try logging in again.');context._redirect('account-home');}
break;}}};this.ladbHomeAfterRender=function(){ladbProvider.bind(ladbProvider.EVENT_LOGIN,this.handleUserLogin,this);ladbProvider.bind(ladbProvider.EVENT_LOGOUT,this.handleError,this);if(this.getRequestParams().hasOwnProperty('invalid_request')){alert('Login failed. Please try again');}};this.ladbHomeBeforeRender=function(data){data.actionType=this._currActionType;data.apiKey=ladbProvider.settings().apiKey;data.redirectUrl=ladbProvider.settings().redirectUrl;data.backUrlHash=this._getBackUrlHash();isLoginAfterBetslip=this.shouldBeRedirectedToBetslip();return data;};this.headerBeforeRender=function(data){data.actionType=this._currActionType;data.backUrlHash=this._getBackUrlHash();return data;};this._getBackUrlHash=function(){if(this.getRequestParams().hasOwnProperty('from-betslip')){return'bet-slip';}
return false;};this.shouldBeRedirectedToBetslip=function(){var request=this.getRequestParams();if(request.hasOwnProperty('just-login')){return false;}
return request.hasOwnProperty('from-betslip');};this.destroy=function(){ladbProvider.unbind(ladbProvider.EVENT_LOGIN,this.handleUserLogin,this);ladbProvider.unbind(ladbProvider.EVENT_LOGOUT,this.handleError,this);};};webApp.extend(webApp.LadbHomeController,webApp.AbstractNodataController);
var webApp=webApp||{};webApp.LadbOpenBetsController=function(name,config){webApp.LadbOpenBetsController.superclass.constructor.call(this,name,config);this.previousSettledBets=0;var scrollRefreshTimeId;this.destroy=function(){this.unbindProviderLogout('ladb');};this.mainBeforeRender=function(data){this.betHistory.set({bets:[],opened:[],settled:[]});data=this.addBookieCredentialsToView(data,'ladb');if(!webApp.bookieCollection.getProvider('ladb').isLoggedIn()){this._redirectAndExit('ladb-home');return false;}
data.trackingId=webApp.eventTracker.getTrackingId();return data;};this.getBetHistory=function(){this.bindProviderLogout('ladb');var context=this;webApp.bookieCollection.getProvider('ladb').getBetHistoryChunks(this.betHistory).success(function(data){var totalBets=context.betHistory.totalBlocks().opened+context.betHistory.totalBlocks().totalSettled;context.previousSettledBets=context.betHistory.totalBlocks().totalSettled;if(totalBets===0){$('#noBets').show();context.hidePreloader();webApp.dataLoading.hide();}else{$('#showMore').show();$('#betsQty').html('1 to '+context.betHistory.bets().length);}
webApp.viewManager.getScroll(context._name).refresh();}).error(function(data){context.hidePreloader();webApp.dataLoading.hide();if(data.target.result().code()===rp.betting.ladbrokes.Error.NO_RECENT_BETS){var totalBets=context.betHistory.totalBlocks().opened
+context.betHistory.totalBlocks().settled;if(totalBets===0&&context.previousSettledBets===0){$('#noBets').show();}else{$('#showMore').hide();$('#noRecentBets').show();}
webApp.viewManager.getScroll(context._name).refresh();}});};this.handleBetHistoryAddedBet=function(event,bet){var view=this._core().getViewManager(),betData;var odds=webApp.userSettings.get('odds');$.extend(bet,{isDecimalOdds:(odds=='decimal')});var $row=$(view.renderTpl('ladb-bet-row',bet));if(bet.isSettled()){if(!this.$settledBetsHeader.is(':visible')){this.$settledBetsHeader.show();}
this.$settledBetsContainer.append($row);}else{if(!this.$openBetsHeader.is(':visible')){this.$openBetsHeader.show();}
this.$openBetsContainer.append($row);}
this.hidePreloader();webApp.dataLoading.hide();$('#betList').show();this.updatePageScroll();};this.updatePageScroll=function(){clearTimeout(scrollRefreshTimeId);var controllerName=this.getName();scrollRefreshTimeId=setTimeout(function(){webApp.viewManager.getScroll(controllerName).refresh();$('.toggleBetDetails').unbind('.toggleBetClick').bind('click.toggleBetClick',function(){var $parent=$(this).closest('li');if($parent.hasClass('minifyBetDetail')){$parent.removeClass('minifyBetDetail');$(this).text('Close');}else{$parent.addClass('minifyBetDetail');$(this).text('Expand');}
webApp.viewManager.getScroll(controllerName).refresh();});},20);};};webApp.extend(webApp.LadbOpenBetsController,webApp.WhOpenBetsController);
var webApp=webApp||{},wh=wh||{};webApp.LadbAccountHomeController=function(name,config){webApp.LadbAccountHomeController.superclass.constructor.call(this,name,config);var ladbProvider=webApp.bookieCollection.getProvider('ladb');var isLogout=false;this.mainBeforeRender=function(data){if(!ladbProvider.isLoggedIn()){this._redirect('ladb-home');return{};}
data=this.addBookieCredentialsToView(data,'ladb');data.headline='Ladbrokes';data.headlineClass='ladbHeadline';data.trackingId=webApp.eventTracker.getTrackingId();return data;};this.destroy=function(){if(!isLogout){this.unbindProviderLogout('ladb');}};this.mainHeaderBeforeRender=function(data){if(this.getRequestParams().hasOwnProperty('from-betslip')){data.backUrlHash='bet-slip';}
return data;};this.mainAfterRender=function(){var context=this;this.bindProviderLogout('ladb');$('#ladb-logout').click(function(){isLogout=true;webApp.dataLoading.show('Logging out');ladbProvider.logout();setTimeout($.proxy(function(){var message='You are now logged out of '+webApp.bookieCollection.getProviderName('ladb');webApp.confirmMessage.show(message);},this),1000);});var providers=webApp.bookieCollection;var showSelector=providers.getCurrentProviderName()!=providers.getProviderName('ladb')&&webApp.registry.get('justLogin');webApp.registry.remove('justLogin');if(showSelector){var data=this.addBookieCredentialsToView({},'ladb');data.btnClass='ladbBtn';data.logoClass='ladbLogo';webApp.landing.show({full:true,template:'landing-change-price',templateData:data,callback:function(){$('#setNewBookiePrices').bind('click',function(){webApp.prefBookmaker.setWithMessage(data.bookie.index,'Prices now set to '+data.bookie.name);webApp.landing.hide();});}});}};};webApp.extend(webApp.LadbAccountHomeController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{};webApp.LadbWithdrawController=function(name,config){webApp.LadbWithdrawController.superclass.constructor.call(this,name,config);this.mainBeforeRender=function(data){data=this.addCredentialsToView(data);data.trackingId=webApp.eventTracker.getTrackingId();return data;};this.mainAfterRender=function(){var eventTracker=this._helper('eventTracker');$('#ladbPhone').bind(eventTracker.EVENT_CLICK_TRACK_EVENT,function(e){e.preventDefault();var eventLabel=webApp.bookieCollection.getProviderName('ladb');eventTracker.trackEventById('account_ladb_phone',eventLabel);var timeout=setTimeout(function(){window.location=$('#ladbPhone').attr('href');},1000);});};};webApp.extend(webApp.LadbWithdrawController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{};webApp.LadbTopUpController=function(name,config){webApp.LadbTopUpController.superclass.constructor.call(this,name,config);var context=this;var ladbProvider=webApp.bookieCollection.getProvider('ladb');this.listener=function(event){ladbProvider.user().bind(rp.betting.User.EVENT_BALANCE_CHANGED,function(newevent){context._redirect('ladb-account-home');},context);};this.mainBeforeRender=function(data){if(!ladbProvider.isLoggedIn()){this._redirect('ladb-home');}
data.apiKey=ladbProvider.settings().apiKey;data.token=ladbProvider.token();data.redirectUrl=ladbProvider.settings().redirectUrl;return data;};this.mainAfterRender=function(){ladbProvider.bind(ladbProvider.EVENT_DEPOSIT_FUNDS,this.listener,this);};this.destroy=function(){ladbProvider.unbind(ladbProvider.EVENT_DEPOSIT_FUNDS);};};webApp.extend(webApp.LadbTopUpController,webApp.AbstractNodataController);
var webApp=webApp||{};webApp.BetSlipController=function(name,config){webApp.BetSlipController.superclass.constructor.call(this,name,config);this.MAX_STAKE=99999.99;this.MIN_STAKE=webApp.bookieCollection.getCurrentProvider().settings().minStake;this.postponeBetSlipUpdateAfterEdit=false;this._scrollInstance=null;this.setScroll=function(){this._scrollInstance=new webApp.blockScroll({blockId:'whBetslipScroll',contentHeight:true});};this.getTemplate=function(){var template;var currSelectionsCount=this.selectionsCollection.selections().length;if(currSelectionsCount){if(currSelectionsCount>1){template='wh-betslip-multiples';}else{template='wh-betslip-main';}}else{template='wh-betslip-empty';}
return template;};this._preExecute=function(){this._config.blocks.main.template=this.getTemplate();this.restoreBetslip();};this._postExecute=function(){this.setScroll();};this.destroy=function(){this.unbindLogout();this.saveBetslip();};this.mainBeforeRender=function(data){data=this.addCredentialsToView(data);data.currency=this.currencyView(this.currency);data.currencyCode=this.currency;var currSelectionsCount=this.selectionsCollection.selections().length;if(currSelectionsCount===0){return data;}
data.bets=this.betslip.bets();var cacheManager=this._core().getCacheManager();if(cacheManager.isCached('card_title')){var cache=cacheManager._findCache('card_title');data.crsId=cache.keys.crs_id;data.raceDate=cache.keys.r_date;data.raceId=cache.keys.race_id;}
data.addSelectionsUrl=webApp.isTablet?'#full-card/race_id=next':'#cards-home';var backUrl=webApp.urlManager.getBackUrl(this._name);var backArr=webApp.urlManager.parseHash(backUrl);if(backArr[0]=='card'||backArr[0]=='full-card'||backArr[0]=='cards-horse'){data.addSelectionsUrl=backUrl;}else if(backArr[0]=='predictor'){backArr[0]=webApp.isTablet?'full-card':'card';data.addSelectionsUrl=webApp.urlManager.createHash(backArr);}
return data;};this.hideKeyboardAndCallback=function(callback){if($('.stake:focus').length){$('.stake').blur();}
setTimeout(callback,150);};this.numDenTitle=function(price){var numDenTitle;var odds=webApp.userSettings.get('odds');if(price==="Evs"){numDenTitle='Evs';}else{if(odds&&odds.toString()==="fractional"){numDenTitle=price.num();if(price.num().toString().match('^(0|[1-9][0-9]*)$')){numDenTitle=numDenTitle+'/'+price.den();}}else{var decimal=parseFloat(price.decimal());numDenTitle=decimal.toFixed(2);}}
return numDenTitle;};this.addMainMenuOverlay=function(){$('.mainMenuOverlay').addClass('mainMenuOverlayShown');};this.mainAfterRender=function($block){this.bindLogout();webApp.UserBalanceHelper.init($block);var currSelectionsCount=this.selectionsCollection.selections().length,eventTracker=this._helper('eventTracker');var context=this;var onLoginOrRegistrationClick=function(e){e.preventDefault();var redirectUrl=$(this).attr('href');var redirectArr=webApp.urlManager.parseHash(redirectUrl);context._redirect(redirectArr[0],$.extend({'from-betslip':1,'just-login':1},redirectArr[1]));};$('.openAccount, #loginBtn').click(onLoginOrRegistrationClick);if(currSelectionsCount===0){return;}else if(currSelectionsCount>1){var editModeButtonHandler=function(){eventTracker.trackEventById('betslip_edit_selections');this.switchToEditMode();};$('#multiplesEditButton').click($.proxy(editModeButtonHandler,this));var editModeDoneButtonHandler=function(){eventTracker.trackEventById('betslip_done');this.switchFromEditMode();};$('#multiplesEditModeDoneButton').click($.proxy(editModeDoneButtonHandler,this));var editModeDiscardButtonHandler=function(){eventTracker.trackEventById('betslip_discard_slip');this.discardBetslipAndGoToCards();};$('#multiplesEditModeDiscardButton').click($.proxy(editModeDiscardButtonHandler,this));}
this._$returns=$('#estimatedReturns');this._$totalStake=$('#totalStake');this.initializeDom();var $betSlipForm=$('#betslip-form');var addSelectionsHandler=function(){eventTracker.trackEventById('betslip_add_selections');};$('#addSelectionsBtn').click($.proxy(addSelectionsHandler,this));$('.betSlipHeader > a.btnBack').click(function(){if(webApp.SelectionsManager.getSelections().length<2){context.discardBetslip();}});var doBet,self=this;if(!webApp.bookieCollection.getCurrentProvider().isLoggedIn()){var bookie=webApp.prefBookmaker.get();doBet=function(){self.addMainMenuOverlay();context.hideKeyboardAndCallback(function(){var redirectUrl=bookie+'-home';context._redirect(redirectUrl,{'from-betslip':1});});return false;};$('#logInPlaceBetBtn').click(doBet);$betSlipForm.bind('submit.bet',function(e){e.preventDefault();});}else{if(this.selectionsCollection.selections().length===1&&this.selectionsCollection.selections()[0].data().isSuspended){this._redirect('market-suspend-error',{'selectionName':this.selectionsCollection.selections()[0].data().selectionName});}
doBet=function(){self.addMainMenuOverlay();context.hideKeyboardAndCallback(function(){context.placeBetClick();});var eventLabel=webApp.bookieCollection.getCurrentProviderName();webApp.eventTracker.trackEventById('betslip_place_bet',eventLabel);return false;};if(this.selectionsCollection.selections().length>0){setTimeout(function(){context.checkBetslip();context.$placeBetButton.click(doBet);},750);}
$betSlipForm.bind('submit.bet',function(e){e.preventDefault();});}};this.checkBetslip=function(){if(webApp.bookieCollection.getCurrentProvider().isLoggedIn()){var context=this;if(this.betslip.bets().length>1){webApp.dataLoading.show('Calculating available bet types',true);}else{webApp.dataLoading.show('Validating bet slip',true);}
this.getBetSlip(function(data){webApp.dataLoading.hide();context.betslip=data.target.result();context.redrawBetslip();context.initValidation(context.betslip.bets());if(context.betslip.bets().length===1){var bet=context.betslip.bets()[0];context.drawFreeBets(bet);}},function(data){webApp.dataLoading.hide();context.initValidation(context.betslip.bets());console.log('here we can find errors');});}};this.saveSuspendedSelections=function(suspendedIds){$.each(suspendedIds,$.proxy(function(index,selectionId){this.selectionsCollection.updateStatusById(selectionId,'isSuspended',true);},this));this.restoreBetslip();if(webApp.currentControllerName==='bet-slip')
{this.redrawBetslip();}
this.updateTotalAndEstReturns();};this.restoreSuspendedSelections=function(){var suspendedSelections=[];$.each(this.selectionsCollection.selections(),$.proxy(function(index,selection){if(selection.data().isSuspended){suspendedSelections.push(selection.id());}},this));this.switchToNoBettingMode(suspendedSelections);};this.switchToNoBettingMode=function(selectionIds){var suspendedSelections=this.selectionsCollection.getSuspendedSelections();var nobetting=webApp.registry.get('nobetting');if(suspendedSelections.length>0||nobetting){this.$noBettingMessage.show();if(nobetting){webApp.registry.remove('nobetting');}}
if(suspendedSelections.length===this.selectionsCollection.selections().length){this.$placeBetButton.addClass('placeBetDisabled');this.$placeBetButton.unbind('click');}
$.each(selectionIds,$.proxy(function(index,selectionId){var $row=$('#selectionRow'+selectionId);$row.addClass('multiSelectionBrickNoBet').addClass('noBettingMode');$row.find(this.$includeInMultiples).switchButton('uncheck').switchButton('disabled').addClass('disabledForEdit');},this));};this.switchToEditMode=function(){this.postponeBetSlipUpdateAfterEdit=true;this.saveBetslip();$('#betslip-form').addClass('editMode');this._disableForEdit(this.$sp,this.$includeInMultiples,this.$eachWay);this.$stake.prop('disabled',true);$('#webApp a').off('click');this._disableAllLinks();$('.betSlipHeader a').addClass('btnDisabled');};this._disableAllLinks=function(){$('#webApp a').bind('click.disableBetting',function(e){e.preventDefault();});};this._disableForEdit=function(){$(arguments).each(function(i,$els){$els.each(function(j,el){var $el=$(el);if(!$el.is(':disabled')){$el.switchButton('disabled').addClass('disabledForEdit');}});});};this.switchSelectionRowToEditMode=function($selectionRow){if($('#betslip-form').hasClass('editMode')){return false;}
this.postponeBetSlipUpdateAfterEdit=false;if($selectionRow.addClass){setTimeout(function(){$selectionRow.addClass('editMode');},1);}
var $buttonsToDisable=this._findButtonsInSelectionRow($selectionRow);this._disableForEdit($buttonsToDisable);this._helper('eventTracker').trackEventById('betslip_swipe_editing',webApp.bookieCollection.getCurrentProviderName());};this._findButtonsInSelectionRow=function($selectionRow){return $selectionRow.find('input[type=checkbox]');};this._leaveSelectionRowEditMode=function($selectionRow){this._findButtonsInSelectionRow($selectionRow).each(function(i,el){var $el=$(el);if($el.is(':disabled')&&$el.hasClass('disabledForEdit')){$el.switchButton('enabled').removeClass('disabledForEdit');}});$selectionRow.removeClass('editMode');};this.switchFromEditMode=function(){this.restoreBetslip();if(this.selectionsCollection.selections().length>1){this.checkBetslip();}
if(this.selectionsCollection.selections().length===1&&this.selectionsCollection.selections()[0].data().isSuspended){this._redirect('market-suspend-error',{'selectionName':this.selectionsCollection.selections()[0].data().selectionName});}
this.redrawBetslip();$('#betslip-form').removeClass('editMode');$('#webApp a').unbind('click.disableBetting');$('.betSlipHeader a').removeClass('btnDisabled');};this.discardBetslipAndGoToCards=function(){this.discardBetslip();var hashArr=webApp.urlManager.parseHash(webApp.configs.defaultHash);this._redirect(hashArr[0],hashArr[1]);};this.discardBetslip=function(){webApp.SelectionsManager.removeAllSelections();this.forgetBetslip();};this.drawFreeBets=function(bet){var freeBets=bet.freeBets();var currency=this.currency;var view=context._core().getViewManager(),currencySign=this.getCurrencySign(currency)?this.getCurrencySign(currency):'';if(freeBets&&freeBets.length>0){var bookie=webApp.bookieCollection.getCurrentBookieParams();$.each(freeBets,function(i,freeBet){var betData={'position':i,'tokenId':freeBet.id(),'amount':freeBet.amount().toFixed(2),'currency':context.currencyView(currency)};$('#freeBetsBlock').append(view.renderTpl('wh-free-bet-row',betData));$('#link'+i).click(function(){alert(freeBet.name()+"\n\nAmount: "+currencySign+freeBet.amount().toFixed(2)+"\nExpires: "+moment(freeBet.expires()).format(utils.moment.FORMAT_FULL_DATETIME)+"\nSee "+bookie.webSite+" for Ts & Cs");return false;});$('#freeBet'+i).switchButton({checked:freeBet.selected(),enableText:'Yes',callback:$.proxy(function(checked,$button){context._handleFreeBetChange(checked,bet,freeBets[i],$button);},this),disableText:'No'}).data({pos:i});});}
this.$freeBets=$('.freeBet');this._scrollInstance.setSize();};this._handleFreeBetChange=function(checked,bet,freeBet,$button){this.$freeBets.each($.proxy(function(i,el){var $el=$(el),swBtn=$el.data('switchButton');if(swBtn.$button!==$button&&$el.attr('checked')){$el.switchButton('uncheck');}},this));$.each(bet.freeBets(),$.proxy(function(i,betFreeBet){if(betFreeBet!==freeBet){betFreeBet.selected(false);}else{freeBet.selected(checked);}},this));webApp.eventTracker.trackEventById('betslip_bet_offer',webApp.bookieCollection.getCurrentProviderName()+(checked?' Yes':' No'));var bookie=webApp.prefBookmaker.get();if($('.betField').length==1){var $betField=$('.betField');}
if(checked){$betField.addClass('color');this.$stake.addClass('useFreeBetOffer-'+bookie);setTimeout(function(){alert('Your total stake will now include this bet offer');},1);}else{$betField.removeClass('color');this.$stake.removeClass('useFreeBetOffer-'+bookie);}};this.initializeDom=function(){var eventTracker=this._helper('eventTracker');this.$stake=$('input.stake');this.$eachWay=$('input.winOrEw');this.$sp=$('input.betPrice');this.$includeInMultiples=$('input.includeInMult');this.$removeSelection=$('span.removeSelection');this.$noBettingMessage=$('.messageBrick');this.$placeBetButton=$('#placeBetBtn');this.$betSlipForm=$('#betslip-form');if(this.$stake!==null&&!webApp.isAndroid_4_x){this.$stake.keyup(this.restrictStake);}
var bets=this.betslip.bets();if(bets.length===1){var selection=bets[0].selections()[0];if(selection.data().isBOG){$('#oddsTitle').hide();$('#oddsTitleImg').show();$('#oddsTitleImg').click(function(){alert("Best Odds Guaranteed \n\n "+"Best Odds Guaranteed is our way of ensuring that you get the best possible price for your bets."+" If you placed a bet in a Best Odds Guaranteed race and take the price available at the time,"+" if the SP (Starting Price) is a better price, we’ll settle your bet at that better price! \n\n"+"This means no more disappointment if the price gets better and better, you’re guaranteed whichever"+" is higher - the SP or the price you took.");});}else{if(!selection.hasPrice()){$('#oddsTitle').text('Starting Price Only');}}}
this.$sp.each($.proxy(function(i,e){$(e).switchButton({checked:true,enableText:'&nbsp;',disableText:'SP',callback:$.proxy(function(checked){var eventLabel=checked?'Disable':'Enable';eventTracker.trackEventById('bets_starting_price',eventLabel);this._handleSPChange(checked,bets[i]);},this)});var selection=bets[i].selections()[0];var $price=$(e).next();if(!selection.hasPrice()){$price.html('Odds');$(e).switchButton('uncheck').switchButton('disabled');}else{$price.html(this.numDenTitle(selection.price()));$(e).switchButton('check');if(selection.isSP()){$(e).switchButton('uncheck');}
if(selection.isTrapChallengePrice()){$(e).switchButton('disabled');$(e).switchButton('highlightPrice');}}},this));this.$eachWay.each($.proxy(function(i,e){$(e).switchButton({checked:true,enableText:'Win',disableText:'EW',callback:$.proxy(function(checked,$button){var eventLabel=checked?'Disable':'Enable';eventTracker.trackEventById('bets_each_way',eventLabel);this._handleEachWayChange(checked,bets[i],this.$stake[i],$button);},this)});if(bets.length>1){$(e).parent().addClass('txtSwitcher');}
var bet=bets[i];if(!bet.isEachWayAllowed()){$(e).switchButton('check').switchButton('disabled');}else{$(e).switchButton('enabled');if(bet.isEachWay()){$(e).switchButton('uncheck');}}},this));this.$stake.each($.proxy(function(i,e){$(e).change($.proxy(function(){this._handleStakeChange(e,bets[i]);},this));var bet=bets[i];var stake=bet.stake();if(parseFloat(stake)!==0.0){$(e).val(stake.toFixed(2)).addClass('change');}},this));this.$includeInMultiples.each($.proxy(function(i,e){var bet=bets[i];var selection=bet.selections()[0];if(selection.isTrapChallengePrice()){$(e).remove();}
else{$(e).switchButton({checked:true,extraClass:'customCheck',enableText:'',disableText:'',callback:$.proxy(function(checked){this._handleIncludeInMultiples(checked,bets[i]);},this)});if(selection.data().includeInMultiple){$(e).switchButton('check');}else{$(e).switchButton('uncheck');}}},this));var stePlugin=new webApp.SwipeToEditPlugin('.multiSelectionBrick');stePlugin.init();stePlugin.beforeEditModeOn=$.proxy(this.switchSelectionRowToEditMode,this);stePlugin.onLeaveEditMode=$.proxy(this._leaveSelectionRowEditMode,this);this.$removeSelection.each($.proxy(function(i,e){$(e).click($.proxy(function(e){this._handleSelectionRemove(bets[i].selections()[0],e);stePlugin.leaveEditMode();},this));},this));if($('.betField').length==1)
{$('.betField').addClass('border');}
$('.betField').bind('blur.hightlight',function(){if($(this).val()){$(this).addClass('change');}else{$(this).removeClass('change');}});this.restoreSuspendedSelections();this.initValidation(bets);this.saveBetslip();this.updateTotalAndEstReturns();};this.updateTotalAndEstReturns=function(){if(!this._$returns){return false;}
$.each(this.betslip.bets(),$.proxy(function(i,e){var bet=this.betslip.bets()[i];if(!bet.isSingle()){var $stakeInput=this.$stake[i];if($(this.$stake[i]).val()===''){$($stakeInput).closest('.innerCont').find('.multEstReturns').html('').removeClass('show');}else{var estimatedReturnsMult='N/A';if(!isNaN(bet.returns())){estimatedReturnsMult=bet.returns();}
$($stakeInput).closest('.innerCont').find('.multEstReturns').html('Est Return '+this.currencyView(this.currency)+estimatedReturnsMult).addClass('show');}}},this));var estimatedReturns='N/A';if(this.selectionsCollection.selections().length!==this.selectionsCollection.getSPSelections().length&&!isNaN(this.betslip.estimatedReturns())){estimatedReturns=this.betslip.estimatedReturns().toFixed(2);}
this._$returns.html(this.getCurrencySign(this.currency)+estimatedReturns);this._$totalStake.html(this.getCurrencySign(this.currency)+this.betslip.totalStake().toFixed(2));};this.redrawBetslip=function(){var data={};if(this.selectionsCollection.selections().length>1){data.bets=this.betslip.bets();data.currency=this.currencyView(this.currency);data.currencyCode=this.currency;$('#single-bets').empty().append(this.viewManager.renderTpl('multiples-single-bet-row',data));$('#multiple-bets').empty().append(this.viewManager.renderTpl('multiples-multiple-bet-row',data));this.initializeDom();this._scrollInstance.setSize();}else{if(this._config.blocks.main.template!==this.getTemplate()){this.viewManager.flash(this._name);this.execute();this.setScroll();}}};this._handleStakeChange=function($stakeInput,bet){var value=this._normalizeStake($stakeInput.value),stake=Math.max(parseFloat(value)||0,0);$($stakeInput).val(value);bet.stake(stake);if(this.selectionsCollection.selections().length>1&&this.$betSlipForm.data('validator')){$($stakeInput).valid();}
this.updateTotalAndEstReturns();this._scrollInstance.refresh();};this._normalizeStake=function(stakeVal){var normalizedVal=stakeVal.replace(',','.');normalizedVal=Math.max(parseFloat(normalizedVal)||0,0);if(normalizedVal){return normalizedVal.toFixed(2);}
return stakeVal;};this.validateBetSlip=function(suppressErrorMessage){var valid=true;valid=this.$betSlipForm.valid();if(valid&&this.betslip.getBetsWithStake().length===0){if(suppressErrorMessage!==true){alert("No Stake Entered\nPlease enter a valid stake");}
valid=false;}
return valid;};this.initValidation=function(bets){if(!webApp.bookieCollection.getCurrentProvider().isLoggedIn()){return;}
var currency=this.getCurrencySign(this.currency),multipleMode=this.selectionsCollection.selections().length>1;this.$betSlipForm.removeData('validator');this.$betSlipForm.validate({showErrors:function(errorMap,errorList){var message="";$.each(errorList,$.proxy(function(i,error){message+=error.message+"\n";},this));if(errorList.length===1){message+="Please enter a valid stake";}else if(errorList.length>1){message+="Please enter valid stakes";}
if(errorList.length>0){message=$('<textarea />').html(message).text();alert(message);}},onfocusout:false,onkeyup:false,onsubmit:false});$.each(bets,$.proxy(function(i,bet){var minStake=(bet.minStake()===0)?this.MIN_STAKE:bet.minStake(),maxStake=(bet.maxStake()===Infinity)?this.MAX_STAKE:bet.maxStake(),message="";if(multipleMode){var betName=utils.bet.getBetTypeName(bet),horseName=bet.selections()[0].data().selectionName;message+="Stake for "+(bet.isSingle()?horseName:betName)+" is incorrect\n";}
$(this.$stake[i]).rules("add",{min:minStake,max:maxStake,messages:{number:message,min:message+"Min Stake: "+currency+minStake+"\n",max:message+"Max Stake: "+currency+maxStake+"\n"}});},this));if(webApp.registry.get('invalidstake')){this.validateBetSlip();webApp.registry.remove('invalidstake');}};this._handleEachWayChange=function(checked,bet,$linkedStakeInput,$button){bet.isEachWay(!checked);if(this.selectionsCollection.selections().length>1){$button.closest('.innerCont').find('.colB > span.betCounter').html(bet.betCounter());$button.closest('.innerCont').find('.colB > span.betName').html(utils.bet.getBetTypeName(bet,true));}
this.updateTotalAndEstReturns();};this._handleSPChange=function(checked,bet){if(bet.hasSelections()&&bet.selections().length===1){bet.selections()[0].isSP(!checked);}
this.updateTotalAndEstReturns();};this._handleIncludeInMultiples=function(checked,bet){this.saveBetslip();if(bet.hasSelections()&&bet.selections().length===1){this.selectionsCollection.updateStatus(bet.selections()[0],'includeInMultiple',checked);}
this.restoreBetslip();this.checkBetslip();this.redrawBetslip();};this._handleSelectionRemove=function(selection,event){this.selectionsCollection.remove(selection);$(event.target).closest('.bricks').remove();if(!$('.noBettingMode').length){this.$noBettingMessage.hide();var selectionsNum=this.selectionsCollection.selections().length;if(selectionsNum===0||selectionsNum===1&&!this.selectionsCollection.selections()[0].data().isSuspended){this.redrawBetslip();return;}}
this._scrollInstance.setSize();if(!this.postponeBetSlipUpdateAfterEdit){this.switchFromEditMode();}};this.placeBetClick=function(){var hideLoader=webApp.dataLoading.hide;if(!this.validateBetSlip()){hideLoader();return;}
this.saveBetslip();webApp.placeBet(this.betslip,hideLoader,hideLoader);webApp.dataLoading.show('Sending Bet Details');};var context=this;this.restrictStake=function(){var $input=$(this),value=$input.val(),dotIndex=value.indexOf('.');var isTooMuchDigitsAfterDot=value.substr(dotIndex).length>3;if((isNaN(value)||isTooMuchDigitsAfterDot)&&value.length>0&&value!=='.'){$input.val(value.substring(0,value.length-1));$input.trigger('change');}};this.getCurrencySign=function(currency){var codes={};var sign=null;codes[this.CURRENCY_UK_POUND]='\u00a3';codes[this.CURRENCY_EURO]='\u20ac';codes[this.CURRENCY_US_DOLLAR]='$';if(codes.hasOwnProperty(currency)){sign=codes[currency];}
return sign;};webApp.placeBet=function(betslip,onValid,onError){webApp.bookieCollection.getCurrentProvider().placeBet(betslip).error(function(data){errorHandler(data);if(typeof onError==='function'){onError(data);}}).success(function(data){webApp.bookieCollection.getCurrentProvider().getBalance().success(function(event){context.betslip=data.target.result();context.saveBetslip();if(typeof onValid==='function'){onValid();}
context.saveBetsForBetToWatch(betslip);context._redirect('receipt',{});});});};this.saveBetsForBetToWatch=function(betslip){var bets=betslip.getBetsWithStake();for(var i=0;i<bets.length;i++){var selections=bets[i].selections();for(var j=0;j<selections.length;j++){var selection=selections[j];webApp.openBets.saveOpenBets({'selectionId':selection.id(),'race_id':selection.data().raceId,'race_ts':selection.data().raceTs,'unitStake':betslip.totalStake()});}}};this.getBetSlip=function(onValid,onError){var checkBetslip=true;webApp.bookieCollection.getCurrentProvider().getBetSlip(this.betslip).error(function(data){errorHandler(data,checkBetslip);if(typeof onError==='function'){onError(data);}}).success(function(data){if(typeof onValid==='function'){onValid(data);}});};var errorHandler=function(data,checkBetslip){var error=data.target.result(),code=error.code();var prefBookie=webApp.prefBookmaker.get();var errorClass=webApp.bookieCollection.getCurrentErrorClassName();switch(code){case errorClass.INVALID_BACK_END_REQUEST:webApp.genericWhErrorHandler(error);break;case errorClass.INVALID_SESSION_TOKEN:case errorClass.EXPIRED_SESSION_TOKEN:case errorClass.EXPIRED_OR_INVALID_SESSION_TOKEN:break;case errorClass.GENERIC_ERROR:if(!checkBetslip){context._redirect('generic-error',{});}
break;case errorClass.STATUS_CHANGED:if(!checkBetslip){var suspendedIds=error.data();if(context.betslip.bets().length==1){context._redirect('market-suspend-error',{'selectionName':context.betslip.bets()[0].selections()[0].data().selectionName});}else{context.saveSuspendedSelections(suspendedIds);if(webApp.currentControllerName=='bet-slip'){context.$noBettingMessage.show();context._scrollInstance.setSize();context.checkBetslip();}else{webApp.registry.set('nobetting',true);context._redirect('bet-slip',{});}}}
break;case errorClass.PRICE_CHANGED:context._redirect('price-changed-error',{'r':Math.random()});break;case errorClass.INSUFFICIENT_FUNDS:if(!checkBetslip){webApp.bookieCollection.getCurrentProvider().getBalance();context._redirect(prefBookie+'-top-up',{});}
break;case errorClass.STAKE_TOO_LOW:case errorClass.STAKE_TOO_HIGH:if(error.data()instanceof rp.betting.BetSlip){if(webApp.currentControllerName==='bet-slip'){context.initValidation(error.data().bets());var suppressErrorMessage=true;context.validateBetSlip(suppressErrorMessage);}else{webApp.registry.set('invalidstake',true);context._redirect('bet-slip',{});}}
break;default:context._redirect('generic-error',{});}};$(window).bind(webApp.EVENT_BETSLIP_EMPTIED,$.proxy(this.discardBetslip,this));};webApp.extend(webApp.BetSlipController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{};webApp.ReceiptController=function(name,config){webApp.ReceiptController.superclass.constructor.call(this,name,config);this.reuseSelections=null;this.genericGAEventLabel='';this._postExecute=function(){var setScroll=new webApp.blockScroll({blockId:'whBetslipReceiptScroll',contentHeight:true});};this.getBackUrl=function(){var prevBackCollection=webApp.urlManager.findBackCollection('bet-slip'),backUrl='',ifPriceCh=(prevBackCollection[1].controller=="price-changed-error"),thirdBetSlipBackUrl=webApp.urlManager.getBackUrl('bet-slip',2);if(ifPriceCh){backUrl=webApp.urlManager.getBackUrl('bet-slip',3);}else if(thirdBetSlipBackUrl=="#account-home/"){backUrl=webApp.urlManager.getBackUrl('bet-slip',5);}else if(thirdBetSlipBackUrl.indexOf('card')>=0){backUrl=webApp.urlManager.getBackUrl('bet-slip',2);}else{backUrl='#card';}
return backUrl;};this.addMainMenuOverlay=function(){$('.mainMenuOverlay').addClass('mainMenuOverlayShown');};this.destroy=function(){if(this.reuseSelections===false){webApp.SelectionsManager.removeAllSelections();}
this.addMainMenuOverlay();};this.mainAfterRender=function($block){webApp.UserBalanceHelper.init($block);var $reuseSelections=$('#reuseSelections');if(this.selectionsCollection.selections().length>1){$reuseSelections.switchButton({checked:true,enableText:'No',disableText:'Yes',callback:$.proxy(function(checked){webApp.eventTracker.trackEventById('bet_receipt_reuse_selections',this.genericGAEventLabel);this.reuseSelections=!checked;this.updateDoneButton(this.reuseSelections);},this)});}else{$reuseSelections.closest('.panels').hide();}
this.reuseSelections=false;};this.mainBeforeRender=function(data){var result=this.addCredentialsToView(data);this.betslip=this.loadBetslip();if(!this.betslip){var hashArr=webApp.urlManager.parseHash(webApp.configs.defaultHash);this._redirect(hashArr[0],hashArr[1]);return false;}
var bets=this.betslip.getBetsWithReceiptId();if(bets.length===0){var hashArr=webApp.urlManager.parseHash(webApp.configs.defaultHash);this._redirect(hashArr[0],hashArr[1]);return false;}
var odds=webApp.userSettings.get('odds');result.isDecimalOdds=(odds==='decimal');result.currencySymbol=this.currencyView(this.currency);result.backUrl=this.getBackUrl();result.bets=bets;this.genericGAEventLabel=this.makeGenericGAEventLabel(bets);result.genericGAEventLabel=this.genericGAEventLabel;this.forgetBetslip();this.restoreDefaultIncludeInMultiple();this.restoreDefaultSP();return result;};this.replaceSlashInUrl=function(str){var length=str.length;str=str.substr(0,length-1);return str;}
this.makeGenericGAEventLabel=function(bets){var betReceiptIds=[];var betTypes=[];for(var i=0,l=bets.length;i<l;i++){betReceiptIds.push(bets[i].receiptId());betTypes.push(bets[i].typeName());}
var betReceiptIdsCsv=betReceiptIds.join(', ');var betTypesCsv=betTypes.join(', ');var bookieName=webApp.bookieCollection.getCurrentProviderName();return betReceiptIdsCsv+' - '+bookieName+' - '+betTypesCsv;};this.updateDoneButton=function(checked){var $button=$("#receiptDone");if(checked){$button.text("Return to Slip").attr("href","#bet-slip").attr("data-eventid","bet_receipt_return_to_slip");}else{$button.text("Done").attr("href","#meeting-list").attr("data-eventid","bet_receipt_done");}};};webApp.extend(webApp.ReceiptController,webApp.AbstractNodataCredentialsController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.ReceiptController=function(name,config){greyhoundbet.ReceiptController.superclass.constructor.call(this,name,config);};webApp.extend(greyhoundbet.ReceiptController,webApp.ReceiptController);
var webApp=webApp||{};webApp.BetsExplainedController=function(name,config){webApp.BetsExplainedController.superclass.constructor.call(this,name,config);var request='';this.mainBeforeRender=function(data){request=this.getRequestParams();var betType=parseInt(request.anchor);var rpBet=new rp.betting.Bet({type:betType});var betTypeName=utils.bet.getBetTypeName(rpBet);var accum='Accumulator';if(betTypeName.indexOf('fold')!=-1){betTypeName=accum;}
request=betTypeName.replace(' ','').toLowerCase();};this.mainAfterRender=function(){var scroll=webApp.viewManager.getScroll('bets-explained'),upperAdHeight,$whAdContainer=$('.whAdContainer');if(request!=''){upperAdHeight=$whAdContainer.is(':visible')?$whAdContainer.outerHeight(true):0;var elemTop=$('#'+request).offset().top;scroll.scrollTo(0,-elemTop+upperAdHeight+65,0);}
$("ul > a").click(function(e){e.preventDefault();$(this).addClass('noHighlight');upperAdHeight=$whAdContainer.is(':visible')?$whAdContainer.outerHeight(true):0;var id=$(this).attr('href');var elemTop=$(''+id).offset().top;scroll.scrollTo(0,-elemTop+upperAdHeight+65,0);});};};webApp.extend(webApp.BetsExplainedController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{};webApp.GenericErrorController=function(name,config){webApp.GenericErrorController.superclass.constructor.call(this,name,config);this._scrollInstance=null;this._postExecute=function(){this._scrollInstance=new webApp.blockScroll({blockId:'betslipErrorScroll',contentHeight:true});};this._preExecute=function(){var prefBookie=webApp.prefBookmaker.get();this._config.blocks['main'].template=prefBookie+'-generic-error';};this.errorRedirect=function(){this._redirectAndExit('cards-home');return;};this.destroy=function(){this.unbindLogout();};this.mainBeforeRender=function(data){var client=webApp.bookieCollection.getCurrentProvider();if(!client.isLoggedIn()){this.errorRedirect();}
var result=this.addCredentialsToView(data);$.extend(result,this.getRequestParams());result.currency=webApp.bookieCollection.getCurrentProvider().user().currency();result.backUrl=webApp.registry.get('backUrlHash')||false;if(result.backUrl){result.backUrl=result.backUrl.replace('predictor','card');}
return result;};this.mainAfterRender=function($block){this.bindLogout();var bookie=webApp.prefBookmaker.get();var bookieAccountRedirectHandler=function(){if(webApp.bookieCollection.getCurrentProvider().isLoggedIn()){this._redirect(bookie+'-account-home');}else{this._redirect(bookie+'-home');}
return false;};webApp.UserBalanceHelper.init($block);$('#'+bookie+'HomeRedirect').click($.proxy(bookieAccountRedirectHandler,this));};};webApp.extend(webApp.GenericErrorController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{};webApp.MarketSuspendErrorController=function(name,config){webApp.MarketSuspendErrorController.superclass.constructor.call(this,name,config);this._scrollInstance=null;this._postExecute=function(){this._scrollInstance=new webApp.blockScroll({blockId:'betslipMarketSuspendErrorScroll',contentHeight:true});};this._preExecute=function(){var prefBookie=webApp.prefBookmaker.get();this._config.blocks['main'].template=prefBookie+'-market-suspend-error';};this.errorRedirect=function(){this._redirectAndExit('cards-home');return;};this.destroy=function(){this.unbindLogout();};this.mainAfterRender=function($block){this.bindLogout();webApp.UserBalanceHelper.init($block);$('.btnError').click(function(event){webApp.SelectionsManager.removeAllSelections();});};this.mainBeforeRender=function(data){var client=webApp.bookieCollection.getCurrentProvider();if(!client.isLoggedIn()){this.errorRedirect();}
data=this.addCredentialsToView(data);$.extend(data,this.getRequestParams());var currency=webApp.bookieCollection.getCurrentProvider().user().currency();data.currency=this.currencyView(currency);data.backUrl=this.getBackUrl();if(data.backUrl){data.backUrl=data.backUrl.replace('predictor','card');}
return data;};this.getBackUrl=function(){return webApp.registry.get('backUrlHash')||false;};};webApp.extend(webApp.MarketSuspendErrorController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{};webApp.PriceChangedErrorController=function(name,config){webApp.PriceChangedErrorController.superclass.constructor.call(this,name,config);this._scrollInstance=null;this._preExecute=function(){var prefBookie=webApp.prefBookmaker.get();this._config.blocks['main'].template=prefBookie+'-price-changed-error';};this.destroy=function(){this.unbindLogout();};this.mainAfterRender=function($block){this.bindLogout();this._scrollInstance=new webApp.blockScroll({blockId:'betslipPriceChangedErrorScroll',contentHeight:true});webApp.UserBalanceHelper.init($block);this.betslip.removeOldPrices();$('#placeBet').click($.proxy(function(event){event.preventDefault();webApp.placeBet(this.betslip,function(){webApp.dataLoading.hide();},function(){webApp.dataLoading.hide();});webApp.dataLoading.show('Sending Bet Details');},this));};this.errorRedirect=function(){this._redirectAndExit('cards-home');return;};this.mainBeforeRender=function(data){var client=webApp.bookieCollection.getCurrentProvider();if(!client.isLoggedIn()){this.errorRedirect();}
data=this.addCredentialsToView(data);this.restoreBetslip();data.betslip=this.betslip;if(!data.betslip.hasOldPrices()){this._redirectAndExit('bet-slip');return;}
data.backUrl=this.getBackUrl();data.currency=this.currencyView(this.currency);return data;};this.getBackUrl=function(){return false;};};webApp.extend(webApp.PriceChangedErrorController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{},wh=wh||{};webApp.ConnectivityCheckController=function(name,config){webApp.ConnectivityCheckController.superclass.constructor.call(this,name,config);webApp.ConnectivityCheckController.CHECK_XML_SERVER='';webApp.ConnectivityCheckController.CHECK_DIFFUSION='';webApp.ConnectivityCheckController.CHECK_AD_SERVER='';webApp.ConnectivityCheckController.CHECK_WH='';webApp.ConnectivityCheckController.CHECK_GOOGLE='';webApp.ConnectivityCheckController.CHECK_TYPE_IMG='image';webApp.ConnectivityCheckController.CHECK_TYPE_METHOD='method';webApp.ConnectivityCheckController.checkData={'xmlServer':{'checkType':webApp.ConnectivityCheckController.CHECK_TYPE_METHOD,'method':function(){webApp.ConnectivityCheckController.checkXmlServer();},'displayName':'Connect to Web server'},'diffusion':{'checkType':webApp.ConnectivityCheckController.CHECK_TYPE_METHOD,'method':function(){webApp.ConnectivityCheckController.checkDiffusion();},'displayName':'Connect to Diffusion'},'adServer':{'checkType':webApp.ConnectivityCheckController.CHECK_TYPE_IMG,'url':'http://images.racingpost.com/2008/Nov/tb1760.jpg','displayName':'Connect to Images server'},'google':{'checkType':webApp.ConnectivityCheckController.CHECK_TYPE_IMG,'url':'https://www.google.com/images/swxa.gif','displayName':'Connect to Internet'},'whServer':{'checkType':webApp.ConnectivityCheckController.CHECK_TYPE_METHOD,'method':function(){webApp.ConnectivityCheckController.checkWh();},'displayName':'Connect to William Hill'},'ladbServer':{'checkType':webApp.ConnectivityCheckController.CHECK_TYPE_METHOD,'method':function(){webApp.ConnectivityCheckController.checkLadb();},'displayName':'Connect to Ladbrokes'}};this.mainBeforeRender=function(data){data.checkData=webApp.ConnectivityCheckController.checkData;return data;};this.mainAfterRender=function(){for(var i in webApp.ConnectivityCheckController.checkData){if(webApp.ConnectivityCheckController.checkData[i].checkType==webApp.ConnectivityCheckController.CHECK_TYPE_METHOD){webApp.ConnectivityCheckController.checkData[i].method();}}};webApp.ConnectivityCheckController.checkDiffusion=function(){if(DiffusionConnector.isConnected){var $statusContainer=$('#diffusionStatus');$statusContainer.closest('li').append('<em>'+DiffusionConnector.getClient().diffusionTransport.clientID+'</em>');$statusContainer.addClass('ok');}};webApp.ConnectivityCheckController.checkXmlServer=function(){$.get(webApp.URL_SELF_CHECK,function(data){var parsedData=$.parseJSON(data);if(parsedData.raceId){var $statusContainer=$('#xmlServerStatus');$statusContainer.closest('li').append('<em>'+parsedData.serverIP+'</em>');$statusContainer.addClass('ok');}});};webApp.ConnectivityCheckController.checkWh=function(){var whProvider=webApp.bookieCollection.getProvider('wh'),$statusContainer=$('#whServerStatus');$statusContainer.closest('li').append('<em>Host: '+whProvider.url()+'</em><em>Prices: '+webApp.bookiesCollection.wh.diffName+'</em>');whProvider.getBalance().error(function(event){if(event.target.result().data()){$statusContainer.addClass('ok');}}).success(function(){$statusContainer.addClass('ok');});};webApp.ConnectivityCheckController.checkLadb=function(){webApp.bookieCollection.getProvider('ladb').checkConnection().success(function(){$('#ladbServerStatus').addClass('ok');});};webApp.ConnectivityCheckController.checkImage=function(elemId,status){var id=$('#'+elemId).attr('id');if(status){$('#'+elemId+'Status').addClass('ok');}};};webApp.extend(webApp.ConnectivityCheckController,webApp.AbstractNodataCredentialsController);
var greyhoundbet=greyhoundbet||{},utils=utils||{},webApp=webApp||{};greyhoundbet.MeetingListController=function(name,config){greyhoundbet.MeetingListController.superclass.constructor.call(this,name,config);this._$orderMenuItems=null;this.meetingsAvailable=true;this._preExecute=function(){var request,requestDate,todayStr,dateStr,todayTmp,dateTmp,today,date;request=this.getRequestParams();requestDate=request.r_date;todayStr=utils.date.toString(utils.date.getSynchronizedToServerNow());dateStr=requestDate||'';todayTmp=todayStr.split("-");dateTmp=dateStr.split("-");today=new Date(todayTmp[0],todayTmp[1],todayTmp[2]);date=new Date(dateTmp[0],dateTmp[1],dateTmp[2]);if(requestDate!='trapDraws'){if(!requestDate||!utils.date.isDate(requestDate)||(date.getTime()<today.getTime())){request.r_date=todayStr;this._redirectAndExit(this.getName(),request);return;}}
if(webApp.registry.get('meetingRacesTime'))webApp.registry.set('meetingRacesTime',false);request.view=request.view||webApp.userSettings.get('cardsListBy');this.setRequestParams(request);var tmpl=requestDate!='trapDraws'?request.view:'trap';this._setupCardsListTemplate(tmpl);};var calendarData={};this.headerBeforeRender=function(data){var request=this.getRequestParams();calendarData=data;var data={};data.raceDate=request.r_date;var date=new Date(request.r_date.replace(/(\d+)-(\d+)-(\d+)/,'$2/$3/$1'));data.listDate=date.format('ddd dd mmm');return data;};this.headerAfterRender=function($header){var request=this.getRequestParams(),context=this;var view=request.view;if(request.r_date=='trapDraws'){$('#cardsListOrderButtons').hide();}else{$('#cardsListOrderButtons').show();this._$orderMenuItems=$('#cardsListOrderButtons li');this._setActiveOrderItem(view);this._$orderMenuItems.click(function(){var sortBy=$(this).attr('id').split('-');context._setActiveOrderItem(sortBy[1]);webApp.userSettings.set('cardsListBy',sortBy[1]);var order='cards_by_'+sortBy[1];webApp.eventTracker.trackEventById(order);});}
webApp.BottomMenuControl.init({btnSelector:'#meetingsDateBtn',urlParam:'r_date',items:{date:{days:calendarData},trapDraws:{urlParamValue:'trapDraws',text:'Trap Draws',btnText:'<span class="trapDrawsBtn">&nbsp;</span>'}},callback:function(d){}});webApp.Calendar.init({$appendTo:$('body'),orientation:webApp.orientation.toLowerCase(),maxYearsBack:5});};this.setupNextRace=function($block){var context=this;var nextRace=this._getNextRace();var todayCard=this.isTodaysDateRequested();if(nextRace!==null&&todayCard){$('#nextRaceOff').bind('click.nextRace',function(){try{webApp.eventTracker.trackEventById('cards_next_race');context._deligate('card',{"race_id":"next"});}catch(ignore){}
return false;});}else if(nextRace!==null&&!todayCard){$('#nextRaceOff').addClass('hideNextRaceOff');}
else{$('#nextRaceOff').addClass('nextRaceOffDisabled');}};this._getNextRace=function(){var data=this._getCache('list');var list=this._orderRacesByTime(data.items);var date=utils.date.getSynchronizedToServerNow();var serverTime=date.getTime();var nextRace=null;$.each(list,function(){var raceTs=parseInt(utils.date.fromString(this.raceDate,0).getTime(),10);if(serverTime<raceTs&&this.country!=='IRE'){nextRace=this;return false;}});return nextRace;};this._setActiveOrderItem=function(viewParam){this._$orderMenuItems.removeClass('active');if(viewParam==='meetings'){this._$orderMenuItems.eq(0).addClass('active');}else{this._$orderMenuItems.eq(1).addClass('active');}};this._setupCardsListTemplate=function(view){var listConfig=this._config.blocks.list;if(view==='trap'){listConfig.template='trap-draws-meetings-list';}else if(view==='time'){listConfig.template='meeting-list-by-time';}else{listConfig.template='meeting-list-by-meeting';}};this.pushData=function(blocksData){for(var i in this._blocksToLoad){var name=this._blocksToLoad[i];if(blocksData[name]){if(typeof(blocksData[name].errorCode)!='undefined'&&blocksData[name].errorCode=='404'){if(name=='list'){this._setCache(name,blocksData[name]);this._setCache('empty-list',{});}else{var params={errorMessage:blocksData[name].errorMessage||'',referer:this._name,errorHash:window.location.hash};this._deligate('error404',params);}}else{this._setCache(name,blocksData[name]);}}else{var config=this.getBlockConfig(name);if(!config.cacheId){this._setCache(name,{});}}}
return this;};this.renderEmpty=false;this._findBlocksToRender=function(){var result=[];if(this.renderEmpty){result=['header','empty-list'];this.renderEmpty=false;}else{result=['header','list'];}
return result;};this.listBeforeRender=function(data){var request=this.getRequestParams(),view=request.view;this.renderEmpty=false;this.meetingsAvailable=data.meetingsAvailable||request.r_date==='trapDraws';if(this.meetingsAvailable){if(request.r_date!='trapDraws'){if(!this.isTodaysDateRequested()){data.cardTab='form';}else{data.cardTab=webApp.userSettings.get('cardTab');}
data.isIos=webApp.isIDevice;if(view==="time"){data.items=data.items.filter(function(record){return!(record.isIrish=="1"&&record.isSkyTv!="1"&&record.isGreyhoundTv!="1"&&record.isTurfTv!="1"&&record.isAtTheRacesTv!="1");});data.items=this._orderRacesByTime(data.items);this.addDateAndTime(data.items,function(){return this.raceDate;});}else{data.items.sort(this._sortTrackByFirstRace);this.addDateAndTime(data.items,function(){return this.races[0].raceDate;});}}else{for(var i in data){var d=utils.date.fromString(i+' 00:00',0);data[i].d=d.format('dddd dd mmmm');}}}
return data;};this.addDateAndTime=function(items,dataSelectorFunctionInsideItem){for(var i=0,j=items.length;i<j;i++){var currItem=items[i],raceDate=dataSelectorFunctionInsideItem.call(items[i]);currItem.raceYYYYMMDD=raceDate.split(' ')[0];currItem.raceHHMM=raceDate.split(' ')[1];currItem.isTodaysDateRequested=this.isTodaysDateRequested();}};this.listAfterRender=function($box){var request=this.getRequestParams();if(request.r_date!='trapDraws'&&this.meetingsAvailable){this.setupNextRace($box);}
webApp.searchFormInit();if(!webApp.isDesktop){webApp.viewManager.getScroll(this._name).scrollTo(0,-44,0);}};this._orderRacesByTime=function(items){var racesByTime=[];var tmpRace,crsKey,i;$.each(items,function(crsKey){$.each(items[crsKey].races,function(i){if(items[crsKey].races[i].raceStatus=="R"){return;}
tmpRace=items[crsKey].races[i];tmpRace.track=items[crsKey].track;tmpRace.racesCount=items[crsKey].racesCount;tmpRace.firstRace=items[crsKey].firstRace;tmpRace.lastRace=items[crsKey].lastRace;tmpRace.tvShortName=items[crsKey].tvShortName;tmpRace.isNonBetting=items[crsKey].isNonBetting;racesByTime.push(tmpRace);});});racesByTime.sort(this._sortRacesByTimestamp);if($('.raceListTime li ').length>0){$('.irish-races-only').removeClass('irish-races-only');}
return racesByTime;};this._sortRacesByTimestamp=function(a,b){var timeA=utils.date.fromString(a.raceDate,0);var timeB=utils.date.fromString(b.raceDate,0);if(timeA<timeB){return-1;}
if(timeA>timeB){return 1;}
return 0;};this._sortTrackByFirstRace=function(a,b){var timeA=utils.date.fromString(a.firstRace,0);var timeB=utils.date.fromString(b.firstRace,0);if(timeA<timeB){return-1;}
if(timeA>timeB){return 1;}
return 0;};};webApp.extend(greyhoundbet.MeetingListController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};webApp.currentRace=0;greyhoundbet.MeetingRacesController=function(name,config){greyhoundbet.MeetingRacesController.superclass.constructor.call(this,name,config);this._preExecute=function(){if(!webApp.isDesktop&&this.isPastDateRequested()||!webApp.isDesktop&&this.accessedFromBookmark()){this._redirectAndExit('meeting-list');return;}};this.data={};this.tipsBeforeRender=function(data){if(data.hasOwnProperty('tips')){var currentIndex,previousIndex,tipsArray=data.tips,tipsArrayLength=tipsArray.length;for(var i=0;i<tipsArrayLength;i++){if(i===0){previousIndex=0;}
else{currentIndex=i;if(tipsArray[currentIndex].race_id===tipsArray[previousIndex].race_id){tipsArray.splice(previousIndex,1);tipsArrayLength=tipsArray.length;}else{previousIndex=currentIndex;}}}
$.extend(this.data,{'tips':tipsArray,'tipsAvailable':'true'});}
else{$.extend(this.data,{'tips':{},'tipsAvailable':'false'});}};this.listBeforeRender=function(data){var raceTime=this.getRequestParams().r_time;webApp.registry.set('meetingRacesTime',raceTime);var date=new Date(data.items[0].firstRace.replace(/(\d+)-(\d+)-(\d+)/,'$2/$3/$1'));$('#meetingHeaderTitle').html(data.items[0].track);$('#meetingBack').html(date.format('mmm dd'));$('#meetingBack ').parent().attr('href','#meeting-list/view=meetings&r_date='+data.items[0].firstRace.split(' ')[0]);$('#meetingBack').click(function(){webApp.eventTracker.trackEventById('cards_back');});var cardTab='';var raceDate=data.items[0].firstRace.split(' ')[0];var nowDate=utils.moment.getSynchronizedToServerNow(0,'YYYY-MM-DD');if(nowDate!=raceDate){cardTab='form';}else{cardTab=webApp.userSettings.get('cardTab');}
webApp.raceDistances=data.items[0].races;var meetingRacesArray=data.items[0].races;var meetingRacesArrayLength=meetingRacesArray.length;var tipsArray=this.data.tips;var newTipsArray=[];if(tipsArray.length&&(meetingRacesArrayLength!==tipsArray.length)){for(var i=0,j=0;i<meetingRacesArrayLength;i++){if(tipsArray[j]){if(meetingRacesArray[i].raceId!==tipsArray[j].race_id){newTipsArray.push({});}
else{newTipsArray.push(tipsArray[j]);j++;}}
else{newTipsArray.push({});}}
this.data.tips=newTipsArray;}
$.extend(this.data,{'list':data.items[0],'cardTab':cardTab});return this.data;};this.headerBeforeRender=function(data){var data={};return data;};this.listAfterRender=function(data){var ul=$('.appList.raceList.raceListTime');var liArray=ul.children();for(var i=0;i<liArray.length;i++){$(liArray[i]).on('click',function(){for(var i=0;i<liArray.length;i++){if(this===liArray[i]){webApp.currentRace=i;}}});}};};webApp.extend(greyhoundbet.MeetingRacesController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{},webApp=webApp||{};greyhoundbet.TrapDrawsRacesController=function(name,config){greyhoundbet.TrapDrawsRacesController.superclass.constructor.call(this,name,config);this.trapDrawsHeaderBeforeRender=function(data){var request=this.getRequestParams(),requestDate=request.r_date;var d=utils.date.fromString(requestDate+' 00:00',0);data.date=d.format('ddd dd mmm');return data;},this.trapDrawsRacesBeforeRender=function(data){var raceTime,raceHours,raceMinutes;data.cName=data.races[0].race.TRACK_NAME;$.each(data.races,function(index){raceTime=data.races[index].race.RACE_TIME;raceHours=+raceTime.split(':')[0];raceHours=((raceHours+11)%12+1);raceMinutes=raceTime.split(':')[1];data.races[index].race.RACE_TIME=''+raceHours+':'+raceMinutes;});return data;}};webApp.extend(greyhoundbet.TrapDrawsRacesController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.MeetingController=function(name,config){greyhoundbet.MeetingController.superclass.constructor.call(this,name,config);};webApp.extend(greyhoundbet.MeetingController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};webApp=webApp||{};webApp.raceInfo=webApp.raceInfo||[];greyhoundbet.CardController=function(name,config){greyhoundbet.CardController.superclass.constructor.call(this,name,config);var EVENT_CHANGE_ORIENTATION=webApp.EVENT_CHANGE_ORIENTATION+'.horseCardOrientation';this._diffusionListeners={};this.isRadionPlaying=false;var diffusionData={};var oddsSortTimeId=null;var sortBy=webApp.userSettings.get('sortBy');this._eachWay=null;this._$tabsLinks=$([]);var $title=$([]);var activeTab='';var displayRadioFlag=false;var tvIdArray=['1','2'];this.raceData={};this.courseId=null;this.videoPageUrl='#video';this.RP_VIDEO_SHOWN_NAME='RP_VIDEO_SHOWN';this._BOG=false;this.setBOG=function(data){this._BOG=(data.data[0]==='1')?true:false;};this._isRaceStatusUpdated=false;this._raceTitleCircle=null;this._preExecute=function(){if(this.isPastDateRequested()||!webApp.isDesktop&&this.accessedFromBookmark()){this._redirectAndExit('meeting-list');return;}
var request=this.getRequestParams();if(!request.tab){request.tab='card';}else{var tabs=['card','form','stats','tips'];if($.inArray(request.tab,tabs)===-1){request.tab='card';}}
this.setRequestParams(request);this._cachedDogs=null;this._diffusionSisRaceSession=new window.rpDiffusion.default({onDataFunction:this.onRaceSisStatusReceived.bind(this)});this._diffusionPriceSession=new window.rpDiffusion.default({onDataFunction:this.onPriceReceived.bind(this)});this._diffusionRaceInfoSession=new window.rpDiffusion.default({onDataFunction:this.onRaceInfoReceived.bind(this)});};this.onRaceSisStatusReceived=function(WebClientMessage){this.acceptRaceInfo(this.transformToLegacyRaceInfo(WebClientMessage));};this.onRaceInfoReceived=function(WebClientMessage){var eachWay=new rp.models.EachWay(this.transformToLegacyRaceInfo(WebClientMessage));this.setEachWay(eachWay);var bog=this.transformToLegacyBOG(WebClientMessage);this.setBOG(bog);};this.transformToLegacyRaceInfo=function(WebClientMessage){return{data:WebClientMessage.getRecords()[0]};};this.transformToLegacyBOG=function(WebClientMessage){return{data:[(WebClientMessage.getRecords()[0][1]==='Y')?'1':'0']};};this.onPriceReceived=function(WebClientMessage){this.acceptPrice(this.transformToLegacyPrice(WebClientMessage));this.acceptPriceHistory(this.transformToLegacyPriceHistory(WebClientMessage));};this.transformToLegacyPrice=function(WebClientMessage){var dataFields=WebClientMessage.getFields(0);var topic=WebClientMessage.getTopic();var topicArr=topic.split('/');var raceTime=topicArr[3];var dogName=topicArr[5];return{selectionId:dataFields[1],selectionName:dogName.replace(/ /g,'_'),hours:Number(raceTime.split(':')[0]),minutes:Number(raceTime.split(':')[1]),numerator:Number(dataFields[7].split('/')[0]),denominator:Number(dataFields[7].split('/')[1]),fractional:dataFields[7],decimal:dataFields[8],isSuspended:dataFields[6]==='H'}};this.transformToLegacyPriceHistory=function(WebClientMessage){var dataFields=WebClientMessage.getFields(0);var topic=WebClientMessage.getTopic();var topicArr=Array.prototype.concat('',topic.split('/')).map(function(elem){return elem.replace(/ /g,'_')});var dataArr=Array.prototype.concat(dataFields[1]+'||'+dataFields[3]+'|'+dataFields[4]+'|',dataFields[6]==='H'?'1':'0',dataFields.slice(9,19));return{topic:topicArr,data:dataArr}};this.destroy=function(){this._diffusionSisRaceSession.unsubscribeAll();this._diffusionRaceInfoSession.unsubscribeAll();this._diffusionPriceSession.unsubscribeAll();delete this._diffusionSisRaceSession;delete this._diffusionRaceInfoSession;delete this._diffusionPriceSession;$(window).unbind('.horseCardOrientation');};this._findBlocksToRender=function(){var result=[],request=this.getRequestParams();if(!request.hasOwnProperty('race_id')||request.race_id==='next'){return['next-race'];}
result=['card-header','card-pager','card-tabs','card-title'];result.push(request.tab);this._config.blocks['card-header'].template='card-header';this._config.blocks['card-pager'].template='card-pager';this._config.blocks.form.template='tab-form';return result;};this.nextRaceBeforeRender=function(data){if(data.race_id===''){this._redirectAndExit('cards-home');}else{this._redirectAndExit('card',data);}};this.cardTabsBeforeRender=function(data){var request=this.getRequestParams();var mainData=this._getCache('card-header');var races=mainData.races[this.courseId].races;data.tab=request.tab;data.race_id=request.race_id;data.r_date=request.r_date;data.racesIds=[];$.each(races,function(i,race){data.racesIds.push(race.raceId);});data.tabs=this.isTodaysDateRequested()?[{tabName:'card'},{tabName:'form'},{tabName:'stats'},{tabName:'tips',queryParamsHashString:'&races_ids='+data.racesIds.join()}]:[{tabName:'form'}];return data;};this.cardTabsAfterRender=function($tabs){var context=this;var request=this.getRequestParams();this._$tabsLinks=$tabs.find('a').bind('click.cardTabClick',function(){context._setActiveTab($(this));context._checkCardTitle();if(webApp.isMobile===false){$(document).trigger('resize.viewm');}});this._setActiveTab(request.tab);};this._setActiveTab=function(tab){var $tabLink,tabName;if(tab instanceof jQuery){$tabLink=tab;tabName=tab.attr('id').split('-')[1];}else{$tabLink=$('#cardTab-'+tab);tabName=tab;}
if(tabName===activeTab){return;}else{activeTab=tabName;}
this._$tabsLinks.removeClass('active');$tabLink.addClass('active');setTimeout($.proxy(function(){var pagerObj={tab:activeTab};if(activeTab=='tips'){pagerObj.races_ids=this.getRequestParams().races_ids;}
this._pager.setButtonsHrefParam(pagerObj);},this),110);};this.cardTitleBeforeRender=function(data){this.titleData=data;data['shouldShowTv']=0;data['videoPageUrl']=this.videoPageUrl;data['isLoggedIn']=webApp.bookieCollection.getCurrentProvider().isLoggedIn();if(data.hasOwnProperty('tvId')&&data.tvId=='2'){data['shouldShowTv']=1;}
var bookie=webApp.bookieCollection.getCurrentBookieParams();if(webApp.isRadioDisplayed){if((data.hasOwnProperty('bagsCode')&&data.bagsCode=='B')||tvIdArray.indexOf(data.tvId)>-1){displayRadioFlag=(bookie.diffName!=='LADB');}}
return data;};this.cardTitleAfterRender=function($block){var titleData={},$predictorButton=null,circleData=[],raceClassMsg='',raceInfoData='',postPickData='',raceTitlePadding=0,averageWordWidth=6,raceTitleMsg='';titleData=this._getCache('card-title');$title=$block;if(webApp.isDesktop){$('.b2v.button.buttonIcon').attr('target','_blank');}
$('#toggleCardBtn').bind('click.toggleCardClick',function(){$('#card-page').toggleClass('collapseCard');});if(this._raceTitleCircle){delete this._raceTitleCircle;}
$predictorButton=$('#btnPredictor');$predictorButton.unbind('.showPredictor');raceClassMsg=titleData.raceGrade+' - '+titleData.distance+'m '+
titleData.raceTypeDesc;raceTitlePadding=raceClassMsg.length*averageWordWidth+'px';raceInfoData='<p class="p1" ><span class="titleColumn1" style="padding-right:'+raceTitlePadding+'">'+titleData.raceTitle+'&nbsp;'+'</span><span class="titleColumn2">'+raceClassMsg+'</span></p>';circleData.push({raceInfo:raceInfoData});if(!titleData.reserved&&this.isTodaysDateRequested()){if(titleData.postPick!=''){postPickData='<p class="p2">'+'&nbsp;POST PICK: '+titleData.postPick+' '+titleData.napNum+'</p>';circleData.push({postPick:postPickData});}
$predictorButton.show();}else{$predictorButton.hide();$predictorButton.bind('click.showPredictor',function(e){e.preventDefault();});}
this._raceTitleCircle=new webApp.SimpleCircle({id:'title-circle-container',data:circleData},true);if(titleData.raceSisStatusTopicD5){var realTopic={topic:titleData.raceSisStatusTopicD5.replace('PREFERRED_BOOKMAKER',webApp.PREFERRED_BOOKMAKER)};this._diffusionSisRaceSession.subscribe(realTopic);}
this._setRaceStatusWithoutDiffusion();if(webApp.orientation==='Portrait'){this._checkCardTitle();}else{this._checkCardTitle('form');}
var $playBtn=$('#whRadio');var $playBtnBox=$('#raceTitleBox');if(displayRadioFlag){if(webApp.orientation==='Portrait'||webApp.isDesktop){$playBtnBox.addClass('showWHRadio');}
if(webApp.radioSupport){this._initRadioPlayerHandling($playBtn);}
else if(webApp.isDesktop){this._initDesktopRadioPlayerHandling($playBtn);}
else{this._initUsingExternalAppAsRadioProvider($playBtn);}
$(window).bind(EVENT_CHANGE_ORIENTATION,function(event,data){if(data.orientation==='Portrait'||webApp.isDesktop){$playBtnBox.addClass('showWHRadio');}else{$playBtnBox.removeClass('showWHRadio');}});}
if(webApp.isDesktop&&displayRadioFlag&&!webApp.whRadio.mediaelementPlayerCreated){$('.webApp').append('<div id="desktopRadioContainer"></div>');webApp.whRadio.initDesktopRadio($('#desktopRadioContainer'));webApp.whRadio.mediaelementPlayerCreated=true;}
if((!displayRadioFlag||webApp.orientation==='Landscape')&&!webApp.isDesktop){$playBtnBox.removeClass('showWHRadio');}
$('#title-circle-container').css('max-width','98%');var $rpgButton=$('.b2v');$rpgButton.bind('click',{'RP_VIDEO_SHOWN_NAME':this.RP_VIDEO_SHOWN_NAME},function(evt){utils.localStorage.set(evt.data.RP_VIDEO_SHOWN_NAME,1);});};this._initRadioPlayerHandling=function($playBtn){context=this;if(webApp.whRadio.isPlaying()){$playBtn.addClass('pause');}
var unableToPlayHandler=function(){webApp.whRadio.stop();$playBtn.removeClass('pause');};var unableToPlayTimer;webApp.whRadio.setOnPlayingCallBack(function(){clearTimeout(unableToPlayTimer);});$playBtn.bind('click.radioPlay',function(){if(webApp.isIOS_7&&context.isRadionPlaying){e.preventDefault();return false;}
if(webApp.whRadio.isPlaying()){webApp.whRadio.stop();$playBtn.removeClass('pause');}else{webApp.whRadio.play($(".appleRadioContainer"));$playBtn.addClass('pause');context.isRadionPlaying=true;setTimeout(function(){context.isRadionPlaying=false;},4000);unableToPlayTimer=setTimeout(function(){unableToPlayHandler();},45*1000);}});};this._initDesktopRadioPlayerHandling=function($playBtn){context=this;if(webApp.whRadio.isPlaying()){$playBtn.addClass('pause');}
$playBtn.on('click',function(e){if(context.isRadionPlaying){e.preventDefault();return false;}
try{if(webApp.whRadio.isPlaying()){webApp.whRadio.stopDesktopRadio();$playBtn.removeClass('pause');}else{webApp.whRadio.playDesktopRadio();$playBtn.addClass('pause');context.isRadionPlaying=true;setTimeout(function(){context.isRadionPlaying=false;},4000);}}
catch(e){isFlashPluginAvailable=navigator.plugins["Shockwave Flash"];if(!isFlashPluginAvailable){alert('Please install Adobe Flash Plug-in to access this functionality');}
else{alert('Something went wrong');}}});};this._initUsingExternalAppAsRadioProvider=function($playBtn){$playBtn.bind('click.radioPlay',function(){webApp.confirmPopup({tpl:'radio-popup'});});};this.cardTitleOnDestroy=function(){this._unsubscribeSisTopics();if(this._raceTitleCircle){delete this._raceTitleCircle;}
this._clearRaceStatusTimeout();};this._unsubscribeSisTopics=function(){if(this._diffusionSisRaceSession){this._diffusionSisRaceSession.unsubscribeAll();}};this._clearRaceStatusTimeout=function(){if(this._checkRaceStatusTimeout){clearTimeout(this._checkRaceStatusTimeout);}};this._setRaceStatusWithoutDiffusion=function(){var titleData=this._getCache('card-title');if(this._isRaceStatusUpdated){return;}
var context=this;var date=utils.date.getSynchronizedToServerNow();var serverTime=parseInt(Date.parse(date.toUTCString()),10);var raceTime=titleData?parseInt(titleData.raceDatetime,10)*1000:parseInt(this.titleData.raceDatetime,10)*1000;var status='Race Status: '+((raceTime>serverTime)?'Upcoming':'Betting Closed');if(this._raceTitleCircle){status='<p class="p3"> '+'&nbsp;'+status+'</p>';this._raceTitleCircle.setVal('status',status).displayDesktop();}
this._checkRaceStatusTimeout=setTimeout(function(){context._setRaceStatusWithoutDiffusion();},1000*10);};this.acceptRaceInfo=function(data){var racesStatuses={'A':'Parading','B':'','C':'Approaching Traps','D':'Start Delay','E':'Going in Traps','H':'Hare Running','J':'Hare Stopped','K':'Traps Failed','N':'No Race','O':'Off','X':''};var state=data.data[0],status='';if(typeof(racesStatuses[state])!=='undefined'&&racesStatuses[state]!==''){this._isRaceStatusUpdated=true;if(this._raceTitleCircle){status='<p class="p3">&nbsp;Race Status: '+racesStatuses[state]+'</p>';this._raceTitleCircle.setVal('status',status).displayDesktop();}}};this._checkCardTitle=function(tabName){tabName=tabName||activeTab;var $mainContainer=$('#sortContainer'),$statusBox=$('.statusBox'),$statsTabContainer=$('#statsList'),$toggleButton=$('#toggleCardBtn'),$explainButton=$('#formeEplainedBtn'),$tipsTabContainer=$('.tipsGrid');$cardTabContainer=$('.cardTabContainer');$formTabContainer=$('.formTabContainer');if(tabName==='card'){$title.show();$toggleButton.show();$explainButton.hide();$tipsTabContainer.hide();$statsTabContainer.hide();$formTabContainer.hide();if(webApp.isDesktop===true){$statusBox.removeClass(' enablePrint');}}else if(tabName==='form'){$title.show();$explainButton.show();$toggleButton.hide();$tipsTabContainer.hide();$statsTabContainer.hide();$cardTabContainer.hide();if(webApp.isDesktop===true){$statusBox.addClass(' enablePrint')}}else if(tabName==='stats'){$title.hide();$mainContainer.hide();$tipsTabContainer.hide();if(webApp.isDesktop===true){$statusBox.removeClass(' enablePrint');}}else{$title.hide();$mainContainer.hide();$statsTabContainer.hide();if(webApp.isDesktop===true){$statusBox.removeClass(' enablePrint');}}};this.cardHeaderBeforeRender=function(data){var request=this.getRequestParams();var raceId=request.race_id;var i,j;for(i in data.races){for(j in data.races[i].races){if(data.races[i].races[j].raceId===raceId){this.courseId=i;break;}}
if(this.courseId!==null){break;}}
data.courseName=data.races[this.courseId].track;data.raceDate=request.r_date;return data;};this.cardPagerAfterRender=function(){var mainData=this._getCache('card-header');var races=mainData.races[this.courseId].races;var prevRaceId=null;races=races.filter(function(value,index,array){if(prevRaceId===value.raceId){return false;}
prevRaceId=value.raceId;return true;});this._pager=new greyhoundbet.racePager({data:races,urlParams:this.getRequestParams(),callback:$.proxy(this.changeCardLinks,this)});};this.cardHeaderAfterRender=function(){var request=this.getRequestParams();var params={race_id:request.race_id,r_date:request.r_date};webApp.urlManager.changeLink($('#btnPredictor'),params);};this.makeBackButton=function(){var request=this.getRequestParams(),href;var raceTime=webApp.registry.get('meetingRacesTime');if(raceTime){href='#meeting-races/track_id='+request.track_id+'&r_time='+raceTime;}else{href='#meeting-list/r_date='+request.r_date;}
$('.btnBack').attr('href',href);};this.changeCardLinks=function(raceData){var params={race_id:raceData.raceId,r_date:raceData.raceDate};var mainData=this._getCache('card-header');var eventLabel=mainData.races[this.courseId].track+' '+raceData.raceTime+' '+raceData.raceDate;this._$tabsLinks.each(function(){webApp.urlManager.changeLink($(this),params);$(this).attr('data-eventlabel',eventLabel);});webApp.urlManager.changeLink($('#btnPredictor'),params);};this.cardBeforeRender=function(data){var request=this.getRequestParams();var mainData=this._getCache('card-header');this.saveRaceData();diffusionData={};this._fillDiffusionData(data.dogs);data.dogs=this._sortDogs(data.dogs,sortBy);data.courseName=mainData.races[this.courseId].track;data.courseCountry=mainData.country;data.raceId=request.race_id;data.raceDate=request.r_date;data.bookie=webApp.bookieCollection.getCurrentProviderName();return data;};this.formBeforeRender=function(data){var request=this.getRequestParams();var mainData=this._getCache('card-header');var raceDataTitle=this._getCache('card-title');var raceCardTabs=this._getCache('card-tabs');webApp.raceInfo=[];webApp.raceInfo.push(raceDataTitle);webApp.raceInfo.push(raceCardTabs);this.saveRaceData();diffusionData={};this._fillDiffusionData(data.dogs);data.dogs=this._sortDogs(data.dogs,sortBy);data.courseName=mainData.races[this.courseId].track;data.raceId=request.race_id;data.raceDate=request.r_date;webApp.raceInfo.push(data.raceDate);data.courseId=request.track_id;data.courseCountry=mainData.country;data.track_id=request.track_id;webApp.printHeader=data.courseName;return data;};this.saveRaceData=function(){var mainData=this._getCache('card-header');var raceId=this.getRequestParams().race_id;var races=mainData.races[this.courseId].races;var i;for(i in races){if(races[i].raceId===raceId){this.raceData=races[i];break;}}};this.statsBeforeRender=function(data){clearAllVacant(data.dogPerformance);clearAllVacant(data.trapRecord);clearAllVacant(data.recordAtThisGrade);clearAllVacant(data.trapTrackRecords);var statLength=data.dogPerformance.length;var i;var reservedTraps=data.reservedTraps;var vacantTraps=data.vacantTraps;var mainData=this._getCache('card-header');for(i=0;i<statLength;i++){data.dogPerformance[i].isVisible=!this.isReservedOrVacant(data.dogPerformance[i].num,reservedTraps,vacantTraps);data.recordAtThisGrade[i].isVisible=!this.isReservedOrVacant(data.recordAtThisGrade[i].num,reservedTraps,vacantTraps);data.trapRecord[i].isVisible=!this.isReservedOrVacant(data.trapRecord[i].num,reservedTraps,vacantTraps);data.trapTrackRecords[i].isVisible=!this.isReservedOrVacant(data.trapTrackRecords[i].num,reservedTraps,vacantTraps);}
data.courseName=mainData.races[this.courseId].track;return data;function clearAllVacant(array){for(record in array){if(array[record].vacant){array.splice(record,1);}}}};this.statsAfterRender=function(){this._setActiveTab('stats');this._checkCardTitle('stats');var iScrollOptions={};function Carousel(options){var $swipe=$('#statsList'),$list=$swipe.find('> ul'),$items=$list.find('> li');var defaultOpts={activeStep:0,isStartAnimate:false,$swipe:$swipe,$list:$list,$items:$items,lastItemOffset:20,prevItemOffset:10,onSwipe:null,onAnimationEnd:null};this.opts={};$.extend(this.opts,defaultOpts,options);this.activeStep=this.opts.activeStep;this.maxStepIndex=this.opts.$items.length-1;this.listOversizeWindow=null;this.isLastSticked=false;this.calculateSizes();this.bindCarouselEvents();}
Carousel.prototype.calculateSizes=function(){this.windowWidth=$(window).width();this.listOversizeWindow=$(this.opts.$list).width()-$(window).width();};Carousel.prototype.animateOnPos=function(position){this.opts.$list.css(webApp.cssVendor+'transform','translate('+position+'px, 0px) translateZ(0px)');};Carousel.prototype.bindCarouselEvents=function(){var me=this;me.opts.$list.bind('swipe.statsSwipe',me._swipeHandler.bind(me));me.opts.$list.bind('webkitTransitionEnd transitionend',me._animationEndHandler.bind(me));$(window).resize(me.windowResizeHandler.bind(me));};Carousel.prototype.windowResizeHandler=function(e){var me=this,listOversizeWOffset=me.listOversizeWindow+me.opts.lastItemOffset,activeTransitionSize=me.opts.$items.eq(me.activeStep)[0].offsetLeft,maxTransitionSize=me.opts.$items.eq(me.maxStepIndex)[0].offsetLeft;me.isLastSticked=false;me.calculateSizes();if(listOversizeWOffset<0){me.scrollToActiveItem(0,'right');me.activeStep=0;}
else if(listOversizeWOffset<maxTransitionSize&&listOversizeWOffset+me.opts.prevItemOffset<activeTransitionSize){me.isLastSticked=true;me.scrollToActiveItem(me.maxStepIndex,'right');}};Carousel.prototype.scrollToActiveItem=function(step,direction){var me=this;me.transitionSize=me.opts.$items.eq(step)[0].offsetLeft;if(me.listOversizeWindow<me.transitionSize){if(direction==='left'){step=me.maxStepIndex;me.animateOnPos(-me.listOversizeWindow-me.opts.lastItemOffset);return step;}
else{if(step<me.maxStepIndex){for(var i=step;i>=0;i--){var itemOffsetLeft=me.opts.$items.eq(i)[0].offsetLeft;if(me.listOversizeWindow>itemOffsetLeft){me.transitionSize=itemOffsetLeft;step=i;break;}}
me.animateOnPos(-me.transitionSize+(step===0?0:me.opts.prevItemOffset));return step;}
else{me.animateOnPos(-me.listOversizeWindow-me.opts.lastItemOffset);return step;}}}
else{me.animateOnPos(-me.transitionSize+(step===0?0:me.opts.prevItemOffset));return step;}};Carousel.prototype._swipeHandler=function(e,direction){if(this.opts.isStartAnimate||this.listOversizeWindow<=0){return;}
this.opts.isStartAnimate=true;if(direction==='left'){if(this.activeStep===this.maxStepIndex||this.isLastSticked){this.activeStep=0;}
else{this.activeStep++;}}
else if(direction==='right'){if(this.activeStep===0){this.activeStep=this.maxStepIndex;}
else{this.activeStep--;}}
this.activeStep=this.scrollToActiveItem(this.activeStep,direction);this.isLastSticked=false;if(this.opts.onSwipe){this.opts.onSwipe();}};Carousel.prototype._animationEndHandler=function(){this.opts.isStartAnimate=false;webApp.eventTracker.trackEventById('cards_stats_swipe',this.opts.$items.eq(this.activeStep).attr('data-eventlabel'));if(this.opts.onAnimationEnd){this.opts.onAnimationEnd();}};if(webApp.isDesktop){iScrollOptions={fadeScrollbars:false,mouseWheel:false,scrollbars:true,scrollX:true,scrollY:false,mouseWheelSpeed:100,interactiveScrollbars:true,preventDefault:false,useTransition:false,freeScroll:true,useTransform:true,scrollbars:'custom',click:false,tap:false,disableMouse:true};var horizontalScroll=new IScroll('#statsList',iScrollOptions);}
else{var carousel=new Carousel();}};this.tipsBeforeRender=function(data){var request=this.getRequestParams();var i;for(i in data.tips){if(request.race_id===data.tips[i].race_id){break;}}
data.currentRace=data.tips.splice(i,1)[0];return data;};this.tipsAfterRender=function(){this._setActiveTab('tips');this._checkCardTitle('tips');$('.tipsGrid a').bind('click.showOtherRace',function(){webApp.viewManager.flash();});webApp.registry.set('cardController',this.getName());webApp.registry.set('cardParams',this.getRequestParams());};this.formAfterRender=function(){var context=this;this._setActiveTab('form');this._checkCardTitle('form');var titleData=this._getCache('card-title');this._subscribePrices(titleData.priceTopicD5);var raceInfoTopic={topic:titleData.infoTopicD5.replace('PREFERRED_BOOKMAKER',webApp.PREFERRED_BOOKMAKER)};this._diffusionRaceInfoSession.subscribe(raceInfoTopic);$(document).on('click','.formGrid a',function(e){var urlManager=webApp.urlManager;var targetHash=$(e.target).attr('href');urlManager.setHash(urlManager.addParamToHash(targetHash,'back',1));e.preventDefault();});if(webApp.isDesktop===true){$('#doPrint').off();webApp.printForm.init($('#doPrint'));}
var raceName=$('.printRaceName');if(webApp.printHeader&&raceName.length>0&&raceName[0].innerHTML===''){raceName.html(webApp.printHeader);}};this.setEachWay=function(eachWay){this._eachWay=eachWay;};this.formOnDestroy=function(){this._unsubscribePrices();this._unsubscribeRaceInfo();webApp.printForm.remove();};this.cardAfterRender=function(){var context=this,$window=$(window),windowHeight=$window.height(),windowWidth=$window.width();this._setActiveTab('card');this._checkCardTitle('card');$('#toggleCardBtn').click(function(){webApp.viewManager.getScroll(context._name).refresh();});var titleData=this._getCache('card-title');this._subscribePrices(titleData.priceTopicD5);var raceInfoTopic={topic:titleData.infoTopicD5.replace('PREFERRED_BOOKMAKER',webApp.PREFERRED_BOOKMAKER)};this._diffusionRaceInfoSession.subscribe(raceInfoTopic);if(webApp.isDesktop){webApp.googleTagAds.proccessAds(windowWidth,windowHeight);}};this.cardOnDestroy=function(){this._unsubscribePrices();this._unsubscribeRaceInfo();var $window=$(window),windowHeight=$window.height(),windowWidth=$window.width(),opts={};opts.isCardTabDestroyed=true;webApp.googleTagAds.proccessAds(windowWidth,windowHeight,opts);};this._cachedDogs=null;this._getCachedDogs=function(){var cache;if(this._cachedDogs===null){cache=this._getCache('card')||this._getCache('form');this._cachedDogs=cache.dogs;}
return this._cachedDogs;};this._findDogInCacheByDiffusionName=function(diffusionName){var result=null,dogs=this._getCachedDogs();for(var i in dogs){if(dogs[i].diffusionName&&dogs[i].diffusionName==diffusionName){result=dogs[i];break;}}
return result;};this.acceptPrice=function(price){var view=this._core().getViewManager();var $historyBlock=$('#price-history-'+price.selectionName);var eventTracker=this._helper('eventTracker');var cachedDogData=this._findDogInCacheByDiffusionName(price.selectionName);var selectionName=cachedDogData&&cachedDogData.dogName;var priceBoxSelector='#bet-'+price.selectionName;var $priceBox=$(priceBoxSelector);var priceButtonSelector=priceBoxSelector;if(!selectionName){return;}
if(price.isSuspended){$(priceBoxSelector).empty();return;}
var bookie=webApp.bookieCollection.getCurrentBookieParams();var odds=webApp.userSettings.get('odds');if(odds==='decimal'){if(price.fractional==='SP'){price.price=price.fractional;}else{price.price=(Math.floor(parseFloat(price.decimal)*100)/100).toString();}}else{price.price=price.fractional;}
var $button=view.renderTpl('price-button',{price:price,bookie:bookie});var mainData=this._getCache('card-header');var selection=new rp.betting.Selection({id:price.selectionId,price:price.fractional==='SP'?null:{num:price.numerator,den:price.denominator},isSP:!!(price.fractional==='SP'),data:{selectionName:selectionName,courseName:mainData.races[this.courseId].track,courseNameAbbr:mainData.trackAbbrName,raceId:this.raceData.raceId,raceTs:moment.utc(this.raceData.raceDate+'T'+this.raceData.raceTime).unix()}});var _context=this;if(!price.isSuspended){$button.bind('click.betClick',function(){webApp.registry.set({backUrlHash:window.location.hash});var tabName=_context.getRequestParams().tab;var capitalized=tabName.charAt(0).toUpperCase()+tabName.slice(1);selection.eachWay(_context._eachWay);selection.data().isBOG=_context._BOG;var onAddMultModeCallback=function(){webApp.selectionsAlert.show(webApp.SelectionsManager.getSelections().length);};webApp.SelectionsManager.setOnAddMultModeCallback(onAddMultModeCallback);webApp.SelectionsManager.processPriceClick(selection,priceButtonSelector+' span',_context,bookie.name);});$button.bind(eventTracker.EVENT_CLICK_TRACK_EVENT,function(){var tabName=_context.getRequestParams().tab||'card';tabName=tabName.charAt(0).toUpperCase()+tabName.slice(1);var eventLabel=mainData.races[_context.courseId].track+' '+price.hours+':'+price.minutes+', '
+selectionName+' - '+bookie.name+' - Card - '+tabName;eventTracker.trackEventById('bets_price_click',eventLabel);});}
$priceBox.html($button);webApp.SelectionsManager.getSelections().length&&webApp.SelectionsManager.isSelected(selection)&&webApp.SelectionsManager.highlightSelectionPrice(priceButtonSelector+' span');};this.acceptPriceHistory=function(data){if(typeof data.topic==='undefined'){return;}
var context=this;var initParams={templates:'',callbacks:'',data:data,isShowDenominatorOne:true};var priceHistory=new diffusion.types.PriceHistory();priceHistory.init(initParams);var isSuspended=priceHistory._isSuspended();var $historyBlock=$('#price-history-'+priceHistory._getOutcomeName());var history=[];var odds=webApp.userSettings.get('odds');var price={selectionName:priceHistory._getOutcomeName(),name:priceHistory._getOutcomeUcFirstName(),isSuspended:isSuspended,decimal:priceHistory._getPriceDecimal(),fractional:priceHistory._getPriceFractional(),selectionId:data.data[0].split('|')[0]};var fractPrice=priceHistory._getPriceFractional();if(odds==='decimal'){history=priceHistory._getHistoryDecimal();}else{history=priceHistory._getHistoryFractional();}
diffusionData[priceHistory._getOutcomeName()]=priceHistory._getPriceDecimal();if($historyBlock){var historyArr=[];var i;for(i=0;i<4;i++){if(typeof history[i]==='undefined'||(odds==='decimal'&&isNaN(history[i]))){break;}
if(odds==='decimal'){historyArr.push((Math.floor(parseFloat(history[i])*100)/100).toString());}else{historyArr.push(history[i]);}}
historyArr.reverse();$historyBlock.html(historyArr.join(' <b>&gt;</b> '));if(isSuspended){$historyBlock.hide();}else{$historyBlock.show();}}
clearTimeout(oddsSortTimeId);oddsSortTimeId=setTimeout(function(context){if(typeof context!=='undefined'&&context.hasOwnProperty('sortByOdds')&&typeof context.sortByOdds==='function'){context.sortByOdds();}else{console.log('context.sortByOdds is not a function');}},300,this);};this._subscribePrices=function(priceTopicD5){var realTopic,context=this;if(priceTopicD5){this._getCachedDogs().forEach(function(dog){realTopic={topic:priceTopicD5.replace('PREFERRED_DOG',dog.dogName.toUpperCase()).replace('PREFERRED_BOOKMAKER',webApp.PREFERRED_BOOKMAKER)};context._diffusionPriceSession.subscribe(realTopic);});}}
this._unsubscribePrices=function(){if(this._diffusionPriceSession){this._diffusionPriceSession.unsubscribeAll();}};this._unsubscribeRaceInfo=function(){if(this._diffusionRaceInfoSession){this._diffusionRaceInfoSession.unsubscribeAll();}};this._fillDiffusionData=function(dogs){var i;for(i in dogs){diffusionData[dogs[i].diffusionName]=9999;}};this._sortDogs=function(dogs,sortBy){if(sortBy==='topSpeed'||sortBy==='trapNum'){dogs.sort(function(el1,el2){var val1=parseInt(el1[sortBy],10);var val2=parseInt(el2[sortBy],10);if(val1<val2){return 1;}else if(val1>val2){return-1;}else{return 0;}});}
return dogs;};this.sortByOdds=function(){var $container=$('#sortContainer');if(sortBy==='odds'&&$container){var sortArr=[];var count=0;var i;for(i in diffusionData){sortArr[count]=[i,diffusionData[i]];count++;}
sortArr=this._arrayToSort(sortArr);var $current=null;for(i in sortArr){var $next=$('#runner-'+sortArr[i][0]);if(!$current){$current=$next;$current.prependTo($container);}else{$current.after($next);}
$current=$next;}}};this._arrayToSort=function(arr){var i;for(i in arr){if(typeof arr[i][1]==='string'){arr[i][1]=arr[i][1].replace(/[^\d\.]/g,'');}}
arr.sort(function(i,ii){if(i[1]-ii[1]>0){return 1;}else{if(i[1]-ii[1]<0){return-1;}else{return 0;}}});return arr;};greyhoundbet.CardController.isShowLocation=function(trainerLocation,courseName,trackId){var irishTrackId=[21,40,41,43,44,45,47,49,51,52,53,54,55,56,88,58,46,72,59,48,57,42,71,50];if((irishTrackId.indexOf(+trackId)!==-1)&&trainerLocation.toUpperCase()==='IRELAND'){return false;}
if(trainerLocation===''){return false;}
if(courseName.toLowerCase()!=trainerLocation.toLowerCase()){return true;}
return false;};this.isReservedOrVacant=function(trapNum,reservedTraps,vacantTraps){if($.inArray(trapNum,reservedTraps)===-1&&$.inArray(trapNum,vacantTraps)===-1){return false;}
return true;};};webApp.extend(greyhoundbet.CardController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.PredictorController=function(name,config){greyhoundbet.PredictorController.superclass.constructor.call(this,name,config);var _context=this,_animateTimeId=null;this.raceData={};this._eachWay=null;this._BOG=false;this._preExecute=function(){this.setSelectionsOnAddConfirmDialog();this._diffusionRaceInfoSession=new window.rpDiffusion.default({onDataFunction:this.onRaceInfoReceived.bind(this)});this._diffusionPriceSession=new window.rpDiffusion.default({onDataFunction:this.onPriceReceived.bind(this)});};this.onRaceInfoReceived=function(WebClientMessage){var eachWay=new rp.models.EachWay(this.transformToLegacyRaceInfo(WebClientMessage));this.setEachWay(eachWay);var bog=this.transformToLegacyBOG(WebClientMessage);this.setBOG(bog);};this.transformToLegacyRaceInfo=function(WebClientMessage){return{data:WebClientMessage.getRecords()[0]};};this.transformToLegacyBOG=function(WebClientMessage){return{data:[(WebClientMessage.getRecords()[0][1]==='Y')?'1':'0']};};this.onPriceReceived=function(WebClientMessage){this.acceptPrice(this.transformToLegacyPrice(WebClientMessage));};this.transformToLegacyPrice=function(WebClientMessage){var dataFields=WebClientMessage.getFields(0);var topic=WebClientMessage.getTopic();var topicArr=topic.split('/');var raceDate=topicArr[1];var raceTime=topicArr[3];var dogName=topicArr[5];return{selectionId:dataFields[1],selectionName:dogName.replace(/ /g,'_'),raceTs:moment.utc(raceDate+'T'+raceTime).unix(),numerator:Number(dataFields[7].split('/')[0]),denominator:Number(dataFields[7].split('/')[1]),fractional:dataFields[7],decimal:dataFields[8],isSuspended:dataFields[6]==='H'}};this._postExecute=function(){$(window).bind(webApp.EVENT_CHANGE_ORIENTATION+'.predictorOrientation',function(){if(webApp.isMobile){_context._core().getViewManager().flash(_context.getName());_context.execute();}});};this.destroy=function(){$(window).unbind('.predictorOrientation');$(window).off('resize.predictor');};this.simulatorBeforeRender=function(data){this._runnersData=data.data;this.raceData=data.raceInfo;this._diffusion5InfoTopic=data.raceInfo.diffusion5InfoTopic;this._diffusion5PriceTopic=data.raceInfo.diffusion5PriceTopic;data.height=webApp.windowHeight+'px';data.orientation=webApp.orientation;data.isMobile=webApp.isMobile;data.windowWidth=$(window).width();data.raceId=data.raceInfo.raceId;data.rDate=data.raceInfo.raceDate.split(' ')[0];return data;};this.simulatorAfterRender=function(){var minDesktopWidth=320;var baseWidth=650;var defaultPaddingRight=75;var sizesRatio;var _context=this;var $dogs=$('#predictorList .gh');var dogsQuantity=$dogs.length;if(webApp.isMobile===false){$('#predictorList').addClass('big-dogs-size');changeGHScales();$(window).on('resize.predictor',changeGHScales);}
else{if(this.rerendered===undefined){$(window).trigger('orientationchange');this.rerendered=true;}}
function changeGHScales(){var windowWidth=$(window).width();var windowHeight=$(window).height();var upperAdHeight=$('.whAdContainer').is(':visible')?$('.whAdContainer').outerHeight(true):0;if(webApp.isDesktop){windowHeight=windowHeight-upperAdHeight;}
if($('.dogPredictor').length&&$('.dogPredictor').height()!=windowHeight){$('.dogPredictor').height(windowHeight);$('#webApp').height(windowHeight);}
else if($('.predictorPortrait').length&&$('.predictorPortrait').height()!=windowHeight){$('.predictorPortrait').height(windowHeight);$('#webApp').height(windowHeight);}
if(windowWidth>minDesktopWidth&&$('.dogPredictor').length>0){sizesRatio=(1-(baseWidth/$(window).width()))+1;if(sizesRatio<0.5){sizesRatio=0.5;}
$dogs.each(function(index,dog){$(dog).css(webApp.cssVendor+'transform','scale('+sizesRatio+')');$(dog).closest('li').css('paddingRight',defaultPaddingRight*sizesRatio);});}
else if($('.dogPredictor').length>0||(windowWidth>minDesktopWidth&&$('.dogPredictor').length===0)){_context._core().getViewManager().flash(_context.getName());_context.execute();}}
if(webApp.orientation==='Landscape'||($(window).width()>minDesktopWidth&&!webApp.isMobile&&!webApp.isTablet)){clearTimeout(_animateTimeId);var minTime=parseFloat(this.raceData.minPrediction);var maxTime=parseFloat(this.raceData.maxPrediction);var timeDiff=maxTime-minTime;var currentScale=greyhoundbet.predictorSettings.scale;while((timeDiff*currentScale)>greyhoundbet.predictorSettings.raceLineLength){currentScale=currentScale-0.1;}
_animateTimeId=setTimeout(function(){$('#predictorList .gh').each(function(index){var rightValue=Math.round((_context._runnersData[index].prediction-minTime)*currentScale*greyhoundbet.predictorSettings.dogSize);if(rightValue>78){rightValue=78;}
$(this).animate({right:rightValue+'%'},3000);});},300);var raceInfoTopic={topic:this._diffusion5InfoTopic.replace('PREFERRED_BOOKMAKER',webApp.PREFERRED_BOOKMAKER)};this._diffusionRaceInfoSession.subscribe(raceInfoTopic);this._subscribePrices(this._diffusion5PriceTopic);}};this._subscribePrices=function(priceTopicD5){var realTopic,context=this;if(priceTopicD5){this._runnersData.forEach(function(dog){realTopic={topic:priceTopicD5.replace('PREFERRED_DOG',dog.dogName.toUpperCase()).replace('PREFERRED_BOOKMAKER',webApp.PREFERRED_BOOKMAKER)};context._diffusionPriceSession.subscribe(realTopic);});}};this.simulatorOnDestroy=function(){this._diffusionRaceInfoSession.unsubscribeAll();this._diffusionPriceSession.unsubscribeAll();delete this._diffusionRaceInfoSession;delete this._diffusionPriceSession;};this.setBOG=function(data){this._BOG=(data.data[0]==='1')?true:false;};this.acceptPrice=function(price){var view=this._core().getViewManager(),odds=webApp.userSettings.get('odds'),priceBoxId='predictor-bet-'+price.selectionName,selectionName=this._findRunner('diffusionName',price.selectionName).dogName||'',priceButtonSelector='#'+priceBoxId+' span',eventTracker=this._helper('eventTracker');if(odds=='decimal'){price.price=(price.fractional==='SP')?'SP':(Math.floor(parseFloat(price.decimal)*100)/100).toString();}else{price.price=price.fractional;}
if(!selectionName){return;}
if(price.isSuspended){$(priceButtonSelector).empty();return;}
var bookie=webApp.bookieCollection.getCurrentBookieParams();var $button=view.renderTpl('price-button',{price:price,bookie:bookie});var $buttonContainer=$('#'+priceBoxId);var selection=new rp.betting.Selection({id:price.selectionId,price:price.fractional==='SP'?null:{num:price.numerator,den:price.denominator},isSP:!!(price.fractional==='SP'),data:{selectionName:selectionName,courseName:this.raceData.normalizedName,courseNameAbbr:this.raceData.normalizedAbbrName,raceId:this.raceData.raceId,raceTs:price.raceTs}});if(!price.isSuspended){$button.bind('click.betClick',function(){webApp.registry.set('backUrlHash',window.location.hash);selection.eachWay(_context._eachWay);selection.data().isBOG=_context._BOG;webApp.SelectionsManager.processPriceClick(selection,priceButtonSelector,_context);});}
$buttonContainer.html($button);webApp.SelectionsManager.getSelections().length&&webApp.SelectionsManager.isSelected(selection)&&webApp.SelectionsManager.highlightSelectionPrice(priceButtonSelector);};this.setEachWay=function(eachWay){this._eachWay=eachWay;};this._findRunner=function(property,value){var result={},runners=this._runnersData;for(var i in runners){if(runners[i][property]&&runners[i][property]==value){result=runners[i];break;}}
return result;};};webApp.extend(greyhoundbet.PredictorController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.FormExplainedController=function(name,config){greyhoundbet.FormExplainedController.superclass.constructor.call(this,name,config);};webApp.extend(greyhoundbet.FormExplainedController,webApp.AbstractNodataCredentialsController);
var greyhoundbet=greyhoundbet||{},webApp=webApp||{},utils=utils||{};greyhoundbet.ResultsListController=function(name,config){greyhoundbet.ResultsListController.superclass.constructor.call(this,name,config);this._preExecute=function(){if(!webApp.isDesktop&&this.accessedFromBookmark()){this._redirectAndExit('meeting-list');}
var request=this.getRequestParams(),requestDate=request.r_date,todayStr=utils.date.toString(utils.date.getSynchronizedToServerNow()),dateStr=requestDate||'',buttonDate=new Date(requestDate),todayTmp=todayStr.split("-"),dateTmp=dateStr.split("-"),today=new Date(todayTmp[0],(todayTmp[1]-1),todayTmp[2]),date=new Date(dateTmp[0],(dateTmp[1]-1),dateTmp[2]);if(!requestDate||!utils.date.isDate(requestDate)||(date.getTime()>today.getTime())){request.r_date=todayStr;this._redirectAndExit(this.getName(),request);return;}
var $resultButton=$('#resultsDateBtn');var resultButtonText='';if(+requestDate.substring(0,4)<new Date().getFullYear()){resultButtonText=buttonDate.format('dd mmm')+' '+buttonDate.format('yyyy').substring(2,4);}
else{resultButtonText=buttonDate.format('mmm dd');}
$resultButton.html(resultButtonText);$(window).bind(webApp.EVENT_CHANGE_ORIENTATION,function(){webApp.Calendar.setOrientation(webApp.orientation.toLowerCase());});};this.headerAfterRender=function($block){var $resultButton=$('#resultsDateBtn'),buttonDate=new Date(webApp.urlManager.getParams()[1]['r_date']),resultButtonText='';if(buttonDate.getFullYear()<new Date().getFullYear()){resultButtonText=buttonDate.format('dd mmm')+' '+buttonDate.format('yyyy').substring(2,4);}
else{resultButtonText=buttonDate.format('mmm dd');}
$resultButton.html(resultButtonText).on('click',function(){webApp.Calendar.show();setTimeout(function(){$('.calendarControll').focus();},0)});};this.meetingsAfterRender=function($block){var context=this,request=this.getRequestParams();function parseTimeTo12h(time){var arr=time.replace(' ','').split(':');var timeConv={1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:1,14:2,15:3,16:4,17:5,18:6,19:7,20:8,21:9,22:10,23:11};return timeConv[arr[0]]+':'+arr[1];}
if(!webApp.isMobile){$.each($('.results-race-list-row div'),function(index,current){$(current).html(parseTimeTo12h($(current).html()));});$.each($('.results-race-list-row > a'),function(index,current){$(current).html(parseTimeTo12h($(current).html()));});}
$('#latestResults').click(function(e){webApp.eventTracker.trackEventById('results_latest');context._redirect('results-latest',{r_date:request.r_date});e.preventDefault();return false;});webApp.searchFormInit();if(!webApp.isDesktop){webApp.viewManager.getScroll(this._name).scrollTo(0,-44,0);}};this.meetingsBeforeRender=function(data){var context=this;$.each(data.tracks,function(section){if(data.tracks[section].races==undefined){return;}
data.tracks[section].races.sort(context._sortTrackByFirstRace);for(var i=0,len=data.tracks[section].races.length;i<len;i++){for(var j=0,k=data.tracks[section].races[i].races.length;j<k;j++){data.tracks[section].races[i].videoAvailable=false;var currentRaceData=data.tracks[section].races[i].races[j];if(currentRaceData.videoid&&currentRaceData.clipId){data.tracks[section].races[i].videoAvailable=true;break;}}}});return data;};this._sortTrackByFirstRace=function(a,b){var timeA=utils.date.fromString(a.firstRace,0);var timeB=utils.date.fromString(b.firstRace,0);if(timeA<timeB){return-1;}
if(timeA>timeB){return 1;}
return 0;};};webApp.extend(greyhoundbet.ResultsListController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.ResultMeetingController=function(name,config){greyhoundbet.ResultMeetingController.superclass.constructor.call(this,name,config);this._preExecute=function(){if(!webApp.isDesktop&&this.accessedFromBookmark()){this._redirectAndExit('meeting-list');}};this.listBeforeRender=function(data){$('.pageHeader #headerTitle').html(data.track.track);var request=this.getRequestParams();var i=0;data.rDate=request.r_date;data.rTime=request.r_time;var deadheatsArray=[];for(var heat in data.deadHeats){for(i=0;i<data.deadHeats[heat].length;i++){if(data.deadHeats[heat][i]==='1st'){deadheatsArray.push({deadheatRace:heat,deadheatPosition:'1st'});}
if(data.deadHeats[heat][i]==='2nd'){deadheatsArray.push({deadheatRace:heat,deadheatPosition:'2nd'});}
if(data.deadHeats[heat][i]==='3rd'){deadheatsArray.push({deadheatRace:heat,deadheatPosition:'3rd'});}}}
var distancesResults=[];var deadheatFor3rdRaceId=[];for(var race in data.track.results){data.track.results[race].forEach(function(curVal,index,races){if(curVal.position==='1'){distancesResults.push({raceId:curVal.raceId,position:1,distances:curVal.rpDistDesc});}
if(curVal.position==='2'){distancesResults.push({raceId:curVal.raceId,position:2,distances:curVal.rpDistDesc});}
if(curVal.position==='3'){distancesResults.push({raceId:curVal.raceId,position:3,distances:curVal.rpDistDesc});}});}
for(i=0;i<deadheatsArray.length;i++){if(deadheatsArray[i].deadheatPosition==='3rd'){deadheatFor3rdRaceId.push(deadheatsArray[i].deadheatRace);}}
var deadheat3rdRacesString='';for(i=0;i<deadheatFor3rdRaceId.length;i++){deadheat3rdRacesString+=deadheatFor3rdRaceId[i]+' ';}
var tempArr=[];for(i=0;i<distancesResults.length;i++){if((distancesResults[i+1]&&distancesResults[i].position===2&&distancesResults[i+1].position===3&&distancesResults[i].distances!==''&&distancesResults[i+1]!==''&&distancesResults[i].raceId===distancesResults[i+1].raceId)||(distancesResults[i+1]&&distancesResults[i].position===2&&distancesResults[i+1].position===3&&deadheat3rdRacesString.search(distancesResults[i].raceId)!==-1)){tempArr.push({raceId:distancesResults[i].raceId,distance:distancesResults[i].distances+', '+distancesResults[i+1].distances});}else if(distancesResults[i+1]&&distancesResults[i].position===2&&distancesResults[i+1].position===3&&distancesResults[i].distances!==''&&distancesResults[i+1]===''&&distancesResults[i].raceId===distancesResults[i+1].raceId){tempArr.push({raceId:distancesResults[i].raceId,distance:distancesResults[i].distances});}else if(distancesResults[i+1]&&distancesResults[i].position===2&&distancesResults[i+1].position===3&&distancesResults[i].distances===''&&distancesResults[i+1]!==''&&distancesResults[i].raceId===distancesResults[i+1].raceId){tempArr.push({raceId:distancesResults[i+1].raceId,distance:distancesResults[i+1].distances});}else if(distancesResults[i+1]&&(distancesResults[i].distances==='dht'||distancesResults[i+1].distances==='dht')&&distancesResults[i].distances!==''&&distancesResults[i+1]!==''&&distancesResults[i].raceId===distancesResults[i+1].raceId&&deadheat3rdRacesString.search(distancesResults[i].raceId)===-1){tempArr.push({raceId:distancesResults[i].raceId,distance:distancesResults[i].distances+', '+distancesResults[i+1].distances});}else if(distancesResults[i+1]&&(distancesResults[i].distances==='dht'||distancesResults[i+1].distances==='dht')&&!distancesResults[i].distances&&distancesResults[i+1]!==''&&distancesResults[i].raceId===distancesResults[i+1].raceId&&deadheat3rdRacesString.search(distancesResults[i].raceId)===-1){tempArr.push({raceId:distancesResults[i+1].raceId,distance:distancesResults[i+1].distances});}if(distancesResults[i+1]&&(distancesResults[i].distances==='dht'||distancesResults[i+1].distances==='dht')&&!distancesResults[i+1].distances&&distancesResults[i]!==''&&distancesResults[i].raceId===distancesResults[i+1].raceId&&deadheat3rdRacesString.search(distancesResults[i].raceId)===-1){tempArr.push({raceId:distancesResults[i].raceId,distance:distancesResults[i].distances});}}
data.distancesResults=tempArr;for(race in data.track.results){for(i=0;i<data.track.results[race].length;i++){for(var j=0;j<tempArr.length;j++){if(data.track.results[race][i].raceId===tempArr[j].raceId){data.track.results[race][i].distancesResults=tempArr[j].distance;for(var k=0;k<deadheatsArray.length;k++){if(deadheatsArray[k].deadheatRace===data.track.results[race][i].raceId){data.track.results[race][i].deadheatPosition=deadheatsArray[k].deadheatPosition;}}}}}}
return data;};this.listAfterRender=function(data){var deadheatTimes1=$('.is-deadheat-1st.deadheat-time').filter(':odd');var deadheatDistances1=$('.is-deadheat-1st.deadheat-distance').filter(':even');var deadheatDistances2=$('.is-deadheat-2nd').filter(':even');if($('.is-deadheat-1st').length>1){$(deadheatTimes1).addClass('deadheat-hide');$(deadheatDistances1).addClass('deadheat-hide');}
if($('.is-deadheat-2nd').length>1){$(deadheatDistances2).addClass('deadheat-hide');}
return data;};this.headerBeforeRender=function(data){var request=this.getRequestParams();data.rDate=request.r_date;data.trackId=request.track_id;data.rTime=request.r_time;data.href='#result-meeting/track_id='+request.track_id+'&r_date='+request.r_date+'&r_time='+request.r_time;return data;};this.headerAfterRender=function($header){var request=this.getRequestParams();var context=this;var date=utils.date.fromString(request.r_date+' 00:00',0);var resultButtonText='';if(date.getFullYear()<new Date().getFullYear()){resultButtonText=date.format('dd mmm')+' '+date.format('yyyy').substring(2,4);}
else{resultButtonText=date.format('mmm dd');}
$('.btnBack').attr('href','#results-list/r_date='+request.r_date).html('<span>'+resultButtonText+'</span>').click(function(){webApp.eventTracker.trackEventById('results_back_to_list',date.format("yyyy-mm-dd"));});$('.btnRefresh').click(function(){webApp.eventTracker.trackEventById('results_refresh');context._refreshList();});};this._refreshList=function(){var _context=this;_context._clearCache('list');_context.execute();};};webApp.extend(greyhoundbet.ResultMeetingController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.ResultsLatestController=function(name,config){greyhoundbet.ResultsLatestController.superclass.constructor.call(this,name,config);this.latestHeaderBeforeRender=function(data){var raceDate=this.getRequestParams().r_date;data.rDate=raceDate||'';data.href='#results-latest/r_date='+raceDate;return data;};this.latestHeaderAfterRender=function($header){var request=this.getRequestParams(),context=this;$header.find('#headerTitle').html('Latest results');$('.btnBack').html('<span>'+(utils.date.fromString(request.r_date+' 00:00',0).format("mmm dd"))+' </span>').click(function(){webApp.eventTracker.trackEventById('results_back_to_list',utils.date.fromString(request.r_date+' 00:00',0).format('yyyy-mm-dd'));});$('.btnRefresh').click(function(){webApp.eventTracker.trackEventById('results_refresh');context._refreshList();});};this._refreshList=function(){var _context=this;_context._clearCache('latestList');_context.execute();};this.latestListBeforeRender=function(data){var i,deadheatsArray=[];if(!data.results){return data;}
for(var heat in data.deadHeats){for(i=0;i<data.deadHeats[heat].length;i++){if(data.deadHeats[heat][i]==='1st'){deadheatsArray.push({deadheatRace:heat,deadheatPosition:'1st'});}
if(data.deadHeats[heat][i]==='2nd'){deadheatsArray.push({deadheatRace:heat,deadheatPosition:'2nd'});}
if(data.deadHeats[heat][i]==='3rd'){deadheatsArray.push({deadheatRace:heat,deadheatPosition:'3rd'});}}}
var distancesResults=[];var deadheatFor3rdRaceId=[];for(var race in data.results){data.results[race].forEach(function(curVal,index,races){if(curVal.position==='1'){distancesResults.push({raceId:curVal.raceId,position:1,distances:curVal.rpDistDesc});}
if(curVal.position==='2'){distancesResults.push({raceId:curVal.raceId,position:2,distances:curVal.rpDistDesc});}
if(curVal.position==='3'){distancesResults.push({raceId:curVal.raceId,position:3,distances:curVal.rpDistDesc});}});}
for(i=0;i<deadheatsArray.length;i++){if(deadheatsArray[i].deadheatPosition==='3rd'){deadheatFor3rdRaceId.push(deadheatsArray[i].deadheatRace);}}
var deadheat3rdRacesString='';for(i=0;i<deadheatFor3rdRaceId.length;i++){deadheat3rdRacesString+=deadheatFor3rdRaceId[i]+' ';}
var tempArr=[];for(i=0;i<distancesResults.length;i++){if((distancesResults[i+1]&&distancesResults[i].position===2&&distancesResults[i+1].position===3&&distancesResults[i].distances!==''&&distancesResults[i+1]!==''&&distancesResults[i].raceId===distancesResults[i+1].raceId)||(distancesResults[i+1]&&distancesResults[i].position===2&&distancesResults[i+1].position===3&&deadheat3rdRacesString.search(distancesResults[i].raceId)!==-1)){tempArr.push({raceId:distancesResults[i].raceId,distance:distancesResults[i].distances+', '+distancesResults[i+1].distances});}else if(distancesResults[i+1]&&distancesResults[i].position===2&&distancesResults[i+1].position===3&&distancesResults[i].distances!==''&&distancesResults[i+1]===''&&distancesResults[i].raceId===distancesResults[i+1].raceId){tempArr.push({raceId:distancesResults[i].raceId,distance:distancesResults[i].distances});}else if(distancesResults[i+1]&&distancesResults[i].position===2&&distancesResults[i+1].position===3&&distancesResults[i].distances===''&&distancesResults[i+1]!==''&&distancesResults[i].raceId===distancesResults[i+1].raceId){tempArr.push({raceId:distancesResults[i+1].raceId,distance:distancesResults[i+1].distances});}else if(distancesResults[i+1]&&(distancesResults[i].distances==='dht'||distancesResults[i+1].distances==='dht')&&distancesResults[i].distances!==''&&distancesResults[i+1]!==''&&distancesResults[i].raceId===distancesResults[i+1].raceId&&deadheat3rdRacesString.search(distancesResults[i].raceId)===-1){tempArr.push({raceId:distancesResults[i].raceId,distance:distancesResults[i].distances+', '+distancesResults[i+1].distances});}else if(distancesResults[i+1]&&(distancesResults[i].distances==='dht'||distancesResults[i+1].distances==='dht')&&!distancesResults[i].distances&&distancesResults[i+1]!==''&&distancesResults[i].raceId===distancesResults[i+1].raceId&&deadheat3rdRacesString.search(distancesResults[i].raceId)===-1){tempArr.push({raceId:distancesResults[i+1].raceId,distance:distancesResults[i+1].distances});}if(distancesResults[i+1]&&(distancesResults[i].distances==='dht'||distancesResults[i+1].distances==='dht')&&!distancesResults[i+1].distances&&distancesResults[i]!==''&&distancesResults[i].raceId===distancesResults[i+1].raceId&&deadheat3rdRacesString.search(distancesResults[i].raceId)===-1){tempArr.push({raceId:distancesResults[i].raceId,distance:distancesResults[i].distances});}}
data.distancesResults=tempArr;for(race in data.results){for(i=0;i<data.results[race].length;i++){for(var j=0;j<tempArr.length;j++){if(data.results[race][i].raceId===tempArr[j].raceId){data.results[race][i].distancesResults=tempArr[j].distance;for(var k=0;k<deadheatsArray.length;k++){if(deadheatsArray[k].deadheatRace===data.results[race][i].raceId){data.results[race][i].deadheatPosition=deadheatsArray[k].deadheatPosition;}}}}}}
return data;};this.latestListAfterRender=function(data){var deadheatTimes1=$('.is-deadheat-1st.deadheat-time').filter(':odd');var deadheatDistances1=$('.is-deadheat-1st.deadheat-distance').filter(':even');var deadheatDistances2=$('.is-deadheat-2nd').filter(':even');var context=this;if($('.is-deadheat-1st').length>1){$(deadheatTimes1).addClass('deadheat-hide');$(deadheatDistances1).addClass('deadheat-hide');}
if($('.is-deadheat-2nd').length>1){$(deadheatDistances2).addClass('deadheat-hide');}
this.refreshTimer=setInterval(function(){context._refreshList();},30000);return data;};this.latestListOnDestroy=function(){clearInterval(this.refreshTimer);};};webApp.extend(greyhoundbet.ResultsLatestController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};var webApp=webApp||{};greyhoundbet.ResultMeetingResultController=function(name,config){greyhoundbet.ResultMeetingResultController.superclass.constructor.call(this,name,config);var context=this;var getFirstRaceTimeFromCache=function(){var trackData=context._getCache('list').track;return trackData.firstRace.split(' ')[1];};this.playerParams={};this._preExecute=function(){if(!webApp.isDesktop&&this.accessedFromBookmark()){this._redirectAndExit('meeting-list');}};this._postExecute=function(){$('.btnRefresh').hide();};this.meetingHeaderBeforeRender=function(data){var request=this.getRequestParams();data.searchDog=request.search?request.search:false;if(request.back||data.searchDog){data.displayBack=true;}
return data;};this.listBeforeRender=function(data){var request=this.getRequestParams(),prizeSterling,context=this;data.collectionJorney=context.collectionJorney;data.rDate=request.r_date;data.trackId=request.track_id;data.raceId=request.race_id;data.raceInstanceId=request.race_id;this.races=[];$.each(data.track.races,function(i,race){if(data.track.results.hasOwnProperty(race.raceId)){race.raceTime=race.raceDate.split(' ')[1];prizeSterling=+race.racePrize;race.racePrize=prizeSterling.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,");context.races.push(race);}
if(race.raceId===data.raceId){data.r_Time=race.raceDate.split(' ')[1];race.clipId?context.playerParams={videoIsAvailable:true,videoId:race.videoid,startSec:race.startSec,endSec:race.endSec,streamDate:request.r_date.slice(0,7).replace('-','_')}:context.playerParams={videoIsAvailable:false};}
race.goTypeNum=context.decorateGoing(race.goTypeNum);});var dateInHeader=this.processDate(request.r_date);$('.pageHeader #headerTitle').html('<span class="rTitle">'+data.track.track+" "+dateInHeader+'</span>');if($('.pageHeader #headerTitle').width()<$('.pageHeader #headerTitle > .rTitle').width()){$('.pageHeader #headerTitle').html('<span class="rTitle">'+data.track.trackShortName+" "+dateInHeader+'</span>');}
return data;};this.decorateGoing=function(going){var result=null;var goingAsInt=parseInt(going);if(isNaN(goingAsInt)){result='';}else{if(goingAsInt>0){result='+'+going;}else if(goingAsInt==0){result='N';}else{result=going;}}
return result;};this.processDate=function(date){var date=new Date(date.replace(/(\d+)-(\d+)-(\d+)/,'$2/$3/$1'));var values=[date.getDate(),date.getMonth()+1];for(var id in values){values[id]=values[id].toString().replace(/^([0-9])$/,'0$1');}
return values[0]+'/'+values[1]+'/'+String(date.getFullYear()).slice(2);};this.initResultPager=function($block){var cacheData=this._getCache('list');var request=this.getRequestParams();var context=this;cacheData.rDate=request.r_date;cacheData.trackId=request.track_id;cacheData.raceId=request.race_id;var races=[];$.each(cacheData.track.races,function(i,race){if(cacheData.track.results.hasOwnProperty(race.raceId)&&cacheData.track.results[race.raceId]&&cacheData.track.results[race.raceId][0].finalROutcomeId!='18'){race.raceTime=race.raceDate.split(' ')[1];races.push(race);}
if(race.raceId===cacheData.raceId){cacheData.rTime=race.raceDate.split(' ')[1];}});pager=new greyhoundbet.racePager({data:races,urlParams:request,prevSelector:'#pagerPrevResult',nextSelector:'#pagerNextResult',timeSelector:'#pagerResultTime'});};this.listAfterRender=function(data){function formatDateMMMDD(unformatedDate){var dateStr,month=unformatedDate[1],year=unformatedDate[0];year=year.replace(/\b\d\d/,'');var formatMonth={1:'Jan',2:'Feb',3:'Mar',4:'Apr',5:'May',6:'Jun',7:'Jul',8:'Aug',9:'Sep',10:'Oct',11:'Nov',12:'Dec'};if(month.search(/0\d/)!==-1){month=month.replace(/0/,'');}
dateStr=formatMonth[month]+' '+year;return dateStr;}
if(webApp.isMobile===false){$.each($('.dog-result-details .dog-color'),function(index,current){$(current).html($(current).html().replace(/\s/g,''));});$.each($('.dog-result-details .dog-sex'),function(index,current){$(current).html($(current).html().toLowerCase());});$.each($('.dog-result-details .dog-sire-dam'),function(index,current){var arrayOfSireAndDam=$(current).html().toLowerCase().split(' ');$.each(arrayOfSireAndDam,function(index,curVal){var firstLetter=curVal.substr(0,1);var restOfString=curVal.substr(1);curVal=firstLetter.toUpperCase().concat(restOfString);arrayOfSireAndDam[index]=curVal;});$(current).html(arrayOfSireAndDam.join(' ').replace(/\s-\s/,'-'));});$.each($('.dog-result-details .dog-date-of-birth'),function(index,current){var dateOfBirth=$(current).html().split(' ');var arrayOfDateParts=dateOfBirth[1].split('-');$(current).html(formatDateMMMDD(arrayOfDateParts));});}
if(webApp.isAndroid&&this.playerParams.videoIsAvailable){var streamUrl='rtmp://greyh.fod.performgroup.com/fod/mp4:arc/flv/323/'+this.playerParams.streamDate+'/'+this.playerParams.videoId+'.mp4';var pathName='/fod/mp4:arc/flv/323/'+this.playerParams.streamDate+'/'+this.playerParams.videoId+'.mp4';var videoStartTime=this.playerParams.startSec;var raceStartSec=this.playerParams.startSec%60;var raceSrartMin=(this.playerParams.startSec-raceStartSec)/60;var videoMessage='The race will starts at '+raceSrartMin+':'+raceStartSec+' of this video';var urlParams={url:streamUrl,host:'greyh.fod.performgroup.com',pathName:pathName,protocol:'rtmp',message:videoMessage};$('.androidArchiveVideo').on('click',function(){webApp.confirmPopup({tpl:'video-popup',urlParams:urlParams});});}};this.collectionJorney='results';};webApp.extend(greyhoundbet.ResultMeetingResultController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.CardMeetingResultController=function(name,config){greyhoundbet.CardMeetingResultController.superclass.constructor.call(this,name,config);this._preExecute=function(){if(!webApp.isDesktop&&this.accessedFromBookmark()){this._redirectAndExit('meeting-list');}};this.collectionJorney='cards';};webApp.extend(greyhoundbet.CardMeetingResultController,greyhoundbet.ResultMeetingResultController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.ResultsFormExplainedController=function(name,config){greyhoundbet.ResultsFormExplainedController.superclass.constructor.call(this,name,config);};webApp.extend(greyhoundbet.ResultsFormExplainedController,webApp.AbstractNodataCredentialsController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.ResultsDogController=function(name,config){greyhoundbet.ResultsDogController.superclass.constructor.call(this,name,config);this.resultsDogHeaderBeforeRender=function(data){var request=this.getRequestParams();data.raceTime=request.r_time;return data;};this.resultsDogHeaderAfterRender=function(){webApp.eventTracker=new webApp.GaEventTracker();webApp.eventTracker.setEventsConfig(webApp.gaEvents);webApp.eventTracker.setDeviceOrientation(webApp.core.getOrientation());var request=this.getRequestParams();$('#dogResultBack').click(function(){webApp.eventTracker.trackEventById('results_back_to_result');});var pagerData=this._prepareDataForPager(this._getCache('results-dog-header'));this._pager=new webApp.simplePager({data:pagerData,urlParams:this.getRequestParams(),urlValue:'dog_id',loop:true,countSelector:'#serialPos'});};this.resultsDogDetailsBeforeRender=function(data){data.isResult=true;data.collectionJorney=this.collectionJorney;webApp.dogCareerDataForSort=data;for(var i=0;i<webApp.dogCareerDataForSort.forms.length;i++){webApp.dogCareerDataForSort.forms[i].index=i;}
return data;};this.resultsDogDetailsAfterRender=function(){$(document).on('click.formMeetingLink','.formGrid a',function(e){var urlManager=webApp.urlManager;var targetHash=$(e.target).attr('href');var currentHash=urlManager.getHash();urlManager.setHash(urlManager.addParamToHash(targetHash,'back',1));e.preventDefault();});webApp.sortableColumns.init($('#sortableTable'));};this._prepareDataForPager=function(pagerData){var result=[];var data=pagerData;if(data.hasOwnProperty('dogs')){$.each(data.dogs,function(key){result.push(data.dogs[key].dogId);});}
return result;};this.collectionJorney='results';this.destroy=function(){$(document).unbind('.formMeetingLink');};};webApp.extend(greyhoundbet.ResultsDogController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.CardDogController=function(name,config){greyhoundbet.CardDogController.superclass.constructor.call(this,name,config);this._preExecute=function(){if(!webApp.isDesktop&&this.accessedFromBookmark()){this._redirectAndExit('meeting-list');}};this.collectionJorney='cards';this.resultsDogDetailsBeforeRender=function(data){data.isResult=false;data.collectionJorney=this.collectionJorney;webApp.dogCareerDataForSort=data;for(var i=0;i<webApp.dogCareerDataForSort.forms.length;i++){webApp.dogCareerDataForSort.forms[i].index=i;}
return data;};};webApp.extend(greyhoundbet.CardDogController,greyhoundbet.ResultsDogController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.ResultVideoController=function(name,config){greyhoundbet.ResultVideoController.superclass.constructor.call(this,name,config);this.clipStartSec=null;this.clipEndSec=null;this.hideRaceDetails=false;this._preExecute=function(){if(!webApp.isDesktop&&this.accessedFromBookmark()){this._redirectAndExit('meeting-list');}};this.playerDataBeforeRender=function(){var request={},playerData={},streamDate='',streamVideoId='',streamUrl='',isFireFox=0,isIE=webApp.isIE;request=this.getRequestParams();this.clipStartSec=request.start_sec;this.clipEndSec=request.end_sec;streamDate=request.r_date.slice(0,7).replace('-','_');streamVideoId=request.video_id;streamUrl='rtmp://greyh.fod.performgroup.com/fod/mp4:arc/flv/323/'+streamDate+'/'+streamVideoId+'.mp4';if(navigator.userAgent.toLowerCase().indexOf('firefox')!==-1){isFireFox=1;}
playerData={clipId:request.clip_id,streamUrl:streamUrl,isFireFox:isFireFox,isIE:isIE};return playerData;};this.listBeforeRender=function(data){var request=this.getRequestParams(),prizeSterling,context=this;data.collectionJorney=context.collectionJorney;data.rDate=request.r_date;data.trackId=request.track_id;data.raceId=request.race_id;data.raceInstanceId=request.race_id;this.races=[];$.each(data.track.races,function(i,race){if(data.track.results.hasOwnProperty(race.raceId)){race.raceTime=race.raceDate.split(' ')[1];prizeSterling=+race.racePrize;race.racePrize=prizeSterling.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,");context.races.push(race);}
if(race.raceId===data.raceId){data.r_Time=race.raceDate.split(' ')[1];}
race.goTypeNum=context.decorateGoing(race.goTypeNum);});return data;};this.playerDataAfterRender=function(){var context=this;var isFlashPluginAvailable=false;if(navigator.userAgent.toLowerCase().indexOf('firefox')!==-1||webApp.isIE){webApp.dataLoading.show('Loading Video');this.player=new MediaElementPlayer('#video-tag',{features:['volume'],clickToPlayPause:false,success:function(mediaElement,domObject){var seeked=false;mediaElement.addEventListener('play',function(e){if(!seeked){seeked=true;mediaElement.setCurrentTime(context.clipStartSec);};},false);mediaElement.addEventListener('timeupdate',function(e){if(e.currentTime>context.clipEndSec){mediaElement.stop();seeked=false;}},false);mediaElement.addEventListener('progress',function(e)
{webApp.dataLoading.hide();},false);},error:function(){webApp.dataLoading.hide();console.log('OPTS: Video player error');}});}
isFlashPluginAvailable=navigator.plugins["Shockwave Flash"];if(webApp.isDesktop&&!webApp.isIE10&&!isFlashPluginAvailable){alert('Please install Adobe Flash Plug-in to access this functionality');$('.playerContainer').hide();this.hideRaceDetails=true;}};this.listAfterRender=function(){if(this.hideRaceDetails){$('.archiveDetails').hide();}};this.onDestroyCallback=function(){if(document.querySelector('#video-tag')){document.querySelector('#video-tag').onerror=function(e){e.preventDefault();return true}}
var context=this;if(webApp.isIE){createFakeMejsElement();}
function createFakeMejsElement(){if(context.player&&$('.mejs-shim').length>0){var id=$('.mejs-shim').attr('id');context.player.remove();$('#video-tag').remove();$('#'+id).remove();var fakeDiv=document.createElement('div');fakeDiv.id=id;fakeDiv.SetReturnValue=function(){return true;};$('body').append(fakeDiv);}}};this.decorateGoing=function(going){var result=null;var goingAsInt=parseInt(going);if(isNaN(goingAsInt)){result='';}else{if(goingAsInt>0){result='+'+going;}else if(goingAsInt==0){result='N';}else{result=going;}}
return result;};};webApp.extend(greyhoundbet.ResultVideoController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.CardVideoController=function(name,config){greyhoundbet.CardVideoController.superclass.constructor.call(this,name,config);this._preExecute=function(){if(!webApp.isDesktop&&this.accessedFromBookmark()){this._redirectAndExit('meeting-list');}};};webApp.extend(greyhoundbet.CardVideoController,greyhoundbet.ResultVideoController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.NewsHomeController=function(name,config){greyhoundbet.NewsHomeController.superclass.constructor.call(this,name,config);this._preExecute=function(){this._setCache('header',{});};this.bindRefresh=function(){var context=this;webApp.eventTracker=new webApp.GaEventTracker();webApp.eventTracker.setEventsConfig(webApp.gaEvents);webApp.eventTracker.setDeviceOrientation(webApp.core.getOrientation());$('#refreshNewsList').click(function(){webApp.eventTracker.trackEventById('news_refresh');context._refreshNewsList();});};this._refreshNewsList=function(){this._clearCache('news-list');this._core().getCacheManager().clearCache(this._getBlockDefaultCacheId('news-story','top-nav'));this.execute();};};webApp.extend(greyhoundbet.NewsHomeController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.NewsStoryController=function(name,config){greyhoundbet.NewsStoryController.superclass.constructor.call(this,name,config);var _pager=null;this.topNavAfterRender=function(){webApp.eventTracker=new webApp.GaEventTracker();webApp.eventTracker.setEventsConfig(webApp.gaEvents);webApp.eventTracker.setDeviceOrientation(webApp.core.getOrientation());$('#newsBackToAll').click(function(){webApp.eventTracker.trackEventById('news_back_to_all');});var pagerData=this._prepareDataForPager(this._getCache('top-nav'));var params=this.getRequestParams();this._pager=new webApp.simplePager({data:pagerData,urlParams:params,loop:false});};this._prepareDataForPager=function(pagerData){var result=[];var data=pagerData;if(data.hasOwnProperty('topNews')){$.each(data.topNews,function(key){result.push(data.topNews[key].id);});}
return result;};this.contentBeforeRender=function(data){if(this._pager){this._pager.renew(data['id']);}
return data;};};webApp.extend(greyhoundbet.NewsStoryController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.BetSlipController=function(name,config){greyhoundbet.BetSlipController.superclass.constructor.call(this,name,config);this.headerBeforeRender=function(data){var cacheManager=this._core().getCacheManager();if(cacheManager.isCached('card_title')){var cache=cacheManager._findCache('card_title');data.crsId=cache.keys.crs_id;data.raceDate=cache.keys.r_date;data.raceId=cache.keys.race_id;}
data=this.addCredentialsToView(data);data.currency=this.currencyView(this.currency);data.currencyCode=this.currency;data.bets=this.betslip.bets();return data;};this.mainBeforeRender=function(data){data=this.addCredentialsToView(data);data.currency=this.currencyView(this.currency);data.currencyCode=this.currency;var currSelectionsCount=this.selectionsCollection.selections().length;if(currSelectionsCount===0){return data;}
data.bets=this.betslip.bets();webApp.bet=data.bets[0]||"";webApp.selection=webApp.bet.selections()[0]||"";var cacheManager=this._core().getCacheManager();if(cacheManager.isCached('card_title')){var cache=cacheManager._findCache('card_title');data.crsId=cache.keys.crs_id;data.raceDate=cache.keys.r_date;data.raceId=cache.keys.race_id;}
data.addSelectionsUrl='#meeting-list';var backUrl=webApp.urlManager.getBackUrl(this._name);var backArr=webApp.urlManager.parseHash(backUrl);if(backArr[0]=='card'||backArr[0]=='advanced-video'){data.addSelectionsUrl=backUrl;}else if(backArr[0]=='predictor'){data.addSelectionsUrl=webApp.urlManager.createHash(backArr);}
backUrl.indexOf('receipt')>=0?data.backUrl='#card':data.backUrl=backUrl;return data;};};webApp.extend(greyhoundbet.BetSlipController,webApp.BetSlipController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.GenericErrorController=function(name,config){greyhoundbet.GenericErrorController.superclass.constructor.call(this,name,config);this.errorRedirect=function(){this._redirectAndExit('meeting-list');return;};this.mainBeforeRender=function(data){var client=webApp.bookieCollection.getCurrentProvider();if(!client.isLoggedIn()){this.errorRedirect();}
var result=this.addCredentialsToView(data);$.extend(result,this.getRequestParams());result.currency=webApp.bookieCollection.getCurrentProvider().user().currency();result.backUrl=webApp.registry.get('backUrlHash')||false;if(result.backUrl){result.backUrl=result.backUrl.replace('predictor','card');}
else{result.backUrl='#meeting-list';}
return result;};};webApp.extend(greyhoundbet.GenericErrorController,webApp.GenericErrorController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.MarketSuspendErrorController=function(name,config){greyhoundbet.MarketSuspendErrorController.superclass.constructor.call(this,name,config);this.errorRedirect=function(){this._redirectAndExit('meeting-list');return;};this.getBackUrl=function(){return'#meeting-list';};};webApp.extend(greyhoundbet.MarketSuspendErrorController,webApp.MarketSuspendErrorController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.PriceChangedErrorController=function(name,config){greyhoundbet.PriceChangedErrorController.superclass.constructor.call(this,name,config);this._preExecute=function(){var prefBookie=webApp.prefBookmaker.get();this._config.blocks['main'].template=prefBookie+'-price-changed-error';$('#price-changed-error-scroll').height(0);};this.errorRedirect=function(){this._redirectAndExit('meeting-list');return;};this.getBackUrl=function(){return'#bet-slip';};};webApp.extend(greyhoundbet.PriceChangedErrorController,webApp.PriceChangedErrorController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.DogController=function(name,config){greyhoundbet.DogController.superclass.constructor.call(this,name,config);this.stats={};this._preExecute=function(){if(!webApp.isDesktop&&this.isPastDateRequested()||!webApp.isDesktop&&this.accessedFromBookmark()){this._redirectAndExit('meeting-list');}};this.headerBeforeRender=function(data){this.stats=data;return data;};this.headerAfterRender=function(){var request=this.getRequestParams();var pagerData=[];var catdTab=this.isTodaysDateRequested()?'card':'form';var trackIdUrlParam=request.track_id?'&track_id='+request.track_id:'';$('.btnBack').attr('href','#card/race_id='+request.race_id+'&r_date='+request.r_date+'&tab='+catdTab
+trackIdUrlParam);for(var i in this.stats.trapTrackRecords){pagerData.push(this.stats.trapTrackRecords[i].dogId);}
this._pager=new webApp.simplePager({data:pagerData,countSelector:'#serialPos',urlParams:request,urlValue:'dog_id'});};this.detailsBeforeRender=function(data){var trapNum=data.dogInfo.trapNum;var stats=this.stats;var additionalData={};if(this.isTodaysDateRequested()){var dogPerformance=this.getStatsByTrap(trapNum,stats.dogPerformance);var trapRecord=this.getStatsByTrap(trapNum,stats.trapRecord);var recordAtThisGrade=this.getStatsByTrap(trapNum,stats.recordAtThisGrade);var totals=[dogPerformance.total,trapRecord.total,recordAtThisGrade.total];additionalData={dogPerformance:dogPerformance,trapRecord:trapRecord,recordAtThisGrade:recordAtThisGrade,trackName:stats.trackName,raceGrade:stats.raceGrade,max:totals.sort(function(a,b){return b-a})[0],isStatisticsAvailable:true};}else{additionalData={isStatisticsAvailable:false};}
webApp.dogCareerDataForSort=data;for(var i=0;i<webApp.dogCareerDataForSort.forms.length;i++){webApp.dogCareerDataForSort.forms[i].index=i;}
var result=$.extend(data,additionalData);result.collectionJorney=this.collectionJorney;return result;};this.detailsAfterRender=function(){$(document).on('click.formMeetingLink','.formGrid a',function(e){var urlManager=webApp.urlManager;var targetHash=$(e.target).attr('href');var currentHash=urlManager.getHash();urlManager.setHash(urlManager.addParamToHash(targetHash,'back',1));e.preventDefault();});webApp.sortableColumns.init($('#sortableTable'));};this.getStatsByTrap=function(trapNum,stats){var i;for(i in stats){if(stats[i].num===trapNum){return stats[i];}}
return{};};this.collectionJorney="cards";this.destroy=function(){$(document).unbind('.formMeetingLink');};};webApp.extend(greyhoundbet.DogController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.VideoController=function(name,config){greyhoundbet.VideoController.superclass.constructor.call(this,name,config);this.RP_VIDEO_SHOWN_NAME='RP_VIDEO_SHOWN';var shownVideoId=parseInt(utils.localStorage.get(this.RP_VIDEO_SHOWN_NAME),10);this._preExecute=function(){if(shownVideoId==0){this._redirectAndExit('meeting-list');return;}
if(webApp.isDesktop){$('body').addClass('hideMainTabs rpgTVPage');}};this._postExecute=function(){if(webApp.isDesktop){$('body').addClass('hideMainTabs');}};var data={};this.videoUrlsBeforeRender=function(videoData){data=videoData;return videoData;};this.videoUrlsAfterRender=function(){var videoUrl='',videoContainer,playerFeatures=[];isFlashPluginAvailable=false;videoContainer=$('#video-tag');videoContainer.hide();if(webApp.isDesktop){$('#videoLoadBox').hide();videoUrl=data['androidlortmp'];if(shownVideoId==1&&videoUrl){utils.localStorage.set(this.RP_VIDEO_SHOWN_NAME,0);videoContainer.show();webApp.dataLoading.show('Loading Video');playerFeatures=['fullscreen','volume'];if(webApp.isIE){playerFeatures=['volume'];}
var player=new MediaElementPlayer('#video-tag',{features:playerFeatures,clickToPlayPause:false,enableAutosize:true,success:function(mediaElement,domObject){mediaElement.addEventListener('progress',function(e)
{webApp.dataLoading.hide();},false);},error:function(){webApp.dataLoading.hide();$('.rpgtvPlayerContainer').hide();isFlashPluginAvailable=navigator.plugins["Shockwave Flash"];if(!isFlashPluginAvailable){alert('Please install Adobe Flash Plug-in to access this functionality');}
else{alert('Something went wrong');}}});}
else{$('#videoLoadBox').hide();$('#videoHolderBox').show();}}
else if(webApp.isIDevice){videoUrl=data['iPhone'];if(shownVideoId==1&&videoUrl){utils.localStorage.set(this.RP_VIDEO_SHOWN_NAME,0);window.location=videoUrl;}else{$('#videoLoadBox').hide();$('#videoHolderBox').show();webApp.viewManager.getScroll(this._name).refresh();}}
else if(webApp.isAndroid){$('#videoLoadBox').hide();$('#videoHolderBox').show();var videoUrl=data['androidhirtmp'],regEx='',urlParams={},urlParts=[],pattern="^(([^:/\\?#]+):)?(//(([^:/\\?#]*)(?::([^/\\?#]*))?))?([^\\?#]*)(\\?([^#]*))?(#(.*))?$";videoUrl=data['androidlortmp'];regEx=new RegExp(pattern);urlParts=regEx.exec(videoUrl);urlParams={url:urlParts[0],host:urlParts[4],pathName:urlParts[7]+urlParts[8],protocol:'rtmp'};if(shownVideoId==1&&videoUrl){webApp.confirmPopup({tpl:'video-popup',urlParams:urlParams});utils.localStorage.set(this.RP_VIDEO_SHOWN_NAME,0);}}};};webApp.extend(greyhoundbet.VideoController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.AdvancedVideoController=function(name,config){greyhoundbet.AdvancedVideoController.superclass.constructor.call(this,name,config);this.RP_VIDEO_SHOWN_NAME='RP_VIDEO_SHOWN';this.isRpgtvDay=false;this.videoDetailsDataLength=0;this.isVideoPlaying=false;this.serverTime='';this.serverFullTime='';this.shouldShowVideo=false;this.tracksShortNames='';this.state=4;this._preExecute=function(){this._diffusionPriceSession=new window.rpDiffusion.default({onDataFunction:this.onPriceReceived.bind(this)});};this.onPriceReceived=function(WebClientMessage){this.acceptPrice(this.transformToLegacyPrice(WebClientMessage));};this.transformToLegacyPrice=function(WebClientMessage){var dataFields=WebClientMessage.getFields(0);var topic=WebClientMessage.getTopic();var topicArr=topic.split('/');var raceTime=topicArr[3];var dogName=topicArr[5];return{selectionId:dataFields[1],selectionName:dogName.replace(/ /g,'_'),name:dogName.replace('TRAP','Trap'),hours:Number(raceTime.split(':')[0]),minutes:Number(raceTime.split(':')[1]),numerator:Number(dataFields[7].split('/')[0]),denominator:Number(dataFields[7].split('/')[1]),fractional:dataFields[7],decimal:dataFields[8],isSuspended:dataFields[6]==='H'}};var data={};var contentData={};this.videoUrlsBeforeRender=function(videoData){data=videoData;this.isRpgtvDay=!data['isNonRpgtvDay'];this.serverTime=data['dayTime'];this.serverFullTime=data['serverFullTime'];return videoData;};this.videoUrlsAfterRender=function(){};this.contentBeforeRender=function(response){this.isRpgtvDay=this.isRpgtvDay&&!!response.meetingsCount;if(this.isRpgtvDay){contentData=response.data;this.createHeader(response);this.checkTimeDifferenceToFirstRace();}
this.setState();return response;};this.contentAfterRender=function(){var context=this;if(this.isRpgtvDay){this.refreshDetails=setInterval(function(){context.requestDetails();},60000);}};this._postExecute=function(){var $window=$(window),windowHeight=$window.height(),windowWidth=$window.width();webApp.googleTagAds.proccessAds(windowWidth,windowHeight);};this.contentOnDestroy=function(){var $window=$(window),windowHeight=$window.height(),windowWidth=$window.width();webApp.googleTagAds.proccessAds(windowWidth,windowHeight);clearInterval(this.refreshDetails);this._diffusionPriceSession.unsubscribeAll();delete this._diffusionPriceSession;};this.checkTimeDifferenceToFirstRace=function(){var racesTime=[],raceTime,firstRaceTime=0,minTimeDiff=30*60*1000,serverTime,serverTimeStamp;if(contentData[0].hasOwnProperty('firstRaceTime')){$.each(contentData,function(i,value){raceTime=value['firstRaceTime'].replace(/-/g,'/');racesTime[i]=new Date(raceTime).getTime();});firstRaceTime=Math.min.apply(Math,racesTime);serverTime=this.serverFullTime.replace(/-/g,'/');serverTimeStamp=new Date(serverTime).getTime();this.shouldShowVideo=firstRaceTime-serverTimeStamp<=minTimeDiff;}};this.initVideoPlayer=function(){var videoUrl='',context=this,videoContainer,playerFeatures=[],$videoPlayerSource=$('.advancedVideoTag').find('source')[0],isFlashPluginAvailable=false;videoContainer=$('.advancedVideoTag');videoContainer.hide();$('#videoLoadBox').hide();videoUrl=data['androidlortmp'];if(videoUrl&&this.shouldShowVideo){$videoPlayerSource.src=videoUrl;videoContainer.show();playerFeatures=['fullscreen','volume'];if(webApp.isIE){playerFeatures=['volume'];}
this.advancedVideoPlayer=new MediaElementPlayer('#video-tag',{features:playerFeatures,clickToPlayPause:false,enableAutosize:true,success:function(mediaElement,domObject){mediaElement.addEventListener('progress',function(e)
{context.isVideoPlaying=true;},false);},error:function(){$('.rpgtvPlayerContainer').hide();isFlashPluginAvailable=navigator.plugins["Shockwave Flash"];if(!isFlashPluginAvailable){alert('Please install Adobe Flash Plug-in to access this functionality');}
else{alert('Something went wrong');}}});}
else{$('#videoLoadBox').hide();$('#videoHolderBox').show();}};this.requestDetails=function(){var url="/video/blocks.sd",params={blocks:"video-urls,content"},context=this;var onSuccess=function(responseData){var responseContentData=responseData['content'],responseVideoData=responseData['video-urls'];data=responseVideoData;contentData=responseContentData.data;context.serverTime=responseVideoData['dayTime'];context.serverFullTime=responseVideoData['serverFullTime'];context.checkTimeDifferenceToFirstRace();context.setState();var newDataLength=JSON.stringify(responseContentData).length;if((context.videoDetailsDataLength!==newDataLength)&&responseContentData){context.renderDetails(responseContentData);context.createHeader(responseContentData);context.videoDetailsDataLength=newDataLength;}};var onError=function(e){console.log(e);};var onComplete=function(){};webApp.ajaxManager.makeRequest(url,params,onSuccess,onError,onComplete);};this.renderDetails=function(data){var view=this._core().getViewManager(),$contentContainer=$('.content');$contentContainer.empty().append(view.renderTpl('video-details',data));view.refreshAllScrolls();};this.createHeader=function(data){var $headerTitle=$('.headerTitle')[0],titleText='RPGTV Trap Challenge',selectionShortTrackNames='';if(data.meetingsCount===1){titleText=data.tracksNames[0]+' RPGTV Trap Challenge';selectionShortTrackNames=data.tracksShortNames[0];}
else if(data.meetingsCount===2){titleText=data.tracksNames[0]+' and '+data.tracksNames[1]+' RPGTV Combined Trap Challenge';selectionShortTrackNames=data.tracksShortNames[0]+' and '+data.tracksShortNames[1];}
$headerTitle.innerText=titleText;this.tracksShortNames=selectionShortTrackNames;};this.removeVideoPlayer=function(){var $rpgtvVideoContainer=$('.rpgtvPlayerContainer'),videoTagString='<video class="videoTag advancedVideoTag" autoplay="" width="100%" height="100%" id="video-tag" preload="auto" style="display: none;"><source type="video/rtmp" src=""></video>';if(this.advancedVideoPlayer){this.advancedVideoPlayer.remove();this.advancedVideoPlayer=false;}
$rpgtvVideoContainer.empty().append(videoTagString)};this.setState=function(){var isVideoAvailable=!!data['androidlortmp'],previousState=this.state;if(!this.isRpgtvDay){this.state=0;}
if(this.isRpgtvDay){if(this.serverTime<'21:30'&&!this.shouldShowVideo){this.state=1;}
if(isVideoAvailable&&this.shouldShowVideo){this.state=2;}
if(this.serverTime>'21:29'&&!isVideoAvailable){this.state=3;}
if(isVideoAvailable&&!this.isVideoPlaying&&previousState===2){this.processState();}}
if(this.state!=previousState){this.processState();}};this.processState=function(){var $videoHolderBox=$('#videoHolderBox'),$videoHolderContainer=$('.videoHolder'),$prgtvPlayerContainer=$('.rpgtvPlayerContainer'),$trapChallengeContainer=$('.trapChallengeContainer'),$trapChallengesFooter=$('.trapChallengesFooter'),$presentersInfoContainer=$('.presentersInfo'),$rpgtvDetailsContainer=$('.rpgtvDetails ');if(this.state==0){$trapChallengeContainer.hide();$trapChallengesFooter.hide();$prgtvPlayerContainer.hide();$rpgtvDetailsContainer.hide();$videoHolderBox.show();$videoHolderContainer.show();$presentersInfoContainer.show();clearInterval(this.refreshDetails);this.removeVideoPlayer();this.isVideoPlaying=false;}
if(this.state==1){$videoHolderBox.hide();$videoHolderContainer.hide();$trapChallengeContainer.show();$trapChallengesFooter.show();$rpgtvDetailsContainer.show();$prgtvPlayerContainer.hide();this.subscribeToPrices();this.removeVideoPlayer();this.isVideoPlaying=false;}
if(this.state==2){$videoHolderBox.hide();$videoHolderContainer.hide();$trapChallengeContainer.hide();this.removeVideoPlayer();$trapChallengesFooter.show();$prgtvPlayerContainer.show();$rpgtvDetailsContainer.show();if(!this.isVideoPlaying){this.initVideoPlayer();}}
if(this.state==3){$prgtvPlayerContainer.hide();$videoHolderBox.show();$videoHolderContainer.show();$rpgtvDetailsContainer.show();$presentersInfoContainer.hide();$trapChallengeContainer.hide();$trapChallengesFooter.show();this.removeVideoPlayer();this.isVideoPlaying=false;}};this.subscribeToPrices=function(){var realTopic,context=this,priceTopicD5=data.priceTopicD5;if(priceTopicD5){[1,2,3,4,5,6].forEach(function(i){realTopic={topic:priceTopicD5.replace('PREFERRED_BOOKMAKER',webApp.PREFERRED_BOOKMAKER).replace('TRAP_NUMBER','TRAP '+i)};context._diffusionPriceSession.subscribe(realTopic);});}};this.acceptPrice=function(price){var view=this._core().getViewManager();var eventTracker=this._helper('eventTracker');var selectionName=price.name;var priceBoxSelector='#bet-'+price.selectionName;var $priceBox=$(priceBoxSelector);var priceButtonSelector=priceBoxSelector+' span';var context=this;if(!selectionName){return;}
if(price.isSuspended){$(priceBoxSelector).empty();return;}
var bookie=webApp.bookieCollection.getCurrentBookieParams();var odds=webApp.userSettings.get('odds');if(odds==='decimal'){if(price.fractional==='SP'){price.price=price.fractional;}else{price.price=(Math.floor(parseFloat(price.decimal)*100)/100).toString();}}else{price.price=price.fractional;}
var $button=view.renderTpl('price-button',{price:price,bookie:bookie});var selection=new rp.betting.Selection({id:price.selectionId,price:price.fractional==='SP'?null:{num:price.numerator,den:price.denominator},isSP:!!(price.fractional==='SP'),data:{selectionName:selectionName,courseName:'RPGTV - Trap Challenge',courseNameAbbr:context.tracksShortNames,isTrapChallengePrice:true,includeInMultiple:false}});var _context=this;if(!price.isSuspended){$button.bind('click.betClick',function(){webApp.registry.set({backUrlHash:window.location.hash});selection.eachWay(_context._eachWay);selection.data().isBOG=_context._BOG;var onAddMultModeCallback=function(){webApp.selectionsAlert.show(webApp.SelectionsManager.getSelections().length);};webApp.SelectionsManager.setOnAddMultModeCallback(onAddMultModeCallback);webApp.SelectionsManager.processPriceClick(selection,priceButtonSelector,_context,bookie.name);});}
$priceBox.html($button);webApp.SelectionsManager.getSelections().length&&webApp.SelectionsManager.isSelected(selection)&&webApp.SelectionsManager.highlightSelectionPrice(priceButtonSelector);};};webApp.extend(greyhoundbet.AdvancedVideoController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.WhHomeController=function(name,config){greyhoundbet.WhHomeController.superclass.constructor.call(this,name,config);};webApp.extend(greyhoundbet.WhHomeController,webApp.WhHomeController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.WhTopUpController=function(name,config){greyhoundbet.WhTopUpController.superclass.constructor.call(this,name,config);this.headerAfterRender=function($header){$('.btnBack').click(function(){webApp.eventTracker.trackEventById('deposit_account');});};};webApp.extend(greyhoundbet.WhTopUpController,webApp.WhTopUpController);
var webApp=webApp||{};webApp.WhGamblingDetailsController=function(name,config){webApp.WhGamblingDetailsController.superclass.constructor.call(this,name,config);};webApp.extend(webApp.WhGamblingDetailsController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{};webApp.LadbGamblingDetailsController=function(name,config){webApp.LadbGamblingDetailsController.superclass.constructor.call(this,name,config);};webApp.extend(webApp.LadbGamblingDetailsController,webApp.AbstractNodataCredentialsController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.SearchController=function(name,config){greyhoundbet.SearchController.superclass.constructor.call(this,name,config);this._preExecute=function(){};this._postExecute=function(){};this.destroy=function(){};this.searchBeforeRender=function(data){return data;};this.searchAfterRender=function(){var request=this.getRequestParams();var $searchPage=$('#search-page');$searchPage.find('.searchField').val(request['search_text']).parent().addClass('changed');webApp.searchFormInit();$searchPage.find('.pagerBtn').on('click',function(){if(!$(this).hasClass('disabled')){var currentPage=parseInt(request['page']);var page=$(this).hasClass('leftBtn')?currentPage-1:currentPage+1;webApp.urlManager.changeParams({'page':page});}});var renderEngagements=function(data,target){$.tmpl('dog-engagements',data).appendTo(target);$(window).trigger('resize');};$searchPage.find('.engagements').on('click',function(event){event.preventDefault();if(!this.getAttribute('data-complete')){var targetElement=this.parentElement.parentElement.parentElement;$(this).attr('data-complete',true);$(targetElement).find('.engagementsList').remove();var dogId=this.getAttribute('data-dog-id');var url="/search/blocks.sd";var params={dog_id:dogId,blocks:"engagements"};var onSuccess=function(data){renderEngagements(data,targetElement);};var onError=function(e){console.log(e);};var onComplete=function(){};$.ajax({url:url,data:params,type:'GET',dataType:'json',cache:false,timeout:(1000*60*1),success:onSuccess,error:onError,complete:onComplete});}});};};webApp.extend(greyhoundbet.SearchController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.SearchDogController=function(name,config){greyhoundbet.SearchDogController.superclass.constructor.call(this,name,config);this.searchDogDetailsBeforeRender=function(data){var request=this.getRequestParams();if(data.hasOwnProperty('dogInfo')){var dogName=data.dogInfo.dogName;$('#dogHeaderTitle').html(dogName);}
data.searchDog=request['dog_id'];data.collectionJorney=this.collectionJorney;webApp.dogCareerDataForSort=data;for(var i=0;i<webApp.dogCareerDataForSort.forms.length;i++){webApp.dogCareerDataForSort.forms[i].index=i;}
return data;};this.searchDogDetailsAfterRender=function(){webApp.sortableColumns.init($('#sortableTable'));};this.collectionJorney='cards';};webApp.extend(greyhoundbet.SearchDogController,webApp.AbstractController);
var greyhoundbet=greyhoundbet||{};greyhoundbet.SearchFormExplainedController=function(name,config){greyhoundbet.SearchFormExplainedController.superclass.constructor.call(this,name,config);};webApp.extend(greyhoundbet.SearchFormExplainedController,webApp.AbstractNodataCredentialsController);
var webApp=webApp||{};webApp.searchFormInit=function(){$('.searchField').on('focus',function(){$(this).parent().addClass('changed');});$('.searchField').on('blur',function(){if(!$.trim($(this).val())){$(this).parent().removeClass('changed');}});$('.searchForm').on('submit',function(){var input=$(this).find('.searchField').val();if(input==""||input.length<=1||input.length>16)
{return false}
var hashString=webApp.urlManager.createHash(['search',{page:1,'search_text':$(this).find('.searchField').val()}]);webApp.urlManager.setHash(hashString);return false;});};

var rp=rp||{};rp.Registry=function(){this._storage={};};rp.Registry.prototype.set=function(key,value){if(typeof(key)==='object'){this.setList(key);return;}
this._storage[key]=value;};rp.Registry.prototype.get=function(key,defaultValue){defaultValue=(typeof defaultValue==='undefined')?null:defaultValue;return(this._storage.hasOwnProperty(key))?this._storage[key]:defaultValue;};rp.Registry.prototype.remove=function(key){delete this._storage[key];};rp.Registry.prototype.setList=function(list){for(var i in list){this.set(i,list[i]);}};
var utils=utils||{};var webApp=webApp||{};utils.date={format:function(dateString,pattern){return(new Date(dateString)).format(pattern);},addLeadingZero:function(inputDatePart){var datePart=inputDatePart.toString();if(datePart.length==1){datePart='0'+datePart;}
return datePart;},toString:function(date){return date.getFullYear()+'-'+this.addLeadingZero(date.getMonth()+1)+'-'+this.addLeadingZero(date.getDate());},timeZoneDiff:function(serverTimezone){var date=new Date();return(parseInt(serverTimezone)+date.getTimezoneOffset()/60)*3600000;},datesDiff:function(firstDate,secondDate){return firstDate.getTime()-secondDate.getTime();},fromString:function(dateString,timezoneDiff){var dateArray=dateString.split(' ');var dayArray=dateArray[0].split('-');var timeArray=dateArray[1].split(':');var date=new Date(dayArray[0],dayArray[1]-1,dayArray[2],timeArray[0],timeArray[1],0);date.setTime(date.getTime()-timezoneDiff);return date;},isDate:function(dateString){var format=/^\d{4}\-\d{2}\-\d{2}$/;if(format.test(dateString)){var year=dateString.split("-")[0];var month=dateString.split("-")[1];var day=dateString.split("-")[2];var dateObject=new Date(year,month-1,day);var validYear=(dateObject.getFullYear()==year);var validMonth=(dateObject.getMonth()+1==month);var validDay=(dateObject.getDate()==day);if(validYear&&validMonth&&validDay){return true;}}
return false;},getSynchronizedToServerNow:function(){var now=new Date();var result=this.getSynchronizedToServerDate(now);return result;},checkTimezoneOverlap:function(){var date=new Date();var timestamp=date.getTime();var result=new Date();var timeDiff;if(webApp&&webApp.SERVER_TIMESTAMP){var delta=webApp.SERVER_TIMESTAMP-webApp.LOCAL_TIMESTAMP;timestamp=timestamp+delta*1000;timeDiff=result.getTimezoneOffset()*60*1000;result.setTime(timestamp+timeDiff);}
if(result.getDay()!==date.getDay()){return true;}else{return false;}},getSynchronizedToServerDate:function(date){var timestamp=date.getTime();var result=new Date();var timeDiff;if(webApp&&webApp.SERVER_TIMESTAMP){var delta=webApp.SERVER_TIMESTAMP-webApp.LOCAL_TIMESTAMP;timestamp=timestamp+delta*1000;timeDiff=result.getTimezoneOffset()*60*1000;result.setTime(timestamp+timeDiff);}
return result;},isValidDaysInMonth:function(day,month,year){var preparedMonth=month-1,date=new Date(year,preparedMonth,day);return(day==date.getDate()&&preparedMonth==date.getMonth()&&year==date.getFullYear());},age:function(date){var today=new Date(),age=today.getFullYear()-date.getFullYear(),monthDiff=today.getMonth()-date.getMonth();if(monthDiff<0||(monthDiff===0&&today.getDate()<date.getDate())){age--;}
return age;},topicFormat:function(date){var day=date.getDate();day=day<10?'0'+day:day;var month=date.getMonth()+1;month=month<10?'0'+month:month;return day+'-'+month+'-'+date.getFullYear();},formatFromString:function(dateString,format){return this.fromString(dateString,0).format(format);}};
utils.oop={paramsReader:function(obj,params){if(typeof params=='object'){for(var i in params){obj[i]=params[i];}}},checkParamsLengthAndType:function(checkSum,params){if(utils.type.isObject(params)){for(var i in checkSum){if(!(i in params)){return false;}
if(utils.type.isString(checkSum[i])){if(!utils.type[checkSum[i]](params[i])){return false;}}else if(utils.type.isArray(checkSum[i])){var isTrue=false;for(var j=0;j<checkSum[i].length;j++){if(utils.type[checkSum[i][j]](params[i])){isTrue=true;break;}}
if(!isTrue){return false;}}}
return true;}else{return false;}},getKeys:function(inHash){var keys=[];if(typeof inHash=='object'){for(var key in inHash){keys.push(key);}}
return keys;},sizeOf:function(hash){var i=0;for(var key in hash){if(typeof hash[key]!='function'){i++;}}
return i;}}
utils.type={isNull:function(variable){return(variable==null)?true:false;},isNumber:function(variable){return(typeof variable=='number')?true:false;},isString:function(variable){return(typeof variable=='string')?true:false;},isBoolean:function(variable){return(typeof variable=='boolean')?true:false;},isFunction:function(variable){return $.isFunction(variable);},isArray:function(variable){return $.isArray(variable);},isObject:function(variable){return $.isPlainObject(variable);},isEmptyObject:function(variable){return(this.isObject(variable)&&$.isEmptyObject(variable))?true:false;},isjQueryObject:function(variable){return(variable instanceof jQuery)?true:false;}}
utils.get_html_translation_table=function(table,quote_style){var entities={},hash_map={},decimal=0,symbol='';var constMappingTable={},constMappingQuoteStyle={};var useTable={},useQuoteStyle={};constMappingTable[0]='HTML_SPECIALCHARS';constMappingTable[1]='HTML_ENTITIES';constMappingQuoteStyle[0]='ENT_NOQUOTES';constMappingQuoteStyle[2]='ENT_COMPAT';constMappingQuoteStyle[3]='ENT_QUOTES';useTable=!isNaN(table)?constMappingTable[table]:table?table.toUpperCase():'HTML_SPECIALCHARS';useQuoteStyle=!isNaN(quote_style)?constMappingQuoteStyle[quote_style]:quote_style?quote_style.toUpperCase():'ENT_COMPAT';if(useTable!=='HTML_SPECIALCHARS'&&useTable!=='HTML_ENTITIES'){throw new Error("Table: "+useTable+' not supported');}
entities['38']='&amp;';if(useTable==='HTML_ENTITIES'){entities['160']='&nbsp;';entities['161']='&iexcl;';entities['162']='&cent;';entities['163']='&pound;';entities['164']='&curren;';entities['165']='&yen;';entities['166']='&brvbar;';entities['167']='&sect;';entities['168']='&uml;';entities['169']='&copy;';entities['170']='&ordf;';entities['171']='&laquo;';entities['172']='&not;';entities['173']='&shy;';entities['174']='&reg;';entities['175']='&macr;';entities['176']='&deg;';entities['177']='&plusmn;';entities['178']='&sup2;';entities['179']='&sup3;';entities['180']='&acute;';entities['181']='&micro;';entities['182']='&para;';entities['183']='&middot;';entities['184']='&cedil;';entities['185']='&sup1;';entities['186']='&ordm;';entities['187']='&raquo;';entities['188']='&frac14;';entities['189']='&frac12;';entities['190']='&frac34;';entities['191']='&iquest;';entities['192']='&Agrave;';entities['193']='&Aacute;';entities['194']='&Acirc;';entities['195']='&Atilde;';entities['196']='&Auml;';entities['197']='&Aring;';entities['198']='&AElig;';entities['199']='&Ccedil;';entities['200']='&Egrave;';entities['201']='&Eacute;';entities['202']='&Ecirc;';entities['203']='&Euml;';entities['204']='&Igrave;';entities['205']='&Iacute;';entities['206']='&Icirc;';entities['207']='&Iuml;';entities['208']='&ETH;';entities['209']='&Ntilde;';entities['210']='&Ograve;';entities['211']='&Oacute;';entities['212']='&Ocirc;';entities['213']='&Otilde;';entities['214']='&Ouml;';entities['215']='&times;';entities['216']='&Oslash;';entities['217']='&Ugrave;';entities['218']='&Uacute;';entities['219']='&Ucirc;';entities['220']='&Uuml;';entities['221']='&Yacute;';entities['222']='&THORN;';entities['223']='&szlig;';entities['224']='&agrave;';entities['225']='&aacute;';entities['226']='&acirc;';entities['227']='&atilde;';entities['228']='&auml;';entities['229']='&aring;';entities['230']='&aelig;';entities['231']='&ccedil;';entities['232']='&egrave;';entities['233']='&eacute;';entities['234']='&ecirc;';entities['235']='&euml;';entities['236']='&igrave;';entities['237']='&iacute;';entities['238']='&icirc;';entities['239']='&iuml;';entities['240']='&eth;';entities['241']='&ntilde;';entities['242']='&ograve;';entities['243']='&oacute;';entities['244']='&ocirc;';entities['245']='&otilde;';entities['246']='&ouml;';entities['247']='&divide;';entities['248']='&oslash;';entities['249']='&ugrave;';entities['250']='&uacute;';entities['251']='&ucirc;';entities['252']='&uuml;';entities['253']='&yacute;';entities['254']='&thorn;';entities['255']='&yuml;';}
if(useQuoteStyle!=='ENT_NOQUOTES'){entities['34']='&quot;';}
if(useQuoteStyle==='ENT_QUOTES'){entities['39']='&#39;';}
entities['60']='&lt;';entities['62']='&gt;';for(decimal in entities){symbol=String.fromCharCode(decimal);hash_map[symbol]=entities[decimal];}
return hash_map;}
utils.htmlspecialchars_decode=function(string,quote_style){var hash_map={},symbol='',tmp_str='',entity='';tmp_str=string.toString();if(false===(hash_map=this.get_html_translation_table('HTML_SPECIALCHARS',quote_style))){return false;}
for(symbol in hash_map){entity=hash_map[symbol];tmp_str=tmp_str.split(entity).join(symbol);}
tmp_str=tmp_str.split('&#039;').join("'");return tmp_str;}
utils.prepareJSONStr=function(str){var quote=/"/g;var slash=/\\/g;str=str.replace(slash,"\\\\");str=str.replace(quote,'\\"');return str;}
var utils=utils||{};utils.numbers={isPositiveInt:function(toBeInt){var result=true;if(toBeInt.replace(/\D/g,'')==toBeInt&&toBeInt>=0){result=true;}else{result=false;}
return result;},getPercentage:function(num1,num2){var result=false;num1=parseFloat(num1);num2=parseFloat(num2);if(num1===0&&num2===0){result=50;}else if(!isNaN(num1)&&!isNaN(num2)){result=num1/(num1+num2)*100;result=Math.round(result*10)/10;}
return result;},numberToShortString:function(number,decPlaces){decPlaces=Math.pow(10,decPlaces);var abbrev=['K','M'];for(var i=abbrev.length-1;i>=0;i--){var size=Math.pow(10,(i+1)*3);if(size<=number){number=Math.round(number*decPlaces/size)/decPlaces;if((number==1000)&&(i<abbrev.length-1)){number=1;i++;}
number+=abbrev[i];break;}}
return number;},toFloatMoney:function(money,precision){var precision=precision||2,moneyStr=money.toString(),moneyIndexOfDot=moneyStr.indexOf('.');var result=0;var digitsAfterDot;if(moneyIndexOfDot!=-1&&(digitsAfterDot=moneyStr.length-moneyIndexOfDot)>precision){result=Math.abs(money+Math.pow(10,-digitsAfterDot)).toFixed(precision);}else{result=Math.abs(money).toFixed(precision);}
return parseFloat(result);},formatMoney:function(money,options){var options=options||{};var NOT_AVAILABLE='NA';var POUND='&pound;';var currency=options.currency===false?'':(options.currency||POUND);var result=currency;if(money==null||isNaN(money)){result+=NOT_AVAILABLE;}else{if(money<0){result='-'+result;}else if(money>0&&options.plus){result='+'+result;}
var precision=options.precision||2;result+=this.toFloatMoney(money,precision).toFixed(2);}
return result;},factorial:function(number){if(number==0){return 1;}else{return number*this.factorial(number-1);}},fixJsFloat:function(number){var returnString=number.toString();var dotIndex=returnString.indexOf('.');if(returnString.substr(dotIndex).length>3){return Math.floor(number*100)/100;}else{return number;}}}
namespace('utils.moment');utils.moment={FORMAT_FULL_DATETIME:"YYYY-MM-DD HH:mm:ss",FORMAT_FULL_DATETIME_NO_SEC:"YYYY-MM-DD HH:mm",FORMAT_FULL_DATETIME_WITH_T:"YYYY-MM-DDTHH:mm:ssZ",FORMAT_FULL_ISO_DATE:"YYYY-MM-DD[T]HH:mm:ss[Z]",FORMAT_DATETIME:"YYYY-MM-DD",FORMAT_DATETIME_STRAIGHT:"DD-MM-YYYY",FORMAT_FULL_DATETIME_SHORT_MONTH:"h:mma, D MMM, YYYY",FORMAT_FULL_DATETIME_SHORT_MONTH_1:"h:mma, D MMM YYYY",FORMAT_FULL_DATETIME_SHORT_MONTH_2:"h:mma D MMM YYYY",FORMAT_DATE_SHORT_MONTH:"D MMM YYYY",FORMAT_TIME_24_HOURS:"HH:mm",FORMAT_TIME_12_HOURS:"h:mm",FORMAT_DAY_MONTH_FULL_WEEKDAY:"dddd, D MMMM",FORMAT_DATE_FULL_MONTH:"MMMM D, YYYY",FORMAT_DATE_SHORT_MONTH_AND_DAY:"MMM D",getSynchronizedToServerNow:function(delta,format){var serverSynchronizationDelta=delta||0;var specifiedFormat=format||utils.moment.FORMAT_FULL_DATETIME;var result=(new moment()).add('seconds',serverSynchronizationDelta+moment().zone()*60);if(format!==false){result=result.format(specifiedFormat);}
return result;},getSynchronizedToServer:function(moment,format,timeZone){var startMoment=moment||new moment();var timeZone=timeZone||"+00:00";var specifiedFormat=format||utils.moment.FORMAT_FULL_DATETIME;var result=startMoment.add('ms',utils.date.timeZoneDiff(timeZone));if(format!==false){result=result.format(specifiedFormat);}
return result;}};
var utils=utils||{};utils.clickReport=function(elementId,appletUrl){this.elementIdSelector='#'+elementId;this.appletUrl=appletUrl;this.image=new Image();};utils.clickReport.prototype.init=function(){var context=this;$(this.elementIdSelector).bind("submit",function(e,p){var data=[];data.push(p.pricebox_uid,p.bookmaker_uid,p.outcome_uid,p.decimal_price,p.sport_desc,Math.random(),0,escape(p.page_description),"X","","","",$.cookie("RP_UID"),escape($.cookie("PermRpLogin")===null?"":$.cookie("PermRpLogin")));data=data.join("&");data="9,"+data.length+","+data;context.image.src=context.appletUrl+data;});};
namespace('utils');utils.string={removeExtraCommas:function(stringWithExtraCommas){var stringWithExtraCommas=stringWithExtraCommas||'';var stringWithoutExtraCommas='';stringWithoutExtraCommas=$.trim(stringWithExtraCommas).replace(/\s+/g,' ').replace(/(,\s*,)+/g,',').replace(/^(,\s?)+/g,'').replace(/(,\s?)+$/g,'')
return stringWithoutExtraCommas;},diffusionToPascalCase:function(string){return string.replace(/(\w)(\w*)/g,function(g0,g1,g2){return g1.toUpperCase()+g2.toLowerCase();});},textToDiffusion:function(text){var diffusionKey=text;diffusionKey=diffusionKey.replace(' ','_').toUpperCase();return diffusionKey;},addCommas:function(number){number+='';x=number.split('.');x1=x[0];x2=x.length>1?'.'+x[1]:'';var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,'$1'+','+'$2');}
return x1+x2;},capitalize:function(string){string=String(string);return string.charAt(0).toUpperCase()+string.substr(1).toLowerCase();},REGEXP_URI:/^(((?:([a-z][a-z0-9\+\-\.]*):)?(?:\/\/([^\/\?#]*))?)([^\?#]*))(?:\?([^#]*))?(?:#(.*))?$/,url:function(url){var match=String(url).match(this.REGEXP_URI),base;return match&&{href:match[1]||'',origin:match[2]||'',scheme:match[3]||'',authority:match[4]||'',path:match[5]||'',query:match[6]||'',hash:match[7]||''};},convertWhToRpCourseName:function(whCourseName){var whCourseName=$.trim(whCourseName);var courseNamesMap={"Bangor":'Bangor-On-Dee',"Epsom Downs":'Epsom',"W'Hampton":'Wolverhampton'};var rpCourseName=courseNamesMap[whCourseName]||whCourseName;return rpCourseName;},wordwrap:function(str,width,brk,cut){var brk=brk||'\n',width=width||75,cut=cut||false;if(!str){return str;}
var regex='.{1,'+width+'}(\\s|$)'+(cut?'|.{'+width+'}|.+$':'|\\S+?(\\s|$)');return str.match(RegExp(regex,'g')).join(brk);},substring:function(str,length,replacement){var result=str,replacement=replacement||'...';if(str&&str.length>length){result=result.substr(0,length)+replacement;}
return result;},replaceByCharCodes:function(str,searchlist,replacelist){var result='';if(str&&$.isArray(searchlist)&&$.isArray(replacelist)){var letters=str.split('');for(var key in searchlist){var searchSign=String.fromCharCode(searchlist[key]),replaceSign=String.fromCharCode(replacelist[key]);for(var index in letters){var letter=letters[index]
letters[index]=letter.replace(searchSign,replaceSign);}}
result=letters.join('');}
return result;},camelCase:function(name){var result='',delimeter='-',words=name?name.split(delimeter):null;if(words){for(var index in words){result+=utils.string.capitalize(words[index]);}}
return result;},parseUrlParams:function(query){var result={},queryList=query?query.split('&'):null;if(queryList){for(var index=0;index<queryList.length;index++){var variables=queryList[index].split('='),name=variables.shift();try{result[name]=decodeURIComponent(variables.join('='));}catch(e){result[name]=unescape(variables.join('='));}}}
return result;},urlCreate:function(url,params){url=this.url(url||'/');params=$.extend(this.parseUrlParams(url.query),params);url=url.href;if(!$.isEmptyObject(params)){url+='?'+$.param(params);}
return url;},isRaceTitleStartsWithRace:function(title){var re=new RegExp("^Race.*$","i");return re.test(title);},hashCode:function(str){var hash=0;if(str.length==0)return hash;for(i=0;i<str.length;i++){char=str.charCodeAt(i);hash=((hash<<5)-hash)+char;hash=hash&hash;}
return hash;}};
try{if(typeof(joop)!='undefined'){throw new ReferenceError('"joop" is already defined. Failed to load jOOP module.');}
var joop=(function(){var context=this;var definitions={errors:{NOT_OBJECT:'Object expected.',NOT_PLAIN_OBJECT:'Plain object expected.',NOT_FUNCTION:'Function expected.',INVALID_PARENT_METHOD:'Invalid parent method.'},specialClassProperties:/^(?:extend|construct)$/};var isObject=function(objectToTest){return((typeof(objectToTest)=='object')&&(objectToTest!==null));};var isPlainObject=function(objectToTest){return(isObject(objectToTest)&&(objectToTest.constructor==Object));};var isFunction=function(functionToTest){return(typeof(functionToTest)=='function');};var cloneObject=function(objectToClone){if(!isObject(objectToClone)){throw new TypeError(definitions.errors.NOT_OBJECT);}
var Clone=function(){};Clone.prototype=objectToClone;return new Clone();};var extendClass=function(classToExtend,superClass){if(!isFunction(superClass)||!isFunction(classToExtend)){throw new TypeError(definitions.errors.NOT_FUNCTION);}
classToExtend.prototype=cloneObject(superClass.prototype);classToExtend.prototype.constructor=classToExtend;classToExtend.prototype.parent=superClass.prototype;classToExtend.prototype.$parent=function(){var caller=arguments.callee.caller;var method=caller._class.prototype.parent[caller._name];if(!isFunction(method)){throw new Error(definitions.errors.INVALID_PARENT_METHOD+' ['+caller._name+']');}
return method.apply(this,arguments);};};var createClass=function(options){var _options=(typeof(options)=='undefined')?{}:options;if(!isPlainObject(_options)){throw new TypeError(definitions.errors.NOT_PLAIN_OBJECT);}
var _constructor=('construct'in _options)?_options.construct:function(){this.$parent.apply(this,arguments);};if(!isFunction(_constructor)){throw new TypeError(definitions.errors.NOT_FUNCTION);}
_constructor._name='constructor';_constructor._class=_constructor;extendClass(_constructor,('extend'in _options)?_options.extend:Object);for(var propertyName in _options){if(!definitions.specialClassProperties.test(propertyName)){_constructor.prototype[propertyName]=_options[propertyName];if(isFunction(_constructor.prototype[propertyName])){_constructor.prototype[propertyName]._name=propertyName;_constructor.prototype[propertyName]._class=_constructor;}}}
return _constructor;};var joop={version:'3.2',createClass:createClass,cloneObject:cloneObject,expose:function(){if(!this._exposed){this._exposed=true;context.$class=this.createClass;context.$clone=this.cloneObject;}}};return joop;})();}catch(err){}
$.extend({few:function(){var elements=[];for(var i=0,size=arguments.length;i<size;i++){elements.push(arguments[i][0]);}
return $(elements);}});
var utils=utils||{};utils.localStorage=(function(){var _name='';var _DOMstorage=null;var _cookieStorage={};$(document).ready(function(){if(typeof window.localStorage=='object'&&window.localStorage!==null){_name='local';}else{var $domElemnt=$('<div id="ieDOMstorage" style="display:none;"></div>');$('body').append($domElemnt);_DOMstorage=$domElemnt.get(0);if(_DOMstorage.addBehavior&&typeof _DOMstorage.load!=='undefined'){_DOMstorage.addBehavior('#default#userData');_DOMstorage.load('namespace');_name='dom';}else{_name='cookie';}}
try{_set('isSupportStorage','y');}catch(e){_name='cookie';}
if(_name=='cookie'){var tmp=$.cookie('cookieStorage');if(tmp&&tmp.match(/^[\{\[]+.*[\}\]]+$/gi)){_cookieStorage=JSON.parse(tmp);}}});var _writeCookie=function(){$.cookie('cookieStorage',JSON.stringify(_cookieStorage),{expires:24,path:'/'});}
var _set=function(key,value){if(!key){return;}
if(typeof value=='undefined'){value=true;}else if($.isArray(value)||$.type(value)=='object'){value=JSON.stringify(value);}
if(_name=='local'){window.localStorage.setItem(key,value);}else if(_name=='dom'){_DOMstorage.setAttribute(key,value);_DOMstorage.save('namespace');}else{_cookieStorage[key]=value;_writeCookie();}}
function _get(key){if(!key){return null;}
var value=null;if(_name=='local'){value=window.localStorage.getItem(key);}else if(_name=='dom'){value=_DOMstorage.getAttribute(key);}else{value=_cookieStorage.hasOwnProperty(key)?_cookieStorage[key]:null;}
if(value=='false'){value=false;}else if(value=='true'){value=true;}else{if(typeof value=='string'&&value.match(/^[\{\[]+.*[\}\]]+$/gi)){value=JSON.parse(value);}}
return value;}
function _remove(key){if(!key){return;}
if(_name=='local'){window.localStorage.removeItem(key);}else if(_name=='dom'){_DOMstorage.removeAttribute(key);_DOMstorage.save('namespace');}else{if(_cookieStorage.hasOwnProperty(key)){delete _cookieStorage[key];_writeCookie();}}}
function _removeAll(){if(_name=='local'){window.localStorage.clear();}else if(_name=='dom'){var attrs=_DOMstorage.XMLDocument.documentElement.attributes;for(var i=0;i<attrs.length;i++){_DOMstorage.removeAttribute(attrs.name);_DOMstorage.save('namespace');}}else{_cookieStorage={};_writeCookie();}}
return{set:function(stateName,stateVal){_set(stateName,stateVal);},get:function(stateName){return _get(stateName);},remove:function(stateName){_remove(stateName);},removeAll:function(){_removeAll();},setVersion:function(nowVersion){var setVersion=this.get('storageVersion');if(parseInt(setVersion)!=parseInt(nowVersion)){this.removeAll();this.set('storageVersion',nowVersion);}}}})();
(function($){$.fn.limitMaxLength=function(length){$(this).keydown(function(e){if($(this).val().length>=length){$(this).val($(this).val().substr(0,length));}});$(this).keyup(function(e){if($(this).val().length>=length){$(this).val($(this).val().substr(0,length));}});}})(jQuery);
var utils=utils||{};utils.userPreferences=utils.userPreferences||{};$.extend(utils.userPreferences,{COOKIE_NAME_SITE_PREFERENCE:'RP_PREFERRED_SITE',SITE_TYPE_FULL:'FS',SITE_TYPE_MOBILE:'MOB',SITE_TYPE_IGNORE:'IGNORE',IS_DEVICE_ON_HOLD:0,cookieName:'COM_PREF_VALUE',stateName:'userPref',load:function(){var data=utils.stat.getCookie(this.stateName);var delimiter=',';if(data===false){data=$.cookie(this.cookieName);delimiter='|';}
var result={bookmakerId:null,rating:null,odds:null};if(data){var parts=data.split(delimiter);if(parts.length>=3){result.rating=parts[0];result.odds=parts[1];result.bookmakerId=parts[2];}}
return result;},save:function(data){if(typeof data!=='object'){return;}
utils.stat.saveCookie(this.stateName,data.rating+','+data.odds+','+data.bookmakerId);},hightlightLabel:function(element){$(element).parents('ol:first').find('li').removeClass('active');$(element).parents('li:first').addClass('active');},chooseFullSite:function(){return this._setSitePreferenceCookie(this.SITE_TYPE_FULL);},chooseMobileSite:function(){return this._setSitePreferenceCookie(this.SITE_TYPE_MOBILE,365);},_setSitePreferenceCookie:function(siteType,expires){if(parseInt(this.IS_DEVICE_ON_HOLD,10)===1){$.cookie(this.COOKIE_NAME_SITE_PREFERENCE,siteType,{domain:this._getCookieDomain(),path:'/',expires:expires});}else{$.cookie(this.COOKIE_NAME_SITE_PREFERENCE,this.SITE_TYPE_IGNORE,{domain:this._getCookieDomain(),path:'/',expires:0});}
return true;},_getCookieDomain:function(){var domain=window.location.hostname,pieces=domain.split('.');if(pieces.length>2){pieces=pieces.slice(1);domain='.'+pieces.join('.');}
return domain;}});
namespace('diffusion.utils');diffusion.utils.common={apostropheRegexp:new RegExp('\'','g'),PRICE_TYPE_DECIMAL:1,PRICE_TYPE_FRACTIONAL:2,drawPriceButton:function(data,params){var price=data.price;var oddsType;if(typeof params.showOdds!='undefined'){oddsType=params.showOdds;}else if(price.oddsType==this.PRICE_TYPE_DECIMAL&&price.decimal>0.0){oddsType=this.PRICE_TYPE_DECIMAL;}else{oddsType=this.PRICE_TYPE_FRACTIONAL;}
var betPrice;var betPriceHistory;if(oddsType==this.PRICE_TYPE_DECIMAL){betPrice=price.decimal;betPriceHistory=price.decimalHist;}else{betPrice=price.fraction;if(betPrice=='1'||betPrice=='1/1'){betPrice='Evs';}
betPriceHistory=price.fractionHist;for(var key in betPriceHistory){if(betPriceHistory[key]=='1'||betPriceHistory[key]=='1/1'){betPriceHistory[key]='Evs';}}}
if(typeof betPrice=='undefined'||betPrice==''){return;}
var betHistory=[];if(price.suspend){betHistory.push('<em>'+betPrice+'</em>');}
if(params.showHistory&&typeof price.decimalHist!='undefined'){var totalHistoryLength=4;var shownHistoryLength=0;for(var ind in price.decimalHist){if(betPriceHistory[ind]){var historyModified=betPriceHistory[ind];betHistory.push('<em>'+historyModified+'</em>');shownHistoryLength++;}
if(shownHistoryLength==totalHistoryLength){break;}}}
params.showBookie=data.bookieId;var onclick=this.getOnClick(params,data.price);var betButton;if(!price.suspend&&'betTemplate'in params){betButton=$.tmpl(params.betTemplate,{bet:betPrice,bookmaker:bookiesData[data.bookieId].name,history:betHistory.join(''),bookmakerId:data.bookieId});}else{betButton=price.suspend?'<strong class="noBetting">No betting</strong>':this._getBetButtonCode({betPrice:betPrice,bookiesData:bookiesData,data:data});betButton+=betHistory.join('');}
data.betBlock.html(betButton);if(!price.suspend){var betTag;if('betTag'in params){betTag=params.betTag;}else{betTag='button';}
$(betTag,data.betBlock).click(onclick);}
var horseDataKey='h'+data.outcomeUid;if(typeof(horsesData)!='undefined'&&(horseDataKey in horsesData)){horsesData[horseDataKey][params.showBookie]=(data.price.fraction=='SP')?9999:data.price.decimal;}},_getBetButtonCode:function(options){var betPrice=options.betPrice;var bookiesData=options.bookiesData;var data=options.data;var betButtonCode=['<button type="button" class="btn btnBet btnLight" title="',betPrice,' with ',bookiesData[data.bookieId].name,' - Click to bet">',betPrice,'</button>'].join('');return betButtonCode;},_prepareBetBlock:function(betBlocks,betButton,betHistory,onClick){if(!betBlocks.length){return;}
if(betBlocks.length>1){var context=this;$.each(betBlocks,function(id,betBlock){context._insertBetContent(betBlock,betButton,betHistory,onClick);});}else{this._insertBetContent(betBlocks[0],betButton,betHistory,onClick);}},_insertBetContent:function(betBlock,betButton,betHistory,onClick){var html=betButton;if(betHistory.length){html+=betHistory.join('');}
betBlock.innerHTML=html;$(betBlock).find('button').click(onClick);},getOnClick:function(params,price){if(typeof price=='undefined'){return;}
var onclick=function(){var pageRef=(typeof(params['pageRef'])!='undefined')?params.pageRef:'';bookiesData.bet(price,params.showBookie,pageRef);return false;};return onclick;},convertDate:function(date){var tmp=date.split('-');return tmp[2]+'-'+tmp[1]+'-'+tmp[0];},convertTime:function(time){var splitedTime=time.split('.');if(splitedTime.length!=2){splitedTime=time.split(':');}
var h=parseInt(splitedTime[0]);h=(h>11)?h:h+12;return h+splitedTime[1];},convertStrToDiff:function(input){return input.replace(/(^\s+)|(\s+$)/g,'').replace(/ /g,'_').replace(/&acute;/gi,'').replace(/&rsquo;/gi,'').toUpperCase().replace(/[^\d\w:\-]/ig,'').replace(/_aw$/i,'').replace(/_ire$/i,'');},convertHorseNameToDiff:function(input){return input.replace(/(^\s+)|(\s+$)/g,'').replace(/ /g,'_').replace(/&acute;/g,'').replace(/&rsquo;/g,'').toUpperCase().replace(/[^\d\w:\-]/ig,'');},convertCourseNameToDiff:function(input){return input.replace(/(^\s+)|(\s+$)/g,'').replace(/ /g,'_').replace(/&acute;/g,'').toUpperCase().replace(/[^\d\w:\-]/ig,'').replace(/_aw/i,'');},bookiesCached:{},getBookieIdByName:function(bookieNameRaw){if(typeof(bookieNameRaw)=='undefined'){return null;}
if(typeof(this.bookiesCached[bookieNameRaw])!='undefined'){return this.bookiesCached[bookieNameRaw];}
var bookieName=bookieNameRaw.replace(/_/g,' ').toUpperCase();var result=null;for(var i in bookiesData){if(i.indexOf('B')==0&&bookiesData[i].betName.toUpperCase()==bookieName){this.bookiesCached[bookieNameRaw]=i;result=i;break;}}
return result;},getEachWayTerms:function(){if(!diffusion.eachWay){diffusion.eachWay={};}
return diffusion.eachWay;},correctAllPrices:function(data){if(typeof data.decimal!='undefined'){data.decimal=this.correctPrice(data.decimal);}
if(typeof data.fraction!='undefined'){data.fraction=this.correctPrice(data.fraction);}
if(typeof data.decimalHist!='undefined'){data.decimalHist=this.correctHistPrices(data.decimalHist);}
if(typeof data.fractionHist!='undefined'){data.fractionHist=this.correctHistPrices(data.fractionHist);}
return data;},correctHistPrices:function(data){for(i in data){if(data[i]!=""){data[i]=this.correctPrice(data[i]);}}
return data;},correctPrice:function(price){if(typeof price!="string"){price=price.toString();}
if(price.substr(price.length-2)=='.0'){price=price.substr(0,price.length-2);}else if(price.substr(price.length-2)=='/1'){price=price.substr(0,price.length-2);}
return price;}};
namespace('diffusion.utils');if(typeof diffusion.utils.outcome=='undefined'){diffusion.utils.outcome={outcomes:{},competition:{},setData:function(data){for(var id in data){var outcome=data[id];if(typeof this.outcomes[outcome.name]=='undefined'){this.outcomes[outcome.name]=this.getOutcome(outcome,true);}else{$.extend(this.outcomes[outcome.name],this.getOutcome(outcome,false));}
if(typeof outcome.priceboxId!='undefined'){if(typeof this.competition[outcome.priceboxId]=='undefined'){this.competition[outcome.priceboxId]=[outcome.outcomeId];}else{this.competition[outcome.priceboxId].push(outcome.outcomeId);}}}},getOutcome:function(data,addEmpty){var keys=['priceboxId','outcomeId','id'];var element={};for(var key in keys){if(typeof data[keys[key]]!='undefined'){element[keys[key]]=data[keys[key]];}else if(addEmpty){element[keys[key]]=0;}}
return element;},getDataByName:function(name){var result=this.outcomes[name];if(typeof result=='undefined'){result=this.getOutcome({});}
return result;},getOutcomeUidByName:function(name){var data=this.getDataByName(name);return data.outcomeId;},getPriceboxByName:function(name){var data=this.getDataByName(name);return data.priceboxId;},getIdByName:function(name){var data=this.getDataByName(name);return data.id;},getOutcomeUidByRace:function(priceboxId){var result=this.competition[priceboxId];if(typeof result=='undefined'){result=[];}
return result;},getNameByOutcomeId:function(outcomeId){var returnOutcomeName='';for(var outcomeName in this.outcomes){if(this.outcomes[outcomeName].outcomeId==outcomeId){returnOutcomeName=outcomeName;break;}}
return returnOutcomeName;}};};
diffusion.utils.topic={PREFERRED_BOOKMAKER:'/PREFERRED_BOOKMAKER',preferredBookmaker:null,setPreferredBookmaker:function(value){this.preferredBookmaker=value;},getPreferredBookmaker:function(){return this.preferredBookmaker;},prepareTopic:function(topic){if(this.preferredBookmaker){topic=this.processPreferredBookmakres(topic);}
return topic;},processPreferredBookmakres:function(topic){var prefBookmakerPos=topic.indexOf(this.PREFERRED_BOOKMAKER);if(prefBookmakerPos>0){var prefBookmaker=this.getPreferredBookmaker();var topicReplaced=topic;if(prefBookmaker=='BEST_ODDS'){prefBookmaker='BOOK_ALL';topicReplaced=topicReplaced.replace(/^GENERAL\//,'AGG_GENERAL/');}
topic=topicReplaced.replace(this.PREFERRED_BOOKMAKER,'/'+prefBookmaker);}
return topic;}};
namespace('diffusion.types');diffusion.types.AbstractPrice=function(){};!function(){this.prefix='';this.prefixEachWay='';this.template='';this.bookmakerId='';this.callbacks='';this.templateNamespace='diffusion-price.';this.mainBookmaker='';this.INDEX_TOPIC_SPORT_NAME=1;this.INDEX_TOPIC_DATE=2;this.INDEX_TOPIC_COMPETITION_NAME=3;this.INDEX_TOPIC_EVENT_NAME=4;this.INDEX_TOPIC_MARKET_NAME=5;this.INDEX_TOPIC_OUTCOME_NAME=6;this.INDEX_TOPIC_BOOKMAKER_NAME=7;this.BEST_ODDS_WWW='BEST_ODDS';this.BEST_ODDS='BEST_ODDS';this.BOOKMAKER_WH='WH_OXI';this.TOPIC_VALUE_EACHWAY='EACH_WAY';this.TOPIC_VALUE_INFO='INFO';this.ACTION_CLEAR=1;this.ACTION_UPDATE=2;this.initCommon=function(data){this.data=data.data;this.prefix=data.prefix;this.prefixEachWay=data.prefixEachWay;this.prefixInfo=data.prefixInfo;this.useBookmaker=data.useBookmaker;this.preferredFilter=data.preferredFilter;this.storage=data.storage;this.pageRef=data.pageRef;this.mainBookmaker=data.mainBookmaker;return true;};this.init=function(data){this.initCommon(data);};this.proceed=function(){};this.getStorageData=function(){return{key:0};};this.getClearKey=function(){return this._getOutcomeName();};this.getBlock=function(){return null;};this.render=function(action){if(this.template){var block=this.getBlock();if(block&&block.length){var bookmaker=this._getBookmakerName();if(this.mainBookmaker===''){var preferredBookmaker=rp.Bookmaker.getPreferredAbbr();if(this.preferredFilter){if(preferredBookmaker===this.BEST_ODDS){bookmaker=this.BEST_ODDS;}else if(preferredBookmaker!=bookmaker){return false;}}}else if(bookmaker!=this.mainBookmaker){return false;}
var outcomeName=this._getOutcomeName();var bookmakerdToDraw=[bookmaker];if(this._isAddBestOdds(bookmaker)){bookmakerdToDraw.push(this.BEST_ODDS);}
for(var currentBookmakerIndex in bookmakerdToDraw){var currentBookmaker=bookmakerdToDraw[currentBookmakerIndex];block=this.getBlock(rp.Bookmaker.getIdByName(currentBookmaker));var params=this._getTemplateParams(currentBookmaker,action);if(params.canShow){var html='';if(action==this.ACTION_UPDATE){html=$.tmpl(this.template,params);}
block.html(html);var newBlock=this.getOnclickBlock(block);if(newBlock){block=newBlock;}
block.unbind('click.price');if(action==this.ACTION_UPDATE){var clickCallback=this._getOnclick(currentBookmaker);if(typeof clickCallback==='function'){block.bind('click.price',clickCallback);}}}}}}};this._isAddBestOdds=function(bookmaker){return false;}
this.clear=function(){this.render(this.ACTION_CLEAR);};this.draw=function(){this.render(this.ACTION_UPDATE);};this._getOutcomeName=function(){return this.data.topic[this.INDEX_TOPIC_OUTCOME_NAME];};this._getOutcomeFormattedName=function(){var outcomeName=this._getOutcomeName();return outcomeName.replace(/_/g,' ');};this._getOutcomeUcFirstName=function(){var name=this._getOutcomeFormattedName();return this._getOutcomeFormattedName().replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase();});};this._getSportName=function(){return this.data.topic[this.INDEX_TOPIC_SPORT_NAME];};this._getEventName=function(){return this.data.topic[this.INDEX_TOPIC_EVENT_NAME];};this._getDate=function(){return this.data.topic[this.INDEX_TOPIC_DATE];};this._getCompetitionName=function(){return this.data.topic[this.INDEX_TOPIC_COMPETITION_NAME];};this.isPriceDecimal=function(){return common.price.isPriceDecimal();};this._getBookmakerName=function(){var bookmaker=this.data.topic[this.INDEX_TOPIC_BOOKMAKER_NAME];if(bookmaker===this.BEST_ODDS_WWW){bookmaker=this.BEST_ODDS;}
return bookmaker;};this._getBookmakerId=function(bookmaker){var bookmakerName=bookmaker||this._getBookmakerName();var bookmakerId=rp.Bookmaker.getIdByName(bookmakerName);return bookmakerId;};this._getBookmakerFormattedName=function(bookmaker){var bookmakerName=bookmaker||this._getBookmakerName();var bookmakerId=this._getBookmakerId(bookmakerName);return bookmakerId?rp.Bookmaker[bookmakerId].name:'';};this._getTemplateParams=function(){return{canShow:false};};this._getOnclick=function(){return false;};this.preProcess=function(listener){this._callback('preProcess',listener);};this.postProcess=function(listener){this._callback('postProcess',listener);};this.getOnclickBlock=function(betBlock){return this._callback('getOnclickBlock',betBlock);};this._callback=function(name,listener){if(this.callbacks&&this.callbacks in diffusion.callbacks&&name in diffusion.callbacks[this.callbacks]){return diffusion.callbacks[this.callbacks][name](this,listener);}else{return null;}};this._getFromStorage=function(date,competitionName,eventName,outcomeName,bookmakerName){var result=this.storage;date=date?('d'+date):date;eventName=eventName?('e'+eventName):eventName
$.each([date,competitionName,eventName,outcomeName,bookmakerName],function(index,value){if(result&&value){result=result[value];}});return result;};this.getEventStorage=function(){return this._getFromStorage(this._getDate(),this._getCompetitionName(),this._getEventName());};this.getOutcomeStorage=function(){return this._getFromStorage(this._getDate(),this._getCompetitionName(),this._getEventName(),this._getOutcomeName());};this.getBookmakerStorage=function(){return this._getFromStorage(this._getDate(),this._getCompetitionName(),this._getEventName(),this._getOutcomeName(),this._getBookmakerName());};}.call(diffusion.types.AbstractPrice.prototype);
namespace('diffusion.types');diffusion.types.Price=function(){};extend(diffusion.types.Price,diffusion.types.AbstractPrice,function($class,$super){this.INDEX_DATA_FRACTIONAL_PRICE=1;this.INDEX_DATA_DECIMAL_PRICE=2;this.INDEX_DATA_BETSLIP=3;this.INDEX_DATA_IS_SUSPENDED=5;this.INDEX_DATA_DIRECTION=9;this.INDEX_BETSLIP_OUTCOME=0;this.INDEX_BETSLIP_PRICE=2;this.INDEX_BETSLIP_EVENT=3;this.INDEX_BETSLIP_MEETING=4;this.POPUP_TIMEOUT=2000;this.POPUP_SELECTOR='.has-popup';this.POPUP_TEMPLATE='diffusion-price.price-popup';this.EVENT_BEST_ODDS_BLUR='click.bestOddsBlur';this.betslip=null;this.bestOddsSelector='bestOddsBlock';this.getBlock=function(overrideBookmakerId){var id=this.prefix+this._getOutcomeName();if(this.useBookmaker){id+='_'+(overrideBookmakerId?overrideBookmakerId:this._getBookmakerId());}
return $(id);};this.init=function(data){if(this.initCommon(data)){this.template=data.templates.price?(this.templateNamespace+data.templates.price):'';this.templateBestOdds=data.templates.bestOdds?(this.templateNamespace+data.templates.bestOdds):'';this.callbacks=data.callbacks.price||{};return true;}else{return false;}};this._getTemplateParams=function(bookmaker,action){var canShow=true;if(action==this.ACTION_CLEAR){return{canShow:canShow};}
var price,title,suspended,direction;if(bookmaker==this.BEST_ODDS){var prices=this.getOutcomeStorage();if(!prices||!(this.BEST_ODDS in prices)){return{canShow:false}}
var priceDecimal=prices[this.BEST_ODDS].decimal;price=this._getPrice(this.isPriceDecimal(),prices[this.BEST_ODDS]);var bookmakers=[];for(var bookie in prices){if(bookie==this.BEST_ODDS||$.inArray(bookie,diffusion.config.bookmakersAllowed)==-1){continue;}
if(!prices[bookie].suspended&&prices[bookie].decimal==priceDecimal){bookmakers.push(this._getBookmakerFormattedName(bookie))}}
title=price+' with '+bookmakers.join(', ')+' - Click to bet';suspended=prices[this.BEST_ODDS].suspended;direction=prices[this.BEST_ODDS].direction;}else{price=this._getPrice(this.isPriceDecimal());title=price+' with '+this._getBookmakerFormattedName(bookmaker)+' - Click to bet';suspended=this._isSuspended();direction=this._getDirection();}
return{bookmakerId:this._getBookmakerId(bookmaker),price:price,title:title,suspended:suspended,direction:direction,canShow:canShow}};this._getPrice=function(isPriceDecimal,prices){var result='';var decimal=prices?prices.decimal:this._getPriceDecimal();var fractional=prices?prices.fractional:this._getPriceFractional();var suspended=prices?prices.suspended:this._isSuspended();if(isPriceDecimal){result=decimal;}else{result=fractional;}
if(fractional=="SP"||decimal=='0.0'){result="SP";}
if(suspended){result='&mdash;';}
return result;};this._getPriceDecimal=function(){var price=this.data.data[this.INDEX_DATA_DECIMAL_PRICE];if(price.substr(price.length-2)=='.0'){price=price.substr(0,price.length-2);}
return price;};this._getPriceFractional=function(){var price=this.data.data[this.INDEX_DATA_FRACTIONAL_PRICE];if(price.substr(price.length-2)=='/1'){price=price.substr(0,price.length-2);}
if(price=='1'){price='Evs';}
return price;};this._isSuspended=function(outcome,bookmaker){var isSuspended=parseInt(this.data.data[this.INDEX_DATA_IS_SUSPENDED])==1;return isSuspended;};this.getStorageData=function(){var returnData={};returnData['d'+this._getDate()]={};returnData['d'+this._getDate()][this._getCompetitionName()]={};returnData['d'+this._getDate()][this._getCompetitionName()]['e'+this._getEventName()]={};returnData['d'+this._getDate()][this._getCompetitionName()]['e'+this._getEventName()][this._getOutcomeName()]={};returnData['d'+this._getDate()][this._getCompetitionName()]['e'+this._getEventName()][this._getOutcomeName()][this._getBookmakerName()]={decimal:this._getPriceDecimal(),decimalForSort:this._isSuspended()?999999:this._getPriceDecimal(),fractional:this._getPriceFractional(),fraction:this._getPriceFractional(),suspended:this._isSuspended(),direction:this._getDirection(),price:this._getPrice(this.isPriceDecimal()),outcomeTopicID:this._getOutcomeName(),outcomeName:this._getOutcomeFormattedName(),sportTopicID:this._getSportName(),bookiePrice:this._getBookiePrice(),bookieEvent:this._getBookieEvent(),bookieOutcome:this._getBookieOutcome(),bookieMeeting:this._getBookieMeeting(),bookmakerName:this._getBookmakerFormattedName(),bookmakerId:this._getBookmakerId()};return returnData;};this._getOnclick=function(bookmaker,doNotShowBubble){function capitalize(name){var result=String(name||'').split('_');for(var i=0,l=result.length;i<l;i++){result[i]=utils.string.capitalize(result[i]);}
return result.join(' ');}
var context=this;var onClick;var storedBookmaker=context._getFromStorage(context._getDate(),context._getCompetitionName(),context._getEventName(),context._getOutcomeName(),bookmaker);if(storedBookmaker&&storedBookmaker.suspended){onClick=false;}else if(RPOST.isIPadWebView){onClick=function(){var eachWayData=context._getFromStorage(context._getDate(),context._getCompetitionName(),context._getEventName(),'EACH_WAY',bookmaker);var fraction=storedBookmaker.fraction;if(fraction.indexOf('/')===-1){fraction+='/1';}
var location='rphd://betslip?status=good'+'&corse='+capitalize(context._getCompetitionName())+'&horseId='+'&raceId='+'&fraction='+fraction+'&decimal='+storedBookmaker.decimal+'&horseName='+capitalize(context._getOutcomeName())+'&raceTime='+context._getEventName().replace(/(\d{2})(\d{2})/,'$1:$2')+'&betslip='+storedBookmaker.bookieOutcome+'%7C%7C%7C%7C'+'&raceDate='+context._getDate();if(eachWayData){var eachWay=rp.betting.EachWay.create({num:eachWayData.ewtOffered[0],den:eachWayData.ewtOffered[1],places:eachWayData.ewtPlaces});if(eachWay.numberOfPlaces()>=2){location+='&eachWay=yes'+'&eachWayData='+eachWayData.ewtOffered[0]+'/'+eachWayData.ewtOffered[1]+'%7C'+eachWayData.ewtPlaces}}
window.location=location;}}else if(bookmaker==this.BEST_ODDS){onClick=function(){diffusion.BestOddsPopup.getInstance().showPopup(this,{outcomeName:context._getOutcomeName(),bookmakers:context._getFromStorage(context._getDate(),context._getCompetitionName(),context._getEventName(),context._getOutcomeName()),eachWay:context._getFromStorage(context._getDate(),context._getCompetitionName(),context._getEventName(),'EACH_WAY'),info:context._getFromStorage(context._getDate(),context._getCompetitionName(),context._getEventName(),'INFO'),listener:context});return false;}}else{var provider=rp.Bookmaker.getProvider(bookmaker);if(provider){var preparedTopic=this.data.topic.slice(0,-1),eachWayTopic,infoTopic;preparedTopic[this.INDEX_TOPIC_BOOKMAKER_NAME]=bookmaker;preparedTopic[this.INDEX_TOPIC_OUTCOME_NAME]=this.TOPIC_VALUE_EACHWAY;eachWayTopic=preparedTopic.join('/');preparedTopic[this.INDEX_TOPIC_OUTCOME_NAME]=this.TOPIC_VALUE_INFO;infoTopic=preparedTopic.join('/');onClick=function(){diffusion.BestOddsPopup.getInstance().hidePopup();if(!doNotShowBubble){var $block=$(this);var $findBubble=$block.find('.bubbleShow');var $popup=$.tmpl(context.POPUP_TEMPLATE);if($findBubble.length){$block=$findBubble;}
$block.rpBubble({position:'top',extraClass:'addBubble',insertHTML:$popup}).rpBubble('show');if(typeof(_pricePopupTimerHandler)!='undefined'){clearTimeout(_pricePopupTimerHandler);}
_pricePopupTimerHandler=setTimeout(function(){$block.rpBubble('hide').rpBubble('destroy');},context.POPUP_TIMEOUT);}
var bookmakerIntegrationApplication=rp.www.betslip.Application.getInstance(),price=storedBookmaker.fractional;if(typeof RPOST.clickReport=='function'){RPOST.clickReport({pricebox_uid:diffusion.utils.outcome.getPriceboxByName(storedBookmaker.outcomeTopicID),outcome_uid:diffusion.utils.outcome.getOutcomeUidByName(storedBookmaker.outcomeTopicID),bookmaker_uid:context._getBookmakerId(bookmaker).substr(1),page_description:"("+RPOST.siteType+") "+context.pageRef,decimal_price:storedBookmaker.decimal,sport_desc:storedBookmaker.sportTopicID});}
bookmakerIntegrationApplication.selection({id:storedBookmaker.bookieOutcome,price:price==='SP'?null:price,isSP:price==='SP',data:{horseName:capitalize(context._getOutcomeName()),courseName:capitalize(context._getCompetitionName()),raceDate:context._getDate(),time:context._getEventName().replace(/(\d{2})(\d{2})/,'$1:$2'),eachWayTopic:eachWayTopic,infoTopic:infoTopic}},bookmaker);return false;};}else{onClick=function(){diffusion.BestOddsPopup.getInstance().hidePopup();rp.Bookmaker.bet(storedBookmaker,context._getBookmakerId(bookmaker),context.pageRef);return false;};}}
return onClick;};this._getBookiePrice=function(){var betslip=this._getBetslip();return betslip[this.INDEX_BETSLIP_PRICE];};this._getBookieEvent=function(){var betslip=this._getBetslip();return betslip[this.INDEX_BETSLIP_EVENT];};this._getBookieOutcome=function(){var betslip=this._getBetslip();return betslip[this.INDEX_BETSLIP_OUTCOME];};this._getBookieMeeting=function(){var betslip=this._getBetslip();return betslip[this.INDEX_BETSLIP_MEETING];};this._getBetslip=function(){if(!this.betslip){var betslip=this.data.data[this.INDEX_DATA_BETSLIP];this.betslip=betslip.split('|');}
return this.betslip;};this._getDirection=function(){return this.data.data[this.INDEX_DATA_DIRECTION];};this.proceed=function(){diffusion.BestOddsPopup.getInstance().updatePopup(this.getBlock('B0'),{bookmakers:this.getOutcomeStorage(),eachWay:this._getFromStorage(this._getDate(),this._getCompetitionName(),this._getEventName(),'EACH_WAY'),info:this._getFromStorage(this._getDate(),this._getCompetitionName(),this._getEventName(),'INFO'),listener:this});return;};this._isAddBestOdds=function(bookmaker){if(bookmaker!=this.BEST_ODDS&&this.useBookmaker){return true}
return false;}});
namespace('diffusion.types');diffusion.types.PriceHistory=function(){};extend(diffusion.types.PriceHistory,diffusion.types.Price,function($class,$super){this.INDEX_DATA_BETSLIP=0;this.INDEX_DATA_IS_SUSPENDED=1;this.INDEX_DATA_FRACTIONAL_PRICE_HISTORY=2;this.INDEX_DATA_DECIMAL_PRICE_HISTORY=7;this.isShowDenominatorOne=false;this.showEndingZero=false;this.init=function(data){if(!this.initCommon(data)){return false;}
this.isShowDenominatorOne=data.isShowDenominatorOne||false;this.showEndingZero=data.showEndingZero||false;this.template=data.templates.priceHistory?(this.templateNamespace+data.templates.priceHistory):'';this.callbacks=data.callbacks.priceHistory||{};return true;};this._getHistory=function(isPriceDecimal,prices){var decimal=prices?prices.historyDecimal:this._getHistoryDecimal();var fractional=prices?prices.historyFractional:this._getHistoryFractional();var history=[];if(isPriceDecimal){history=decimal;}else{history=fractional;}
for(var i in history){if(fractional[i]=="SP"||decimal[i]=='0.0'){history[i]="SP";}}
return history;};this._getPriceDecimal=function(index){index=index||0;var price=this.data.data[this.INDEX_DATA_DECIMAL_PRICE_HISTORY+index];if(this.showEndingZero){price=parseFloat(price).toFixed(2);}else{if(price.substr(price.length-2)=='.0'){price=price.substr(0,price.length-2);}}
return price;};this._getPriceFractional=function(index){index=index||0;var price=this.data.data[this.INDEX_DATA_FRACTIONAL_PRICE_HISTORY+index];if(!this.isShowDenominatorOne&&price.substr(price.length-2)=='/1'){price=price.substr(0,price.length-2);}
if(price=='1'){price='Evs';}
return price;};this._getHistoryFractional=function(){var price=[];var currentPrice;for(var i=0;i<5;i++){currentPrice=this._getPriceFractional(i);if(currentPrice){price.push(currentPrice);}else{break;}}
return price;};this._getHistoryDecimal=function(){var price=[];var currentPrice;for(var i=0;i<5;i++){currentPrice=this._getPriceDecimal(i);if(currentPrice){price.push(currentPrice);}else{break;}}
return price;};this._getTemplateParams=function(bookmaker,action){var params=$super._getTemplateParams.apply(this,arguments);if(action==this.ACTION_CLEAR){return{canShow:params.canShow};}
if(params.canShow){params.historyDecimal=this._getHistoryDecimal();params.historyFractional=this._getHistoryFractional();params.priceHistory=this._getHistory(this.isPriceDecimal());}
return params;};});
var rpDates={gsMonthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],gsDayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday']};Date.prototype.format=function(format){if(!this.valueOf()){return' ';}
var context=this,expression=new RegExp('(yyyy|mmmm|mmm|mm|0mm|dddd|ddd|dd|0dd|hh|nn|mn|ss|a\/p)','gi');return format.replace(expression,function($1){switch($1.toLowerCase()){case'yyyy':return context.getFullYear();case'mmmm':return rpDates.gsMonthNames[context.getMonth()];case'mmm':return rpDates.gsMonthNames[context.getMonth()].substr(0,3);case'mm':return(context.getMonth()+1);case'0mm':return('0'+(context.getMonth()+1)).slice(-2);case'dddd':return rpDates.gsDayNames[context.getDay()];case'ddd':return rpDates.gsDayNames[context.getDay()].substr(0,3);case'dd':return context.getDate();case'0dd':return('0'+(context.getDate())).slice(-2);case'hh':return((h=context.getHours()%12)?h:12);case'nn':return context.getMinutes();case'mn':return((context.getMinutes()<10)?'0'+context.getMinutes():context.getMinutes());case'ss':return context.getSeconds();case'a/p':return context.getHours()<12?'a':'p';}});};
(function($){var hasTouch='ontouchstart'in window;var EVENT_TAP_START=hasTouch?'touchstart':'mousedown';var EVENT_TAP_END=hasTouch?'touchend':'mouseup';var EVENT_TAP_MOVE=hasTouch?'touchmove':'mousemove';var getBrowserEvent=function(e){return(hasTouch?e.originalEvent.touches[0]:e);};$.event.special.swipe={setup:function(){$(this).bind(EVENT_TAP_START+'.startSwap',function(e){e=getBrowserEvent(e);var $el=$(this);var startX=e.screenX;var startY=e.screenY;var endX=startX;var endY=startY;var startTime=new Date().getTime();$(document).bind(EVENT_TAP_MOVE+'.moveSwap',function(ev){var event=getBrowserEvent(ev);endX=event.screenX;endY=event.screenY;if(Math.abs(startX-endX)>16){ev.preventDefault();}}).unbind('.endSwap').bind(EVENT_TAP_END+'.endSwap',function(){var deltaX=endX-startX;var deltaY=endY-startY;var deltaTime=(new Date().getTime())-startTime;if(Math.abs(deltaX)>60&&Math.abs(deltaY)<50){var direction=deltaX<0?'left':'right';$el.trigger('swipe',[direction,deltaTime]);}
$(document).unbind('.moveSwap').unbind('.endSwap');});});},teardown:function(){$(this).unbind('.startSwap');$(document).unbind('.moveSwap').unbind('.endSwap');}};})(jQuery);
var webApp=webApp||{};webApp.WhErrorHandler=function(settings){var reporters=settings||{};var ERROR_CODE_SOMETHING_WRONG=-7;var _doNothing=function(){};var _reporters={user:reporters.user||_doNothing,developer:reporters.developer||_doNothing};return{'generic':function(data,errorSource){var reporters=_reporters;var statusCode=(typeof(data.code)=='function')?data.code():null;var statusMessage=(typeof(data.message)=='function')?data.message():null;if(statusCode>1&&statusMessage){reporters.user(data.message());}else if(statusCode==ERROR_CODE_SOMETHING_WRONG){reporters.user('William Hill says: "'+data.message()+'"');}else if(statusCode<0){reporters.user('Unexpected error connecting to William Hill.');}
reporters.developer({statusCode:statusCode,statusMessage:statusMessage,errorSource:errorSource});}};};
var webApp=webApp||{};webApp.ErrorHandler={actionCore:'Core',actionWh:'WH',_category:'Errors',_errorTracker:null,_ignoreList:['Redirect','Deligate'],setErrorTracker:function(tracker){this._errorTracker=tracker;},getErrorTracker:function(){return this._errorTracker;},process:function(message,event,action){action=action||this.actionCore;if(this._ifShouldProcess(event)){var str=action+': '+message;if(event){str+='\n'+event.stack;}
this._console(str);this.getErrorTracker().trackEvent(this._category,action,message);}},_ifShouldProcess:function(event){var isIgnoreEvent=event&&event['name']&&$.inArray(event['name'],this._ignoreList)>=0;var isNoTracker=this.getErrorTracker()==null;var result=true;if(isNoTracker||isIgnoreEvent){result=false;}
return result;},_console:function(message){console.log(message);}};
var webApp=webApp||{};webApp.userSettings=(function(){var _storage;return{set:function(key,val){_storage.set(key,val);},get:function(key){return(typeof _storage=='object')?_storage.get(key):null;},remove:function(key){_storage.remove(key);},setStorage:function(storage){_storage=storage;},setDefaults:function(version){if(this.get('version')==version){return;}
_storage.removeAll();var settings={version:version,odds:'fractional',sortBy:'number',cardTab:'card',cardsListBy:'meetings',showUserBalance:true};for(var key in settings){this.set(key,settings[key]);}}};})();
var webApp=webApp||{};webApp.mintClient=(function(){var _params={};var _login=null;var _password=null;var _mintService=null;var _errorHandlers={};return{init:function(params){this.reset();this.setParams(params);},reset:function(){_params={};_login=null;_password=null;_mintService=null;_errorHandlers={};},registerDefaultErrorHandlers:function(){this.registerErrorHandler(-20,this.sessionExpired);this.registerErrorHandler(-21,this.sessionExpired);this.registerErrorHandler(-3,this.sessionExpired);this.registerErrorHandler(106,this.sessionExpired);},registerErrorHandler:function(errorNo,handler){_errorHandlers[errorNo]=handler;},unregisterErrorHandler:function(errorNo){delete _errorHandlers[errorNo];},sessionExpired:function(){if(!_login){return;}
var defaultParams=$.extend({},_mintService.getDefaultParams());delete defaultParams.token;_mintService.setDefaultParams(defaultParams);_mintService.addRequestToQueueStart(_mintService.getLastRequest());_mintService.unshiftRequest('AuthenticateAccount',{'userName':_login,'password':_password},function(){},function(){_login=null;_password=null;_mintService.abortAll();});},saveCredentials:function(login,password){_login=login;_password=password;},getUserName:function(){return _login;},isLoggedIn:function(){return _login?true:false;},request:function(name,params,onSuccess,onError){var successCallback=function(data){if(!data){return;}
var status='';if(data.hasOwnProperty('statusCode')){status=data.statusCode;}else if(data.hasOwnProperty('status')){status=data.status;data.statusCode=status;}
if(status=='1'){onSuccess(data);}else if(status){if(typeof(_errorHandlers[status])=='function'){_errorHandlers[status](data);}else{onError(data);}}};_mintService.request(name,params,successCallback,onError);},setService:function(service){_mintService=service;},getService:function(){return _mintService;},setParams:function(params){_params=params||params;},getParams:function(){return _params;},getErrorHandler:function(errorNo){return _errorHandlers[errorNo];}};})();
(function($){$.fn.switchButton=function(options){return this.each(function(){if($(this).data('switchButton')){var thisData=$(this).data('switchButton');if(typeof options=='string'){switch(options){case'check':thisData.check();break;case'uncheck':thisData.uncheck();break;case'disabled':thisData.disable();break;case'enabled':thisData.enable();break;case'highlightPrice':thisData.highlightPrice();break;}}}else{$(this).data('switchButton',new SB(this,options));}});};var SB=function(el,options){this.opt=$.extend({checked:true,disabled:false,enableText:'YES',enableId:'',disableText:'NO',disableId:'',activeClass:'switchBtnActive',disabledClass:'switchBtnDisabled',highlightPriceClass:'switchBtnDisabled_highlightPrice',extraClass:''},options);this.$input=$(el);this.$button=null;this.init();};$.extend(SB.prototype,{init:function(){this.$input.attr('checked',this.opt.checked);this.createHtml();if(!this.$input.is(':disabled')&&!this.opt.disabled){this.enable();}else{this.disable();}},createHtml:function(){this.$input.wrap('<label class="switchBtn '+this.opt.extraClass+'"></label>');this.$button=this.$input.parent();this.$button.append('<span id="'+this.opt.enableId+'" class="enableText">'+this.opt.enableText+'</span><span id="'+this.opt.disableId+'" class="disableText">'+this.opt.disableText+'</span>');this.setActiveClass();},addEvents:function(){var context=this;var timeId;this.$button.unbind('.switchButtonClick').bind('click.switchButtonClick',function(e){e.preventDefault();var timeVal=$(this).closest('.bricks').length?0:300;clearTimeout(timeId);timeId=setTimeout(function(){var state=!context.$input.attr('checked');context.$input.attr('checked',state).trigger('change',[]);context.setActiveClass();if(typeof context.opt.callback=='function'){context.opt.callback(state,context.$button);}},timeVal);});},setActiveClass:function(activeId){this.$button.toggleClass(this.opt.activeClass,!!this.$input.attr('checked'));},check:function(){this.$input.attr('checked',true);this.setActiveClass();},uncheck:function(){this.$input.attr('checked',false);this.setActiveClass();},enable:function(){this.$button.removeClass(this.opt.disabledClass);this.$input.attr('disabled',false);this.addEvents();},disable:function(){this.$button.addClass(this.opt.disabledClass);this.$input.attr('disabled',true);this.$button.unbind('.switchButtonClick');},highlightPrice:function(){this.$button.addClass(this.opt.highlightPriceClass);}});})(jQuery);
var webApp=webApp||{};webApp.core=(function(){var _configs={};var _currentControllerName='';var _controllers=[];var _helpers={};var ORIENTATION_PORTRAIT='Portrait';var ORIENTATION_LANDSCAPE='Landscape';var DEFAULT_CONTROLLER_NAMESPACE='webApp';var $body=$([]);var bodyClasses='';var $focusLink=$([]);return{init:function(configs){_configs=configs||{};var context=this;var isWideBreakpointReached=$(window).width()>1140;_configs.dispatchCallback=function(requestParams){webApp.core.dispatch(requestParams);};if(webApp.isIOS_6&&!webApp.isTablet){window.scroll(0,1);}
$body=$('body');this.bindChangeOrientation();if(!webApp.isTablet){bodyClasses+=' mobileBrowser';}else{bodyClasses+=' desktopBrowser';}
if(!webApp.isMobile){bodyClasses+=' desktopPC';}
if(webApp.isTabletScreen){bodyClasses+=' tabletScreen';}
if(webApp.isAndroid){bodyClasses+=' android';if(webApp.isAndroid_4){bodyClasses+=' android4';}}
if(webApp.isIDevice){bodyClasses+=' iOS';if(webApp.isIOS_5){bodyClasses+=' iOS5';}}
if(navigator.userAgent.match(/iPad;.*CPU.*OS 7_\d/i)){bodyClasses+=' ipad_ios7';}
if(!webApp.HorseDetailsController){bodyClasses+=' greyhoundBet';}
$body.addClass(bodyClasses);var viewManager=context.getViewManager();var highlightAnimationId;$(document).on('click.highlight',function(e){$focusLink.removeClass('highlight highlightFade');var $newFocusLink=$([]);if(e.target.tagName.toLowerCase()=='a'){$newFocusLink=$(e.target);}else if($(e.target).closest('a').length){$newFocusLink=$(e.target).closest('a');}else{return;}
$focusLink=$newFocusLink;if($focusLink.css('position')!='absolute'){$focusLink.addClass('highlight');clearTimeout(highlightAnimationId);highlightAnimationId=setTimeout(function(){$focusLink.addClass('highlightFade');},150);}});$('span.btnBack').on('click.backClick',function(){window.history.go(-1);});$('select').on('change.hideBar blur.hideBar',function(){webApp.viewManager.hideUrlBar();});if(typeof webApp.prefBookmaker!=='undefined'){webApp.prefBookmaker.set();}
if(webApp.isIDevice&&!webApp.isIPad){var orient=context.getOrientation();$(window).bind('resize.fixSize',function(){var nowOrient=context.getOrientation();if(orient==nowOrient){context.setCssClass();}else{orient=nowOrient;}});}
webApp.$mainTabs.show();this.getViewManager().init(_configs).setHelpers(_helpers);this.getUrlManager().init(_configs);if(typeof webApp.prefBookmaker!=='undefined'){if(!webApp.userSettings.get('isDefaultBookieSet')||!webApp.userSettings.get('isLandingJourneyComplete')){$(window).bind('switchpage.landingBox',function(e,cn){if(cn!='news-story'){setTimeout(function(){if(webApp.isDesktop&&!webApp.HorseDetailsController&&isWideBreakpointReached){webApp.landing.initDesktopLanding();}
else{webApp.landing.show({template:'landing',callback:webApp.landing.bookieCallback});}},200);$(window).unbind('switchpage.landingBox');}});}
webApp.prefBookmaker.set();}},dispatch:function(requestParams){var controllerName=requestParams[0]||'';var request=requestParams[1]||{};$(window).trigger('changeHistory',[requestParams,_currentControllerName]);sessionStorage.setItem('prevControllerName',_currentControllerName);if(_currentControllerName!=controllerName){for(var i=0;i<_controllers.length;i++){_controllers[i].destroy();}
_controllers=[];try{var includes=_configs.controllers[controllerName].include;if(includes){for(var i=0;i<includes.length;i++){_controllers.push(this._setupController(includes[i],controllerName));}}else{_controllers.push(this._setupController(controllerName));}}catch(e){console.log(e.name+': '+e.message+'. Controller name: '+controllerName);return;}
$(window).trigger(webApp.EVENT_CHANGE_CONTROLLER,[requestParams]);_currentControllerName=controllerName;}
$(window).trigger(webApp.EVENT_CHANGE_HASH,[requestParams]);try{for(var i=0;i<_controllers.length;i++){_controllers[i].setRequestParams(request).execute();}}catch(e){if(e.name=='Redirect'){return;}
console.log('Internal error: '+e.name+': "'+e.message+'" in '+e.fileName+' ('+e.lineNumber+')');}},_setupController:function(controllerName,parentName){var controllerClassName=this._getControllerClassName(controllerName);var controllerConstructor=this.getControllerConstructor(controllerClassName);if(!controllerConstructor){if(controllerName!='error404'){this.dispatch(['error404',{'errorHash':window.location.hash}]);}
throw{name:'ParamError',message:'Controller class "'+controllerClassName+'" doesn`t exists!'};}
var configs=$.extend({},_configs.controllers[controllerName]);var controller=new controllerConstructor(controllerName,configs);controller.setCore(this);if(parentName){controller._parentName=parentName;}
return controller;},_getControllerClassName:function(controllerName){var result='';var nameParts=controllerName.split('-');for(var i=0;i<nameParts.length;i++){var str=nameParts[i];nameParts[i]=str.charAt(0).toUpperCase()+str.slice(1);}
result=nameParts.join('')+'Controller';return result;},getControllerNamespaces:function(){if(!_configs.controllerNamespaces){return[DEFAULT_CONTROLLER_NAMESPACE];}
return _configs.controllerNamespaces;},getControllerConstructor:function(controllerName){var namespaces=this.getControllerNamespaces();for(var i=0;i<namespaces.length;i++){var namespace=namespaces[i];if(typeof(window[namespace])!='undefined'&&typeof(window[namespace][controllerName])=='function'){return window[namespace][controllerName];}}
return false;},getAjaxManager:function(){return webApp.ajaxManager;},getCacheManager:function(){return webApp.cacheManager;},getViewManager:function(){return webApp.viewManager;},getUrlManager:function(){return webApp.urlManager;},addHelper:function(name,instance){_helpers[name]=instance;return this;},getHelper:function(name){if(!_helpers[name]){throw{name:'ParamError',message:'Helper instance "'+name+'" doesn`t exists!'};}
return _helpers[name];},bindChangeOrientation:function(){var context=this;var timeId=null;if(webApp.isAndroid){webApp.orientation=this.getOrientationBySize();}else{webApp.orientation=this.getOrientation();}
this.setCssClass();if(webApp.isIDevice&&!webApp.isMobileEmulation){$(window).bind('orientationchange',function(){var timeWait=350;clearTimeout(timeId);timeId=setTimeout(function(){webApp.orientation=context.getOrientation();context.setCssClass();$(window).trigger(webApp.EVENT_CHANGE_ORIENTATION,{'orientation':webApp.orientation});},timeWait);});}else{$(window).bind('resize.webAppOrientation',function(){clearTimeout(timeId);timeId=setTimeout(function(){var newOrientation=context.getOrientation();if(newOrientation!==webApp.orientation){webApp.orientation=newOrientation;context.setCssClass();$(window).trigger(webApp.EVENT_CHANGE_ORIENTATION,{'orientation':webApp.orientation});}},240);});}},getOrientation:function(){if(webApp.isMobile&&typeof window.orientation!=='undefined'){switch(window.orientation){case-90:case 90:return ORIENTATION_LANDSCAPE;default:return ORIENTATION_PORTRAIT;}}else{return this.getOrientationForBrowsers();}},getOrientationBySize:function(){if(webApp.isMobile){return($(window).width()>$(window).height())?ORIENTATION_LANDSCAPE:ORIENTATION_PORTRAIT;}else{return this.getOrientationForBrowsers();}},getOrientationForBrowsers:function(){if(!webApp.isTablet){return($(window).width()<$(window).height())?ORIENTATION_PORTRAIT:ORIENTATION_LANDSCAPE;}else{return($(window).width()<920)?ORIENTATION_PORTRAIT:ORIENTATION_LANDSCAPE;}},setCssClass:function(){if(webApp.orientation==ORIENTATION_PORTRAIT){$body.removeClass('orientationLandscape').addClass('orientationPortrait');}else{$body.removeClass('orientationPortrait').addClass('orientationLandscape');}
if(webApp.isIOS_6&&!webApp.isTablet){window.scroll(0,1);}
webApp.windowHeight=webApp.viewManager.getHeight();}};})();
var webApp=webApp||{};webApp.ajaxManager=(function(){var _routes={};var _request={};var _cacheIds=[];var _controllers={};var _count=0;var _messages={retry:"Cannot connect to Racing Post.\nPlease check your internet connection and try again.",unknown:"A problem has occurred while getting data from the Racing Post. Please try again later."};var _getBaseUrl=function(controllerName){return _routes[controllerName];};var _createBlocksUrlParams=function(controller){var blocksConfig=controller.getBlocksToLoad();var blocks=[];var result={};for(var name in blocksConfig){var cacheId=controller._getBlockCacheId(name);if(_cacheIds.indexOf(cacheId)==-1){blocks.push(name);_cacheIds.push(cacheId);}}
result.blocks=blocks.join(',');return result;};var _createRequest=function(url,params,onSuccess,onError,onComplete){return $.ajax({url:url,data:params,type:'GET',dataType:'json',cache:false,timeout:(1000*60*1),success:onSuccess,error:onError,complete:onComplete});};var _processConnectionError=function(context,controller){if(confirm(_messages.retry)){context.process(controller);}else{webApp.core.getUrlManager().goBack();}};return{init:function(routes){_routes=routes;$(window).bind(webApp.EVENT_CHANGE_CONTROLLER,function(){for(var i in _request){if(_request[i]){_request[i].abort();}}
_request={};_cacheIds=[];_controllers={};_count=0;});},process:function(controller){var requestParams,blocksParams,isNoBlocks,baseUrl,context=this,controllerName=controller.getName(),onSuccess,onError,onComplete;if(_request[controllerName]){_request[controllerName].abort();_request[controllerName]=null;_cacheIds=[];_controllers[controllerName]=null;}
requestParams=controller.getRequestParams();blocksParams=_createBlocksUrlParams(controller);isNoBlocks=(blocksParams.blocks.length==0);baseUrl=_getBaseUrl(controllerName);requestParams=$.extend({},requestParams,blocksParams);onSuccess=function(data){try{_request[controllerName]=null;_count--;controller.pushData(data);if(_count==0){for(var c in _controllers){_controllers[c].render(true);}
_cacheIds=[];_controllers={};}}catch(e){console.log(e.name+": "+e.message);}};onError=function(jXHR,status,errorThrown){_count--;if(status=='abort'){return true;}
if(status=='timeout'){_processConnectionError(context,controller);}else{alert(_messages.unknown);webApp.core.getUrlManager().goBack();}};onComplete=function(){_request[controllerName]=null;};if(!isNoBlocks){_count++;_request[controllerName]=_createRequest(baseUrl,requestParams,onSuccess,onError,onComplete);}else{controller.render();}
_controllers[controllerName]=(controller);},makeRequest:function(url,params,onSuccess,onError,onComplete){return $.ajax({url:url,data:params,type:'GET',dataType:'json',cache:false,timeout:(1000*60*1),success:onSuccess,error:onError,complete:onComplete});}};})();
var webApp=webApp||{};webApp.cacheManager=(function(){return{_prefix:'cache ',_keysSeparator:'/',_cachedKeysRecordName:'cachedKeys',_cachedSizeRecordName:'cachedSize',_cachedSizeLimit:200000,_cacheKeyDateLastUpdated:'cacheDateUpdated',_dateFormat:'YYYY-MM-DD',_storage:null,init:function(storage,cachedSizeLimit){this._cachedSizeLimit=cachedSizeLimit||200000;this._storage=storage||{records:[],getItem:function(key){return this.records[key]||null;},setItem:function(key,value){this.records[key]=value;},removeItem:function(key){delete this.records[key];}};},_isCacheActual:function(blockCache){var lifeTime=blockCache['lifeTime'];var createdTime=blockCache['created'];var createdDate=new Date(createdTime);var now=utils.date.getSynchronizedToServerNow();var passedTime=now.getTime()-createdTime;var expired=passedTime>lifeTime;var anotherDay=now.getUTCDate()!=createdDate.getUTCDate();return!(expired||anotherDay);},_clearOldStorageRecord:function(){var cache=this._storage.getItem(this._cachedKeysRecordName);if((cache!==null)&&(cache!=='')){var keysArray=cache.split(this._keysSeparator);var newKeyArray=[];var filterKeysArray=function(key){if(webApp.blocksToLeaveCached.indexOf(key)===-1){return key;}};newKeyArray=keysArray.filter(filterKeysArray);var key=newKeyArray.shift();if(!key){var remainingCacheSize=0;for(key in this._storage){if(key.indexOf('cache ')!==-1&&webApp.blocksToLeaveCached.indexOf(key)===-1){delete this._storage[key];}
else if(webApp.blocksToLeaveCached.indexOf(key)!==-1){var keyLength=key.length;var keyDataLength=this._storage.getItem(key).length
remainingCacheSize+=keyLength+keyDataLength;}};this._storage.setItem(this._cachedSizeRecordName,remainingCacheSize);return false;}
keysArray.splice(keysArray.indexOf(key),1);var dataLength=this._storage.getItem(key).length;this._storage.removeItem(key);console.log('removed from cache: '+key);console.log('available free space obtained: '+dataLength);this._storage.setItem(this._cachedKeysRecordName,keysArray.join(this._keysSeparator));var cachedDataSize=parseInt(this._storage.getItem(this._cachedSizeRecordName)||0);cachedDataSize-=dataLength;this._storage.setItem(this._cachedSizeRecordName,cachedDataSize);}
else{for(key in this._storage){if(key.indexOf('cache ')!==-1){delete this._storage[key];}};this._storage.setItem(this._cachedSizeRecordName,0);}},setCache:function(cacheId,data,keys,lifeTime,created){try{var cacheKeyName=this._createCacheKey(cacheId,keys);var stringDataToStore=JSON.stringify({data:data,keys:keys,lifeTime:lifeTime,created:created||new Date().getTime()});var storingDataLength=stringDataToStore.length;var storingDataLengthIncreased=storingDataLength*2;if(storingDataLengthIncreased>parseInt(this._cachedSizeLimit)){console.log('Cache limit is less, than storing object size');return false;}
if((parseInt(this._storage.getItem(this._cachedSizeRecordName))+storingDataLength)>parseInt(this._cachedSizeLimit)){while((parseInt(this._storage.getItem(this._cachedSizeRecordName))+storingDataLengthIncreased)>parseInt(this._cachedSizeLimit)&&parseInt(this._storage.getItem(this._cachedSizeRecordName))>0){this._clearOldStorageRecord();}}
var cachedKeys=this._storage.getItem(this._cachedKeysRecordName)||'';var cachedKeysArray=cachedKeys.length?cachedKeys.split(this._keysSeparator):[];if(cachedKeysArray.indexOf(cacheKeyName)!==-1){this.clearCache(cacheId,keys);}
else{cachedKeysArray.push(cacheKeyName);cachedKeys=cachedKeysArray.join(this._keysSeparator);}
this._storage.setItem(cacheKeyName,stringDataToStore);this._storage.setItem(this._cachedKeysRecordName,cachedKeys);var cachedDataSize=parseInt(this._storage.getItem(this._cachedSizeRecordName)||0);cachedDataSize+=storingDataLength;this._storage.setItem(this._cachedSizeRecordName,cachedDataSize);var dateUpdated=utils.moment.getSynchronizedToServerNow(0,this._dateFormat);this._storage.setItem(this._cacheKeyDateLastUpdated,dateUpdated);}catch(e){console.log(e);}
return true;},getCache:function(cacheId,keys){var blockCache={};if(!this._storage.getItem(this._createCacheKey(cacheId,keys))){return null;}else{blockCache=JSON.parse(this._storage.getItem(this._createCacheKey(cacheId,keys)));}
if($.isArray(blockCache['data'])){return $.merge([],blockCache['data']);}else{return $.extend(true,{},blockCache['data']);}},isCached:function(cacheId,keys){var blockCache={};var result=false;if(!this._storage.getItem(this._createCacheKey(cacheId,keys))){return null;}else{blockCache=JSON.parse(this._storage.getItem(this._createCacheKey(cacheId,keys)));}
if(this._isCacheActual(blockCache)){result=true;}
return result;},clearCache:function(cacheId,keys){keys=keys||false;var cache=this._storage.getItem(this._cachedKeysRecordName);if(cache!==null){var keysArray=cache.split(this._keysSeparator);var dataLength=0;var cacheKey=this._createCacheKey(cacheId);if(!keys){for(key in keysArray){if(keysArray[key].indexOf(cacheKey)===0){dataLength+=this._storage.getItem(keysArray[key]).length;this._storage.removeItem(keysArray[key]);delete keysArray[key];}}}else{var key=this._createCacheKey(cacheId,keys);var item=this._storage.getItem(key);if(item){dataLength+=item.length;this._storage.removeItem(key);}}
this._storage.setItem(this._cachedKeysRecordName,keysArray.join(this._keysSeparator));}
var cachedDataSize=parseInt(this._storage.getItem(this._cachedSizeRecordName)||0);cachedDataSize-=dataLength;this._storage.setItem(this._cachedSizeRecordName,cachedDataSize);},clearAllCache:function(){var cache=this._storage.getItem(this._cachedKeysRecordName);if(cache!==null){var keysArray=cache.split(this._keysSeparator);for(var key in keysArray){if(keysArray[key].indexOf(this._prefix)===0){this._storage.removeItem(keysArray[key]);}}}
this._storage.setItem(this._cachedKeysRecordName,'');this._storage.setItem(this._cachedSizeRecordName,0);},showData:function(){console.dir(this._storage);},_createCacheKey:function(cacheId,keys){var values=Object.keys(keys||{}).map(function(key){if((typeof keys[key]=="object")){return this._hashCode(JSON.stringify(keys[key]));}else{return keys[key];}},this);var keysStr=values.length?values.join('_'):'';return this._prefix+cacheId+' | '+keysStr;},getCacheDateChanged:function(){var now=moment.utc(utils.date.getSynchronizedToServerNow());var lastUpdatedStr=this._storage.getItem(this._cacheKeyDateLastUpdated);if(!lastUpdatedStr){return false;}
var cacheLastUpdated=moment.utc(lastUpdatedStr,this._dateFormat);return(now.utc().date()-cacheLastUpdated.utc().date())||(now.utc().month()-cacheLastUpdated.utc().month());},getCachedDataSize:function(){var result=parseInt(this._storage.getItem(this._cachedSizeRecordName));if(isNaN(result)){result=0;}
return result;},_hashCode:function(string){var hash=0,i,l,char;if(string.length==0)
return hash;for(i=0,l=string.length;i<l;i++){char=string.charCodeAt(i);hash=((hash<<5)-hash)+char;hash|=0;}
return hash;}};})();
var webApp=webApp||{};webApp.history=webApp.history||{};webApp.urlManager=(function(){var _defaultHash='';var _dispatchCallback;var _back={};var _controllersTree={};var _currCollection='';var _prevCollection='';var isMenuClick=false;var isBackBtnClick=false;var _version=2;return{getHash:function(){return window.location.href.replace(/^[^#]+/g,'');},setHash:function(hashString){window.location.hash=hashString;},setLocation:function(location){window.location=location;},replaseHash:function(location){var windowUrl=window.location.href;var hashIndex=windowUrl.indexOf('#');if(hashIndex!=-1){windowUrl=windowUrl.substring(0,hashIndex);}
window.location.replace(windowUrl+location);},parseHash:function(hashString){var result=['',{}];if(!hashString){return result;}
hashString=hashString.substring(1);hashString=hashString.replace(/^\/*|\/*$/g,"");var hashArray=hashString.split('/');result[0]=decodeURIComponent(hashArray[0]);var hashParams=hashArray[1];if(typeof hashParams=='undefined'){return result;}
hashParams=hashParams.split('&');for(var i in hashParams){var param=hashParams[i].split('=');var paramName=decodeURIComponent(param[0]);var paramValue=decodeURIComponent(param[1]||'');result[1][paramName]=paramValue;}
return result;},getControllerName:function(){var hashString=this.getHash();return this.parseHash(hashString)[0];},getParams:function(){var hashString=this.getHash();return this.parseHash(hashString);},processHash:function(hashString){var hashParams=this.parseHash(hashString);if(webApp.isTablet){var tabletHash=(this._config.deviceConfig&&this._config.deviceConfig.tablet)||{};if(tabletHash.hasOwnProperty(hashParams[0])){hashParams[1]=tabletHash[hashParams[0]][1]?tabletHash[hashParams[0]][1]:hashParams[1];hashParams[0]=tabletHash[hashParams[0]][0];this.replaseHash(this.createHash(hashParams));return;}}else{var phoneHash=(this._config.deviceConfig&&this._config.deviceConfig.phone)||{};if(phoneHash.hasOwnProperty(hashParams[0])){hashParams[1]=phoneHash[hashParams[0]][1]?phoneHash[hashParams[0]][1]:hashParams[1];hashParams[0]=phoneHash[hashParams[0]][0];this.replaseHash(this.createHash(hashParams));return;}}
_dispatchCallback(hashParams);},createHash:function(params){var result='#'+encodeURIComponent(params[0])+'/';var tempArr=[];for(var i in params[1]){tempArr.push(encodeURIComponent(i)+'='+encodeURIComponent(params[1][i]));}
result+=tempArr.join('&');return result;},changeLink:function($link,params,controllerName){if($link.length!=1){return;}
var linkHref=this._filterHash($link.attr('href'));linkHref=this.parseHash(linkHref);if(controllerName){linkHref[0]=controllerName;}
for(var i in params){linkHref[1][i]=params[i];}
$link.attr('href',this.createHash(linkHref));},changeParams:function(params){var linkHref=this.parseHash(this.getHash());for(var i in params){linkHref[1][i]=params[i];}
this.replaseHash(this.createHash(linkHref));},goBack:function(){window.history.back();},init:function(config){this._config=config;_defaultHash=config.defaultHash||'';_dispatchCallback=config.dispatchCallback||null;if(typeof _dispatchCallback!='function'){throw{name:'ParamError',message:'Parameter "dispatchCallback" should be "function"'};}
var currentHash=this.getHash();var context=this;_controllersTree=config.tree;if(!currentHash||currentHash=='#'){this.setHash(_defaultHash);currentHash=_defaultHash;}
this.initBack();this.initBackButtonHandling();this.processHash(currentHash);$(window).bind('hashchange.webAppHashChange',function(){context.processHash(context.getHash());if(!webApp.HorseDetailsController&&webApp.sortOrder){webApp.sortOrder={date:'desc',track:'asc',dis:'asc',trp:'asc',split:'asc',pos:'asc',fin:'asc',by:'asc',win:'asc',rem:'asc',wt:'asc',go:'asc',wght:'asc',sp:'asc',grade:'asc',cal:'asc'};}});},initBack:function(){if(sessionStorage.version!=_version||!sessionStorage.backData){for(var collection in _controllersTree){_back[collection]=[];}
_back.all=[];sessionStorage.version=_version;}else{_back=JSON.parse(sessionStorage.backData);}
var context=this;var currControllerName;if(webApp.isMobile===false&&!webApp.HorseDetailsController){var mainBlock=$('.webApp');var wrapper=mainBlock.wrap('<div class="mainWrapper clearfix"></div>').parent();wrapper.prepend('<div class="layout-col1"><div class="wrap"></div></div>');mainBlock.wrap('<div class="layout-col2"></div>');$('.layout-col2').prepend('<div id="mainTabs" class="mainTabs desktop-PC">'+'<div class="contentOverlay"></div>'+'<div class="js-ladbAdContainer ladbAdContainer">'+'<div class="js-googleTagAds js-ladbSideAd" id="div-gpt-ad-1445252554342-0">'+'</div>'+'</div>'+'<ul id="mainMenu" class="mainMenu clearfix">'+'<li class="tab cardsTab">'+'<a href="#meeting-list" id="meetingMenu" class="tabHref cardMenuItem meetingMenu" data-eventid="main_menu_cards">'+'<i><!-- --></i> <div class="tabName">Cards</div>'+'</a>'+'<div class="subCategoryList">'+'<a href="#meeting-list" class="cardsToday subTabHref" data-eventid="side_menu_cards_today"><div>Today</div></a>'+'<a href="#meeting-list" class="cardsFuture futureBtn subTabHref" data-eventid="side_menu_cards_future"><div>Future</div></a>'+'<a href="#meeting-list/r_date=trapDraws" class="cardsTrapDraws subTabHref" data-eventid="side_menu_cards_trap_draws"><div>Trap Draws</div></a>'+'<a href="#advanced-video" target="_blank" class="cardsRpgtv subTabHref" data-test-selector="cardsRpgtv" data-eventid="side_menu_cards_rpgtv"><div>RPGTV</div></a>'+'</div>'+'</li>'+'<li class="tab resultsTab">'+'<a href="#results-list" id="resultsMenu" class="tabHref resultsMenuItem resultsMenu" data-eventid="main_menu_results">'+'<i><!-- --></i> <div class="tabName">Results</div>'+'</a>'+'<div class="subCategoryList">'+'<a href="#results-list" class="resultsToday subTabHref" data-eventid="side_menu_results_today"><div>Today</div></a>'+'<a href="#results-list" class="resultsArchive archiveCalendar subTabHref" data-eventid="side_menu_results_archive"><div>Archive</div></a>'+'</div>'+'</li>'+'<li class="tab newsTab">'+'<a href="#news-home" id="newsMenu" class="tabHref newsMenuItem newsMenu" data-eventid="main_menu_news">'+'<i><!-- --></i> <div class="tabName">News</div>'+'</a>'+'</li>'+'<li class="tab accountTab">'+'<a href="#account-home" id="accountMenu" class="tabHref accountMenuItem accountMenu" data-eventid="main_menu_account">'+'<i><!-- --></i> <div class="tabName">Accounts</div>'+'</a>'+'<li class="tab betSlipTab">'+'<a href="#bet-slip" id="betslipMenu" class="tabHref betSlipItem betSlipMenu" data-test-selector="betSlipSideMenu">'+'<i><!-- --><span class="betSlipCounter betSlipSideCounter betSlipCounter_side" data-test-selector="betSlipSideCounter">1</span></i> <div class="tabName">Bet Slip</div>'+'</a>'+'</li>'+'</ul></div>');$('.mainTabs').hide();webApp.$mainTabsLinks=$('.mainTabs').find('.tabHref');$('.mainWrapper .mainTabs').prepend('<div class="sidebar-header"><div class="logo"></div></div>');wrapper.append('<div class="layout-col3"><div class="wrap"></div></div>');$('.layout-col2 .mainTabs').attr('id','mainTabs-sidebar');$('body > .mainTabs').addClass('desktop-PC');webApp.mainTabsSubLinks=$('.mainTabs').find('.subTabHref');webApp.mainTabsSubLinks.bind(webApp.eventTracker.EVENT_CLICK_TRACK_EVENT,function(){webApp.eventTracker.processElem(this);});webApp.selectionsAlert.setCounter(webApp.SelectionsManager.getSelections().length);}
webApp.$mainTabsLinks.bind(webApp.eventTracker.EVENT_CLICK_TRACK_EVENT,function(){webApp.eventTracker.processElem(this);});webApp.$mainTabsLinks.bind('click.setFlagMenuClick',function(e){webApp.$mainTabsLinks.removeClass('active');if(webApp.isDesktop&&!webApp.HorseDetailsController){webApp.mainTabsSubLinks.removeClass('active');}
$(this).addClass('active');isMenuClick=true;});currControllerName=this.parseHash(this.getHash())[0];if(_back.all.length===0&&currControllerName!=='meeting-list'){_currCollection=this.findCollection('meeting-list');context.pushBack(this.parseHash('#meeting-list'));}
var prev=this.parseHash(this.getHash());_currCollection=this.findCollection(prev[0]);var $activeTabLink=document.querySelectorAll('#'+_currCollection+'Menu');$.each($activeTabLink,function(){if(!$(this).hasClass('active')){webApp.$mainTabsLinks.removeClass('active');$(this).addClass('active');}});this.pushBack(prev);$(window).bind('changeHistory.setMainLinks',function(e,next,prevControllerName){var controllerName=next[0];var collectionName=context.findCollection(controllerName);var collectionChangedFlag=false;var prevControllerCollectionName=context.findCollection(prevControllerName);if(prevControllerCollectionName&&collectionName!=prevControllerCollectionName){collectionChangedFlag=true;}
if(!collectionName){return;}
context.pushBack(next);if(isMenuClick){webApp.viewManager.animationType='none';isMenuClick=false;}
var $activeTabLink=document.querySelectorAll('#'+collectionName+'Menu');if(controllerName==='card-meeting-result'||controllerName==='card-dog'||controllerName==='card-video'){$activeTabLink=document.querySelectorAll('#resultsMenu');}
webApp.$mainTabsLinks.removeClass('active');$.each($activeTabLink,function(){$(this).addClass('active');});$activeTabLink=document.querySelectorAll('#'+collectionName+'Menu');var allowOverride=_controllersTree[collectionName].allowOverrideHomeUrl;if(typeof allowOverride=='undefined'||(allowOverride==true)){$.each($activeTabLink,function(){$(this).attr('href',webApp.urlManager.getHash());});}
else{$.each($activeTabLink,function(){$(this).attr('href',_controllersTree[collectionName].homeUrl);});}
if(collectionChangedFlag){var rememberLastVisited=_controllersTree[prevControllerCollectionName].rememberLastVisited;if(rememberLastVisited){var $prevTabLink=document.querySelectorAll('#'+prevControllerCollectionName+'Menu');$.each($prevTabLink,function(){$(this).attr('href',context.getLastVisitedCollectionUrl(prevControllerName));});}}
prev=next;sessionStorage.backData=JSON.stringify(_back);});},initBackButtonHandling:function(){var context=this;$(document).on('click.backBtn','.btnBack, .backBtn',function(){context.setBackBtnClicked();});},setBackBtnClicked:function(){isBackBtnClick=true;},pushBack:function(currArr){var url=this.createHash(currArr);var controllerName=currArr[0];if(!controllerName||!_currCollection){return;}
var obj={controller:controllerName,url:url};if(webApp.urlManager.error404BackCollection.length>2){webApp.urlManager.error404BackCollection.shift();}
if(obj&&obj.controller!=='error404'){webApp.urlManager.error404BackCollection.push(obj.url);}
if(_back.all.length&&obj.controller!=='error404'){webApp.viewManager.animationType='own';if(isBackBtnClick){if(_back.all.length>1){_back.all.pop();}
_back.all[_back.all.length-1]=obj;webApp.viewManager.animationType='back';}else if(_back.all[_back.all.length-1].controller==controllerName){_back.all[_back.all.length-1]=obj;}else{_back.all.push(obj);}}else if(obj.controller!=='error404'){_back.all.push(obj);}
if(obj.controller==='error404'){_back.all.pop();_back[_currCollection].pop();}
if(_back.all.length>6){_back.all.shift();}
var newCollection=this.findCollection(controllerName);var isNew=newCollection!=_currCollection;if(webApp.isDesktop&&!webApp.HorseDetailsController){this.subMenuItemsHighlighting(newCollection);}
if(isNew){_prevCollection=_currCollection;}
_currCollection=newCollection;var currentBackCollection=_back[_currCollection];var prevCollectionName=(isNew)?_prevCollection:_currCollection;var prevBackCollection=_back[prevCollectionName];var storeLastvisited=true;var controllersDoNotStoreHistory=['card-meeting-result','card-video','card-dog','form-explained','search'];if((prevCollectionName==='meeting'||prevCollectionName==="search")&&controllersDoNotStoreHistory.indexOf(controllerName)!==-1){storeLastvisited=false;}
if(storeLastvisited){_back[_currCollection+'lastVisited']=obj;}
if(isNew&&_prevCollection==="meeting"){for(var i=0,j=_back[prevCollectionName].length;i<j;i++){if(prevBackCollection[i].controller==="card-meeting-result"){_back[prevCollectionName].splice(i,j);break;}}}
if(!currentBackCollection.length){currentBackCollection.push(obj);}else{var isFindInCollection=false;var controllersDoNotRewriteInBackCollection=['card-meeting-result','card-dog','result-meeting-result','results-dog','form-explained','search'];for(var i=0;i<currentBackCollection.length;i++){if(currentBackCollection[i].controller==controllerName&&controllersDoNotRewriteInBackCollection.indexOf(controllerName)!==-1){if(isBackBtnClick){isFindInCollection=true;currentBackCollection.pop();break;}
if(i===currentBackCollection.length-1){currentBackCollection[i]=obj;isFindInCollection=true;break;}}
else if(currentBackCollection[i].controller==controllerName){currentBackCollection[i]=obj;if(i!=currentBackCollection.length-1){currentBackCollection.splice(i+1,currentBackCollection.length-i);}
isFindInCollection=true;break;}}
if(!isFindInCollection){currentBackCollection.push(obj);}
if(this.parseHash(_controllersTree[_currCollection].homeUrl)[0]==controllerName){webApp.viewManager.animationType='back';currentBackCollection=[];currentBackCollection.push(obj);}}
isBackBtnClick=false;if(!prevBackCollection.length){this.resetTabHref(prevCollectionName);}},resetTabHref:function(collectionName){var $tabLink=document.querySelectorAll('#'+collectionName+'Menu');var allowOverride=_controllersTree[collectionName].allowOverrideHomeUrl;if(typeof allowOverride=='undefined'||(allowOverride==true)){$.each($tabLink,function(){$(this).attr('href',_controllersTree[collectionName].homeUrl);});}},findCollection:function(controllerName){var collectionName='';for(var name in _controllersTree){var collection=_controllersTree[name].controllers;if(collection.indexOf(controllerName)!=-1){collectionName=name;break;}}
return collectionName;},findBackCollection:function(controllerName){return _back[this.findCollection(controllerName)];},getLastVisitedCollectionUrl:function(controllerName){var recordName=this.findCollection(controllerName)+'lastVisited';return _back[recordName]&&_back[recordName].url;},getBackUrl:function(controllerName,steps){var collection=this.findCollection(controllerName);var currArr=_back[collection];if(currArr.length<2&&_back.all.length<2){return _controllersTree[collection].homeUrl;}
if(steps){var st=_back.all.length-1-steps;if(st>-1){return _back.all[st].url;}else{return _controllersTree[collection].homeUrl;}}
if(_prevCollection==='betslip'&&(controllerName==="wh-top-up"||controllerName==="wh-home")){return _back.all[_back.all.length-2].url;}
if(currArr.length>1){return currArr[currArr.length-2].url;}else{return _back.all[_back.all.length-2].url;}},getPrevCollectionUrl:function(){if(_prevCollection){return _back[_prevCollection][_back[_prevCollection].length-1].url;}else{return _controllersTree[_currCollection].homeUrl;}},getBackUrlFor:function(controllerName){for(var i=_back.all.length-1;i>-1;i--){if(_back.all[i].controller==controllerName){return _back.all[i].url;}}},_filterHash:function(linkHref){if(linkHref.match(/^((http[s]?:\/\/)|(www\.))([a-z0-9-].?)+(:[0-9]+)?(\/.*)?$/gi)){linkHref=linkHref.match(/(#.*)/gi).toString();}
return linkHref;},addParamToHash:function(hash,paramName,paramVal){var urlParams=this.parseHash(hash);urlParams[1][paramName]=paramVal;return this.createHash(urlParams);},subMenuItemsHighlighting:function(collectionName){var context=this;var collection=collectionName;var controller=this.getControllerName();var url={controllerName:this.getParams()[0],params:this.getParams()[1]};var requestedDate=url.params.r_date;var currentDate=utils.date.getSynchronizedToServerNow().format('yyyy-0mm-0dd');var options={meeting:function(requestedDate,currentDate){if(requestedDate){if(requestedDate==='trapDraws'||controller==='trap-draws-races'){highlightSubMenu($('.cardsTrapDraws'));}
else{if(requestedDate>currentDate){highlightSubMenu($('.cardsFuture'));}
else if(requestedDate<currentDate){if(controller==='card-video'||controller==='card-meeting-result'||controller==='card-dog'){highlightSubMenu($('.resultsArchive'));}
else{highlightSubMenu();}}
else{highlightSubMenu($('.cardsToday'));}}}
else if(controller==='advanced-video'){highlightSubMenu($('.cardsRpgtv'));}
else{highlightSubMenu();}},results:function(requestedDate,currentDate){context.openDefaultPage=false;if(requestedDate<currentDate){highlightSubMenu($('.resultsArchive'));}
else{highlightSubMenu($('.resultsToday'));}},default:function(){highlightSubMenu();}};if(options[collection]){options[collection](requestedDate,currentDate);}
else{options['default']();}
function highlightSubMenu(item){webApp.mainTabsSubLinks.removeClass('active');if(item){item.addClass('active');}}},isTransitionNotNeeded:function(requestedController){var controllerName=this.getControllerName();var transition;transition=requestedController===controllerName?true:false;return transition;},getPreviousCollectionHomeUrl:function(){return _controllersTree[_prevCollection].homeUrl;},getPreviousCollectionName:function(){return _prevCollection;},rewriteMainTabLink:function(collectionName,url){var $tabLink=document.querySelectorAll('#'+collectionName+'Menu');$.each($tabLink,function(){$(this).attr('href',url);});},error404BackCollection:[]};})();
var webApp=webApp||{};webApp.viewManager=(function(){var _configs={};var _supportTransition=false;var _animationClearTimeId;var _$loading=$([]);var _active='';var _activeController='';var _prevController='';var _preview=null;var _current=null;var _process=null;var _isInit=false;var _bodyClass='';var _animation='none';var _backAnimation={'left':'right','right':'left','up':'down','down':'up'};var _imageLoadTimeId;var _scrollType='';return{animationType:'none',setTpls:function(tpls){for(var i in tpls){$.template(i,tpls[i]);}
return this;},setHelpers:function(helpers){_helpers=helpers;return this;},renderTpl:function(tplName,data){data=data||{};var $content=$($.tmpl(tplName,data,_helpers));$(document).trigger(webApp.EVENT_VIEW_RENDER_TPL,{'$content':$content});return $content;},init:function(config){_configs=config;_$loading=$('#pageLoading');webApp.disableScroll=true;document.addEventListener('touchmove',function(e){if(webApp.disableScroll){e.preventDefault();}});this.resetProcess();$(window).bind(webApp.EVENT_CHANGE_CONTROLLER+'.viewManager',$.proxy(function(e,params){var controllerName=params[0];if(_current&&_current.name==controllerName){_$loading.hide();_process.$container.remove();this.resetProcess();return;}
if(_process.name==controllerName){return;}
_$loading.show();this.resetProcess();_process.name=controllerName;_process.$container=this.createPage(controllerName);_prevController=_activeController;_active=_activeController=controllerName;if(_isInit){if(this.animationType=='back'){_animation=_configs.controllers[controllerName].animation||'left';_animation=_backAnimation[_animation];}else if(this.animationType=='none'){_animation='none';}else{_animation=_configs.controllers[controllerName].animation||'left';}}
switch(_animation){case'left':_process.$container.addClass('webAppPageRight');break;case'right':_process.$container.addClass('webAppPageLeft');break;case'up':_process.$container.addClass('webAppPageBottom');break;case'down':_process.$container.addClass('webAppPageTop');break;case'none':_process.$container.addClass('webAppPageNoAnimation');break;}
var includes=_configs.controllers[controllerName].include;if(includes){_process.$container.empty();for(var i=0;i<includes.length;i++){_process.pages[includes[i]]=this.createPage(includes[i]);_process.$container.append(_process.pages[includes[i]]);_process.blocks[includes[i]]={};_process.levels[includes[i]]={};}}else{_process.pages[controllerName]=_process.$container;_process.blocks[controllerName]={};_process.levels[controllerName]={};}},this));var context=this;var orientchangeTimer;var resizeTimeId,resizeOrientationTimeId;var orientation=webApp.orientation;var wh=this.getHeight();$(window).bind('resize',function(){clearTimeout(resizeTimeId);resizeTimeId=setTimeout(function(){context.refreshAllScrolls();},200);if(webApp.isIDevice){if(webApp.isIOS_6&&!webApp.isTablet){clearTimeout(resizeOrientationTimeId);resizeOrientationTimeId=setTimeout(function(){if(orientation==webApp.orientation){if(_scrollType=='frame'){if(wh<context.getHeight()){setTimeout(function(){context.setFrameSize();},250);}}else{for(var p in _current.pages){context.setScrollSize(p);}
$(window).trigger('updateScroolSize',[]);}}
orientation=webApp.orientation;wh=context.getHeight();},500);}else if(webApp.isIOS_8&&_scrollType==="frame"){}else{$(window).scrollTop(0);}}});$(window).bind('changeorientaion',function(){clearTimeout(orientchangeTimer);var $fi=$('input:focus');if($fi.length){$fi.attr('readonly','readonly');$fi.attr('disabled','true');orientchangeTimer=setTimeout(function(){$fi.blur();$fi.removeAttr('readonly');$fi.removeAttr('disabled');$fi=$([]);setTimeout(function(){if(_isInit){for(var sc in _current.pages){context.setScrollSize(sc);}
context.setFrameSize();$(window).trigger('updateScroolSize',[]);}},350);},450);}else{orientchangeTimer=setTimeout(function(){if(_isInit){for(var sc in _current.pages){context.setScrollSize(sc);}
context.setFrameSize();$(window).trigger('updateScroolSize',[]);}},100);}});if(webApp.isIDevice){$(window).on('resize',function(e){if(window.innerHeight!=$(window).height()){$(window).trigger('orientationchange');}});}
if(webApp.$appContainer.length>0&&typeof webApp.$appContainer.get(0).style[webApp.vendor+'Transition']!='undefined'){_supportTransition=true;}
webApp.$appContainer.bind('webkitTransitionEnd transitionend',function(e){if(e.target.id!='webApp'){return;}
clearTimeout(_animationClearTimeId);_animationClearTimeId=setTimeout(function(){context.clearAnimation();},50);});webApp.$appContainer.height(wh-webApp.$mainTabs.outerHeight());if(webApp.isMobile===false){this.resizeWindow();}
return this;},resizeWindow:function(){var context=this;if(webApp.isMobile===false&&!webApp.HorseDetailsController){$(window).on('resize.viewm',function(){var webAppPage=$('.webAppPage');var windowHeight=$(window).height();var windowWidth=$(window).width();var upperAdHeight=$('.whAdContainer').is(':visible')?$('.whAdContainer').outerHeight(true):0;$('.layout-col1 .wrap').height(windowHeight);$('.layout-col3 .wrap').height(windowHeight);$('.mainWrapper .mainTabs').height(windowHeight);var iScrollWrapper=$('.webAppPageContent');var pageHeaderHeight=$('.pageHeader').outerHeight();webApp.googleTagAds.proccessAds(windowWidth,windowHeight);webApp.windowHeight=windowHeight;if(webAppPage.length>1&&(webAppPage.hasClass('predictor')||webAppPage.hasClass('bet-slip')||webAppPage.hasClass('receipt'))){return;}else if(webAppPage.length===1&&(webAppPage.hasClass('bet-slip')||webAppPage.hasClass('receipt')||webAppPage.hasClass('market-suspend-error'))){$('.webApp').css('height',windowHeight-upperAdHeight);$(window).trigger('updateScroolSize');return;}
if(webAppPage.hasClass('predictor')){iScrollWrapper.css('height',windowHeight-upperAdHeight);}else if(webAppPage.hasClass('ladb-home')||webAppPage.hasClass('ladb-top-up')){context.setFrameSize();return;}
else{iScrollWrapper.css('height',windowHeight-webApp.$mainTabs.outerHeight()-pageHeaderHeight-upperAdHeight);$('.webApp').css('height',iScrollWrapper.height()+pageHeaderHeight);}
if(_current){for(var s in _current.scrolls){_current.scrolls[s].refresh();}}});}},getHeight:function(){var wh=$(window).height();var wih=window.innerHeight;var h=wh<wih?wh:wih;if(h==671){h=672}
if(webApp.isIOS_6&&!webApp.isTablet){h=window.innerHeight;}
return h;},createPage:function(controllerName){var $page=this.renderTpl(_configs.templates['page']);$page.attr('id',controllerName+'-page').addClass(controllerName);$page.find('> .webAppPageContent').attr('id',controllerName+'-scroll');return $page;},resetProcess:function(){_process=null;_process={name:'',$container:$([]),pages:{},scrolls:{},levels:{},blocks:{}}},_createBlockId:function(blockName,keys){return blockName+'|'+$.param(keys);},removeBlock:function(controllerName,blockName){if(_current&&_current.blocks[controllerName]){for(var blockId in _current.blocks[controllerName]){var blockData=_current.blocks[controllerName][blockId];if(blockData.name==blockName){this._destroyBlock(_current,controllerName,blockId);_current.levels[controllerName][blockData.config.level].blockId='';break;}}}},_destroyBlock:function(pageData,controllerName,blockId){if(!pageData.blocks[controllerName][blockId]){return;}
pageData.blocks[controllerName][blockId].config.onDestroyClb(pageData.blocks[controllerName][blockId].$);delete pageData.blocks[controllerName][blockId];},_createLevelContainer:function(level){var html=this.renderTpl(_configs.templates.level,{});html.addClass('level level-'+level);return html;},_drawBlock:function(controllerName,blockId,$block,level,blockName){var controllerLevels=_current.levels[controllerName];if(controllerLevels[level]&&controllerLevels[level].blockId==blockId){return;}
var $levelContainer;var drawLevel=false;var levelData=controllerLevels[level];if(levelData){$levelContainer=levelData.container;$levelContainer.removeClass(levelData.name);this._destroyBlock(_current,controllerName,levelData.blockId);}else{$levelContainer=this._createLevelContainer(level);drawLevel=true;}
$levelContainer.addClass(blockName);$levelContainer.empty().append($block);var context=this;if(drawLevel){var $page=_current.pages[controllerName].find('> .webAppPageContent');var $pageContent=$page.find('> .scrollContent');var $header=$levelContainer.find('> .pageHeader');if($header.length||$levelContainer.hasClass('results-header')){$levelContainer.insertBefore($page);}else{var isPrepend=false;for(var i in controllerLevels){if(level<i){$levelContainer.insertBefore(controllerLevels[i].container);isPrepend=true;break;}}
if(!isPrepend){$pageContent.append($levelContainer);}}
controllerLevels[level]={};controllerLevels[level].container=$levelContainer;}
controllerLevels[level].name=blockName;controllerLevels[level].blockId=blockId;if(_current.scrolls[controllerName]){_current.scrolls[controllerName].refresh();}
this.scrollToTop(controllerName);$block.find('img').bind('load.fixScroll',function(){clearTimeout(_imageLoadTimeId);_imageLoadTimeId=setTimeout(function(){context.refreshAllScrolls();},320);});},renderBlock:function(controllerName,blockName,blockConfig,data,keys){var blockId=this._createBlockId(blockName,keys);var level=blockConfig.level||null;if(level==null){return;}
if(_current.blocks[controllerName][blockId]){return;}
var $block=$([]);if(typeof(data)!='object'){data={};}
data=blockConfig.beforeRenderClb(data);if(data===false){return false;}
$block=this.renderTpl(blockConfig.template,data);this._drawBlock(controllerName,blockId,$block,level,blockName);_current.blocks[controllerName][blockId]={'name':blockName,'config':blockConfig,'$':$block};var $backLinks=$block.parent().find('a.btnBack');$backLinks.each(function(){var thisHref=$(this).attr('href');if(!thisHref||thisHref=='#'){$(this).attr('href',webApp.urlManager.getBackUrl(controllerName));}});blockConfig.afterRenderClb($block);return $block;},showBlocksPreloader:function(controllerName,blocksConfig){if(typeof _current.levels[controllerName]=='undefined'){return;}
var mainBlockName='';var prevLevel=null;var levels=_current.levels[controllerName];for(var block in blocksConfig){if(block=='ads'){continue;}
var blockId=this._createBlockId(block,blocksConfig[block].keys);if(!levels[blocksConfig[block].level]){this._drawBlock(controllerName,blockId,$([]),blocksConfig[block].level,block);}else if(levels[blocksConfig[block].level].blockId==blockId){continue;}
if(prevLevel==null){prevLevel=blocksConfig[block].level;mainBlockName=block;}else{if(block.level<prevLevel){prevLevel=blocksConfig[block].level;mainBlockName=block;}}}
if(prevLevel){for(var name in blocksConfig){var level=levels[blocksConfig[name].level];if(level){var preloader=this.renderTpl(_configs.templates['block-preloader']);var blockId=level.blockId;this._destroyBlock(_current,controllerName,blockId);level.blockId='';level.container.removeClass(level.name).addClass(name).empty();if(name==mainBlockName){level.container.html(preloader);}
level.name=name;this.scrollToTop(controllerName);if(_current.scrolls[controllerName]){_current.scrolls[controllerName].refresh();}}}}},pageReady:function(controllerName){if(_process.pages.hasOwnProperty(controllerName)){if(_current){this.clearAnimation(true);}
_preview=null;_preview=_current;_current=null;_current=_process;this.resetProcess();webApp.$appContainer.append(_current.$container);if(webApp.configs.controllers[controllerName]){_scrollType=webApp.configs.controllers[controllerName].defaultScroll;webApp.disableScroll=_scrollType?false:true;if(_scrollType){if(webApp.isIOS_6&&!webApp.isTablet){$('#iOS6Height').hide();}
$('body').removeClass('fixedMainBlocks flowMainBlocks');_bodyClass=_scrollType=='frame'?'flowMainBlocks':'fixedMainBlocks';for(var p in _current.pages){_current.pages[p].addClass(_bodyClass);}
if(webApp.configs.controllers[controllerName].hideMainTabs){_bodyClass+=' hideMainTabs'}else{$('body').removeClass('hideMainTabs');}}else{if(webApp.isIOS_6&&!webApp.isTablet){$('#iOS6Height').show();}
this.applyPageScroll();}}
$('body').addClass(_bodyClass);}},switchPage:function(controllerName,pageName){$('.mainTabs').show();_$loading.hide();$('#'+controllerName+'-scroll').find('> .scrollContent > .pageLoading').remove();pageName=pageName||controllerName;if(pageName==_active){_active='';if(!_isInit){$('body').addClass(_bodyClass);_isInit=true;}
$(window).scrollTop(0);this.setScrollSize(controllerName);if(_supportTransition){switch(_animation){case'none':this.clearAnimation();break;case'left':webApp.$appContainer.addClass('slideToLeft goSlide');break;case'right':webApp.$appContainer.addClass('slideToRight goSlide');break;case'up':webApp.$appContainer.addClass('slideToUp goSlide');break;case'down':webApp.$appContainer.addClass('slideToDown goSlide');break;}}else{this.clearAnimation();}
if(webApp.isMobile===false){$(window).trigger('resize.viewm');}}},applyPageScroll:function(){_bodyClass='';var iScrollOptions={};$('body').removeClass('fixedMainBlocks flowMainBlocks hideMainTabs');for(var i in _current.pages){if(webApp.configs.controllers[i].hideMainTabs){$('body').addClass('hideMainTabs');}
var $scrollBox=_current.pages[i].find('> .webAppPageContent');var context=this;var isUseTransform=true;if(webApp.isAndroid_2){isUseTransform=$scrollBox.find('input[type=text], input[type=password], input[type=number], select').length?false:true;}
if(webApp.isDesktop){iScrollOptions={fadeScrollbars:false,mouseWheel:true,scrollbars:true,scrollX:false,mouseWheelSpeed:100,interactiveScrollbars:true,preventDefault:false,useTransition:false,freeScroll:true,useTransform:isUseTransform,scrollbars:'custom',click:false,tap:false,disableMouse:true};}
else{iScrollOptions={fadeScrollbars:webApp.isMobile&&!webApp.isAndroid_2,mouseWheel:true,scrollbars:true,scrollX:false,mouseWheelSpeed:100,interactiveScrollbars:false,preventDefault:false,useTransition:false,freeScroll:true,useTransform:isUseTransform,click:false,tap:false};}
_current.scrolls[i]=new IScroll('#'+i+'-scroll',iScrollOptions);_current.scrolls[i].name=i;_current.scrolls[i].on('scrollEnd',function(){if(this.isInit){webApp.configs.controllers[this.name].scrollPos=(this.y>0?0:this.y);}
$(document).trigger('endPageScroll',[this]);});this.setScrollSize(i);}
setTimeout(function(){for(var s in _current.scrolls){_current.scrolls[s].isInit=true;}},50);},setScrollSize:function(pageName){var $scrollBox=_current.pages[pageName].find('> .webAppPageContent');$scrollBox.hide();if(webApp.isAndroid){webApp.windowHeight=$(window).height();}
webApp.$appContainer.css('minHeight',0).height(webApp.windowHeight-webApp.$mainTabs.outerHeight());var $divs=_current.pages[pageName].find('> div');if(webApp.isMobile===false){$(window).trigger('resize.viewm');}
var topPos=0;var bottomSpace=0;var isTop=true;$divs.each(function(){if($(this).hasClass('webAppPageContent')){isTop=false;return;}
if(!$(this).hasClass('overlay')){if(isTop){topPos+=$(this).outerHeight();}else{bottomSpace+=$(this).outerHeight();}}});$scrollBox.css({top:topPos}).show();var $scrollBoxContent=$scrollBox.find('> .scrollContent');$scrollBoxContent.find('> .floatBox').remove();if(bottomSpace&&$scrollBoxContent.html()){$scrollBoxContent.append('<div class="floatBox" style="height:'+bottomSpace+'px"></div>');}
if(_current.scrolls[pageName]){_current.scrolls[pageName].refresh();}},setFrameSize:function(){if(_scrollType=='frame'){var upperAdHeight=$('.whAdContainer').is(':visible')?$('.whAdContainer').outerHeight(true):0;var contentHeight=webApp.windowHeight-webApp.$mainTabs.outerHeight()-upperAdHeight;webApp.$appContainer.css('minHeight',contentHeight).height('auto');for(var i in _current.pages){var $header=_current.pages[i].find('.pageHeader');if($header.length){contentHeight-=$header.outerHeight();}
_current.pages[i].find('iframe').height(contentHeight);}}},removeMainMenuOverlay:function(){if($('.webAppPage.receipt').length===1)return;$('.mainMenuOverlay').removeClass('mainMenuOverlayShown');},clearAnimation:function(readyFlag){_current.$container.removeClass('webAppPageLeft webAppPageRight webAppPageTop webAppPageBottom webAppPageNoAnimation');webApp.$appContainer.removeClass('slideToRight slideToLeft slideToUp slideToDown goSlide');if(!readyFlag){$(window).trigger('switchpage',[_current.name]);}
if(_preview){_$loading.hide();for(var name in _preview.blocks){var blocks=_preview.blocks[name];for(var blockId in blocks){this._destroyBlock(_preview,name,blockId);}}
for(var sc in _preview.scrolls){_preview.scrolls[sc].destroy();_preview.scrolls[sc]=null;}
_preview.$container.remove();_preview=null;if(webApp.isMobile===false){$(window).trigger('resize.viewm');}}
this.removeMainMenuOverlay();this.setFrameSize();},hideUrlBar:function(controllerName){if(_current.scrolls[controllerName]&&(this.animationType=='back'||this.animationType=='none')){var savePos=webApp.configs.controllers[controllerName].scrollPos;var topPos=savePos?savePos:0;if(topPos){_current.scrolls[controllerName].scrollTo(0,topPos,0);}}},refreshAllScrolls:function(){for(var sk in _current.scrolls){_current.scrolls[sk].refresh();}},scrollToTop:function(controllerName){if(_current.scrolls[controllerName]){_current.scrolls[controllerName].scrollTo(0,0,0);}},enableScrolls:function(){if(_current){for(var sc in _current.scrolls){if(_current.scrolls[sc]){_current.scrolls[sc].enable();}}}},disableScrolls:function(){if(_current){for(var sc in _current.scrolls){if(_current.scrolls[sc]){_current.scrolls[sc].disable();}}}},getScroll:function(controllerName){return _current&&_current.scrolls[controllerName]?_current.scrolls[controllerName]:null;},flash:function(controllerName){if(!_current||!_current.pages[controllerName]){return;}
for(var blockId in _current.blocks[controllerName]){this._destroyBlock(_current,controllerName,blockId);}
_current.pages[controllerName].find('> div').each(function(){if($(this).hasClass('webAppPageContent')){$(this).find('> .scrollContent').empty();}else if(!$(this).hasClass('overlay')&&!$(this).hasClass('rubiconFrame')){$(this).remove();}});_current.levels[controllerName]={};if(webApp.configs.controllers[controllerName]){webApp.configs.controllers[controllerName].scrollPos=0;}}}})();
var webApp=webApp||{};webApp.Component=function(){var _core;this.setCore=function(core){_core=core;return this;};this._core=function(){return _core;};this._helper=function(helperName){return this._core().getHelper(helperName);};};
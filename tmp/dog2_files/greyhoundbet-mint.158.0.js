
var webApp=webApp||{};webApp.SimplePriceListener=function(callbacks){var _callbacks=callbacks||{},_priceCallback=_callbacks.price||function(){},_eachWayCallback=_callbacks.eachWay||function(){},_bestOddsCallback=_callbacks.bestOdds||function(){},_oddsType=webApp.userSettings.get('odds');this.onUpdate=function(data){if($.inArray('EACH_WAY',data.topic)!==-1){this._processEachWayData(data);return;}
if($.inArray('INFO',data.topic)!==-1){this._processBestOddsData(data);return;}
this._processPriceData(data);};this._processPriceData=function(data){var price=new rp.HorseBetInfo(data,_oddsType);_priceCallback(price);};this._processEachWayData=function(data){var eachWay=new rp.models.EachWay(data);_eachWayCallback(eachWay);};this._processBestOddsData=function(data){_bestOddsCallback(data);};};
var webApp=webApp||{};webApp.SimpleRaceListener=function(controller){this.controller=controller;this.onUpdate=function(data){this.update(data);};this.update=function(data){this.controller.acceptRaceInfo(data);};};
var webApp=webApp||{};webApp.PriceHistoryListener=function(controller){this.controller=controller;this.onUpdate=function(data){this.update(data);};this.update=function(data){if($.inArray('EACH_WAY',data.topic)!==-1){this.controller.setEachWay(new rp.models.EachWay(data));return;}
if($.inArray('INFO',data.topic)!==-1){this.controller.setBOG(data);return;}
this.controller.acceptPriceHistory(data);};};
var webApp=webApp||{};webApp.HorseInfoListener=function(callbacks){var HORSE_RESERVE_STATUS_INDEX=0;var HORSE_NORUNNER_STATUS_INDEX=1;var HORSE_NAME_INDEX=6;var RESERVE_STATUS='reserve';var NON_RUNNER_STATUS='N';var _checkers={'non-runner':function(topic,data){return(data[HORSE_NORUNNER_STATUS_INDEX]===NON_RUNNER_STATUS);},reserved:function(topic,data){var reserveStatus=data[HORSE_RESERVE_STATUS_INDEX].toLowerCase();return(reserveStatus.indexOf(RESERVE_STATUS)>-1);},runner:function(topic,data){var isReserved=_checkers.reserved(topic,data),isNonRunner=_checkers['non-runner'](topic,data);return!(isReserved||isNonRunner);}};this.onUpdate=function(data){this.update(data);};this.update=function(data){var outcome=data.data||[],topic=data.topic,checker,i;if(!($.isArray(outcome)&&outcome[0])){return;}
for(i in _checkers){checker=_checkers[i];if(callbacks[i]&&checker(topic,outcome)){callbacks[i](topic[HORSE_NAME_INDEX],topic,outcome);}}};};
diffusion.listeners.Abstract=joop.createClass({TOPIC_PART_COMPETITION:'competitionTopicID',TOPIC_PART_EVENT:'eventTopicID',TOPIC_PART_DATE:'dateTopicID',TOPIC_PART_BOOKIE:'bookmakerTopicID',TOPIC_PART_OUTCOME:'outcomeTopicID',TOPIC_PART_SPORT:'sportTopicID',TOPIC_PART_MARKET:'marketTopicID',TOPIC_PART_ORDER_SPORT:1,TOPIC_PART_ORDER_MARKET:5,TOPIC_PART_ORDER_COMPETITON:3,TOPIC_PART_ORDER_EVENT:4,TOPIC_PART_ORDER_DATE:2,TOPIC_PART_ORDER_BOOKIE:7,TOPIC_PART_ORDER_OUTCOME:6,_prepareDataAndCallListener:function(data){var converted=this._convert(data);this.update(converted.data,converted.delta,converted.isItl);},_array_combine:function(keys,values,initial){var result={};if(typeof initial=='object'){result=initial;}
for(var key=0;key<values.length;key++){if(values[key]==null){continue;}
if(!(key in keys)){continue;}
result[keys[key]]=values[key];}
return result;}});
diffusion.listeners.AbstractMonothread=joop.createClass({extend:diffusion.listeners.Abstract,onUpdate:function(data){this._prepareDataAndCallListener(data);}});
diffusion.listeners.AbstractMultithread=joop.createClass({extend:diffusion.listeners.Abstract,construct:function(){},onUpdate:function(data){var context=this;setTimeout(function(){context._prepareDataAndCallListener(data);},1);}});
namespace('diffusion.listeners');diffusion.listeners.price=function(init){$.extend(this,{prefix:'',prefixEachWay:'',templates:{},callbacks:{},useBookmaker:0,preferredFilter:0,pageRef:'',ACTION_CLEAR:1,ACTION_UPDATE:2},init);this.mainBookmaker=init.bookmaker||'';this.storage={};};!function(){this.processData=function(data,action){var answerType;if($.inArray('EACH_WAY',data.topic)!==-1){answerType=new diffusion.types.EachWay();}else if($.inArray('INFO',data.topic)!==-1){answerType=new diffusion.types.Info();}else if($.inArray('PRC_HIST',data.topic)!==-1){answerType=new diffusion.types.PriceHistory();}else if($.inArray('PRC',data.topic)!==-1){answerType=new diffusion.types.Price();}else{return false;}
var initParams={preferredFilter:this.preferredFilter,useBookmaker:this.useBookmaker,prefix:this.prefix,prefixEachWay:this.prefixEachWay,templates:this.templates,callbacks:this.callbacks,data:data,storage:this.storage,pageRef:this.pageRef,mainBookmaker:this.mainBookmaker};if(answerType.init(initParams)){answerType.preProcess(this);if(action==this.ACTION_UPDATE){this.addToStorage(answerType.getStorageData());answerType.draw();}else if(action==this.ACTION_CLEAR){answerType.clear();}
answerType.proceed();answerType.postProcess(this);}
return true;};this.onClear=function(data){return this.processData(data,this.ACTION_CLEAR);};this.onUpdate=function(data){return this.processData(data,this.ACTION_UPDATE);};this.addToStorage=function(data){$.extend(true,this.storage,data);};this.clearStorage=function(key){};this.setBookmaker=function(bookmaker){this.mainBookmaker=bookmaker;};this.resetBookmaker=function(){this.mainBookmaker='';};}.call(diffusion.listeners.price.prototype);
var webApp=webApp||{};webApp.configs={defaultHash:'#meeting-list',controllerNamespaces:['greyhoundbet','webApp','footballbet'],templates:{"level":"view-level","page-preloader":"view-page-preloader","block-preloader":"view-block-preloader","page":"view-page","ad":"adCms"},holders:{header:'#pageHeader'},tree:{meeting:{homeUrl:'#meeting-list',controllers:["meeting-list","meeting-races","trap-draws-races","card","predictor","dog","form-explained","video","advanced-video","card-meeting-result","card-dog","card-video","search"],rememberLastVisited:true,allowOverrideHomeUrl:false},results:{homeUrl:'#results-list',controllers:['results-list','result-meeting','result-meeting-result','results-latest','results-dog','results-form-explained','result-video'],rememberLastVisited:true,allowOverrideHomeUrl:false},news:{homeUrl:'#news-home',controllers:["news-home","news-story"]},betslip:{rememberLastVisited:false,allowOverrideHomeUrl:false,homeUrl:'#bet-slip',controllers:['bet-slip','bets-explained','generic-error','market-suspend-error','price-changed-error','receipt','generic-error','market-suspend-error','price-changed-error','wh-gambling-details','ladb-gambling-details']},account:{homeUrl:'#account-home',allowOverrideHomeUrl:false,controllers:["account-home","account-customise","account-form-lines","account-sort-by","account-odds",'bet-slip',"mult-bets-explained","wh-home","wh-account-home","wh-terms","wh-register","wh-help-info","wh-forgotten-password",'wh-free-bets-offer','wh-open-bets','wh-withdraw','wh-top-up','wh-bet-detail','connectivity-check','ladb-home','ladb-open-bets','ladb-account-home','ladb-withdraw','ladb-top-up']},'search':{controllers:['search-dog','search-form-explained']},errors:{controllers:['error404']}},controllers:{'search':{cacheLifetime:0,blocks:{header:{level:1,template:'search-header'},search:{level:2,template:'search-results',cacheBy:['page','search_text'],noCache:true}}},'search-dog':{cacheLifetime:0,blocks:{"search-dog-header":{level:1,template:'search-dog-header'},"search-dog-details":{level:2,template:'search-dog-details',cacheBy:['dog_id'],noCache:true}}},'search-form-explained':{cacheLifetime:0,blocks:{"header":{template:'form-explained-head',level:1},"main":{template:'form-explained',level:2}}},"error404":{secondLinks:{cards:{referers:['card','dog','predictor'],text:"Today's cards",controller:"card"},meeting:{referers:['meeting-races','trap-draws-races'],text:"Today's cards",controller:"meeting-list"},news:{referers:['news-home','news-story'],text:"News",controller:"news-home"},results:{referers:['results-list'],text:"Return to Results menu",hideMainSiteLink:true,controller:"results-list"}},cacheLifetime:0,blocks:{"header":{template:'search-header',level:1},"main":{template:'error-404',level:2}}},'account-home':{cacheLifetime:0,blocks:{header:{level:1,template:'account-header'},'main':{'template':'account-home-main','level':2,'beforeRender':'addDataToView','afterRender':'afterMainRender'}}},'account-sort-by':{cacheLifetime:0,blocks:{header:{level:1,template:'account-sort-by-header'},'main':{'template':'account-sort-by','level':2}}},'account-odds':{cacheLifetime:0,blocks:{header:{level:1,template:'account-odds-header'},'main':{'template':'account-odds','level':2}}},'wh-home':{cacheLifetime:0,'blocks':{header:{level:1,template:'wh-home-header'},'main':{'template':'wh-home-main','level':2}}},'wh-account-home':{cacheLifetime:0,blocks:{'main-header':{'template':'user-page-header','level':1},'main':{'template':'user-page','level':2}}},'bet-slip':{cacheLifetime:0,'blocks':{'main':{'template':'wh-betslip-main','level':2}},hideMainTabs:true,defaultScroll:true},'bets-explained':{blocks:{'header':{'template':'bets-explained-header','level':1},'main':{'template':'bets-explained-main','level':2}},hideMainTabs:true},'wh-terms':{cacheLifetime:0,blocks:{header:{level:1,template:'wh-terms-header'},'main':{template:'wh-terms-main',level:2}}},'wh-register':{cacheLifetime:0,blocks:{header:{level:1,template:'wh-register-header'},'registration':{template:'wh-register-main',level:2}}},'receipt':{cacheLifetime:0,blocks:{'main':{template:'wh-receipt',level:1}},hideMainTabs:true,hideMainTabsMobile:true,defaultScroll:true},'wh-help-info':{cacheLifetime:0,blocks:{header:{level:1,template:'wh-help-info-header'},'main':{template:'wh-help-info-main',level:2}}},'wh-forgotten-password':{cacheLifetime:0,blocks:{header:{level:1,template:'wh-forgotten-password-header'},'main':{template:'wh-forgotten-password-main',level:2}}},'wh-withdraw':{cacheLifetime:0,blocks:{header:{level:1,template:'wh-withdraw-header'},'main':{template:'wh-withdraw-main',level:2}}},'market-suspend-error':{cacheLifetime:0,'blocks':{'main':{'template':'wh-market-suspend-error','level':1,'afterRender':'mainAfterRender','beforeRender':'mainBeforeRender'}},hideMainTabs:true,defaultScroll:true},'price-changed-error':{cacheLifetime:0,'blocks':{'main':{'template':'wh-price-changed-error','level':1,'afterRender':'mainAfterRender','beforeRender':'mainBeforeRender'}},hideMainTabs:true,defaultScroll:true},'generic-error':{cacheLifetime:0,blocks:{main:{template:'wh-generic-error',level:1}},hideMainTabs:true},'wh-open-bets':{cacheLifetime:0,'blocks':{'header':{'template':'wh-open-bets-header','level':1},'main':{'template':'wh-open-bets','level':2,'afterRender':'mainAfterRender','beforeRender':'mainBeforeRender'}}},'wh-top-up':{cacheLifetime:0,'blocks':{header:{level:1,template:'wh-header-top-up'},'main':{'template':'wh-top-up-main','level':2}}},'wh-bet-detail':{cacheLifetime:0,'blocks':{'main':{'template':'wh-bet-detail','level':1}}},'wh-free-bets-offer':{cacheLifetime:0,'blocks':{header:{level:1,template:'wh-free-bets-offer-header'},'main':{'template':'wh-free-bets-offer','level':2}}},'meeting-list':{cacheLifetime:0,blocks:{header:{level:1,template:'meetings-header',renderCacheBy:['r_date'],cacheLifetime:0},list:{level:2,template:'meeting-list-by-meeting',cacheBy:['view','r_date'],cacheLifetime:0},'empty-list':{level:2,template:'meeting-list-empty',cacheBy:['r_date'],cacheLifetime:0}}},'trap-draws-races':{cacheLifetime:0,blocks:{'trap-draws-header':{level:1,template:'trap-draws-header'},'trap-draws-races':{level:2,template:'trap-draws-races-list',cacheBy:['r_date','track_id'],cacheLifetime:0}}},'meeting-races':{cacheLifetime:0,blocks:{header:{level:1,template:'meeting-races-header',cacheBy:['track_id','r_date']},'tips':{level:2,cacheBy:['race_id']},list:{level:2,template:'meeting-races',cacheBy:['track_id','r_time','r_date'],cacheLifetime:0}}},'card':{cacheLifetime:0,blocks:{'next-race':{level:1,cacheLifetime:0},'card-header':{level:1,template:'card-header',cacheBy:['r_date']},'card-pager':{level:2,template:'card-pager'},'card-tabs':{level:3,template:'card-tabs'},'card-title':{level:4,template:'card-title',cacheBy:['race_id']},'card':{level:5,template:'tab-card',cacheBy:['race_id','r_date']},'form':{level:5,template:'tab-form',cacheBy:['race_id']},'stats':{level:5,template:'tab-stats',cacheBy:['race_id']},'tips':{level:5,template:'tab-tips',cacheBy:['race_id']}}},'predictor':{cacheLifetime:0,blocks:{simulator:{level:1,template:'predictor',cacheBy:['race_id']}},hideMainTabs:true,hideMainTabsMobile:true},'dog':{cacheLifetime:0,blocks:{"header":{template:'greyhound-info-header',level:1,cacheBy:['r_date','race_id']},"details":{template:'greyhound-info',level:2,cacheBy:['dog_id']}}},'form-explained':{cacheLifetime:0,blocks:{"header":{template:'form-explained-head',level:1},"main":{template:'form-explained',level:2}}},'results-form-explained':{cacheLifetime:0,blocks:{"header":{template:'form-explained-head',level:1},"main":{template:'form-explained',level:2}}},'results-list':{cacheLifetime:0,blocks:{header:{level:1,template:'results-meetings-header'},meetings:{level:2,template:'results-meetings-list',cacheBy:['r_date'],cacheLifetime:0}}},'result-meeting':{cacheLifetime:0,blocks:{header:{level:1,template:'results-meeting-header'},list:{level:2,template:'results-meeting-list',cacheBy:['track_id','r_date','r_time'],cacheLifetime:0}}},'card-meeting-result':{cacheLifetime:0,blocks:{meetingHeader:{level:1,cacheBy:['r_date'],template:'results-meeting-header'},"results-meeting-pager":{level:2,cacheBy:['r_date'],template:'results-meeting-pager',afterRender:'initResultPager'},list:{level:3,template:'results-meeting-result',cacheBy:['race_id','track_id','r_date'],cacheLifetime:0}}},'result-meeting-result':{cacheLifetime:0,blocks:{meetingHeader:{level:1,cacheBy:['r_date'],template:'results-meeting-header'},"results-meeting-pager":{level:2,cacheBy:['r_date'],template:'results-meeting-pager',afterRender:'initResultPager'},list:{level:3,template:'results-meeting-result',cacheBy:['race_id','track_id','r_date'],cacheLifetime:0}}},'results-latest':{cacheLifetime:0,blocks:{latestHeader:{level:1,cacheBy:['r_date'],template:'results-meeting-header'},latestList:{level:2,template:'results-latest-list',cacheLifetime:0}}},'results-dog':{cacheLifetime:0,blocks:{"results-dog-header":{template:'results-dog-header',level:1,cacheBy:['race_id'],beforeRender:'saveDogData',afterRender:'bindHeaderEvents'},"results-dog-details":{level:2,template:'results-dog-details',cacheBy:['dog_id']}}},'card-dog':{cacheLifetime:0,blocks:{"results-dog-header":{template:'results-dog-header',level:1,cacheBy:['race_id'],beforeRender:'saveDogData',afterRender:'bindHeaderEvents'},"results-dog-details":{level:2,template:'results-dog-details',cacheBy:['dog_id']}}},'result-video':{cacheLifetime:0,'blocks':{'header':{'template':'archive-header','level':1},'player-data':{template:'archive-player',cacheBy:['video_id','r_date'],level:2},list:{level:3,template:'archive-details',cacheBy:['race_id','track_id','r_date'],cacheLifetime:0}}},'card-video':{cacheLifetime:0,'blocks':{'header':{'template':'archive-header','level':1},'player-data':{template:'archive-player',cacheBy:['video_id','r_date'],level:2},list:{level:3,template:'archive-details',cacheBy:['race_id','track_id','r_date'],cacheLifetime:0}}},'news-home':{cacheLifetime:0,blocks:{"news-header":{level:1,template:'news-home-header',afterRender:'bindRefresh'},"news-list":{level:2,template:'news-home-list',cacheId:'news-list'}}},'news-story':{cacheLifetime:0,blocks:{"top-nav":{template:'news-story-header',level:1,cacheId:'news-list'},"content":{template:'news-story-content',level:2,cacheBy:['story_id']}}},'video':{cacheLifetime:0,'blocks':{'header':{'template':'video-header','level':1},'video-urls':{'template':'video-player','level':2,'cacheBy':['race_id'],'cacheLifetime':0}}},'advanced-video':{cacheLifetime:0,'blocks':{'header':{'template':'video-header','level':1},'video-urls':{'template':'advanced-video-player','level':2,'cacheBy':['race_id'],'cacheLifetime':0},'content':{'template':'video-details','level':3,'cacheLifetime':0}}},'connectivity-check':{cacheLifetime:0,'blocks':{'header':{'template':'connectivity-check-header','level':1},'main':{'template':'connectivity-check','level':2}}},'ladb-home':{cacheLifetime:0,blocks:{'header':{template:'ladb-home-header',level:1},'ladb-home':{template:'ladb-home',level:2}},defaultScroll:'frame'},'ladb-account-home':{cacheLifetime:0,blocks:{'main-header':{'template':'user-page-header','level':1},'main':{'template':'user-page','level':2}}},'ladb-top-up':{cacheLifetime:0,blocks:{'main':{'template':'ladb-top-up','level':1}},defaultScroll:'frame'},'ladb-withdraw':{cacheLifetime:0,blocks:{'header':{'template':'ladb-withdraw-header','level':1},'main':{'template':'ladb-withdraw','level':2}}},'ladb-open-bets':{cacheLifetime:0,'blocks':{'header':{'template':'ladb-open-bets-header','level':1},'main':{'template':'ladb-open-bets','level':2}}},'wh-gambling-details':{cacheLifetime:0,'blocks':{'header':{'template':'gambling-details-header','level':1},'main':{'template':'wh-gambling-details','level':2}}},'ladb-gambling-details':{cacheLifetime:0,'blocks':{'header':{'template':'gambling-details-header','level':1},'main':{'template':'ladb-gambling-details','level':2}}}}};
var greyhoundbet=greyhoundbet||{};var webApp=webApp||{};greyhoundbet.URL_MEETING='/meeting/blocks.sd';greyhoundbet.URL_CARD='/card/blocks.sd';greyhoundbet.URL_NEWS='/news/blocks.sd';greyhoundbet.URL_DOG='/dog/blocks.sd';greyhoundbet.URL_MEETING="/meeting/blocks.sd";greyhoundbet.URL_RESULTS="/results/blocks.sd";greyhoundbet.URL_CARD="/card/blocks.sd";greyhoundbet.URL_NEWS="/news/blocks.sd";greyhoundbet.URL_VIDEO='/video/blocks.sd';webApp.URL_SELF_CHECK='/maintenance/check_server.sd';greyhoundbet.URL_SEARCH='/search/blocks.sd';webApp.routes={'meeting-list':greyhoundbet.URL_MEETING,'meeting-races':greyhoundbet.URL_MEETING,'trap-draws-races':greyhoundbet.URL_MEETING,'meeting':greyhoundbet.URL_MEETING,'card':greyhoundbet.URL_CARD,'predictor':greyhoundbet.URL_CARD,'dog':greyhoundbet.URL_DOG,'results-list':greyhoundbet.URL_RESULTS,'results-latest':greyhoundbet.URL_RESULTS,'result-meeting':greyhoundbet.URL_RESULTS,'result-meeting-result':greyhoundbet.URL_RESULTS,'result-video':greyhoundbet.URL_RESULTS,'news-home':greyhoundbet.URL_NEWS,'video':greyhoundbet.URL_VIDEO,'advanced-video':greyhoundbet.URL_VIDEO,'news-story':greyhoundbet.URL_NEWS,'results-dog':greyhoundbet.URL_RESULTS,'connectivity-check':greyhoundbet.URL_SELF_CHECK,'search':greyhoundbet.URL_SEARCH,'search-dog':greyhoundbet.URL_SEARCH,'card-meeting-result':greyhoundbet.URL_RESULTS,'card-dog':greyhoundbet.URL_RESULTS,'card-video':greyhoundbet.URL_RESULTS};
var webApp=webApp||{};webApp.EVENT_VIEW_RENDER_TPL='view.renderTpl';webApp.EVENT_CHANGE_ORIENTATION='changeorientaion';webApp.EVENT_CHANGE_HASH='changehash';webApp.EVENT_CHANGE_CONTROLLER='changecontroller';webApp.EVENT_BETSLIP_EMPTIED='betslipemptied';webApp.PREFERRED_BOOKMAKER='PREFERRED_BOOKMAKER';webApp.LIVEEVENTS_PER_PAGE=8;webApp.NEWS_LIVE_VIEW_ID=4;webApp.RACEDAY_LIVE_VIEW_ID=1;
var webApp=webApp||{};webApp.gaEvents={main_menu_news:['Main Menu','News'],main_menu_account:['Main Menu','Accounts'],main_menu_cards:['Main Menu','Cards'],main_menu_results:['Main Menu','Results'],side_menu_cards_today:['Main Menu','Cards','Today'],side_menu_cards_future:['Main Menu','Cards','Future'],side_menu_cards_trap_draws:['Main Menu','Cards','Trap Draws'],side_menu_cards_rpgtv:['Main Menu','Cards','RPGTV'],side_menu_results_today:['Main Menu','Results','Today'],side_menu_results_archive:['Main Menu','Results','Archive'],cards_by_time:['Cards','Order By Time'],cards_by_meetings:['Cards','Order By Meetings'],cards_next_race:['Cards','Next Race Off'],cards_meetings_click:['Cards','Meetings Click'],cards_next_time:['Cards','Next Card Time'],cards_prev_time:['Cards','Previous Card Time'],cards_card:['Cards','Card'],cards_tab_card:['Cards','Tab Card'],cards_tab_form:['Cards','Tab Form'],cards_tab_stats:['Cards','Tab Stats'],cards_tab_tips:['Cards','Tab Tips'],cards_title_toggle:['Cards','Card Title Toggle'],cards_more_button:['Cards','More Detail Button'],cards_runner:['Cards','Lifetime Form'],cards_prev_runner:['Cards','Previous Card Runner'],cards_next_runner:['Cards','Next Card Runner'],cards_predictor:['Cards','Predictor'],cards_back_to_card:['Cards','Back to Card'],predictor_back:['Cards','Back to Card'],cards_back_to_list:['Cards','Back to Cards List'],cards_back:['Cards','Back'],cards_form_explained:['Cards','Form Explained Button'],cards_stats_swipe:['Cards','Stats Swipe'],results_latest:['Results','Latest Results'],results_meetings_click:['Results','Meetings Click'],results_date_select:['Results','Results Date Selection'],results_refresh:['Results','Results Refresh'],results_race_result:['Results','Race Result'],results_next_time:['Results','Next Result Time'],results_prev_time:['Results','Previous Result Time'],results_title_toggle:['Results','Result Title Toggle'],results_lifetime_form:['Results','Lifetime Form'],results_next_runner:['Results','Next Result Runner'],results_prev_runner:['Results','Previous Result Runner'],results_back_to_list:['Results','Back to Results Home'],results_back_to_result:['Results','Back to Result'],news_refresh:['News','Refresh'],news_story:['News','Story'],news_back_to_all:['News','Back to All News'],news_previous_story:['News','Previous Story'],news_next_story:['News','Next Story'],news_email_story:['News','Email Story'],news_post_on_facebook:['News','Post Story on Facebook'],news_post_on_twitter:['News','Post Story to Twitter'],'account_wh_logined':['Accounts','Log in to William Hill'],'account_wh_terms':['Accounts','Bookmaker Terms & Conditions'],'account_wh_phone':['Accounts','Call Phone'],'account_wh_site':['Accounts','Visit Website'],'account_back':['Accounts','Back To Account'],'account_ladb_terms':['Accounts','Bookmaker Terms & Conditions'],'account_ladb_site':['Accounts','Visit Website'],'account_ladb_phone':['Accounts','Call Phone'],account_login:['Accounts','Log in'],account_logout:['Accounts','Log out'],account_save_name:['Accounts','Save Username'],account_save_pass:['Accounts','Save Password'],account_forgot_pass:['Accounts','Forgotten Account Details'],account_no_account:['Accounts','Register'],account_topup:['Accounts','Top up'],account_bet_history:['Accounts','Bet History'],account_withdraw:['Accounts','Withdraw'],account_terms:['Accounts','Bookmaker Terms & Conditions'],account_sort_card:['Accounts','Sort Card By'],account_odds_display:['Accounts','Odds Display'],account_odds_type:['Accounts','Odds Type'],account_help:['Accounts','Help'],account_share:['Accounts','Share with Friends'],account_feedback:['Accounts','Email feedback'],account_pref_bookie:['Accounts','Preferred Bookmaker'],account_wh_bet_prom:['Accounts','Exclusive RP Offer'],bets_price_click:['Bets','Price Click'],bets_each_way:['Bets','Each Way'],bets_starting_price:['Bets','Starting Price'],error_404:['Errors','Error 404'],error_generic:['Errors','Generic'],error_market_suspended:['Errors','Market Suspended'],error_price_changed:['Errors','Price Change'],error_no_betting:['Errors','No Betting Error'],error_location_unknown:['Errors','Cancel Bet -'],deposit_deposit:['Deposit','Deposit'],deposit_account:['Deposit','My Account'],bet_receipt_card:['Bet Receipt','Bet Receipt Back Button'],bet_receipt_done:['Bet Receipt','Done'],bet_receipt_account:['Bet Receipt','Account'],betslip_place_bet:['Bet Slip','Place Bet'],betslip_account:['Bet Slip','Account Button'],betslip_back:['Bet Slip','Back'],betslip_login_and_bet:['Bet Slip','Log in & Place Bet'],betslip_login:['Bet Slip','Log in'],betslip_open_account:['Bet Slip','Open Account'],betslip_bet_offer:['Bet Slip','Bet Offer'],pref_bookie_login:['Preferred Bookmaker'],pref_bookie_register:['Preferred Bookmaker'],pref_bookie_start:['Preferred Bookmaker'],pref_bookie_select:['Preferred Bookmaker']};
var webApp=webApp||{};webApp.SelectionsManager=(function(){var onAddMultModeCallback=function(){return;};return{init:function(){$(window).bind('changebookie',function(e){rp.betting.SelectionsCollection.instance()._restoreSelections();webApp.SelectionsManager.updateCounter();});webApp.SelectionsManager.updateCounter();return this;},updateCounter:function(){var storedSelectionCount=this.getSelections().length;if(storedSelectionCount){webApp.selectionsAlert.setCounter(storedSelectionCount);}else{webApp.selectionsAlert.hideCounter();}},getSelections:function(){return rp.betting.SelectionsCollection.instance().selections();},removeAllSelections:function(){rp.betting.SelectionsCollection.instance().clear();webApp.selectionsAlert.hideCounter();return this;},addSelection:function(selection){rp.betting.SelectionsCollection.instance().add(selection);},getSelectionForSingleMode:function(){return rp.betting.SelectionsCollection.instance().selections()[0];},removeSelection:function(selection){rp.betting.SelectionsCollection.instance().remove(selection);return this;},isSelected:function(selection){return rp.betting.SelectionsCollection.instance().exists(selection);},highlightSelectionPrice:function(priceButtonSelector){$(priceButtonSelector).addClass('active');$(priceButtonSelector).find('i').text('IN SLIP');},unhighlightSelectionPrice:function(priceButtonSelector,bookieName){$(priceButtonSelector).removeClass('active');$(priceButtonSelector).find('i').text(bookieName);},setOnAddMultModeCallback:function(callback){if(typeof callback=='function'){onAddMultModeCallback=callback;}else{throw new Error('Illegal argument type, function is expected');}},processPriceClick:function(selection,priceButtonSelector,_context,bookieName){if(!this.getSelections().length){rp.betting.SelectionsCollection.instance().clear();this.addSelection(selection);if(_context instanceof webApp.AbstractController){_context._redirect('bet-slip');}else if(typeof _context==="function"){_context();}}else{if(this.isSelected(selection)){this.removeSelection(selection);this.unhighlightSelectionPrice(priceButtonSelector,bookieName);var selectionsTotal=this.getSelections().length;webApp.selectionsAlert.show(selectionsTotal);if(0===selectionsTotal){$(window).trigger(webApp.EVENT_BETSLIP_EMPTIED);}}else{if(this.getSelections().length<10){this.addSelection(selection);this.highlightSelectionPrice(priceButtonSelector);onAddMultModeCallback.call(this);}else{alert('You have the max of 10 selections in your slip already');}}}}};})();
namespace('rp');rp.Object=function(options){if(!(this instanceof arguments.callee)){throw new Error('rp.Object called as function.');}
this.set(options);};extend(rp.Object,Object,function($class){var PROPERTIES_STORAGE="__objectProperties";function clone(object){var constr=function(){};constr.prototype=object;return new constr;};this.property=function(name,accessors){if(!this.hasOwnProperty(PROPERTIES_STORAGE)){this[PROPERTIES_STORAGE]=clone(this[PROPERTIES_STORAGE]);}
var property='_'+name,getter,setter;accessors=accessors||{};getter=accessors.get;if(!$.isFunction(getter)){getter=this[name]||function(){return this[property];};}
setter=this[name];if(accessors.set){setter=accessors.set;if(!$.isFunction(setter)){setter=this[name]||function(value){this[property]=value;};}}
this[PROPERTIES_STORAGE][name]=this[name]=function(){if(arguments.length===0){return getter.call(this);}else if(setter){setter.apply(this,arguments);}
return this;};return this;};this.get=function(property){var result={},name,accessor,value;for(var i=0,l=arguments.length;i<l;i++){name=arguments[i];accessor=this[name];if($.isFunction(accessor)){value=$class.toJSON(accessor.call(this));result[name]=value;}}
return result;};this.set=function(properties){var accessor;for(var name in properties){accessor=this[name];if($.isFunction(accessor)){accessor.call(this,properties[name]);}}
return this;};this.proxy=function(handler){return $.proxy(handler,this);};var prefix='id-'+Number(new Date).toString(36);var count=1;this.uid=function(){if(!this._uid){this._uid=$class.uid();}
return this._uid;};this.toJSON=function(){var result={};for(var index in this[PROPERTIES_STORAGE]){result[index]=$class.toJSON(this[PROPERTIES_STORAGE][index].call(this));}
return result;};$class.uid=function(){return prefix+(count++).toString(36);};$class.toJSON=function(value){var json=null;if($.isArray(value)){json=[];for(var i=0,l=value.length;i<l;i++){json[i]=this.toJSON(value[i]);}}else if(value&&value.constructor===Object){json={};for(var i in value){json[i]=this.toJSON(value[i]);}}else if(value&&value.toJSON){json=value.toJSON();}else if(value!=null){json=value.valueOf();}
return json;};});
namespace('rp');rp.Storage=function(name){arguments.callee.$super.apply(this,arguments);};extend(rp.Storage,rp.Object,function($class,$super){var storage;try{storage=window.localStorage;}catch(error){storage={getItem:function(name){return this[name];},setItem:function(name,value){this[name]=value;}};}
function getData(name){var data=storage.getItem(name);return data&&JSON.parse(data)||{};};function setData(name,data){storage.setItem(name,JSON.stringify(data));};this._name='rp';this.property('name',{set:true});this.getValue=function(name,defaultValue){var data=getData(this._name);return data&&data.hasOwnProperty(name)?data[name]:defaultValue;};this.setValue=function(name,value,extendable){var data=getData(this._name)||{};if(extendable){value=$.extend(data[name]||{},value);}
data[name]=value;setData(this._name,data);},this.unsetValue=function(name){var data=getData(this._name);delete data[name];setData(this._name,data);};});
namespace('rp');rp.EventTarget=function(){arguments.callee.$super.apply(this,arguments);};extend(rp.EventTarget,rp.Object,function($class,$super){var slice=Array.prototype.slice;this._listeners=null;this.property('listeners',{get:function(){if(!this._listeners){this._listeners={};}
return this._listeners;}});this.event=function(name,accessors){var getter,setter;accessors=accessors||{};getter=accessors.get;if(!$.isFunction(getter)){getter=this[name]||function(){var args=slice.call(arguments);args.unshift(name);this.trigger.apply(this,args);return this;};}
setter=accessors.set;if(!$.isFunction(setter)){setter=this[name]||function(handler,context){this.bind(name,handler,context);};}
this[name]=function(){var accessor=$.isFunction(arguments[0])?setter:getter;accessor.apply(this,arguments);return this;};this["un"+name]=function(handler,context){this.unbind(name,handler,context);return this;};return this;};this.bind=function(types,handler,context){var listeners,uid;types=String(types).toLowerCase().split(/\s/);context=context||this;uid=this.uid.call(handler)+this.uid.call(context);for(var i=0,l=types.length;i<l;i++){listeners=namespace.call(this.listeners(),types[i]);if(!listeners.hasOwnProperty(uid)){listeners[uid]={handler:handler,context:context};}}
return this;};this.unbind=function(types,handler,context){var listeners,uid;types=String(types).toLowerCase().split(/\s/);context=context||this;uid=this.uid.call(handler)+this.uid.call(context);for(var i=0,l=types.length;i<l;i++){listeners=this.listeners()[types[i]];if(listeners){delete listeners[uid];}}
return this;};this.trigger=function(type,data){var args=slice.call(arguments),type=String(type).toLowerCase(),event=new rp.Event(type,this),listeners=this.listeners()[type],listener;args[0]=event;for(var uid in listeners){listener=listeners[uid];listener.handler.apply(listener.context,args);if(event.isImmediatePropagationStopped()){break;}}
return!event.isDefaultPrevented();};});
namespace('rp');rp.Event=function(type,target){this.type=type;this.target=target;};extend(rp.Event,rp.Object,function($class,$super){var PROPAGATION_STOPPED=1,PROPAGATION_IMMEDIATE_STOPPED=2;this.type='';this.target=null;this._defaultPrevented=false;this._propagationStopped=0;this.stopPropagation=function(){this._propagationStopped|=PROPAGATION_STOPPED;};this.stopImmediatePropagation=function(){this._propagationStopped|=PROPAGATION_IMMEDIATE_STOPPED;};this.isPropagationStopped=function(){return!!(this._propagationStopped&&PROPAGATION_STOPPED);};this.isImmediatePropagationStopped=function(){return!!(this._propagationStopped&&PROPAGATION_IMMEDIATE_STOPPED);};this.preventDefault=function(){this._defaultPrevented=true;};this.isDefaultPrevented=function(){return this._defaultPrevented;};});
var rp=rp||{};rp.models=rp.models||{};rp.models.EachWay=function(response){var INDEX_DATA_EACH_WAY=0;var _parts=response.data[INDEX_DATA_EACH_WAY].split('|'),_bet=_parts[0],_places=_parts[1],_slashPosition=_bet.indexOf('/');this.num=_bet.substring(0,_slashPosition);this.den=_bet.substring(_slashPosition+1);this.places=_places;};
var rp=rp||{};rp.HorseBetInfo=function(price,oddsType){var INDEX_TOPIC_TIME=4,INDEX_TOPIC_HORSE_NAME=6,INDEX_TOPIC_DATE=2,INDEX_DATA_BETSLIP=3,INDEX_DATA_DECIMAL_PRICE=2,INDEX_DATA_FRACTIONAL_PRICE=1,INDEX_DATA_IS_SUSPENDED=5,SEPARATOR_FRACTIONAL_PRICE='/',SEPARATOR_BETSLIP='|';NOON_HOURS=12;var _betslip=price.data[INDEX_DATA_BETSLIP],_time=price.topic[INDEX_TOPIC_TIME],_hours=Math.floor(_time/100),_minutes=Math.round(_time%100),_fractional=price.data[INDEX_DATA_FRACTIONAL_PRICE],_separatorPosition=_fractional.indexOf(SEPARATOR_FRACTIONAL_PRICE),_raceDateISO8601=price.topic[INDEX_TOPIC_DATE].split('-').reverse().join('-')+'T'+_hours+':'+((_minutes<10)?'0':'')+_minutes;this._oddsType=oddsType||'fractional';this.selectionId=_betslip.substring(0,_betslip.indexOf(SEPARATOR_BETSLIP));this.horseName=price.topic[INDEX_TOPIC_HORSE_NAME];this.selectionName=this.horseName;this.name=price.topic[INDEX_TOPIC_HORSE_NAME].replace(/_/g,' ').replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase();});this.hours=(_hours!=NOON_HOURS)?(_hours%=NOON_HOURS):_hours;this.minutes=(_minutes<10)?'0'+_minutes:_minutes;this.numerator=parseInt(_fractional.substring(0,_separatorPosition),10)||1;this.denominator=parseInt(_fractional.substring(_separatorPosition+1),10)||1;this.fractional=price.data[INDEX_DATA_FRACTIONAL_PRICE];this.decimal=price.data[INDEX_DATA_DECIMAL_PRICE];this.isSuspended=(price.data[INDEX_DATA_IS_SUSPENDED]==1)?true:false;this.raceTs=moment.utc(_raceDateISO8601).unix();};rp.HorseBetInfo.prototype.toString=function(oddsType){var result=''
oddsType=oddsType||this._oddsType;if(oddsType=='decimal'){result=parseFloat(this.decimal).toFixed(2);}else{result=this.fractional;}
if(this.fractional=="SP"||this.decimal=='0.0'){result="SP";}
if(this.isSuspended){result='&mdash;';}
return result;};
namespace('rp',function(rp){rp.Timeout=function(){arguments.callee.$super.apply(this,arguments);};extend(rp.Timeout,rp.EventTarget,function($class,$super){$class.EVENT_TICK='tick';this.event($class.EVENT_TICK);this._handle=null;this.property('isStarted',{get:function(){return this._handle!=null;}});this._interval=1000;this.property('interval',{set:function(interval){this.stop();this._interval=Number(interval)||0;}});this._handleTick=function(){this._handle=null;this.trigger($class.EVENT_TICK);};this.start=function(){this.stop();this._handle=window.setTimeout($.proxy(this._handleTick,this),this._interval);};this.stop=function(){if(this._handle){window.clearTimeout(this._handle);this._handle=null;}};});rp.timeout=function(interval){return new rp.Timeout({interval:interval});};});
namespace('rp',function(rp){rp.url=function(url,base){if(!(url instanceof URL)){url=URL.create(url,base);}
return url;};function URL(){URL.$super.apply(this,arguments);};extend(URL,rp.Object,function($class,$super){var
REGEXP_SCHEME=/^[a-z][a-z0-9\+\-\.]+$/,REGEXP_AUTHORITY=/^(?:([^:@]+)(?::([^@]+))?@)?([^:]*)(?::(\d+))?$/;$class.normalize=function(path){var out=[],part='';path=String(path).split('/');while(path.length){part=path.shift();if(part!='.'){part=='..'?out.pop():out.push(part);}}
return out.length?out.join('/'):'/';};this._scheme=null;this.property('scheme',{set:function(scheme){if(!REGEXP_SCHEME.test(scheme)){throw new Error('Invalid scheme.');}
this._scheme=String(scheme);}});this._user=null;this.property('user',{set:function(user){this._user=String(user||'');}});this._password=null;this.property('password',{set:function(password){this._password=String(password||'');}});this._host='';this.property('host',{set:function(host){this._host=String(host);}});this._port=null;this.property('port',{set:function(port){this._port=port>0&&Number(port)||null;}});this._path='';this.property('path',{set:function(path){this._path=$class.normalize(path);}});this._params=null;this.property('params',{get:function(){return this._params;},set:function(params){this._params=$.extend({},this._params,params);}});this._hash='';this.property('hash',{set:function(hash){this._hash=String(hash||'');}});this.property('authority',{get:function(){return[(this._user?this._user+(this._password?':'+this._password:'')+'@':''),this._host,this._port?':'+this._port:''].join('');},set:function(authority){var match=String(authority).match(REGEXP_AUTHORITY);if(!match){throw new Error(authority+' is not well formed url authority.');}
this.user(match[1]).password(match[2]).host(match[3]).port(match[4]);}});this.property('origin',{get:function(){return this._scheme+'://'+this.authority();}});this.property('href',{get:function(){return this.origin()+this._path;}});this.property('folder',{get:function(){return this._path.replace(/[^\/]+$/,'');}});this.property('query',{get:function(){return Query.stringify(this.params());},set:function(query){this.params(Query.parse(query));}});this.param=function(name,value){if(arguments.length===1){return this._params.hasOwnProperty(name)?this._params[name]:null;}
this._params[name]=value;return this;};this.toString=function(){var authority=this.authority(),query=this.query(),hash=this.hash();return String(this._scheme+':'
+(authority?'//'+authority:'')
+this._path
+(query?'?'+query:'')
+(hash?'#'+hash:''));};$class.create=function(url,base){url=utils.string.url(url);if(!url){throw new Error(url+' is not well formed url.');}
if(!url.scheme){base=rp.url(base||String(location));url.scheme=base.scheme();url.authority=base.authority();url.query=(url.path||url.query)?url.query:base.query();url.path=url.path||'';if(url.path.charAt(0)!=='/'){url.path=base.folder()+url.path;}}
return new URL(url);};});function Query(){this._values={};};extend(Query,rp.Object,function($class,$super){this._maxKey=0;this._isArray=null;this.property('isArray',{set:function(isArray){this._isArray=Boolean(isArray);}});var VALUES={'true':true,'false':false,'null':null};function convert(value){if(VALUES.hasOwnProperty(value)){return VALUES[value];}
return(value===''||isNaN(value))?value.replace(/\+/g,' '):+value;};this.add=function(key,value){if(key===''||key===' '){key=this._maxKey++;}else if(key===String(parseInt(key,10))){this.isArray(key>=0);this._maxKey=Math.max(key+1,this._maxKey);}else{this.isArray(false);}
if(value==null){if(!(this._values[key]instanceof $class)){this._values[key]=new $class();}}else{this._values[key]=convert(value);}
return this._values[key];};this.values=function(){var values=this._isArray?[]:{},value=null;for(var i in this._values){value=this._values[i];values[i]=(value instanceof $class)?value.values():value;}
return values;};function parseKeys(name){var keys=[],left=0,right=0,pos=0;if(/\S/.test(name)){name=name.replace(/[\+\s]/g,'_');while(true){left=name.indexOf('[',pos);right=name.indexOf(']',left);if(left===0||(pos&&(left!==pos||right===-1))){break;}else if(left===-1||right===-1){keys.push(name.replace('[','_'));break;}else{if(!pos){keys.push(name.substr(pos,left));}
keys.push(name.substring(left+1,right));pos=right+1;}}}
return keys;};$class.parse=function(query){var pairs=String(query==null?'':query).split('&'),items=new $class(),pair,keys,value,values;for(var i=0,l=pairs.length;i<l;i++){pair=pairs[i].split('=');keys=[];value='';try{keys=parseKeys(decodeURIComponent(pair.shift()));value=decodeURIComponent(pair.join('='));}catch(error){continue;}
if(keys.length){values=items;for(var j=0,k=keys.length-1;j<k;j++){values=values.add(keys[j]);}
values.add(keys[k],value);}}
return items.isArray(false).values();};$class.stringify=function(query){return $.param(query);};});});
namespace('utils');utils.bet={LABEL_PLACED_SHORT:'P',LABEL_WIN_SHORT:'W',LABEL_VOID_SHORT:'V',LABEL_EACHWAY_SHORT:'E',LABEL_EACHWAY_ABBR:'EW',LABEL_PLACED_FULL:'Placed',LABEL_WIN_FULL:'Win',LABEL_WON_FULL:'Won',LABEL_LOST_FULL:'Lost',LABEL_VOID_FULL:'Void',LABEL_EACHWAY_FULL:'EachWay',LABEL_GBP:'&pound;',LABEL_EUR:'&euro;',LABEL_USD:'$',LABEL_SEK:'Kr',LABEL_SP:'SP',LABEL_EVS:'Evs',detectLabel:function(bet){var result='';if(bet instanceof rp.betting.Bet){var winnings=bet.returns(),price=bet.selection().price(),isEachWay=bet.isEachWay();if(winnings>0){if(bet.label()===utils.bet.LABEL_VOID_FULL){result=utils.bet.LABEL_VOID_SHORT;}else if(bet.isSingle()&&!bet.selection().isSP()){if(!isEachWay){result=utils.bet.LABEL_WIN_SHORT;}else if(isEachWay&&bet.isSingle()){var den=price.den(),num=price.num(),stake=(bet.stake()*num/den);result=(winnings>stake)?utils.bet.LABEL_WIN_SHORT:utils.bet.LABEL_PLACED_SHORT;}}else{result=utils.bet.LABEL_WIN_SHORT;}}}
return result;},formatSelectionPrice:function(selection,decimal){var result=utils.bet.LABEL_SP;if(!selection.isSP()){if(decimal){result=selection.getPrice(decimal).toFixed(2);}else{result=selection.price().fractional();}};return result;},replaceEncodings:function(str){var searchlist=[65533],replacelist=[39];return utils.string.replaceByCharCodes(str,searchlist,replacelist);},convertCurrencyCodeToHtml:function(code,defaultHtml){var MONEY_ISO_CONVERT={GBP:this.LABEL_GBP,EUR:this.LABEL_EUR,USD:this.LABEL_USD,SEK:this.LABEL_SEK};MONEY_ISO_CONVERT[this.LABEL_GBP]=this.LABEL_GBP;MONEY_ISO_CONVERT[this.LABEL_EUR]=this.LABEL_EUR;MONEY_ISO_CONVERT[this.LABEL_USD]=this.LABEL_USD;MONEY_ISO_CONVERT[this.LABEL_SEK]=this.LABEL_SEK;var returnCode=defaultHtml||this.LABEL_GBP;if(MONEY_ISO_CONVERT[code]){returnCode=MONEY_ISO_CONVERT[code];}
return returnCode;},isStraight:function(selections){var differentRaces={};for(var i=0;i<selections.length;i++){if(differentRaces[selections[i].data().raceId]){return false;}else{differentRaces[selections[i].data().raceId]=1;}}
return true;},getNumberOfCombinations:function(n,k){var combinations=0;if(k>n){return combinations;};combinations=utils.numbers.factorial(n)/(utils.numbers.factorial(k)*utils.numbers.factorial(n-k));return combinations;},getCombinations:function(source,min,max){var length=source.length;function generate(result,source,ancestor){var combination;for(var i=0,l=source.length;i<l;i++){combination=(ancestor||[]).concat([source[i]]);if(combination.length>=min){result.push(combination);}
if(combination.length<max){generate(result,source.slice(i+1),combination);}}
return result;}
min=Math.max(+min||0,1);max=Math.min(Math.max(+max||length,min),length);return generate([],source);},getBetTypeName:function(bet,pluralize,typeNameDefault){var result='',types=rp.betting.Bet.TYPE,betType=bet.type(),selCount=this.totalAccumulators;for(var typeName in types){var typeCode=types[typeName];if(typeCode===bet.type()){result=typeName;break;}}
if(!result&&typeNameDefault){result=typeNameDefault;}else if(result){var typePeices=result.split('_'),typeNames=[];$.map($.makeArray(typePeices),function(val,i){typeNames.push(utils.string.capitalize(val));});result=typeNames.join(' ');}
if(bet.isAccumulator()){if(selCount===4&&betType==types.FOURFOLD||selCount===5&&betType==types.FIVEFOLD||selCount===6&&betType==types.SIXFOLD||selCount===7&&betType==types.SEVENFOLD||selCount===8&&betType==types.EIGHTFOLD||selCount===9&&betType==types.NINEFOLD||selCount===10&&betType==types.TENFOLD){if(bet.betCounter()>1){result+=" accumulators";}else{result+=" accumulator";}}else if(bet.betCounter()>1&&pluralize){result+="s";}
if(betType===types.SINGLE){result+=" Bet";}}
return result;},totalAccumulators:0,accumulatorsCounter:function(bets){var total=1;betLength=bets.length||0;for(var i=0;i<betLength;i++){var betType=bets[i].type();if(betType>=258&&betType<=268){total++;}}
this.totalAccumulators=total;return'';},getPermutations:function(sourceArrays){var totalCombinations=1;for(var i=0;i<sourceArrays.length;i++){totalCombinations*=sourceArrays[i].length;}
var resultingSets=[];for(var currNumber=0;currNumber<totalCombinations;currNumber++){var currentIndexes=[];var currDigitWeigth=1;for(var i=0;i<sourceArrays.length;i++){var currIndex=(Math.floor(currNumber/currDigitWeigth))%sourceArrays[i].length;currDigitWeigth*=[sourceArrays[i].length];currentIndexes.push(sourceArrays[i][currIndex]);}
resultingSets.push(currentIndexes);}
return resultingSets;}};
namespace('rp.betting');rp.betting.Bet=function(){this._selections=[];this._freeBets=[];arguments.callee.$super.apply(this,arguments);};extend(rp.betting.Bet,rp.EventTarget,function($class,$super){$class.EVENT_CHANGE='change';this.event($class.EVENT_CHANGE);var
i=8,TYPE_ACCUMULATOR=(1<<i++),TYPE_FULL_COVER=(1<<i++),TYPE_HAS_SINGLES=(1<<i++),TYPE_TOTE=(1<<i++);$class.TYPE={};$class.TYPE.SINGLE=TYPE_HAS_SINGLES|TYPE_ACCUMULATOR|1;$class.TYPE.DOUBLE=TYPE_ACCUMULATOR|2;$class.TYPE.TREBLE=TYPE_ACCUMULATOR|3;$class.TYPE.FOURFOLD=TYPE_ACCUMULATOR|4;$class.TYPE.FIVEFOLD=TYPE_ACCUMULATOR|5;$class.TYPE.SIXFOLD=TYPE_ACCUMULATOR|6;$class.TYPE.SEVENFOLD=TYPE_ACCUMULATOR|7;$class.TYPE.EIGHTFOLD=TYPE_ACCUMULATOR|8;$class.TYPE.NINEFOLD=TYPE_ACCUMULATOR|9;$class.TYPE.TENFOLD=TYPE_ACCUMULATOR|10;$class.TYPE.ACCUMULATOR=TYPE_ACCUMULATOR;$class.TYPE.TRIXIE=TYPE_FULL_COVER|3;$class.TYPE.YANKEE=TYPE_FULL_COVER|4;$class.TYPE.SUPER_YANKEE=$class.TYPE.CANADIAN=TYPE_FULL_COVER|5;$class.TYPE.HEINZ=TYPE_FULL_COVER|6;$class.TYPE.SUPER_HEINZ=TYPE_FULL_COVER|7;$class.TYPE.GOLIATH=TYPE_FULL_COVER|8;$class.TYPE.PATENT=TYPE_HAS_SINGLES|$class.TYPE.TRIXIE;$class.TYPE.LUCKY_15=TYPE_HAS_SINGLES|$class.TYPE.YANKEE;$class.TYPE.LUCKY_31=TYPE_HAS_SINGLES|$class.TYPE.CANADIAN;$class.TYPE.LUCKY_63=TYPE_HAS_SINGLES|$class.TYPE.HEINZ;$class.TYPE.TOTE_WIN=TYPE_TOTE|1;$class.TYPE.TOTE_PLACE=TYPE_TOTE|2;$class.TYPE.TOTE_EXACTA=TYPE_TOTE|3;$class.TYPE.TOTE_TRIFECTA=TYPE_TOTE|4;$class.TYPE.TOTE_QUADPOT=TYPE_TOTE|5;$class.TYPE.TOTE_PLACEPOT=TYPE_TOTE|6;$class.TYPE.TOTE_JACKPOT=TYPE_TOTE|7;$class.TYPE.TOTE_SCOOP6=TYPE_TOTE|8;$class.TYPE.TOTE_SWINGER=TYPE_TOTE|9;function getTotalBets(selections,hasSingles){return utils.bet.getCombinations(selections,hasSingles?1:2);}
function getAccumulatorReturns(stake,selections){var returns=stake;for(var i=0,l=selections.length;i<l;i++){returns=selections[i].returns(returns);}
return returns;}
function getEachWayReturns(stake,selections){var returns=stake;for(var i=0,l=selections.length;i<l;i++){returns*=(selections[i].price().decimal()-selections[i].eachWay().num())/selections[i].eachWay().den()+1;}
return returns;}
function checkAllSelectionsAreIncluded(selections,allowedSelectionsId){var result=true;for(var i=0;i<selections.length;i++){if(allowedSelectionsId.indexOf(parseInt(selections[i].id()))==-1){result=false;break;}}
return result;}
function getSelectionIdsForPlace(selections){var selectionIds=[];sortSelectionsByPriceDESC(selections);for(var i=0,l=selections.length;i<l;i++){var maxSelectionsPerRace=selections[i][0].eachWay().numberOfPlaces();selections[i]=selections[i].splice(selections[i],maxSelectionsPerRace);for(var j=0;j<selections[i].length;j++){selectionIds.push(parseInt(selections[i][j].id()));}}
return selectionIds;}
function getSelectionIdsForWin(selections){var selectionIds=[];var maxSelectionsPerRace=1;sortSelectionsByPriceDESC(selections);for(var i=0,l=selections.length;i<l;i++){selections[i]=selections[i].splice(selections[i],maxSelectionsPerRace);for(var j=0;j<selections[i].length;j++){selectionIds.push(parseInt(selections[i][j].id()));}}
return selectionIds;}
function sortSelectionsByPriceDESC(selections){for(var i=0;i<selections.length;i++){selections[i].sort(function(a,b){return b.price().decimal()-a.price().decimal();})}}
function selectionsContainSP(selections){var result=false;for(var i=0;i<selections.length;i++){if(selections[i].isSP()){result=true;break;}}
return result;}
function getMultBetReturns(stake,selections,type,eachWay){var selectionsArrByRaceId=groupSelectionsByRaceId(selections);var selectionIdsForWin=getSelectionIdsForWin(selectionsArrByRaceId,1);var returns=0;var numSelectionsAccordingToType=type&0xff;if(numSelectionsAccordingToType>selectionsArrByRaceId.length){throw new Error('Can not calculate '+numSelectionsAccordingToType+'-fold accumulator on '+'selections from '+selectionsArrByRaceId.length+' races');}
var multitudesPermutations=utils.bet.getCombinations(selectionsArrByRaceId,numSelectionsAccordingToType,numSelectionsAccordingToType);var resultingAccumulators=[];for(var i=0;i<multitudesPermutations.length;i++){var accumulators=utils.bet.getPermutations(multitudesPermutations[i]);for(var j=0;j<accumulators.length;j++){resultingAccumulators.push(accumulators[j]);}}
for(var i=0,l=resultingAccumulators.length;i<l;i++){if(checkAllSelectionsAreIncluded(resultingAccumulators[i],selectionIdsForWin))
returns+=getAccumulatorReturns(stake,resultingAccumulators[i]);if(eachWay){var selectionIdsForEachWay=getSelectionIdsForPlace(selectionsArrByRaceId);if(checkAllSelectionsAreIncluded(resultingAccumulators[i],selectionIdsForEachWay)){returns+=getEachWayReturns(stake,resultingAccumulators[i]);}}}
return returns;}
function groupSelectionsByRaceId(selections){var selectionsByRaceId={};for(var i=0,l=selections.length;i<l;i++){selectionsByRaceId[selections[i].data().raceId]=selectionsByRaceId[selections[i].data().raceId]||[];selectionsByRaceId[selections[i].data().raceId].push(selections[i]);}
var result=[];for(var key in selectionsByRaceId){result.push(selectionsByRaceId[key]);}
return result;}
function getFullCoverReturns(stake,selections,hasSingles,eachWay){var bets=getTotalBets(selections,hasSingles),EWReturns=0,accumulatorReturns=0;for(var i=0,l=bets.length;i<l;i++){accumulatorReturns+=getAccumulatorReturns(stake,bets[i]);if(eachWay){EWReturns+=getEachWayReturns(stake,bets[i]);}}
return EWReturns+accumulatorReturns;};this._label='';this.property('label',{set:true});this._betReference='';this.property('betReference',{set:true});this._betDate='';this.property('betDate',{set:true});this._receiptId='';this.property('receiptId',{set:true});this._type=$class.TYPE.SINGLE;this.property('type',{'set':true});this._typeName=null;this.property('typeName',{'set':true});this._betHistoryEW=false;this.property('betHistoryEW',{'set':true,'get':function(){return!!this._betHistoryEW;}});this.betCounter=function(){var betCounter=0;if(this.isSingle()){betCounter=1;}else if(this.isAccumulator()){var selectionsArrByRaceId=groupSelectionsByRaceId(this._selections);var numSelectionsAccordingToType=this._type&0xff;var multitudesPermutations=utils.bet.getCombinations(selectionsArrByRaceId,numSelectionsAccordingToType,numSelectionsAccordingToType);var resultingAccumulators=[];for(var i=0;i<multitudesPermutations.length;i++){var accumulators=utils.bet.getPermutations(multitudesPermutations[i]);for(var j=0;j<accumulators.length;j++){resultingAccumulators.push(accumulators[j]);}}
betCounter=resultingAccumulators.length;}else{var bets=getTotalBets(this._selections,this.hasSingles());betCounter=bets.length;}
return this._isEachWay?betCounter*2:betCounter;};this._selections=null;this.property('selections',{set:function(selections){this._selections=[];this.selection.apply(this,selections);}});this.property('selection',{get:function(){return this._selections[0];},set:function(selection){for(var i=0,l=arguments.length;i<l;i++){selection=arguments[i];if(!(selection instanceof rp.betting.Selection)){selection=rp.betting.Selection.create(selection);}
selection.bind(rp.betting.Selection.EVENT_CHANGE,this.triggerChangeEvent,this);this._selections.push(selection);}
this.triggerChangeEvent();}});this.triggerChangeEvent=function(){this.trigger($class.EVENT_CHANGE);};this._stake=0;this.property('stake',{set:function(stake){stake=parseFloat(stake)||0;if(stake<0){throw new TypeError('Invalid stake value.');}
if(this._stake!==stake){this._stake=Math.round(stake*100)/100;this.triggerChangeEvent();}}});this._minStake=0;this.property('minStake',{set:function(minStake){minStake=+minStake||0;if(minStake<0){throw new TypeError('Invalid stake value.');}
this._minStake=minStake;}});this._maxStake=Number.POSITIVE_INFINITY;this.property('maxStake',{set:function(maxStake){_maxStake=+maxStake;if(_maxStake>=0&&!isNaN(_maxStake)){this._maxStake=_maxStake;}
else{this._maxStake=Number.POSITIVE_INFINITY;throw new TypeError('Invalid stake value.');}}});this._totalStake=null;this.property('totalStake',{get:function(){var stake=this._totalStake;if(stake==null){if(this.isFullCover()){var selections=this._selections;stake=this._stake*getTotalBets(selections,this.hasSingles()).length*(this.isEachWay()?2:1);}else{stake=this._stake*this.betCounter();}}
return stake;},set:true});this._returns=null;this.property('returns',{get:function(){var returns=this._returns;if(returns==null){returns=NaN;if(this.isValidCount()){var stake=this._stake,selections=this._selections;if(!selectionsContainSP(selections)){if(this.isSingle()){returns=selections[0].returns(stake,this.isEachWay());}else{returns=this.isAccumulator()?getMultBetReturns(stake,selections,this._type,this.isEachWay()):getFullCoverReturns(stake,selections,this.hasSingles(),this.isEachWay());}}}}
return(utils.numbers.toFloatMoney(returns));},set:true});this._isEachWay=false;this.property('isEachWay',{get:function(){return this._isEachWay&&this.isEachWayAllowed();},set:function(isEachWay){isEachWay=!!isEachWay;if(this._isEachWay!==isEachWay){this._isEachWay=isEachWay;this.triggerChangeEvent();}}});this._freeBets=null;this.property('freeBets',{set:function(freeBets){this._freeBets=[];this.freeBet.apply(this,freeBets);}});this.freeBet=function(freeBet){for(var i=0,l=arguments.length;i<l;i++){freeBet=arguments[i];if(!(freeBet instanceof rp.betting.FreeBet)){freeBet=new rp.betting.FreeBet(freeBet);}
this._freeBets.push(freeBet);}
this.triggerChangeEvent();return this;};this.freeBetsAmount=function(){var amount=0,freeBet;for(var i=0,l=this._freeBets.length;i<l;i++){freeBet=this._freeBets[i];if(freeBet.selected()){amount+=freeBet.amount();}}
return amount;};this._isSettled=false;this.property('isSettled',{set:true});this.count=function(){return this._selections.length;};this.isSingle=function(){return this._type===$class.TYPE.SINGLE;};this.isMultiple=function(){return this._type!==$class.TYPE.SINGLE;};this.isAccumulator=function(){return!!(this._type&TYPE_ACCUMULATOR);};this.isFullCover=function(){return!!(this._type&TYPE_FULL_COVER);};this.hasSingles=function(){return this.isFullCover()&&!!(this._type&TYPE_HAS_SINGLES);};this.isOpened=function(){return!this.isSettled();};this.hasSelections=function(){return!!this.count();};this.isValidCount=function(){var minCount=(this._type&0xff)||1,count=this.count();return count>=minCount;};this.isValid=function(){return this.isValidCount()&&this._stake>=this._minStake&&this._stake<=this._maxStake;};this.isEachWayAllowed=function(){var isAllowed=true;for(var i=0,l=this._selections.length;isAllowed&&i<l;i++){isAllowed=isAllowed&&this._selections[i].hasEachWay();}
return isAllowed;};this.reset=function(){this._selections=[];this._freeBets=[];this._stake=0;this._isEachWay=false;this._betHistoryEW=false;this._receiptId="";this._betReference="";this._type=$class.TYPE.SINGLE;this._typeName="";this._minStake=0;this._maxStake=Number.POSITIVE_INFINITY;this._returns=null;this._totalStake=null;this._isSettled=null;this.triggerChangeEvent();return this;};this.combinations=function(source,min,max){return utils.bet.getCombinations(source,min,max);};this.toJSON=function(){return this.get('betDate','receiptId','betReference','type','typeName','selections','stake','minStake','maxStake','freeBets','isEachWay','label');};$class.create=function(bet,instance){var type=$.type(bet);instance=instance instanceof this?instance:new this();return instance.set(bet);};});
namespace('rp.betting');rp.betting.FreeBet=function(){arguments.callee.$super.apply(this,arguments);};extend(rp.betting.FreeBet,rp.EventTarget,function($class,$super){this._id='';this.property('id',{set:true});this._name='';this.property('name',{set:true});this._expires=null;this.property('expires',{set:function(expires){this._expires=new Date(expires);}});this._amount=0;this.property('amount',{set:true});this._selected=false;this.property('selected',{set:true});this.toJSON=function(){return this.get('id','name','expires','amount','selected');};});
namespace('rp.betting');rp.betting.User=function(){arguments.callee.$super.apply(this,arguments);};extend(rp.betting.User,rp.EventTarget,function($class,$super){$class.EVENT_BALANCE_CHANGED='balanceChanged';this.event($class.EVENT_BALANCE_CHANGED);this._login='';this.property('login',{set:true});this._token='';this.property('token',{set:true});this._title='';this.property('title',{set:true});this._firstName='';this.property('firstName',{set:true});this._currency='';this.property('currency',{set:true});this._balance=NaN;this.property('balance',{set:function balance(balance){balance=+balance;if(this._balance!==balance){this._balance=balance;this.trigger($class.EVENT_BALANCE_CHANGED,this._balance);}}});this._userIdentifier='';this.property('userIdentifier',{set:true});this._refreshToken='';this.property('refreshToken',{set:true});this._flags=null;this.property('flags',{set:true});this.toJSON=function(){return this.get("login","token","title","firstName","balance","currency","userIdentifier","refreshToken","flags");};});
namespace('rp.betting');rp.betting.SearchCriteria=function(){arguments.callee.$super.apply(this,arguments);};extend(rp.betting.SearchCriteria,rp.Object,function($class,$super){this._fromDate=null;this.property('fromDate',{'set':true});this._toDate=null;this.property('toDate',{'set':true});this._blockSize=null;this.property('blockSize',{'set':true});this._minimumBets=null;this.property('minimumBets',{'set':true});this._blockNumber='';this.property('blockNumber',{'set':true});this.toJSON=function(){return this.get('fromDateTime','toDateTime','blockSize','blockNumber');};this.reset=function(){this.blockNumber(null);};});
namespace('rp.betting');rp.betting.BetHistory=function(){arguments.callee.$super.apply(this,arguments);};extend(rp.betting.BetHistory,rp.EventTarget,function($class,$super){$class.EVENT_ADDED_BET='betHistoryAddedBet';this.event($class.EVENT_ADDED_BET);this._totalBlocks=null;this.property('totalBlocks',{'set':true});this._lastBetId=null;this.property('lastBetId',{'set':true});this._searchCriteria=null;this.property('searchCriteria',{set:function(criteria){if(criteria&&!(criteria instanceof rp.betting.SearchCriteria)){criteria=new rp.betting.SearchCriteria(criteria);}
this._searchCriteria=criteria;}});this._bets=[];this.property('bets',{'set':true,'get':true});this.addBet=function(bet){this._bets.push(bet);if(bet.isSettled()){this._settled.push(bet);}else{this._opened.push(bet);}
this.trigger($class.EVENT_ADDED_BET,bet);};this.addBets=function(bets){for(var index in bets){this.addBet(bets[index]);}};this._opened=[];this.property('opened',{'get':true,'set':true});this._settled=[];this.property('settled',{'get':true,'set':true});this.clearBets=function(){this._bets=[];this._opened=[];this._settled=[];};this.reset=function(){this.clearBets();this.totalBlocks(null);this.searchCriteria()&&this.searchCriteria().reset();};this.find=function(searchSet){var searchResult=[];if(!$.isEmptyObject(searchSet)){for(var index in this._bets){var bet=this._bets[index];if(searchSet.receiptId&&searchSet.receiptId==bet.receiptId()){searchResult.push(bet);}}}
return searchResult;};});
namespace('rp.betting');rp.betting.Selection=function(){arguments.callee.$super.apply(this,arguments);};extend(rp.betting.Selection,rp.EventTarget,function($class,$super){var LABEL_SP='SP';$class.EVENT_CHANGE='change';this.event($class.EVENT_CHANGE);this._id='';this.property('id',{set:true});this._data=null;this.property('data',{set:true});this._price=null;this.property('price',{set:function(price){price=price||null;if(price&&!(price instanceof rp.betting.Price)){price=rp.betting.Price.create(price);}
if(String(this._price)!==String(price)){this._price=price;this.trigger($class.EVENT_CHANGE);}}});this._oldPrice=null;this.property('oldPrice',{set:true});this.getPrice=function(decimal,isSpecific){var result;if(this.isSP()){result=LABEL_SP;}else{result=this.getPriceReal(decimal,isSpecific);}
return result;};this.getPriceReal=function(decimal,isSpecific){var result;if(this.price()){if(isSpecific){if(this.price().num()===1&&this.price().den()===1){result=rp.betting.Price.EVS;}}
if(!result){result=this.price().toString(decimal,isSpecific);}}else{result=LABEL_SP;}
return result;}
this.getOldPrice=function(decimal,isSpecific){var result;if(this.isSP()){result=LABEL_SP;}else{result=this.getOldPriceReal(decimal,isSpecific);}
return result;};this.getOldPriceReal=function(decimal,isSpecific){var result;if(this.oldPrice()){if(isSpecific){if(this.oldPrice().num()===1&&this.oldPrice().den()===1){result=rp.betting.Price.EVS;}}
if(!result){result=this.oldPrice().toString(decimal);}}else{result=LABEL_SP;}
return result;}
this._eachWay=null;this.property('eachWay',{set:function(eachWay){eachWay=eachWay||null;if(eachWay&&!(eachWay instanceof rp.betting.EachWay)){eachWay=rp.betting.EachWay.create(eachWay);}
if(String(this._eachWay)!==String(eachWay)){this._eachWay=eachWay;this.trigger($class.EVENT_CHANGE);}}});this._isSP=false;this.property('isSP',{get:function(){return this._isSP||this._price==null;},set:function(isSP){isSP=!!isSP;if(this._isSP!==isSP){this._isSP=isSP;this.trigger($class.EVENT_CHANGE);}}});this.hasPrice=function(){return this._price!=null;};this.isTrapChallengePrice=function(){return this._data.isTrapChallengePrice;};this.hasEachWay=function(){var result=!!this._eachWay;if(result){if(this._eachWay.numberOfPlaces()<2){result=false;}}
return result;};this.winReturns=function(stake){var returns=NaN;if(!this.isSP()){returns=stake*this.price().num()/this.price().den()+stake;}
return returns;};this.eachWayReturns=function(stake){var returns=0,price=this.price();if(this.hasEachWay()&&price){returns=stake*price.num()*this.eachWay().num()/price.den()/this.eachWay().den()+stake;}
return returns;};this.returns=function(stake,eachWay){var returns=this.winReturns(stake);if(eachWay){if(this.eachWay().get('places').places!=''){returns+=this.eachWayReturns(stake);}else{returns='N/A';}}
return returns;};this.toJSON=function(){return this.get("id","price","eachWay","isSP","data");};$class.create=function(selection,instance){var type=$.type(selection);instance=instance instanceof this?instance:new this();if(type==="string"||type==="number"){selection={price:selection};}
return instance.set(selection);};});
namespace('rp.betting');rp.betting.Price=function(){arguments.callee.$super.apply(this,arguments);};extend(rp.betting.Price,rp.Object,function($class,$super){$class.EVS='Evs';this._num=0;this.property('num',{set:function(num){num=parseInt(num,10)||0;if(num<0){throw new TypeError('Invalid numerator value.');}
this._num=num;}});this._den=1;this.property('den',{set:function(den){den=parseInt(den,10);den=isFinite(den)?den:1;if(den<1){throw new TypeError('Invalid denumerator value.');}
this._den=den;}});this.odds=function(){return this._num/this._den;};this.decimal=function(){return 1+this.odds();};this.fractional=function(isSpecific){if(isSpecific&&this._num==this._den==1){return $class.EVS;}else{return this._num+'/'+this._den;}};this.toString=function(decimal,isSpecific){return decimal?Math.floor(this.decimal()*100)/100:this.fractional(isSpecific);};this.toJSON=function(){return this.get('num','den');};$class.create=function(price,instance){var type=$.type(price);instance=instance instanceof this?instance:new this();if(type==="string"||type==="number"){price=String(price);if(price.toLowerCase()===$class.EVS.toLowerCase()){price='1';}
price=price.split('/');}
if($.isArray(price)){price={num:price[0],den:price[1]};}
return instance.set(price);};});
namespace('rp.betting');rp.betting.EachWay=function(){arguments.callee.$super.apply(this,arguments);};extend(rp.betting.EachWay,rp.betting.Price,function($class,$super){this._places='';this.property('places',{set:true});this.numberOfPlaces=function(){var result=1;if(this.places()){result=parseInt(this.places().split('-')[1]);}
return result;};this.toString=function(decimal){return $super.toString.call(this,decimal)+' '+this.places();};this.toJSON=function(){return $.extend(this.get("places"),$super.toJSON.call(this));};$class.create=function(eachWay,instance){var type=$.type(eachWay);instance=instance instanceof this?instance:new this();if(type==="string"){eachWay=eachWay.split(/[\s+\|]/g);}
if($.isArray(eachWay)){$class.$super.create.call(this,$.trim(eachWay[0]),instance);eachWay={places:$.trim(eachWay[1])};}
return instance.set(eachWay);};});
namespace('rp.betting');rp.betting.BetSlip=function(){arguments.callee.$super.apply(this,arguments);};extend(rp.betting.BetSlip,rp.EventTarget,function($class,$super){$class.EVENT_CHANGE='change';this.event($class.EVENT_CHANGE);this.triggerChangeEvent=function(){this.trigger($class.EVENT_CHANGE);};this._bets=null;this.property('bets',{get:function(){return this._bets;},set:function(bets){this._bets=[];for(var i=0,l=bets.length;i<l;i++){var bet=bets[i];if(!(bet instanceof rp.betting.Bet)){bet=rp.betting.Bet.create(bet);}
bet.bind(rp.betting.Bet.EVENT_CHANGE,this.triggerChangeEvent,this);this._bets.push(bet);}
this.triggerChangeEvent();}});this.getBetsWithStake=function(){var betsWithStake=[];for(var i=0;i<this.bets().length;i++){if(this.bets()[i].stake()>0){betsWithStake.push(this.bets()[i]);}}
return betsWithStake;};this.getActiveBets=function(){var activeBets=[];for(var i=0;i<this.bets().length;i++){if(!this.bets()[i].selections()[0].data().isSuspended){activeBets.push(this.bets()[i]);}}
return activeBets;};this.getBetsWithReceiptId=function(){var betsWithReceiptId=[];for(var i=0;i<this.bets().length;i++){if(this.bets()[i].receiptId()){betsWithReceiptId.push(this.bets()[i]);}}
return betsWithReceiptId;};this.totalStake=function(){var totalStake=0;for(var i=0;i<this.bets().length;i++){totalStake+=this.bets()[i].totalStake();}
return totalStake;};this.estimatedReturns=function(){var estimatedReturns=0;var bets=this.getBetsWithStake();for(var i=0;i<bets.length;i++){estimatedReturns+=bets[i].returns();}
return estimatedReturns;};this.getBetBySelectionId=function(selectionId){for(var i=0;i<this.bets().length;i++){if(this.bets()[i].type()==rp.betting.Bet.TYPE.SINGLE){if(this.bets()[i].selections()[0].id()==selectionId){return this.bets()[i];}}};return{};};this.getBetByType=function(type){for(var i=0;i<this.bets().length;i++){if(this.bets()[i].type()==type){return this.bets()[i];}};return{};};this.getSingleBets=function(){var singleBets=[];for(var i=0;i<this.bets().length;i++){if(this.bets()[i].type()==rp.betting.Bet.TYPE.SINGLE){singleBets.push(this.bets()[i]);}}
return singleBets;};this.removeOldPrices=function(){var singleBets=this.getSingleBets(),selection;for(var i=0;i<singleBets.length;i++){selection=singleBets[i].selections()[0];if(selection.data().oldNum&&selection.data().oldDen){delete selection.data().oldNum;delete selection.data().oldDen;}}};this.hasOldPrices=function(){var singleBets=this.getSingleBets(),result=false,selection;for(var i=0;i<singleBets.length;i++){selection=singleBets[i].selections()[0];if(selection.data().oldNum&&selection.data().oldDen){result=true;}}
return result;};this.toJSON=function(){return this.get('bets');};$class.create=function(betslip,instance){var type=$.type(betslip);instance=instance instanceof this?instance:new this();var betslipRest=JSON.parse(betslip);var bets=(betslipRest==null)?[]:betslipRest.bets;if(type==="string"){betslip={bets:bets};}
return instance.set(betslip);};});
namespace('rp.betting',function(betting){betting.BetSlipBuilder=function(){betting.BetSlipBuilder.$super.apply(this,arguments);};extend(betting.BetSlipBuilder,rp.EventTarget,function($class,$super){var _betSlip=new rp.betting.BetSlip();$class.buildBetSlip=function(selectionsCollection,betslip){if(!(selectionsCollection instanceof rp.betting.SelectionsCollection)){throw new Error('Instance of rp.betting.SelectionsCollection expected.');}
var selections=selectionsCollection.selections();var bets=[];for(var i=0;i<selections.length;++i){var singleBet=new rp.betting.Bet({type:rp.betting.Bet.TYPE.SINGLE});singleBet.selection(selections[i]);bets.push(singleBet);}
var includedInMultiples=getIncludedInMultiples(selections);var multipleTypes=getAvailableBetTypes(includedInMultiples);$.each(multipleTypes,function(key,value){var multipleBet=new rp.betting.Bet({type:parseInt(key)});multipleBet.selections(includedInMultiples);bets.push(multipleBet);});_betSlip.bets(bets);if((betslip instanceof rp.betting.BetSlip)){$class.mergeBetslips(betslip,_betSlip);}
return _betSlip;};$class.mergeBetslips=function(oldBetslip,newBetslip){var oldBets=oldBetslip.bets();var newBets=newBetslip.bets();function mergeSingleBet(newBet,oldBets){for(var i=0;i<oldBets.length;i++){if(!newBet.selections()[0].data().isSuspended){if(newBet.selections()[0].id()===oldBets[i].selections()[0].id()){newBet.stake(oldBets[i].stake());newBet.isEachWay(oldBets[i].isEachWay());newBet.minStake(oldBets[i].minStake());newBet.maxStake(oldBets[i].maxStake());break;}}}}
function mergeMultipleBet(newBet,oldBets){for(var i=0;i<oldBets.length;i++){if(oldBets[i].type()===newBet.type()){newBet.isEachWay(oldBets[i].isEachWay());if(oldBets[i].betCounter()===newBet.betCounter()){newBet.stake(oldBets[i].stake());newBet.minStake(oldBets[i].minStake());newBet.maxStake(oldBets[i].maxStake());}else{newBet.isEachWay(false);}
break;}}}
for(var i=0;i<newBets.length;i++){if(newBets[i].isSingle()){mergeSingleBet(newBets[i],oldBets);}else{mergeMultipleBet(newBets[i],oldBets);}}};function getIncludedInMultiples(selections){var included=[];for(var i=0;i<selections.length;++i){if(selections[i].data().includeInMultiple&&!selections[i].data().isSuspended){included.push(selections[i]);}}
return included;};function getAvailableBetTypes(includedInMultiples){var complexBets={'3':{'515':4,'1539':7},'4':{'516':11,'1540':15},'5':{'517':26,'1541':31},'6':{'518':57,'1542':63},'7':{'519':120},'8':{'520':247}};var types={};var selectionCounter=includedInMultiples.length;if(selectionCounter<=1){return types;};if(utils.bet.isStraight(includedInMultiples)){for(var k=2;k<selectionCounter+1;++k){types[rp.betting.Bet.TYPE.ACCUMULATOR|k]=utils.bet.getNumberOfCombinations(selectionCounter,k);}
if(complexBets[selectionCounter]){jQuery.extend(types,complexBets[selectionCounter]);}}else{var selectionsPerRace=prepareSelectionsPerRace(includedInMultiples);for(var i=2;i<selectionsPerRace.length+1;++i){var crossCombinations=utils.bet.getCombinations(selectionsPerRace,i,i);var betTypeAmount=calculateCrossBetTypesAmount(crossCombinations);types[rp.betting.Bet.TYPE.ACCUMULATOR|i]=betTypeAmount;};}
return types;};function prepareSelectionsPerRace(includedInMultiples){var selections={};var selectionsPerRaceArray=[]
for(var i=0;i<includedInMultiples.length;i++){var raceId=includedInMultiples[i].data().raceId;selections[raceId]=(selections[raceId]||0)+1;}
for(var i in selections){selectionsPerRaceArray.push(selections[i]);}
return selectionsPerRaceArray;};function calculateCrossBetTypesAmount(crossCombinations){var totalNumber=0;for(var i=0;i<crossCombinations.length;i++){var multiplePerCombination=1;for(var j=0;j<crossCombinations[i].length;j++){multiplePerCombination*=crossCombinations[i][j];}
totalNumber+=multiplePerCombination;}
return totalNumber;};});});
namespace('rp.betting',function(betting){var instance=null;betting.SelectionsCollection=function(){if(instance){return instance;}
instance=this;betting.SelectionsCollection.$super.apply(this,arguments);this._restoreSelections();};extend(betting.SelectionsCollection,rp.EventTarget,function($class,$super){$class.EVENT_SELECTION_ADDED="added_selection";$class.EVENT_SELECTION_REMOVED="removed_selection";$class.EVENT_SELECTION_UPDATED="status_selection";this.event($class.EVENT_SELECTION_ADDED).event($class.EVENT_SELECTION_REMOVED).event($class.EVENT_SELECTION_UPDATED);this.STORAGE_KEY="selections";this.property('storage',{get:function(){var prefBookie=window.webApp.prefBookmaker.get();this._storage=new rp.Storage({name:prefBookie+'_selectionsCollection'});return this._storage;}});this._selections=new Array();this.property('selections');this._restoreSelections=function(){var result=new Array();var selectionsArray=this.storage().getValue(this.STORAGE_KEY)||new Array();for(var i=0;i<selectionsArray.length;i++){result.push(new rp.betting.Selection(selectionsArray[i]));}
this._selections=result;};this.add=function(selection){this._throwExceptionIfNotSelectionInstance(selection);if(!selection.data().isTrapChallengePrice){selection.data().includeInMultiple=true;}
this._selections.push(selection);this.storage().setValue(this.STORAGE_KEY,this._selections);this.trigger($class.EVENT_SELECTION_ADDED,{selectionAmount:this._selections.length});return this;};this.remove=function(selection){this._throwExceptionIfNotSelectionInstance(selection);var selections=this._selections||[];for(var index=0;index<selections.length;index++){var foundSelection=this._selections[index];if(foundSelection.id()===selection.id()){this._selections.splice(index,1);break;}}
this.storage().setValue(this.STORAGE_KEY,this._selections);this.trigger($class.EVENT_SELECTION_REMOVED,{selectionAmount:this._selections.length});return this;};this.removeById=function(selectionId){var selection=new rp.betting.Selection({id:selectionId});return this.remove(selection);};this.exists=function(selection){var result=false;var selections=this._selections||[];for(var index=0;index<selections.length;index++){var foundSelection=this._selections[index];if(foundSelection.id()===selection.id()){result=true;break;}}
return result;};this.updateStatus=function(selection,propertyName,status){var selections=this._selections||[];for(var index=0;index<selections.length;index++){var currSelection=selections[index];if(currSelection.id()===selection.id()){var data=currSelection.data()||{};data[propertyName]=status;currSelection.data(data);break;}}
this.storage().setValue(this.STORAGE_KEY,this._selections);this.trigger($class.EVENT_SELECTION_UPDATED,{selection:selection,propertyName:propertyName,status:status});return this;};this.updateStatusById=function(selectionId,propertyName,status){for(var i=0;i<this._selections.length;i++){if(this._selections[i].id()==selectionId){return this.updateStatus(this._selections[i],propertyName,status);}}};this.getSuspendedSelections=function(){var suspendedSelections=[];for(var i=0;i<this._selections.length;i++){if(this._selections[i].data().isSuspended){suspendedSelections.push(this._selections[i]);}}
return suspendedSelections;};this.getSPSelections=function(){var spSelections=[];for(var i=0;i<this._selections.length;i++){if(this._selections[i].isSP()){spSelections.push(this._selections[i]);}}
return spSelections;};this.clear=function(){this._selections=new Array();this.storage().setValue(this.STORAGE_KEY,null);};this.update=function(selection){this._throwExceptionIfNotSelectionInstance(selection);var selections=this._selections||[];for(var index=0;index<selections.length;index++){var currSelection=this._selections[index];if(currSelection.id()===selection.id()){this._selections[index]=selection;break;}}
this.storage().setValue(this.STORAGE_KEY,this._selections);return this;};this._throwExceptionIfNotSelectionInstance=function(selection){if(!(selection instanceof rp.betting.Selection)){throw new Error('Invalid argument type, instance of rp.betting.Selection expected');}};$class.instance=function(options){return new $class(options);};});});
var webApp=webApp||{};webApp.selectionsAlert=(function(){var showTimeId;var $mBetSlipCounter=$('#betSlipCounter');var $ghBetMainCounter=$('.betSlipMainCounter');var selectionsCountChangedHandler=function(event,data){setCounter(data.selectionAmount);};var setCounter=function(count){if(count!=0){if(webApp.HorseDetailsController){$mBetSlipCounter.html(count).show();}
else{$('.betSlipSideCounter').html(count).show();$ghBetMainCounter.html(count).show();}}else{hideCounter();}};var hideCounter=function(){if(webApp.HorseDetailsController){$mBetSlipCounter.hide();}
else{$('.betSlipSideCounter').hide();$ghBetMainCounter.hide();}};return{init:function(){rp.betting.SelectionsCollection.instance().bind(rp.betting.SelectionsCollection.EVENT_SELECTION_ADDED,selectionsCountChangedHandler,this);rp.betting.SelectionsCollection.instance().bind(rp.betting.SelectionsCollection.EVENT_SELECTION_REMOVED,selectionsCountChangedHandler,this);},showTextMessage:function(text){this.hideAlert();var html='<div id="selectionsAlert" data-test-selector="selectionsAlert">'+text+'</div>';if(webApp.HorseDetailsController){$('body').append(html);}
else{$('#webApp').append(html);}
showTimeId=setTimeout($.proxy(function(){this.hideAlert();},this),1500);},show:function(count){if(typeof count=='undefined')return;this.hideAlert();var html='<h5 data-test-selector="selectionsAlertCount">'+count+'</h5><h6>Selections in<br/>your Bet Slip</h6>';this.showTextMessage(html);},hideAlert:function(){if($('#selectionsAlert').length){clearTimeout(showTimeId);$('#selectionsAlert').remove();}},hideCounter:function(){hideCounter();},setCounter:function(count){setCounter(count);}};})();
namespace('rp.betting');rp.betting.Error=function(code,message,data){this._code=code;this._message=String(message||'');this._data=data;};extend(rp.betting.Error,rp.Object,function($class,$super){$class.MESSAGE_INSUFFICIENT_FUNDS="Unfortunately we are unable to place your bet as you have insufficient funds in your account. Simply visit the Account tab on the Bet Slip to top up.";this._code=null;this.property('code',{set:true});this._message='';this.property('message',{set:true});this._data=null;this.property('data',{set:true});});
namespace('rp.betting');rp.betting.Command=function(name,data){this._name=name;this._data=data;this._settings={};};extend(rp.betting.Command,rp.EventTarget,function($class,$super){this.EVENT_CALL='call';this.EVENT_SUCCESS='success';this.EVENT_ERROR='error';this.EVENT_ABORT='abort';this.EVENT_COMPLETE='complete';this.EVENT_TIMEOUT='timeout';this.STATUS_CALL='call';this.STATUS_ABORT='abort';this.STATUS_TIMEOUT='timeout';this.STATUS_SUCCESS='success';this.STATUS_ERROR='error';this._xhr=null;this.property('xhr',{set:true});this._name=null;this.property('name');this._data=null;this.property('data',{set:true});this._settings=null;this.property('settings',{set:function settings(settings){$.extend(this._settings,settings);}});this._status=null;this.property('status',{set:true});this._result=null;this.property('result',{set:true});this.event(this.EVENT_SUCCESS);this.event(this.EVENT_TIMEOUT).event(this.EVENT_ERROR).event(this.EVENT_COMPLETE);this._success=function(data,status){this.status(status||this.STATUS_SUCCESS).result(data).success(this.result());};this._error=function(xhr,status,message){this.status(status||this.STATUS_ERROR);if(this.isTimeout()){this.timeout();}else if(!this.isAborted()){status=xhr.status||status;this.result(new rp.betting.Error(status,message)).error(this.result(),xhr);}};this._complete=function(){this._xhr=null;this.complete();};this.event(this.EVENT_CALL,{get:function(){var data=this.data();if(this.trigger(this.EVENT_CALL,data)){$.extend(this._settings,{success:$.proxy(this._success,this),error:$.proxy(this._error,this),complete:$.proxy(this._complete,this)});var settings=$.extend({},this.settings()),type=String(settings.type||'get').toLowerCase(),provider=settings.proxy?settings.proxy:jQuery;if(type==='post'&&!jQuery.isEmptyObject(data)){data=JSON.stringify(data);}
settings.data=data;delete settings.proxy;this.status(this.STATUS_CALL).result(null);this._xhr=provider.ajax(settings);}}});this.event(this.EVENT_ABORT,{get:function(){this.status(this.STATUS_ABORT);if(this.trigger(this.EVENT_ABORT)){if(this._xhr&&this._xhr.abort){this._xhr.abort();}}}});this.isCalled=function(){return this._status===this.STATUS_CALL;};this.isAborted=function(){return this._status===this.STATUS_ABORT;};this.isTimeout=function(){return this._status===this.STATUS_TIMEOUT;};this.isSuccess=function(){return this._status===this.STATUS_SUCCESS;};});
namespace('rp.betting');rp.betting.Queue=function(command){this._commands=[];for(var i=0,l=arguments.length;i<l;i++){this.add(arguments[i]);}};extend(rp.betting.Queue,rp.betting.Command,function($class,$super){this.EVENT_PROGRESS='progress';this.property('count',{get:function count(){return this._commands.length;}});this._settings=null;this.property('settings',{set:true});this._current=null;this.property('current',{get:function current(){return this._commands[this._current];},set:function(command){if(command instanceof rp.betting.Command){this._commands.splice(this._current,0,command);}}});this.event(this.EVENT_PROGRESS);this.event(this.EVENT_CALL,{get:function(){if(this.trigger(this.EVENT_CALL)){this._current=-1;this.result(null).next();}}});this.event(this.EVENT_ABORT,{get:function(){if(this.trigger(this.EVENT_ABORT,this)){this.status(this.STATUS_ABORT);this.current().abort();}}});this.add=function(command){if(!(command instanceof rp.betting.Command)){throw new TypeError('Instance of rp.betting.Command expected.');}
this._commands.push(command);return this;};function success(event){var command=event.target;this.status(command.status()).result(command.result()).progress(this.result()).next();};function error(event){var command=event.target;this.status(command.status()).result(command.result()).error();};function timeout(event){var command=event.target;this.status(command.status()).timeout();};function complete(event){var cmnd=event.target;cmnd.unbind(cmnd.EVENT_SUCCESS,success,this).unbind(cmnd.EVENT_ERROR,error,this).unbind(cmnd.EVENT_TIMEOUT,timeout,this).unbind(cmnd.EVENT_COMPLETET,complete,this);};this.proceed=function(){var cmnd=this.current();this.status(this.STATUS_CALL);if(cmnd){cmnd.settings(this.settings()).success(success,this).error(error,this).timeout(timeout,this).complete(complete,this).call();}};this.next=function(){this._current++;if(this._current<this.count()){this.proceed();}else{var result=this.result();this.status(this.STATUS_SUCCESS).success(result).complete(result);}};});
namespace('rp.betting');rp.betting.Provider=function(){if(this.constructor===rp.betting.Provider){throw new Error('Can not instantiate abstract class rp.betting.Provider.');}
rp.betting.Provider.$super.apply(this,arguments);this.init();};extend(rp.betting.Provider,rp.EventTarget,function($class,$super){$class.PROVIDER_NAME='abstract';$class.EVENT_USER_HAS_SELECTED_ACTIVE_PROVIDER="eventUserHasSelectedActiveProvider";this.EVENT_LOGIN='login';this.EVENT_LOGOUT='logout';this.KEY_USER='user';this.event('login').event('logout');this.id=function(){return this.constructor.PROVIDER_NAME;};var TYPE=rp.betting.Bet.TYPE;this.BET_TYPES={SGL:TYPE.SINGLE,DBL:TYPE.DOUBLE,TBL:TYPE.TREBLE,ACC4:TYPE.FOURFOLD,ACC5:TYPE.FIVEFOLD,ACC6:TYPE.SIXFOLD,ACC7:TYPE.SEVENFOLD,ACC8:TYPE.EIGHTFOLD,ACC9:TYPE.NINEFOLD,AC10:TYPE.TENFOLD,TRX:TYPE.TRIXIE,GOL:TYPE.GOLIATH,PAT:TYPE.PATENT,YAN:TYPE.YANKEE,HNZ:TYPE.HEINZ,SHNZ:TYPE.SUPER_HEINZ,CAN:TYPE.CANADIAN,L15:TYPE.LUCKY_15,L31:TYPE.LUCKY_31,L63:TYPE.LUCKY_63};this.BET_CODES={};for(var type in this.BET_TYPES){this.BET_CODES[this.BET_TYPES[type]]=type;}
this.getBetType=function(typeCode){var type=0;typeCode=String(typeCode);if(this.BET_TYPES.hasOwnProperty(typeCode)){type=this.BET_TYPES[typeCode];}
return type;};this.getBetTypeCode=function(bet){var codes=this.BET_CODES,type=codes[bet.type()]||codes[TYPE.SINGLE];return type;};this._isReady=false;this.property('isReady',{set:true});this._proxy=null;this.property('proxy',{set:function(proxy){if(proxy instanceof rp.betting.AbstractProxy){this._proxy=proxy;}},get:function(){return this._proxy;}});this._timeout=1000*60*60;this.property('timeout',{set:function(timeout){if(timeout>0){this._timeout=+timeout;}},get:function(){return this._timeout;}});this._storage=null;this.property('storage',{get:function(){if(!this._storage){this._storage=new rp.Storage({name:this.id()+'.provider'});}
return this._storage;}});this.store=function(name,value){var storage=this.storage();if(arguments.length===2){if(value!==null){storage.setValue(name,value);}else{storage.unsetValue(name);}}
return storage.getValue(name);};this._user=null;this.property('user',{set:function(user){if(!(user instanceof rp.betting.User)){user=null;}
this._user=user;this.store(this.KEY_USER,this._user);}});this.property('token',{get:function(){return this._user&&this._user.token();},set:function(token){if(this._user){this._user.token(token);}else{this.user(new rp.betting.User({token:token}));}
this.store(this.KEY_USER,this._user);}});this._settings=null;this.property('settings',{set:true});this.isLoggedIn=function(){return this._user!=null;};this.init=function(){var user=this.store(this.KEY_USER);if(user){this.user(new rp.betting.User(user));}else{this.isReady(true);}};this.login=function(user){};this.getBetSlip=function(betSlip){};this.placeBet=function(betSlip){};this.getBetHistory=function(searchCriteria){};this.getPaymentDetails=function(){};this.makePayment=function(paymentDetails){};this.getBookmakerId=function(){return this.settings()["bookmakerId"]||null;};this.logout=function(){};this.refreshToken=function(){};this.getBalance=function(){};});
namespace('rp.betting');rp.betting.PaymentDetails=function(){arguments.callee.$super.apply(this,arguments);};extend(rp.betting.PaymentDetails,rp.Object,function($class,$super){this._csc='';this.property('csc',{set:true});this._amount=0;this.property('amount',{set:true});this._payMethodId=null;this.property('payMethodId',{set:true});this._cardNumber=null;this.property('cardNumber',{set:true});this._maxDepositAmount=1000;this.property('maxDepositAmount',{set:true});this._minDepositAmount=0;this.property('minDepositAmount',{set:true});this.cardNumberWithStars=function(){var substitution='&bull;';var delimiter='&nbsp;';var cardNumber=String(this._cardNumber||'');return cardNumber.replace(/\s/g,'').replace(/(\d+)?(\D+)(\d+)/g,function($0,$1,$2,$3){$1=$1||'';var digitsLength=$1.length+$3.length;var cardNumberStr=$1;for(var i=0;i<16-digitsLength;i++){cardNumberStr+='#';}
cardNumberStr+=$3;var cardNumberArr=cardNumberStr.split('');cardNumberArr.splice(12,0,' ');cardNumberArr.splice(8,0,' ');cardNumberArr.splice(4,0,' ');return cardNumberArr.join('').replace(/\s/g,delimiter).replace(/#/g,substitution);})},$class.parse=function(details){var options={};if(details){options={'payMethodId':details.payMethodId,'cardNumber':details.cardNumber}}
return new rp.betting.PaymentDetails(options);};this.toJSON=function(){return this.get('csc','amount','amount','payMethodId','cardNumber');};});
namespace('rp.betting.ladbrokes');rp.betting.ladbrokes.Error=function(){arguments.callee.$super.apply(this,arguments);};extend(rp.betting.ladbrokes.Error,rp.betting.Error,function($class,$super){$class.GENERIC_ERROR=-500;$class.INVALID_SESSION_TOKEN=1026;$class.EXPIRED_SESSION_TOKEN=1027;$class.EXPIRED_OR_INVALID_SESSION_TOKEN=1028;$class.STATUS_CHANGED=1024;$class.PRICE_CHANGED=1025;$class.GENERIC_BETSLIP_ERROR=70;$class.INSUFFICIENT_FUNDS=1030;$class.STAKE_TOO_LOW=1031;$class.STAKE_TOO_HIGH=1032;$class.CLIENT_UNAUTHORISED=1029;$class.API_CLIENT_QUOTA_EXCEEDED=2000;$class.FAKE_SUSPENDED=2;$class.NO_RECENT_BETS=3;});
namespace('rp.betting.ladbrokes',function(ladbrokes){ladbrokes.Command=function(name,data){arguments.callee.$super.call(this,name,data||{});};extend(ladbrokes.Command,rp.betting.Command,function($class,$super){$class.CUSTOMER_API='customer-api';$class.BETTING_API='betting-api';$class.BANKING_API='banking-api';$class.SPORTSBOOK_API='sportsbook-api';$class.CUSTOMERS=$class.CUSTOMER_API+'/customers';$class.SPORTSBOOK=$class.BETTING_API+'/sportsbook';$class.CUSTOMER=$class.CUSTOMER_API+'/customer';$class.CUSTOMER_LOGOUT=$class.CUSTOMER+'/logout';$class.CUSTOMER_REFRESH_TOKEN=$class.CUSTOMERS;$class.CHECK_BETSLIP=$class.SPORTSBOOK+'/betslips/check';$class.BUILD_BETSLIP=$class.SPORTSBOOK+'/build-betslip';$class.SUBMIT_BETSLIP=$class.SPORTSBOOK+'/submit-betslip';$class.BETS=$class.SPORTSBOOK+'/bets';$class.GET_BALANCE=$class.BANKING_API+'/wallets/sportsbook-wallet';$class.SELECTIONS_STATUS=$class.SPORTSBOOK_API+'/classes/0/types/0/events/0/markets/0/selections/';$class.STATUS_LADB_ERROR='ladberror';var ERROR_MESSAGES={"BETTING-SELECTION-SUSPENDED":ladbrokes.Error.STATUS_CHANGED,"LIVE-PRICE-NOT-AVAILABLE":ladbrokes.Error.STATUS_CHANGED,"BETTING-EVENT-STARTED":ladbrokes.Error.STATUS_CHANGED,"BETTING-PRICE-CHANGED":ladbrokes.Error.PRICE_CHANGED,"BETTING-BETSLIP-PROBLEM":ladbrokes.Error.STATUS_CHANGED,"EXPIRED-OR-MISSING-OR-INVALID-ACCESS-TOKEN":ladbrokes.Error.EXPIRED_OR_INVALID_SESSION_TOKEN,"EXPIRED-OR-INVALID-ACCESS-TOKEN":ladbrokes.Error.EXPIRED_OR_INVALID_SESSION_TOKEN,"API-CLIENT-UNAUTHORISED":ladbrokes.Error.CLIENT_UNAUTHORISED,"SOMETHING-WENT-WRONG":ladbrokes.Error.GENERIC_ERROR,"INSUFFICIENT-FUNDS":ladbrokes.Error.INSUFFICIENT_FUNDS,"BETTING-STAKE-TOO-LOW":ladbrokes.Error.STAKE_TOO_LOW,"BETTING-STAKE-TOO-HIGH":ladbrokes.Error.STAKE_TOO_HIGH,"API-CLIENT-QUOTA-EXCEEDED":ladbrokes.Error.API_CLIENT_QUOTA_EXCEEDED};$class.getErrorCode=function(message){return ERROR_MESSAGES[message]||ladbrokes.Error.GENERIC_ERROR;};function getError(error){var errorCode;if(!$.isArray(error)){error=[error];};var errorCodes=$.map(error,function(value){return $class.getErrorCode(value.errorCode);});var errorString=$.map(error,function(value){return value.errorDescription;});if($.inArray(ladbrokes.Error.STATUS_CHANGED,errorCodes)>=0){errorCode=ladbrokes.Error.STATUS_CHANGED;}else if($.inArray(ladbrokes.Error.PRICE_CHANGED,errorCodes)>=0){errorCode=ladbrokes.Error.PRICE_CHANGED;}else if($.inArray(ladbrokes.Error.INSUFFICIENT_FUNDS,errorCodes)>=0){errorCode=ladbrokes.Error.INSUFFICIENT_FUNDS;}else if($.inArray(ladbrokes.Error.STAKE_TOO_LOW,errorCodes)>=0){errorCode=ladbrokes.Error.STAKE_TOO_LOW;}else if($.inArray(ladbrokes.Error.STAKE_TOO_HIGH,errorCodes)>=0){errorCode=ladbrokes.Error.STAKE_TOO_HIGH;}else{errorCode=errorCodes[0];}
var priorityError=new ladbrokes.Error(errorCode,errorString[errorCodes.indexOf(errorCode)]);return priorityError;}
this.property('token',{get:function(){return this._xhr&&this._xhr.getResponseHeader('x-update-access-token');}});this.event(this.EVENT_ERROR,{get:function(result,xhr){var responseText=xhr.responseText,response,apiError,errorCode,priorityError,isSpecific400Error;if($.browser){isSpecific400Error=$.browser.msie&&xhr.status==0&&!responseText;}
else{isSpecific400Error=navigator.userAgent.match(/MSIE/)&&xhr.status==0&&!responseText;}
if(isSpecific400Error){apiError={errorCode:"API-CLIENT-QUOTA-EXCEEDED"};}else{try{response=JSON.parse(responseText);apiError=response&&(response.apiError||response.apiWarning);}catch(e){}}
if(apiError){priorityError=getError(apiError);if(priorityError){this.status($class.STATUS_LADB_ERROR).result(priorityError.data(apiError));}}
$super.error.call(this,this.result());}});this.isLadbError=function(){return this._status===$class.STATUS_LADB_ERROR;};$class.create=function(name,data){return new $class(name,data);};});});
namespace('rp.betting.ladbrokes',function(ladbrokes){var
instance=null,xClientRequestId=0;ladbrokes.Provider=function(){if(instance){return instance;}
instance=this;ladbrokes.Provider.$super.apply(this,arguments);};extend(ladbrokes.Provider,rp.betting.Provider,function($class,$super){var
TYPE=rp.betting.Bet.TYPE,apiLinks={};$class.PROVIDER_NAME='LADB';$class.FORM_AUTHENTICATE='/forms/authorise-client';$class.FORM_DEPOSIT='/forms/deposit-funds';$class.FORM_REGISTER='/forms/register-customer';this.EVENT_DEPOSIT_FUNDS="deposit-funds";this.EVENT_ADD_PAYMENT_METHOD="add-payment-method";this.EVENT_AUTHENTICATE="authorise-client";this.EVENT_REGISTER="register-customer";this.EVENT_PROCESS_LOGIN="processLogin";this.event(this.EVENT_DEPOSIT_FUNDS);this.event(this.EVENT_AUTHENTICATE);this.event(this.EVENT_REGISTER);this._url=null;this.property('url',{set:true});this._apiVersions=null;this.property('apiVersions',{set:true});this._params=null;this.property('params',{set:true});function handleMessage($event){var event=$event.originalEvent;var data={};try{data=JSON.parse(event.data);}catch(e){}
var params=data.params||{},error=params.error||params.error_code||"",eventName=data.event,eventNamespace=data.namespace||undefined;if(eventNamespace&&eventNamespace!=$class.PROVIDER_NAME){return false;}
switch(eventName){case this.EVENT_REGISTER:case this.EVENT_ADD_PAYMENT_METHOD:case this.EVENT_PROCESS_LOGIN:case this.EVENT_AUTHENTICATE:if(!error&&typeof(params.token)!=='undefined'){this.user(new rp.betting.User({login:params.username,token:params.token}));this.token(params.token,1);this.initUser();}else{this.logout();this.trigger(this.EVENT_LOGOUT,params);}
break;case this.EVENT_DEPOSIT_FUNDS:this.getBalance();this.trigger(this.EVENT_DEPOSIT_FUNDS,params);break;default:if(eventName!=undefined){this.logout();this.trigger(this.EVENT_LOGOUT,params);}
break;}};var refreshTimeout=null;this.property('token',{set:function(token,expires){var interval;$super.token.call(this,token);if(this.token()&&expires){interval=expires||this.settings().tokenRefreshTime;if(interval){refreshTimeout.interval(interval).start();}}}});function getLocalDate(date){var self=$class.instance();return moment(date,utils.moment.FORMAT_FULL_DATETIME_WITH_T).add('ms',utils.date.timeZoneDiff(self.settings().timeZone)).format(utils.moment.FORMAT_FULL_DATETIME);}
this.init=function(){$super.init.call(this);$(window).bind('message.ladbrokes-provider',$.proxy(handleMessage,this));refreshTimeout=rp.timeout().tick(this.refreshToken,this);function success(){this.initUser();}
if(this.user()){this.refreshToken().success(success,this);}};this.getFormApiLink=function(name,params){var settings=this.settings(),url=rp.url(name,this.url()),state=name.split('/').pop();url.params(params).params({'locale':'en-GB','client_id':settings.apiKey,'redirect_uri':settings.redirectUrl,'state':state});return String(url);};function setApiLinks(root,links){var link,name;for(var i=0,l=links.length;i<l;i++){name=root;link=links[i];if(link.rel!=='self'){name+='/'+link.rel;}
apiLinks[name]={url:link.href,type:link.method};}}
function getApiLink(command){var self=$class.instance(),name=command.name(),link=apiLinks[name],path=name,user=self.user(),apiVersions=self.apiVersions();if(name.indexOf(ladbrokes.Command.CUSTOMER_API)===0&&user){path=ladbrokes.Command.CUSTOMERS+'/'+user.login();if(name!==ladbrokes.Command.CUSTOMER){path+='/access-tokens/'+user.token();}}
if(apiVersions){for(var apiName in apiVersions){if(apiVersions.hasOwnProperty(apiName)&&name.indexOf(apiName)===0){path=apiVersions[apiName]+path;}}}
if(!link){link={url:String(rp.url(path,self.url()))};if(name===ladbrokes.Command.CUSTOMER_LOGOUT){link.type='delete';}}
return link;}
function setCommandSettings(command){var self=$class.instance(),settings=command.settings(),name=command.name(),url,type;$.extend(settings,getApiLink(command));type=(settings.type||'get').toLowerCase();url=rp.url(settings.url);url.params(self.params());if(name!==ladbrokes.Command.BETTING_API&&name!==ladbrokes.Command.SPORTSBOOK&&name!==ladbrokes.Command.BANKING_API){url.param('no-links',1);}
if(name===ladbrokes.Command.CUSTOMER_REFRESH_TOKEN){url.param('access-token',self.token());}
settings.headers=$.extend({},settings.headers,{'Accept':'application/json'});if(type!=='get'){settings.headers=$.extend({},settings.headers,{"X-Client-Request-ID":self.getXClientRequestId(),"Content-Type":'application/json;charset=UTF-8'});if(self.token()){settings.headers["Authorization"]='Bearer '+self.token();}}
settings.url=String(url);settings.type=type;command.settings(settings);};this.getXClientRequestId=function(){return(Number(new Date())+(++xClientRequestId)).toString(36);};function createCommand(name,data,settings){var self=$class.instance();settings=settings||{};function call(event){setCommandSettings(event.target);}
function success(event){var command=event.target,result=command.result();if(result.links&&result.links.link){setApiLinks(command.name(),result.links.link||[]);}};return ladbrokes.Command.create(name,data).settings({type:settings.type||'get',dataType:'json',timeout:self.timeout(),proxy:self.proxy()}).call(call,self).success(success,self);};function createQueue(command){var self=$class.instance(),queue;function timeout(event){event.stopImmediatePropagation();event.target.proceed();}
function error(event){var queue=event.target,command=queue.current();if(command.isLadbError()){switch(command.result().code()){case ladbrokes.Error.INVALID_SESSION_TOKEN:case ladbrokes.Error.EXPIRED_SESSION_TOKEN:case ladbrokes.Error.EXPIRED_OR_INVALID_SESSION_TOKEN:case ladbrokes.Error.API_CLIENT_QUOTA_EXCEEDED:if(command.name()!==ladbrokes.Command.CUSTOMER_LOGOUT){this.isReady(true);this.logout();break;}}}}
queue=new rp.betting.Queue();for(var i=0,l=arguments.length;i<l;i++){queue.add(arguments[i]);}
queue.timeout(timeout,self).error(error,self);return queue;};function callCommand(){return createQueue.apply(this,arguments).call();};function GetCustomer(user){var self=$class.instance();function success(event){var command=event.target,customer=command.result().customer;command.result(user.set({title:customer.title,firstName:customer.firstName,userIdentifier:customer.customerKey,currency:customer.preferredCurrency}));}
return createCommand(ladbrokes.Command.CUSTOMER,{'access-token':user.token(),'no-links':1}).success(success,self);}
function RefreshToken(user){var self=$class.instance();function success(event){var result=event.target.result(),accessToken=result&&result.accessToken,expiresIn;if(accessToken){expiresIn=(accessToken.expiresIn-120)*1000;this.token(accessToken.token,expiresIn>0?expiresIn:0);}}
return createCommand(ladbrokes.Command.CUSTOMER_REFRESH_TOKEN).success(success,self);}
function GetSelectionsStatus(betslip){var self=$class.instance();var selectionIds=getSelectionsIds(betslip);function success(event){var command=event.target,result=command.result(),suspendedSelections=[],activeSelections=[],selections=result&&(result.selection||result.resource.selections.selection);if(!$.isArray(selections)){selections=[selections];};$.each(selections,function(index,value){if(value.selectionStatus=="Active"){activeSelections.push(value.selectionKey.toString());}})
suspendedSelections=$(selectionIds.split(",")).not(activeSelections).get();var error=new ladbrokes.Error(ladbrokes.Error.STATUS_CHANGED,'suspended selections or market suspended');error.data(suspendedSelections);event.stopImmediatePropagation();command.result(error).error(command,command.result());}
function error(event){var command=event.target,error=command.result();if(error.code()==ladbrokes.Error.GENERIC_ERROR){error.data(selectionIds.split(","));error.code(ladbrokes.Error.STATUS_CHANGED);}}
return createCommand(ladbrokes.Command.SELECTIONS_STATUS+selectionIds).error(error,self).success(success,self);}
function LogOut(user){var self=$class.instance();function complete(event){this.user(null);this.trigger(this.EVENT_LOGOUT);}
return createCommand(ladbrokes.Command.CUSTOMER_LOGOUT).complete(complete,self);}
function GetBalance(user){var self=$class.instance();function success(event){var command=event.target,wallet=command.result().wallet;user.balance(wallet.balance).currency(wallet.currency);command.result(user);}
return createCommand(ladbrokes.Command.GET_BALANCE,{'access-token':user.token(),'no-links':1}).success(success,self);};function getRedeemPromos(bet){var freeBets=bet.freeBets(),redeemPromos=[],freeBet;for(var i=0,l=freeBets.length;i<l;i++){freeBet=freeBets[i];if(freeBet.selected()){redeemPromos.push(freeBet.id());}}
return redeemPromos;}
function getLadbrokesBetSlip(betslip,ignoreStake){var self=$class.instance(),ladbBetSlip={},betArray=[],legs,leg,bet,ladbBet,selection,part,price,minimumStake=0.12;var bets=ignoreStake?betslip.getActiveBets():betslip.getBetsWithStake();for(var i=0,l=bets.length;i<l;i++){bet=bets[i];legs=[];for(var j=0;j<bet.selections().length;j++){selection=bet.selections()[j];price={selectionPriceTypeCode:selection.isSP()?'SP':'LP'}
if(!selection.isSP()){$.extend(price,{numPrice:selection.price().num(),denPrice:selection.price().den()});}
part={selectionKey:selection.id(),partNo:1,selectionPrice:price};if(bet.isEachWay()&&selection.hasEachWay()){$.extend(part,{eachWayDetail:{eachWayPlaces:selection.eachWay().numberOfPlaces(),eachWayNum:selection.eachWay().num(),eachWayDen:selection.eachWay().den()}});};leg={legSortCode:"SS",part:part,legNo:j+1};legs.push(leg);};ladbBet={stakePerLine:ignoreStake?minimumStake:bet.stake(),betTypeCode:self.getBetTypeCode(bet),legTypeCode:bet.isEachWay()?"E":"W",leg:(legs.length==1)?legs[0]:legs,redeemPromoKey:ignoreStake?'':getRedeemPromos(bet).join(','),betNo:i+1}
betArray.push(ladbBet);}
ladbBetSlip={betslip:{bet:(betArray.length==1)?betArray[0]:betArray}};return ladbBetSlip;};function getLadbErrorObjects(errors,code){if(!$.isArray(errors)){errors=[errors];};var errorObjects=$.map(errors,function(value){if(ladbrokes.Command.getErrorCode(value.errorCode)==code){return value&&value.failureResponseObject&&value.failureResponseObject.failedBetslip&&value.failureResponseObject.failedBetslip.failedBet;}});return errorObjects;}
function getSelectionsIds(betslip){var ids=[],bets=betslip.getSingleBets(),bet,selection;for(var i=0,l=bets.length;i<l;i++){bet=bets[i];selection=bet.selections()[0];if(!selection.data().isSuspended){ids.push(selection.id());}}
return ids.join();}
function updateMultiplePrices(betslip,data,ignoreUpdate){var bet,selection;var newPrices={};$.each(data,function(index,value){newPrices[value.selectionKey]={den:value.denPrice,num:value.numPrice}})
var bets=ignoreUpdate?betslip.getActiveBets():betslip.getSingleBets();for(var i=0,l=bets.length;i<l;i++){bet=bets[i];for(var j=0;j<bet.selections().length;j++){selection=bet.selections()[j];if(newPrices[selection.id()]){selection.data().oldNum=selection.price().num();selection.data().oldDen=selection.price().den();selection.oldPrice(selection.price());selection.price({den:newPrices[selection.id()].den,num:newPrices[selection.id()].num});}}}
return betslip;};function updateMultipleFailedBetMiniMax(betslip,data,ignoreStake){var bets=ignoreStake?betslip.getActiveBets():betslip.getBetsWithStake(),bet;$.each(data,function(index,value){bet=bets[value.betNo-1];bet.set({minStake:value.betMinStake,maxStake:value.betMaxStake});});return betslip;};function GetMultipleBetSlip(betslip,withUpdatedPrices){var self=$class.instance();function success(event){var command=event.target,ladbBetSlip=command.result().betslip,bets=betslip.getActiveBets(),freeBets=[],usedFreeBets,date=utils.moment.getSynchronizedToServerNow(this.settings().serverDateDelta,false),promotions;var ladbBets=ladbBetSlip.bet;if(!$.isArray(ladbBets)){ladbBets=[ladbBets];};if(ladbBets){for(var i=0,l=ladbBets.length;i<l;i++){var ladbBet=ladbBets[i];bets[i].set({minStake:ladbBet.betMinStake,maxStake:ladbBet.betMaxStake});usedFreeBets=bets[i].freeBets()
promotions=ladbBet.redeemablePromos?ladbBet.redeemablePromos.promotion:[];if(!$.isArray(promotions)){promotions=[promotions];};for(var j=0;j<promotions.length;j++){var promotion=promotions[j],expiryDate=moment(promotion.expiry,utils.moment.FORMAT_FULL_DATETIME_WITH_T),freeBetKey=promotion.key,selected=false;if(usedFreeBets){for(var index=0,len=usedFreeBets.length;index<len;index++){var usedFreeBet=usedFreeBets[index];if(freeBetKey==usedFreeBet.id()){selected=usedFreeBet.selected();}}}
if(date.valueOf()<expiryDate.valueOf()){freeBets.push({id:freeBetKey,name:promotion.name,amount:parseFloat(promotion.amount)||0,expires:expiryDate,selected:selected});}}
if(freeBets.length>0){bets[i].freeBets(freeBets);}}}
command.result(betslip);}
function error(event){var error=event.target.result(),errorCode=error.code();if(errorCode===ladbrokes.Error.PRICE_CHANGED){error.data(updateMultiplePrices(new rp.betting.BetSlip(betslip.toJSON()),getLadbErrorObjects(error.data(),errorCode),true));}
if(errorCode===ladbrokes.Error.STATUS_CHANGED){error.code(ladbrokes.Error.FAKE_SUSPENDED);}
else if(errorCode===ladbrokes.Error.STAKE_TOO_LOW||errorCode===ladbrokes.Error.STAKE_TOO_HIGH){error.data(updateMultipleFailedBetMiniMax(betslip,getLadbErrorObjects(error.data(),errorCode),true));}}
return createCommand(ladbrokes.Command.CHECK_BETSLIP,withUpdatedPrices?getLadbrokesBetSlip(withUpdatedPrices,true):getLadbrokesBetSlip(betslip,true),{type:'post'}).success(success,self).error(error,self);}
function PlaceMultipleBet(betslip){var self=$class.instance();function success(event){var command=event.target,ladbBetSlip=command.result().betslip,bets=betslip.getBetsWithStake();var ladbBets=ladbBetSlip.bet;if(!$.isArray(ladbBets)){ladbBets=[ladbBets];};if(ladbBets){for(var i=0,l=ladbBets.length;i<l;i++){var ladbBet=ladbBets[i];bets[i].set({receiptId:ladbBet.betReceipt,betDate:getLocalDate(ladbBet.betPlacedDateTime),betReference:ladbBet.betKey,returns:ladbBet.potentialPayout});bets[i].typeName(utils.bet.getBetTypeName(bets[i]));var selections=bets[i].selections();var legs=ladbBets[i].leg;if(!$.isArray(legs)){legs=[legs];};for(var j=0,len=selections.length;j<len;j++){var data=selections[j].data();var price=legs[j].part.selectionPrice;selections[j].data($.extend(data,{selectionDesc:data.selectionDesc||data.horseName,eventTypeName:data.eventTypeName||data.courseName,eventDesc:data.eventDesc||moment(data.time,utils.moment.FORMAT_TIME_24_HOURS).format(utils.moment.FORMAT_TIME_12_HOURS),eventTime:data.eventTime||moment(data.raceDate,utils.moment.FORMAT_DATETIME_STRAIGHT).format(utils.moment.FORMAT_FULL_DATETIME)}));if(price.denPrice&&price.numPrice){selections[j].price({den:price.denPrice,num:price.numPrice})}}}}
command.result(betslip);callCommand(GetBalance(this.user()));};function error(event){var error=event.target.result(),errorCode=error.code();if(errorCode===ladbrokes.Error.PRICE_CHANGED){error.data(updateMultiplePrices(betslip,getLadbErrorObjects(error.data(),errorCode)));}
if(errorCode===ladbrokes.Error.STATUS_CHANGED){error.code(ladbrokes.Error.FAKE_SUSPENDED);}
else if(errorCode===ladbrokes.Error.STAKE_TOO_LOW||errorCode===ladbrokes.Error.STAKE_TOO_HIGH){error.data(updateMultipleFailedBetMiniMax(betslip,getLadbErrorObjects(error.data(),errorCode)));}}
return createCommand(rp.betting.ladbrokes.Command.SUBMIT_BETSLIP,getLadbrokesBetSlip(betslip)).success(success,self).error(error,self);};this.initUser=function(){var self=$class.instance(),user=self.user();function success(event){this.isReady(true);this.user(event.target.result()).trigger(this.EVENT_LOGIN,user);}
return callCommand(createCommand(ladbrokes.Command.BETTING_API),createCommand(ladbrokes.Command.SPORTSBOOK),createCommand(ladbrokes.Command.BANKING_API),GetCustomer(user),GetBalance(user)).success(success,self);};this.getBetSlip=function(betslip){if(betslip instanceof rp.betting.BetSlip){function error(event){var queue=event.target,error=queue.result(),errorCode=error.code();if(errorCode===ladbrokes.Error.PRICE_CHANGED){event.stopImmediatePropagation();queue.add(GetMultipleBetSlip(betslip,error.data())).next();}
if(errorCode===ladbrokes.Error.FAKE_SUSPENDED){event.stopImmediatePropagation();queue.add(GetSelectionsStatus(betslip)).next();}};return callCommand(GetMultipleBetSlip(betslip)).error(error,this);}else{throw new Error('Instance of rp.betting.BetSlip expected.');}};this.getSuspendedSelections=function(betslip){if(betslip instanceof rp.betting.BetSlip){return callCommand(GetSelectionsStatus(betslip));}else{throw new Error('Instance of rp.betting.BetSlip expected.');}}
this.placeBet=function(betslip){if(betslip instanceof rp.betting.BetSlip){function error(event){var queue=event.target,error=queue.result(),errorCode=error.code();if(errorCode===ladbrokes.Error.FAKE_SUSPENDED){event.stopImmediatePropagation();queue.add(GetSelectionsStatus(betslip)).next();}};return callCommand(PlaceMultipleBet(betslip)).error(error,this);}else{throw new Error('Instance of rp.betting.Bet or rp.betting.BetSlip expected.');}};this.logout=function(){refreshTimeout.stop();if(this.isLoggedIn()){return callCommand(LogOut(this.user()));}};this.logoutLite=function(){refreshTimeout.stop();this.user(null);this.trigger(this.EVENT_LOGOUT);}
this.getBalance=function(){if(this.isLoggedIn()){return callCommand(GetBalance(this.user()));}};this.refreshToken=function(){if(this.isLoggedIn()){return callCommand(RefreshToken(this.user()));}};this.getBetHistory=function(betHistory){if(!(betHistory instanceof rp.betting.BetHistory)){throw new Error('Instance of rp.betting.BetHistory expected.');}
function setBlockNumber(number){number=parseInt(number);if(isNaN(number)){number=1;}
betHistory.searchCriteria().set({'blockNumber':number});}
var blockSize=betHistory.searchCriteria().blockSize();function ceilNumber(number){return Math.ceil(number/blockSize);}
var commands=[];var areTotalsSet=betHistory.totalBlocks()&&betHistory.totalBlocks().hasOwnProperty('settled')&&betHistory.totalBlocks().hasOwnProperty('opened');if(!areTotalsSet){commands.push(GetBetHistory(betHistory,false),GetBetHistory(betHistory,true));}else{var openBets=betHistory.opened(),totalOpenBets=betHistory.totalBlocks().opened,settledBets=betHistory.settled(),totalSettledBets=betHistory.totalBlocks().settled,minimumEstablished=betHistory.searchCriteria().minimumBets();if(openBets.length<totalOpenBets){commands.push(GetBetHistory(betHistory,false));}else{if(settledBets.length<totalSettledBets){if(settledBets.length==0){setBlockNumber(ceilNumber(totalSettledBets));commands.push(GetBetHistory(betHistory,true));if((totalSettledBets%blockSize)<minimumEstablished){setBlockNumber(ceilNumber(totalSettledBets)-1);commands.push(GetBetHistory(betHistory,true));setBlockNumber(ceilNumber(totalSettledBets));}}else{commands.push(GetBetHistory(betHistory,true));}}}}
return callCommand.apply(null,commands).success(function(event){var queue=event.target,noBetsYet=(betHistory.bets().length==0),blockSize=betHistory.searchCriteria().blockSize(),areTotalsSet=betHistory.totalBlocks()&&betHistory.totalBlocks().hasOwnProperty('settled')&&betHistory.totalBlocks().hasOwnProperty('opened'),minimumEstablished=betHistory.searchCriteria().minimumBets();function firstBetHistoryCalls(totalBets,isOpen){var betsOnLastPage=totalBets%blockSize;setBlockNumber(ceilNumber(totalBets));queue.add(GetBetHistory(betHistory,isOpen));if(betsOnLastPage<minimumEstablished&&betsOnLastPage>0){setBlockNumber(ceilNumber(totalBets)-1);queue.add(GetBetHistory(betHistory,isOpen));setBlockNumber(ceilNumber(totalBets));}}
if(areTotalsSet&&noBetsYet){var totalOpenBets=betHistory.totalBlocks().opened,totalSettledBets=betHistory.totalBlocks().settled;if(totalOpenBets==0&&totalSettledBets==0){queue.complete();}else{event.stopImmediatePropagation();if(totalOpenBets!=0){firstBetHistoryCalls(totalOpenBets,false);}else{firstBetHistoryCalls(totalSettledBets,true);}
queue.proceed();}}else{var totalBets=betHistory.bets().length,totalOpenBets=betHistory.totalBlocks().opened,totalSettledBets=betHistory.totalBlocks().settled;if(totalBets<minimumEstablished&&!!totalSettledBets){event.stopImmediatePropagation();if(totalBets==totalOpenBets){setBlockNumber(ceilNumber(totalSettledBets));}else{setBlockNumber(ceilNumber(totalSettledBets)-1);}
queue.add(GetBetHistory(betHistory,true));queue.proceed();}}}).error(function(event){var queue=event.target;if(!(queue.result()instanceof rp.betting.Error)){event.stopImmediatePropagation();queue.next();}});};function GetBetHistory(betHistory,isSettled){var self=$class.instance();function parseBets(data){betHistory.searchCriteria().set({'blockNumber':betHistory.searchCriteria().blockNumber()-1});var bets=data.bets.bet;if(!$.isArray(bets)){bets=[bets];}
if(bets&&bets.length){var betsToAdd=[];for(var betIndex in bets){var bet=bets[betIndex],rpBet=new rp.betting.Bet(),betTypeCode=self.getBetType(bet.betTypeCode),betDate=moment(bet.betPlacedDateTime,utils.moment.FORMAT_FULL_DATETIME_WITH_T).add('ms',utils.date.timeZoneDiff(self.settings().timeZone));rpBet.set({'receiptId':bet.betReceipt,'totalStake':bet.totalBetStake,'type':betTypeCode,'isEachWay':bet.isEachWay,'betHistoryEW':bet.isEachWay,'betReference':bet.betKey,'betDate':betDate,'isSettled':isSettled,'stake':bet.stakePerLine});rpBet.typeName(utils.bet.getBetTypeName(rpBet));if(bet.betSettlement){var winnings=parseFloat(bet.betSettlement.winnings);rpBet.set({returns:winnings});}else{if(bet.isEachWay){rpBet.returns(NaN);}}
var selections=bet.leg,betSelections=[];if(!$.isArray(selections)){selections=[selections];}
for(var index in selections){var selectionParts=selections[index].part;if(!$.isArray(selectionParts)){selectionParts=[selectionParts];}
for(var ind in selectionParts){var selection=selectionParts[ind],rpSelection=new rp.betting.Selection(),isSP=!selection.selectionPrice,price=null,eachWay=bet.isEachWay?new rp.betting.EachWay():null,eventDesc=moment(selection.eventName,utils.moment.FORMAT_TIME_24_HOURS).isValid()?moment(selection.eventName,utils.moment.FORMAT_TIME_24_HOURS).format(utils.moment.FORMAT_TIME_12_HOURS):moment(selection.eventStartDateTime,utils.moment.FORMAT_FULL_ISO_DATE).format(utils.moment.FORMAT_TIME_12_HOURS);if(!isSP){price={'num':selection.selectionPrice.numPrice,'den':selection.selectionPrice.denPrice};}
rpSelection.set({'id':selection.selectionKey,'data':{'eventDesc':eventDesc,'marketDesc':selection.marketName,'selectionDesc':selection.selectionName,'eventTypeName':selection.eventTypeName,'eventTime':selection.eventStartDateTime,'raceId':utils.string.hashCode(selection.eventName)
+moment(selection.eventStartDateTime).unix()},'price':price,'isSP':isSP,'eachWay':eachWay});betSelections.push(rpSelection);}}
rpBet.selections(betSelections);if(rpBet.isSettled()){if(rpBet.returns()>0){rpBet.label(utils.bet.LABEL_WIN_FULL);}else{rpBet.label(utils.bet.LABEL_LOST_FULL);}}
betsToAdd.unshift(rpBet);}
betHistory.addBets(betsToAdd);}}
function error(event){var command=event.target,error=command.result(),errorCode=error.code();if(errorCode==rp.betting.ladbrokes.Error.GENERIC_ERROR){if(isSettled){$.extend(betHistory.totalBlocks(),{'settled':0});}else{betHistory.set({'totalBlocks':{'opened':0}});}
event.target.result(betHistory);command.status(1);}}
function success(event,result){var numberOfBets=$.isEmptyObject(result.bets)?0:result.bets.totalBets;var onePageOnly=(numberOfBets!=0)&&(numberOfBets<(betHistory.searchCriteria().blockSize()+1));if(betHistory.totalBlocks()==null||typeof betHistory.totalBlocks().settled=='undefined'){if(isSettled){var noOpenBets=(betHistory.totalBlocks().opened==0);$.extend(betHistory.totalBlocks(),{'settled':numberOfBets});if(noOpenBets&&onePageOnly){parseBets(result);}}else{betHistory.set({'totalBlocks':{'opened':numberOfBets}});if(onePageOnly){parseBets(result);}}}else{parseBets(result);}
event.target.result(betHistory);}
var searchCriteria=betHistory.searchCriteria(),requestFields={'startdate':isSettled?moment.utc().subtract('days',1).format(utils.moment.FORMAT_FULL_ISO_DATE):moment.utc(searchCriteria.fromDate()).format(utils.moment.FORMAT_FULL_ISO_DATE),'enddate':isSettled?moment.utc().format(utils.moment.FORMAT_FULL_ISO_DATE):moment.utc(searchCriteria.toDate()).format(utils.moment.FORMAT_FULL_ISO_DATE),'howmany':searchCriteria.blockSize(),'pagenumber':searchCriteria.blockNumber()!=null?searchCriteria.blockNumber():1,'select':'default,betReceipt,leg.part.eventTypeName,betTypeCode,leg.part.eventStartDateTime,isEachWay,totalBetStake','access-token':self.token(),'no-links':1};if(isSettled){$.extend(requestFields,{'decorator':'settled'});}
return createCommand(ladbrokes.Command.BETS,requestFields).success(success,self).error(error,self);}
this.getBetHistoryChunks=function(betHistory){if(!(betHistory instanceof rp.betting.BetHistory)){throw new Error('Instance of rp.betting.BetHistory expected.');}
var commands=[];var noBetsCounter=0;var areOpenBetsLoaded=betHistory.totalBlocks()&&betHistory.totalBlocks().hasOwnProperty('opened');if(!areOpenBetsLoaded){betHistory.searchCriteria().set({'fromDate':moment().subtract('months',this.settings().openBetsPeriodMonths).format(utils.moment.FORMAT_FULL_ISO_DATE),'toDate':moment().format(utils.moment.FORMAT_FULL_ISO_DATE),'blockNumber':1});commands.push(GetBetHistoryChunks(betHistory,false));}else{var openBets=betHistory.opened().length,totalBets=betHistory.bets().length,totalOpenBets=betHistory.totalBlocks().opened;if(openBets<totalOpenBets){betHistory.searchCriteria().set({'blockNumber':betHistory.searchCriteria().blockNumber()+1});commands.push(GetBetHistoryChunks(betHistory,false));}else{var areSettledBetsLoaded=betHistory.totalBlocks()&&betHistory.totalBlocks().hasOwnProperty('settled');if(!areSettledBetsLoaded){betHistory.searchCriteria().set({'toDate':moment().format(utils.moment.FORMAT_FULL_ISO_DATE),'fromDate':moment().subtract('days',this.settings().settledBetsChunksPeriodDays).format(utils.moment.FORMAT_FULL_ISO_DATE),'blockNumber':1});}else{var settledBets=betHistory.settled().length,totalSettledBets=betHistory.totalBlocks().totalSettled;if(settledBets<totalSettledBets){betHistory.searchCriteria().set({'blockNumber':betHistory.searchCriteria().blockNumber()+1});}else{betHistory.searchCriteria().set({'toDate':moment(betHistory.searchCriteria().toDate()).subtract('days',this.settings().settledBetsChunksPeriodDays).format(utils.moment.FORMAT_FULL_ISO_DATE),'fromDate':moment(betHistory.searchCriteria().fromDate()).subtract('days',this.settings().settledBetsChunksPeriodDays).format(utils.moment.FORMAT_FULL_ISO_DATE),'blockNumber':1});}}
commands.push(GetBetHistoryChunks(betHistory,true));}}
return callCommand.apply(null,commands).success(function(event){}).error($.proxy(function(event){var queue=event.target,lastCommand=queue.current();if(queue.result()instanceof rp.betting.BetHistory){if(lastCommand.data().decorator!=='settled'){lastCommand._result.searchCriteria().set({'toDate':moment().format(utils.moment.FORMAT_FULL_ISO_DATE),'fromDate':moment().subtract('days',this.settings().settledBetsChunksPeriodDays).format(utils.moment.FORMAT_FULL_ISO_DATE),'blockNumber':1});queue.add(GetBetHistoryChunks(betHistory,true));event.stopImmediatePropagation();queue.next();}else{if(noBetsCounter<this.settings().settledBetsRetryLimit){lastCommand._result.searchCriteria().set({'toDate':moment(betHistory.searchCriteria().toDate()).subtract('days',this.settings().settledBetsChunksPeriodDays).format(utils.moment.FORMAT_FULL_ISO_DATE),'fromDate':moment(betHistory.searchCriteria().fromDate()).subtract('days',this.settings().settledBetsChunksPeriodDays).format(utils.moment.FORMAT_FULL_ISO_DATE),'blockNumber':1});noBetsCounter++;queue.add(GetBetHistoryChunks(betHistory,true));event.stopImmediatePropagation();queue.next();}else{queue.result(new ladbrokes.Error(ladbrokes.Error.NO_RECENT_BETS,'No recent bets'));}}}},this));};function GetBetHistoryChunks(betHistory,isSettled){var self=$class.instance();function parseBets(data){var bets=data.bets.bet;if(!$.isArray(bets)){bets=[bets];}
if(bets&&bets.length){var betsToAdd=[];for(var betIndex in bets){var bet=bets[betIndex],rpBet=new rp.betting.Bet(),betTypeCode=self.getBetType(bet.betTypeCode),betDate=moment(bet.betPlacedDateTime,utils.moment.FORMAT_FULL_DATETIME_WITH_T).add('ms',utils.date.timeZoneDiff(self.settings().timeZone));rpBet.set({'receiptId':bet.betReceipt,'totalStake':bet.totalBetStake,'type':betTypeCode,'isEachWay':bet.isEachWay,'betHistoryEW':bet.isEachWay,'betReference':bet.betKey,'betDate':betDate,'isSettled':isSettled,'stake':bet.stakePerLine});rpBet.typeName(utils.bet.getBetTypeName(rpBet));if(bet.betSettlement){var winnings=parseFloat(bet.betSettlement.winnings);rpBet.set({returns:winnings});}else{if(bet.isEachWay){rpBet.returns(NaN);}}
var selections=bet.leg,betSelections=[];if(!$.isArray(selections)){selections=[selections];}
var betSelections=[];for(var index in selections){var selectionParts=selections[index].part;if(!$.isArray(selectionParts)){selectionParts=[selectionParts];}
for(var ind in selectionParts){var selection=selectionParts[ind],rpSelection=new rp.betting.Selection(),isSP=!selection.selectionPrice,price=null,eachWay=bet.isEachWay?new rp.betting.EachWay():null,eventDesc=moment(selection.eventName,utils.moment.FORMAT_TIME_24_HOURS).isValid()?moment(selection.eventName,utils.moment.FORMAT_TIME_24_HOURS).format(utils.moment.FORMAT_TIME_12_HOURS):moment(selection.eventStartDateTime,utils.moment.FORMAT_FULL_ISO_DATE).format(utils.moment.FORMAT_TIME_12_HOURS);if(!isSP){price={'num':selection.selectionPrice.numPrice,'den':selection.selectionPrice.denPrice};}
rpSelection.set({'id':selection.selectionKey,'data':{'eventDesc':eventDesc,'marketDesc':selection.marketName,'selectionDesc':selection.selectionName,'eventTypeName':selection.eventTypeName,'eventTime':selection.eventStartDateTime,'raceId':utils.string.hashCode(selection.eventName)
+moment(selection.eventStartDateTime).unix()},'price':price,'isSP':isSP,'eachWay':eachWay});betSelections.push(rpSelection);}}
rpBet.selections(betSelections);if(rpBet.isSettled()){if(rpBet.returns()>0){rpBet.label(utils.bet.LABEL_WIN_FULL);}else{rpBet.label(utils.bet.LABEL_LOST_FULL);}}
betsToAdd.push(rpBet);}
betHistory.addBets(betsToAdd);}}
function error(event){var command=event.target,error=command.result(),errorCode=error.code();if(errorCode===rp.betting.ladbrokes.Error.GENERIC_ERROR){if(isSettled){$.extend(betHistory.totalBlocks(),{'settled':0});}else{betHistory.set({'totalBlocks':{'opened':0}});}
event.target.result(betHistory);command.status(1);};}
function success(event,result){var numberOfBets=($.isEmptyObject(result.bets))?0:result.bets.totalBets;if(isSettled){$.extend(betHistory.totalBlocks(),{'settled':numberOfBets});if(betHistory.searchCriteria().blockNumber()===1){if(!betHistory.totalBlocks().hasOwnProperty('totalSettled')){betHistory.totalBlocks().totalSettled=numberOfBets;}else{betHistory.totalBlocks().totalSettled+=numberOfBets;}}}else{betHistory.set({'totalBlocks':{'opened':numberOfBets}});}
if(numberOfBets!==0){parseBets(result);}else{event.target.status(1);}
event.target.result(betHistory);}
var searchCriteria=betHistory.searchCriteria(),requestFields={'startdate':moment.utc(searchCriteria.fromDate()).format(utils.moment.FORMAT_FULL_ISO_DATE),'enddate':moment.utc(searchCriteria.toDate()).format(utils.moment.FORMAT_FULL_ISO_DATE),'howmany':searchCriteria.blockSize(),'pagenumber':searchCriteria.blockNumber()!=null?searchCriteria.blockNumber():1,'select':'default,betReceipt,leg.part.eventTypeName,betTypeCode,leg.part.eventStartDateTime,isEachWay,totalBetStake','access-token':self.token(),'sort-order':'desc','sort-by':'betPlacedDateTime','no-links':1};if(isSettled){$.extend(requestFields,{'decorator':'settled'});}
return createCommand(ladbrokes.Command.BETS,requestFields).success(success,self).error(error,self);}
$class.instance=function(options){return new $class(options);};this.checkConnection=function(){return callCommand(createCommand(ladbrokes.Command.BETTING_API));}});});
namespace('rp.betting');rp.betting.AbstractProxy=function(){if(this.constructor===arguments.callee){throw new Error('Unable to create instance of abstract class rp.betting.AbstractProxy');}
$(window).bind('message.proxy',$.proxy(this._handleWindowMessage,this));this._ajaxes={};};extend(rp.betting.AbstractProxy,rp.Object,function($class,$super){this.MESSAGE_READY='ready';this.MESSAGE_REQUEST='request';this.MESSAGE_ABORT='abort';this.MESSAGE_SUCCESS='success';this.MESSAGE_ERROR='error';this.MESSAGE_COMPLETE='complete';this.TEXT_FATAL='Fatal error!';this._ajaxes=null;this._targetWindow=null;this.property('targetWindow',{set:true});this.postMessage=function(event,data){var targetWindow=this.targetWindow(),message;try{message=JSON.stringify({type:event,data:data});}catch(e){if(event===this.MESSAGE_ERROR&&data.xhr.responseXML){delete data.xhr.responseXML;data.xhr.responseText='{"error": "'+this.TEXT_FATAL+'"}';}
message=JSON.stringify({type:event,data:data});}
if(targetWindow){targetWindow.postMessage(message,"*");}};this.getMessageFromEvent=function(event){var originalEvent=event.originalEvent,message={};try{message=JSON.parse(originalEvent.data);}catch(e){}
return message;};this._handleWindowMessage=function(event){throw new Error('Unable to call abstract method [object rp.betting.AbstractProxy]._handleWindowMessage.');};});
namespace('rp.betting');rp.betting.LocalProxy=function(proxyUrl){arguments.callee.$super.call(this,utils.string.url(proxyUrl).origin);this._proxyUrl=proxyUrl;};extend(rp.betting.LocalProxy,rp.betting.AbstractProxy,function($class,$super){var ID='rp-betting-proxy-container';var isProxyReady=false;this.property('targetWindow',{get:function(){if(!this._targetWindow){var $iframe=$('<iframe />').appendTo($('<div />').appendTo(document.body).width(0).height(0).attr('id',ID).css('overflow','hidden')).attr('src',this._proxyUrl);this._targetWindow=$iframe[0].contentWindow;}
return this._targetWindow;}});this._sendRequestMessage=function(id,settings){this.postMessage(this.MESSAGE_REQUEST,{id:id,settings:settings});};this._sendAbortMessage=function(id){this.postMessage(this.MESSAGE_ABORT,{id:id});};this._handleReadyMessage=function(){isProxyReady=true;for(var id in this._ajaxes){this._sendRequestMessage(id,this._ajaxes[id]);}};this._handleSuccessMessage=function(data){var ajax=this._ajaxes[data.id];if(ajax&&$.isFunction(ajax.success)){ajax.success(data.data,data.textStatus,data.xhr);}};this._handleErrorMessage=function(data){var ajax=this._ajaxes[data.id];if(ajax&&$.isFunction(ajax.error)){ajax.error(data.xhr,data.textStatus);}};this._handleCompleteMessage=function(data){var ajax=this._ajaxes[data.id];if(ajax&&$.isFunction(ajax.complete)){ajax.complete(data.xhr,data.textStatus);}
delete this._ajaxes[data.id];};this._handleWindowMessage=function(event){var message=this.getMessageFromEvent(event);switch(message.type){case this.MESSAGE_READY:this._handleReadyMessage();break;case this.MESSAGE_SUCCESS:this._handleSuccessMessage(message.data);break;case this.MESSAGE_ERROR:this._handleErrorMessage(message.data);break;case this.MESSAGE_COMPLETE:this._handleCompleteMessage(message.data);break;}};this._abort=function(id){if(id in this._ajaxes){this._sendAbortMessage(id);}};this._getAbort=function(id){return $.proxy(function(){this._abort(id);},this);};this.ajax=function(settings){var id=rp.Object.uid();this.targetWindow();this._ajaxes[id]=settings;if(isProxyReady){this._sendRequestMessage(id,settings);}
return{abort:this._getAbort(id)};};});
namespace('rp.betting');rp.betting.RemoteProxy=function(targetWindow){if(arguments.callee._instance){return arguments.callee._instance;}
arguments.callee._instance=this;arguments.callee.$super.call(this);this._targetWindow=targetWindow;};extend(rp.betting.RemoteProxy,rp.betting.AbstractProxy,function($class,$super){this._sendReadyMessage=function(){this.postMessage(this.MESSAGE_READY);};this._sendSuccessMessage=function(id,xhr,textStatus,data){this.postMessage(this.MESSAGE_SUCCESS,{id:id,xhr:xhr,textStatus:textStatus,data:data});};this._sendErrorMessage=function(id,xhr,textStatus){this.postMessage(this.MESSAGE_ERROR,{id:id,xhr:xhr,textStatus:textStatus});};this._sendCompleteMessage=function(id,xhr,textStatus){this.postMessage(this.MESSAGE_COMPLETE,{id:id,xhr:xhr,textStatus:textStatus});};this._requestAjax=function(settings,callbacks){var request=$.extend({},settings,callbacks);return $.ajax(request);};this._handleRequestMessage=function(data){if(data&&data.id){this._ajaxes[data.id]=this._requestAjax(data.settings,{success:$.proxy(function(response,textStatus,xhr){this._sendSuccessMessage(data.id,xhr,textStatus,response);},this),error:$.proxy(function(xhr,textStatus){this._sendErrorMessage(data.id,xhr,textStatus);},this),complete:$.proxy(function(xhr,textStatus){this._sendCompleteMessage(data.id,xhr,textStatus);delete this._ajaxes[data.id];},this)});}};this._handleAbortMessage=function(data){var id=data.id;if(this._ajaxes.hasOwnProperty(id)){this._ajaxes[id].abort();}};this._handleWindowMessage=function(event){var message=this.getMessageFromEvent(event);switch(message.type){case this.MESSAGE_REQUEST:this._handleRequestMessage(message.data);break;case this.MESSAGE_ABORT:this._handleAbortMessage(message.data);break;}};this.ready=function(){this._sendReadyMessage();};});
namespace('rp.betting');rp.betting.ServerProxy=function(targetWindow){if(arguments.callee._instance){return arguments.callee._instance;}
arguments.callee._instance=this;arguments.callee.$super.call(this);this._targetWindow=targetWindow;};extend(rp.betting.ServerProxy,rp.betting.RemoteProxy,function($class,$super){this._url=null;this.property('url',{set:true});this._requestAjax=function(settings,callbacks){var request=$.extend({},{type:'POST',url:this.url(),dataType:'json',data:{'request':settings}});return $super._requestAjax.apply(this,[request,callbacks]);};});
namespace('rp.betting.mint');rp.betting.mint.Error=function(){arguments.callee.$super.apply(this,arguments);};extend(rp.betting.mint.Error,rp.betting.Error,function($class,$super){$class.GENERIC_ERROR=-100;$class.INVALID_BACK_END_REQUEST=-3;$class.INVALID_SESSION_TOKEN=10071;$class.EXPIRED_SESSION_TOKEN=-21;$class.EXPIRED_OR_INVALID_SESSION_TOKEN=106;$class.USERNAME_NOT_FOUND=21;$class.INCORRECT_PASSWORD=22;$class.MONTH_6_SELF_EXCLUSION=23;$class.HOUR_24_SELF_EXCLUSION=24;$class.ACCOUNT_NOT_ACTIVE=25;$class.ACCOUNT_LOCKED=27;$class.NO_BETS_FOUND=35;$class.PAYMENT_AUTHORISATION_FAILED=51;$class.TOP_UP_AMOUNT_LESS_THAN_MINIMUM=52;$class.INVALID_CSC_CV2_NUMBER=53;$class.DAILY_DEPOSIT_LIMIT=54;$class.NO_CARD_DETAILS_REGISTERED=67;$class.PAYMENT_AUTHORISATION_FAILED_2=24005;$class.POCF_NOT_ACCEPTED=24015;$class.GENERIC_BETSLIP_ERROR=70;$class.BETSLIP_CONTAINS_DELAYS=71;$class.INSUFFICIENT_FUNDS=63;$class.STAKE_TOO_LOW=64;$class.STAKE_TOO_HIGH=66;$class.STATUS_CHANGED=1024;$class.PRICE_CHANGED=1025;$class.MISSING_REQUEST_PARAMETER=10070;$class.INVALID_REQUEST_PARAMETER=10071;$class.NONE_DOC_OXI_XML_ERROR='Call to OxiXml failed.';});
namespace('rp.betting.mint');rp.betting.mint.Command=function(name,data){arguments.callee.$super.call(this,name,data||{});};extend(rp.betting.mint.Command,rp.betting.Command,function($class,$super){var mint=rp.betting.mint;MINT_SUCCESS=1;$class.SESSIONS_API='sessions';$class.ACCOUNTS_API='accounts';$class.BETSLIPS_API='betslips';$class.BETS_API='bets';$class.WALLETS_API='wallets';$class.AUTHENTICATE_ACCOUNT=$class.SESSIONS_API+'/tickets';$class.LOGOUT=$class.SESSIONS_API+'/tickets/';$class.GET_ACCOUNT_DETAILS=$class.ACCOUNTS_API+'/me';$class.GET_BALANCE=$class.ACCOUNTS_API+'/me/balance';$class.GET_BET_SLIP=$class.BETSLIPS_API+'/me';$class.PLACE_BET=$class.BETS_API+'/me/multiples';$class.VIEW_BET_HISTORY=$class.BETS_API+'/me';$class.GET_CARD_PAYMENT_DETAILS=$class.WALLETS_API+'/me/methods';$class.MAKE_CARD_PAYMENT=$class.WALLETS_API+'/me';$class.ACCEPT_POCF=$class.ACCOUNTS_API+'/me/flags';this.STATUS_MINT_ERROR='minterror';$class.ERROR_CODES={"25023":mint.Error.GENERIC_ERROR,"23023":mint.Error.GENERIC_ERROR,"25020":mint.Error.PRICE_CHANGED,"23020":mint.Error.PRICE_CHANGED,"25022":mint.Error.STATUS_CHANGED,"23022":mint.Error.STATUS_CHANGED,"25021":mint.Error.STATUS_CHANGED,"23021":mint.Error.STATUS_CHANGED,"25024":mint.Error.STATUS_CHANGED,"23024":mint.Error.STATUS_CHANGED,"23011":mint.Error.STAKE_TOO_LOW,"23012":mint.Error.STAKE_TOO_HIGH,"23010":mint.Error.INSUFFICIENT_FUNDS,"10071":mint.Error.INVALID_SESSION_TOKEN,"20000":mint.Error.USERNAME_NOT_FOUND,"20010":mint.Error.INCORRECT_PASSWORD,"24000":mint.Error.NO_CARD_DETAILS_REGISTERED,"10070":mint.Error.MISSING_REQUEST_PARAMETER,"24015":mint.Error.POCF_NOT_ACCEPTED,"24005":mint.Error.PAYMENT_AUTHORISATION_FAILED_2};$class.determineErrorCode=function(responseCode){return $class.ERROR_CODES[responseCode]||mint.Error.GENERIC_ERROR;};function getError(error){var errorCode=0;var errorCodes=$.map(error,function(value){if(value.faultCode==="10071"){switch(value.faultName){case'who-ticket':return $class.determineErrorCode(value.faultCode);break;case'status':return mint.Error.INVALID_REQUEST_PARAMETER;break;default:return mint.Error.GENERIC_ERROR;break;}}else{return $class.determineErrorCode(value.faultCode);}});var errorString=$.map(error,function(value){return value.faultString;});if($.inArray(mint.Error.STATUS_CHANGED,errorCodes)>=0){errorCode=mint.Error.STATUS_CHANGED;}else if($.inArray(mint.Error.PRICE_CHANGED,errorCodes)>=0){errorCode=mint.Error.PRICE_CHANGED;}else if($.inArray(mint.Error.INSUFFICIENT_FUNDS,errorCodes)>=0){errorCode=mint.Error.INSUFFICIENT_FUNDS;}else if($.inArray(mint.Error.STAKE_TOO_LOW,errorCodes)>=0){errorCode=mint.Error.STAKE_TOO_LOW;}else if($.inArray(mint.Error.STAKE_TOO_HIGH,errorCodes)>=0){errorCode=mint.Error.STAKE_TOO_HIGH;}else if($.inArray(mint.Error.PAYMENT_AUTHORISATION_FAILED_2,errorCodes)>=0){errorCode=mint.Error.PAYMENT_AUTHORISATION_FAILED_2;}else{errorCode=errorCodes[0];}
return new mint.Error(errorCode,errorString[errorCodes.indexOf(errorCode)]);}
this.property('token',{get:function(){if(this.isSuccess()){return this.result().token||null;}},set:function(token){var name=this.name(),data=this.data();if(name===$class.VIEW_BET_HISTORY&&data&&data.searchCriteria){data.searchCriteria.token=token;}else if(name!==$class.AUTHENTICATE_ACCOUNT&&name!==$class.ADDRESS_LOOKUP&&data){data.token=token;}}});this.event(this.EVENT_SUCCESS,{get:function(){var result=this.result(),error;if(result&&result.statusCode!==1){error=result.whoFaults||(result.whoBetslips?result.whoBetslips.whoFaults:false)||(result.whoBets?result.whoBets.whoFaults:false)||false;};if(error){this.status(this.STATUS_MINT_ERROR).result(getError(error).data(result)).error(result);}else{$super.success.apply(this,arguments);}}});this.event(this.EVENT_ERROR,{get:function(result,xhr){if(xhr){var responseText=xhr.responseText,error=false;var response=null;if(responseText){response=JSON.parse(responseText);if(response&&response.statusCode!==1){error=response.whoFaults||false;}}
this.status(this.STATUS_MINT_ERROR).result(getError(error).data(response));}
$super.error.apply(this,this.result());}});this.isMintError=function(){return this._status===this.STATUS_MINT_ERROR;};$class.create=function(name,data){return new $class(name,data);};});
namespace('rp.betting.mint');rp.betting.mint.Provider=function(){if(arguments.callee._instance){return arguments.callee._instance;}
arguments.callee._instance=this;arguments.callee.$super.apply(this,arguments);};extend(rp.betting.mint.Provider,rp.betting.Provider,function($class,$super){var
mint=rp.betting.mint,TYPE=rp.betting.Bet.TYPE,Command=mint.Command;$class.PROVIDER_NAME='WH_OXI';$class.ACCEPTED_POCF_URL_PARAMS='?pocf=A'
this._url=null;this.property('url',{set:true});this._params=null;this.property('params',{set:true});this.property('user',{set:function(user){if(!(user instanceof rp.betting.User)){user=null;}
this._user=user;this.store(this.KEY_USER,this._user);}});var _password='';function createCommand(name,data){function call(event){setCommandSettings(event.target);};var self=$class.instance();var d=new Date();return Command.create(name,$.extend({},data,self.params())).settings({url:self.url()+name,proxy:self.proxy(),type:'POST',dataType:'json',jsonp:null,jsonpCallback:null,timeout:self.timeout(),cache:false}).call(call,self);};function setCommandSettings(command){var self=$class.instance(),settings=command.settings(),name=command.name(),url,type;type=settings.type.toLowerCase();url=rp.url(settings.url);switch(name){case mint.Command.GET_ACCOUNT_DETAILS:case mint.Command.GET_BALANCE:case mint.Command.VIEW_BET_HISTORY:case mint.Command.GET_CARD_PAYMENT_DETAILS:type='get';break;case mint.Command.LOGOUT:type='delete';url.path(url.path()+self.token());break;case mint.Command.ACCEPT_POCF:type='put';url.path(url.path()+$class.ACCEPTED_POCF_URL_PARAMS);break;}
if(name==mint.Command.FLAG){type='PUT';}
settings.headers=$.extend({},settings.headers,{'Accept':'application/json'});if(self.token()&&name!==mint.Command.LOGOUT){settings.headers=$.extend({},settings.headers,{'who-ticket':self.token()});}
if(type!=='get'){var contentType='application/json';if(name===mint.Command.AUTHENTICATE_ACCOUNT||name==mint.Command.MAKE_CARD_PAYMENT){contentType='application/x-www-form-urlencoded';}
settings.headers=$.extend({},settings.headers,{"Content-Type":contentType});}
settings.url=String(url);settings.type=type;command.settings(settings);};function createQueue(command){function timeout(event){event.stopImmediatePropagation();event.target.proceed();};function error(event){var queue=event.target,command=queue.current();if(command.isMintError()){switch(command.result().code()){case mint.Error.INVALID_BACK_END_REQUEST:if(command.result().message()!=mint.Error.NONE_DOC_OXI_XML_ERROR){break;}
case mint.Error.INVALID_SESSION_TOKEN:case mint.Error.EXPIRED_SESSION_TOKEN:case mint.Error.EXPIRED_OR_INVALID_SESSION_TOKEN:if(command.name()!==mint.Command.LOGOUT){this.isReady(true);this.logout();}
break;}}}
var self=$class.instance(),queue=new rp.betting.Queue();for(var i=0,l=arguments.length;i<l;i++){queue.add(arguments[i]);}
queue.error(error,self).timeout(timeout,self);return queue;};function callCommand(){return createQueue.apply(this,arguments).call();}
function AuthenticateAccount(user,password){var self=$class.instance();function success(event){_password=password;var result=event.target.result();this.token(result.whoSessions.ticket);user.token(result.whoSessions.ticket);event.target.result(user);}
var params={username:user.login(),password:encodeURIComponent(password)};return createCommand(Command.AUTHENTICATE_ACCOUNT,params).success(success,self);};function GetAccountDetails(user){function success(event){var command=event.target,customer=command.result().whoAccounts.account,pocf=null;if(customer.flags&&customer.flags.length>0){for(var i=0;i<customer.flags.length;i++){var current=customer.flags[i];if(current.hasOwnProperty('pocf')){pocf=current.pocf;}}}
command.result(user.set({title:customer.title,firstName:customer.firstName,userIdentifier:customer.accountId,pocf:pocf}));}
var self=$class.instance();return createCommand(Command.GET_ACCOUNT_DETAILS).success(success,self);};function GetBalance(user){function success(event){var command=event.target;var customer=command.result().whoAccounts.account;command.result(user.set({balance:customer.balance,currency:customer.currencyCode}));$class.instance().user(user);}
var self=$class.instance();return createCommand(Command.GET_BALANCE).success(success,self);};function Logout(){var self=$class.instance();function success(event){this.token(null);this.user().token(null);}
return createCommand(Command.LOGOUT).success(success,self);};function GetCardPaymentDetails(details){function success(event,result){var method=result.whoWallets.paymentMethods[0];details.set({'payMethodId':method.id,'cardNumber':method.card.number,'maxDepositAmount':method.limits.maxDeposit,'minDepositAmount':method.limits.minDeposit});event.target.result(details);}
var self=$class.instance();return createCommand(Command.GET_CARD_PAYMENT_DETAILS,{}).success(success,self);};function MakeCardPayment(details){function success(event,result){details.set(result);event.target.result(details);}
var self=$class.instance();return createCommand(Command.MAKE_CARD_PAYMENT,{'transactionType':'deposit','id':details.payMethodId(),'cv2':details.csc(),'amount':details.amount()}).success(success,self);};function GetBetHistory(betHistory,ascOrder){var self=$class.instance(),searchCriteria=betHistory.searchCriteria();function getParsedBetHistory(data){var numberOfBets=($.isEmptyObject(data.whoBets))?0:data.whoBets.bet.length,betsExist=(numberOfBets!=0);if(betsExist){if(!ascOrder){var blockNumber=betHistory.searchCriteria().blockNumber()+1;betHistory.searchCriteria().set({'blockNumber':blockNumber});var betsToAdd=[];for(var index in data.whoBets.bet){var bet=data.whoBets.bet[index];var rpBet=new rp.betting.Bet(),isEachWay=bet.leg[0].legType==utils.bet.LABEL_EACHWAY_SHORT,betTypeCode=self.getBetType(bet.betTypeCode),betTypeName=bet.betTypeName,estimatedReturns=null;rpBet.set({'betReference':bet.betId,'betDate':moment(bet.transDateTime,utils.moment.FORMAT_FULL_DATETIME).format(utils.moment.FORMAT_FULL_DATETIME),'receiptId':bet.receipt,'isSettled':bet.settled==="Y",'totalStake':parseFloat(bet.stake),'stake':parseFloat(bet.stakePerLine),'type':betTypeCode,'isEachWay':isEachWay,'betHistoryEW':isEachWay});rpBet.typeName(utils.bet.getBetTypeName(rpBet));if(rpBet.isSettled()){estimatedReturns=parseFloat(bet.winnings);}else if(parseFloat(bet.estimatedReturns)>0){estimatedReturns=parseFloat(bet.estimatedReturns);}
if(estimatedReturns!=null){rpBet.returns(estimatedReturns);}
if(isEachWay&&estimatedReturns==null){rpBet.returns(NaN);}
for(var selectionKey in bet.leg){var selection=bet.leg[selectionKey].part[0];var eachWay=isEachWay?new rp.betting.EachWay():null;rpBet.selection(new rp.betting.Selection({'id':selection.outcomeId,'data':{'eventTypeDesc':selection.eventTypeDescription,'eventDesc':selection.eventDescription,'marketDesc':selection.eventMarketDescription,'selectionDesc':selection.description,'startDateTime':moment(selection.startDateTime,utils.moment.FORMAT_FULL_DATETIME).format(utils.moment.FORMAT_TIME_12_HOURS),'raceId':('r'+selection.eventTypeDescription+selection.startDateTime).replace(/\W/g,'')},'isSP':selection.priceType=='S','price':(selection.priceType!=='S')&&{'num':selection.priceNum,'den':selection.priceDen},'eachWay':eachWay}));}
if(rpBet.isSettled()){if(rpBet.returns()>0){rpBet.label(utils.bet.LABEL_WIN_FULL);}else{rpBet.label(utils.bet.LABEL_LOST_FULL);}}
betsToAdd.push(rpBet);}
betHistory.addBets(betsToAdd);}else{betHistory.lastBetId(data.whoBets.bet[0].betId)}}}
function success(event,result){getParsedBetHistory(result);event.target.result(betHistory);}
return createCommand(Command.VIEW_BET_HISTORY,{"fromDateTime":moment(searchCriteria.fromDate()).sod().format(utils.moment.FORMAT_FULL_DATETIME),"toDateTime":moment(searchCriteria.toDate()).eod().format(utils.moment.FORMAT_FULL_DATETIME),"blockSize":searchCriteria.blockSize(),"blockNum":searchCriteria.blockNumber()!=null?searchCriteria.blockNumber():0,"sortOrder":ascOrder?'A':'D',"settled":'A'}).success(success,self);};function getSuspendedSelections(whoFaults,conditions){var suspendedSelections=[];$.each(whoFaults,function(index,value){if($.inArray(value.faultCode.toString(),conditions)>-1){if($.inArray(value.solution.outcomeId,suspendedSelections)<0){suspendedSelections.push(value.solution.outcomeId);}}});return suspendedSelections;}
function getWhBetslip(betslip){var whBetslip=[],bets=betslip.getBetsWithStake();for(var i=0,l=bets.length;i<l;i++){var bet=bets[i];whBetslip.push(getWhBet(bet,i+1));}
return whBetslip;}
function getWhBet(bet,i){var self=$class.instance();var whBet={betNum:i,betTypeCode:self.getBetTypeCode(bet),stake:parseFloat(bet.stake()).toFixed(2),freeBetId:getWhoFreeBet(bet),leg:getWhoSelections(bet)}
return whBet;}
function getWhoSelections(bet){var selections=bet.selections(),whoSelections=[],selection,whoSelection;for(var i=0,l=selections.length;i<l;i++){selection=selections[i];var part={outcomeId:selection.id(),status:"A",priceType:selection.isSP()?'S':'L',includeInMultiple:selection.data().includeInMultiple}
if(!selection.isSP()){var price=selection.price();$.extend(part,{priceNum:price.num(),priceDen:price.den()});}
whoSelection={legType:bet.isEachWay()?utils.bet.LABEL_EACHWAY_SHORT:utils.bet.LABEL_WIN_SHORT,part:part};whoSelections.push(whoSelection);}
return whoSelections;};function getWhoFreeBet(bet){var freeBets=bet.freeBets(),whoFreeBet='',freeBet;for(var i=0,l=freeBets.length;i<l;i++){freeBet=freeBets[i];if(freeBet.selected()){whoFreeBet=freeBet.id()}}
return whoFreeBet;}
function updateMultiplePrices(betslip,whoFaults,conditions){var solutions=$.map(whoFaults,function(value){if(conditions.faultCode===value.faultCode){return value.solution;}});var bet,selection;var newPrices={};$.each(solutions,function(index,value){newPrices[value.outcomeId]={den:value.priceDen,num:value.priceNum}});var bets=betslip.getSingleBets();for(var i=0,l=bets.length;i<l;i++){bet=bets[i];for(var j=0;j<bet.selections().length;j++){selection=bet.selections()[j];if(newPrices[selection.id()]){selection.data().oldNum=selection.price().num();selection.data().oldDen=selection.price().den();selection.oldPrice(selection.price());selection.price({den:newPrices[selection.id()].den,num:newPrices[selection.id()].num});}}}
return betslip;}
function updateMultipleMinMax(betslip,whoFaults,conditions){var bets=betslip.getBetsWithStake(),bet;$.each(whoFaults,function(index,value){if($.inArray(value.faultCode.toString(),conditions)>-1){bet=bets[value.solution.betNum-1]
var minStake=value.solution.minStake||0,maxStake=value.solution.maxStake||Number.POSITIVE_INFINITY;bet.set({minStake:bet.minStake()||minStake,maxStake:bet.maxStake()!=Number.POSITIVE_INFINITY?bet.maxStake():maxStake});}});return betslip;}
function GetMultipleBetSlip(betslip){var self=$class.instance();function success(event){var command=event.target,whBets=command.result().whoBetslips.bet,whBet,bet,type,types=[],date=utils.moment.getSynchronizedToServerNow(self.settings().serverDateDelta);if(whBets){for(var i=0,l=whBets.length;i<l;i++){whBet=whBets[i];type=self.getBetType(whBet.betTypeCode);types.push(type);if(type!==0){if(type==rp.betting.Bet.TYPE.SINGLE){bet=betslip.getBetBySelectionId(whBet.leg[0].part[0].outcomeId);}else{bet=betslip.getBetByType(type);}
bet.set({minStake:whBet.minStake,maxStake:whBet.maxStake});var whFreeBets=whBet.freeBet||[],freeBets=[],usedFreeBets=bet.freeBets();for(var j=0;j<whFreeBets.length;j++){var whoFreeBet=whFreeBets[j],expiryDate=moment(whoFreeBet.expiryDateTime,utils.moment.FORMAT_FULL_DATETIME),selected=false,freebetId=whoFreeBet.freebetId;if(date.valueOf()<expiryDate.format(utils.moment.FORMAT_FULL_DATETIME)){if(usedFreeBets){for(var index=0,len=usedFreeBets.length;index<len;index++){var usedFreeBet=usedFreeBets[index];if(freebetId==usedFreeBet.id()){selected=usedFreeBet.selected();}}}
freeBets.push({id:freebetId,name:whoFreeBet.offerName,amount:parseFloat(whoFreeBet.value)||0,expires:expiryDate,selected:selected});}}
bet.freeBets(freeBets);};};var indexesToDelete=[];$.each(betslip.bets(),function(index,value){if($.inArray(value.type(),types)<0){indexesToDelete.unshift(index);}})
$.each(indexesToDelete,function(index,value){betslip.bets().splice(value,1);})}
command.result(betslip);}
function error(event){var command=event.target,error=command.result(),errorCode=error.code(),data=error.data();if(errorCode===mint.Error.PRICE_CHANGED||errorCode===mint.Error.STATUS_CHANGED){data.statusCode=1;event.stopImmediatePropagation();command.result(data).success(data);}}
return createCommand(Command.GET_BET_SLIP,{whoBetslips:{leg:getLegForBetslips(betslip)}}).success(success,self).error(error,self);}
function getLegForBetslips(betslip){var legs=[],bets=betslip.getSingleBets(),bet,selection,leg;for(var i=0,l=bets.length;i<l;i++){bet=bets[i];selection=bet.selections()[0];if(!selection.data().isSuspended){var part={outcomeId:selection.id(),status:"A",priceType:selection.isSP()?'S':'L',includeInMultiple:selection.data().includeInMultiple}
if(!selection.isSP()){var price=selection.price();$.extend(part,{priceNum:price.num(),priceDen:price.den()});}
leg={legType:bet.isEachWay()?utils.bet.LABEL_EACHWAY_SHORT:utils.bet.LABEL_WIN_SHORT,part:part};legs.push(leg);}}
return legs;};function PlaceMultipleBet(betslip){var self=$class.instance();function success(event){var command=event.target,betPlaced=command.result().whoBets.betPlaced,betsWithStake=betslip.getBetsWithStake();if(betPlaced){for(var j=0;j<betPlaced.length;j++){var whoPlacement=betPlaced[j],bet=betsWithStake[j],selections=bet.selections(),receiptId=whoPlacement.betReceipt,betReference=whoPlacement.betId,totalStake=whoPlacement.totalStake,betDate=moment().add('ms',utils.date.timeZoneDiff(self.settings().timeZone)).format(utils.moment.FORMAT_FULL_DATETIME);if(whoPlacement.placedDateTime){betDate=moment(whoPlacement.placedDateTime,utils.moment.FORMAT_FULL_DATETIME).add('ms',utils.date.timeZoneDiff(self.settings().timeZone)).format(utils.moment.FORMAT_FULL_DATETIME);}
bet.set({receiptId:receiptId,betReference:betReference,betDate:betDate,totalStake:parseFloat(totalStake),typeName:utils.bet.getBetTypeName(bet)});for(var i=0,l=selections.length;i<l;i++){data=selections[i].data();var courseName=data.courseName,eventTime=data.time?moment(data.time,utils.moment.FORMAT_TIME_24_HOURS).format(utils.moment.FORMAT_TIME_12_HOURS):'',eventDesc=eventTime+' '+courseName;selections[i].data($.extend(data,{selectionDesc:data.selectionDesc||data.horseName,eventDesc:data.eventDesc||eventDesc}));}}}
event.target.result(betslip);callCommand(GetBalance(this.user()));};function error(event){var error=event.target.result(),errorCode=error.code(),data=error.data();if(errorCode===mint.Error.PRICE_CHANGED){error.data(updateMultiplePrices(betslip,data.whoBets.whoFaults,{faultCode:"23020"}));}
if(errorCode===mint.Error.STATUS_CHANGED){error.data(getSuspendedSelections(data.whoBets.whoFaults,["23021","23022","23024"]));}
else if(errorCode===mint.Error.STAKE_TOO_LOW||errorCode===mint.Error.STAKE_TOO_HIGH){error.data(updateMultipleMinMax(betslip,data.whoBets.whoFaults,["23011","23012"]));}}
var multipleBet={whoBets:{bet:getWhBetslip(betslip)}}
return createCommand(Command.PLACE_BET,multipleBet).success(success,self).error(error,self);}
function UpdateUserPocfFlag(user){var self=this;var classInstance=$class.instance();function success(){if(user.flags()){for(var i=0,len=user.flags().length;i<len;i++){if(user.flags()[i].pocf){user.flags()[i].pocf='Y';break;}}
classInstance.user(user);}}
return createCommand(Command.FLAG,{pocf:'A'}).success(success,self);}
this.init=function(){var user=this.store(this.KEY_USER);if(user){var userHasAtLeastOneProperty=false;for(var propertyName in user){userHasAtLeastOneProperty=true;break;}
if(userHasAtLeastOneProperty){if(typeof user.pocf!=='undefined'){this.user(new rp.betting.mint.User(user));this.getBalance();}else{this.store(this.KEY_USER,{});this.init();}}}
this.isReady(true);};this.login=function(userName,password){function success(event){this.user(event.target.result()).trigger(this.EVENT_LOGIN,this.user());}
var user=new rp.betting.mint.User({login:userName});if(this.user()){return createQueue(Logout(),AuthenticateAccount(user,password),GetAccountDetails(user),GetBalance(user)).success(success,this).call();}else{return createQueue(AuthenticateAccount(user,password),GetAccountDetails(user),GetBalance(user)).success(success,this).call();}};this.logout=function(){function success(event){this.user(null).trigger(this.EVENT_LOGOUT);}
return createQueue(Logout()).success(success,this).call();};this.logoutLite=function(){this.logout();}
this.getBetSlip=function(betslip){if(betslip instanceof rp.betting.BetSlip){return createQueue(GetMultipleBetSlip(betslip)).call();}else{throw new Error('Instance of rp.betting.BetSlip expected.');}};this.placeBet=function(betslip){if(betslip instanceof rp.betting.BetSlip){return createQueue(PlaceMultipleBet(betslip)).call();}else{throw new Error('Instance of rp.betting.BetSlip expected.');}};this.getBetHistory=function(betHistory){if(!(betHistory instanceof rp.betting.BetHistory)){throw new Error('Instance of rp.betting.BetHistory expected.');}
var commands=[];if(betHistory.lastBetId()==null){commands.push(GetBetHistory(betHistory,true));}
commands.push(GetBetHistory(betHistory));return callCommand.apply(null,commands);};this.getPaymentDetails=function(){var details=new rp.betting.PaymentDetails();return callCommand(GetCardPaymentDetails(details));};this.makePayment=function(paymentDetails){if(!(paymentDetails instanceof rp.betting.PaymentDetails)){throw new Error('Instance of rp.betting.PaymentDetails expected.');}
return callCommand(MakeCardPayment(paymentDetails),GetBalance(this.user()));};this.updateUserPocfFlag=function(){return callCommand(UpdateUserPocfFlag(this.user()));}
this.getBalance=function(){return callCommand(GetBalance(this.user()));};$class.instance=function(options){return new $class(options);};this.addressSearch=function(params){return createCommand(Command.ADDRESS_LOOKUP,params).call();};this.acceptPocf=function(){var self=this;var user=this.user();var classInstance=$class.instance();function success(data){user.set({pocf:"Y"});classInstance.user(user);}
return createCommand(Command.ACCEPT_POCF).success(success,self).call();};});
namespace('rp.betting.mint');rp.betting.mint.User=function(){arguments.callee.$super.apply(this,arguments);};extend(rp.betting.mint.User,rp.betting.User,function($class,$super){this._pocf=null;this.property('pocf',{set:true});this.toJSON=function(){return this.get("login","token","title","firstName","balance","currency","userIdentifier","refreshToken","pocf");};});
var wh=wh||{};wh.Utils={MONTHS:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],AMPM:['am','pm'],getPriceType:function(){return utils.stat.getCookie('userPrefOdds');},toDayStart:function(date){date.setHours(0);date.setMinutes(0);date.setSeconds(0);date.setMilliseconds(0);return date;},toDayEnd:function(date){date=this.toDayStart(date);date.setDate(date.getDate()+1);date.setMilliseconds(-1);return date;},formatNumber:function(number,digits){var s=Number(number).toString();while(s.length<digits){s='0'+s;}
return s;},formatDate:function(date){return[[this.formatNumber(date.getFullYear(),4),this.formatNumber(date.getMonth()+1,2),this.formatNumber(date.getDate(),2)].join('-'),[this.formatNumber(date.getHours(),2),this.formatNumber(date.getMinutes(),2),this.formatNumber(date.getSeconds(),2)].join(':')].join(' ');},dateFromString:function(dateString){var dateArray=String(dateString).split(/\D/);var year=Number(dateArray[0])||0;var month=dateArray[1]-1||0;var day=Number(dateArray[2])||0;var hour=Number(dateArray[3])||0;var minutes=Number(dateArray[4])||0;var seconds=Number(dateArray[5])||0;return new Date(year,month,day,hour,minutes,seconds);},formatUserDate:function(dateString){var date=this.dateFromString(dateString);var day=date.getDate();var month=date.getMonth();var year=date.getFullYear();var hours=date.getHours()%12;var minutes=this.formatNumber(date.getMinutes(),2);var suffix=this.AMPM[Math.floor(date.getHours()/12)];return[day,this.MONTHS[month],year,hours+':'+minutes+suffix].join(' ');},formatDateForBetsHistory:function(dateString){var date=this.dateFromString(dateString);var hours=date.getHours();hours=hours>12?hours%12:hours;var minutes=this.formatNumber(date.getMinutes(),2);var suffix=this.AMPM[Math.floor(date.getHours()/12)];var day=date.getDate();var month=this.MONTHS[date.getMonth()];var year=date.getFullYear();var res=[hours+':'+minutes+suffix+', ',day,month+', ',year].join(' ');return res;},formatFloat:function(number){return(Number(number)||0).toFixed(2);},formatCardNumber:function(cardNumber){return String(cardNumber||'').replace(/(\d+)?(\D+)(\d+)/g,function($0,$1,$2,$3){return[$1||'',$.trim($2.replace(/./g,'*').replace(/(.{4})/g,'$1 ')),$3].join(' ');});},getUrlScheme:function(url){var match=String(url).match(/^([a-z][a-z0-9\+\-\.]+):/);return match?match[1]:'';},getUrlOrigin:function(url){var match=String(url).match(/^([a-z][a-z0-9\+\-\.]+:\/\/[^\/]+)/);return match?match[1]:'';},capitalizeName:function(sourceString){var result=sourceString.split('_');for(var i=0;i<result.length;i++){result[i]=result[i].charAt(0).toUpperCase()+result[i].slice(1).toLowerCase();}
return result.join(' ');}};(function($){var prefix='id-'+Number(new Date).toString(36);var count=1;wh.Utils.getUID=function(){return prefix+(count++).toString(36);};var
checkboxData='wh_checkbox';function transformCheckbox(){var $this=$(this);if(!$this.data(checkboxData)){var data={};$this.data(checkboxData,data).bind('click',transformCheckbox.handleCheckboxClick).hide();data.$label=$('<label>').insertAfter($this).bind('click',transformCheckbox.handleLabelClick).addClass($this.attr('type')).data(checkboxData,{$checkbox:$this});}}
transformCheckbox.handleCheckboxClick=function(){$(this).data(checkboxData).$label.toggleClass('checked',!this.checked);};transformCheckbox.handleLabelClick=function(){$(this).data(checkboxData).$checkbox.click();};var
placeholderData='wh_placeholder';function transformPlaceholder(){var $this=$(this);if($this.attr('placeholder')&&!$this.data(placeholderData)){var data={};var text=$this.attr('placeholder');$this.wrap('<div class="placeholder-wrapper" />').data(placeholderData,data).bind('focus',transformPlaceholder.handleFocus).bind('blur change',transformPlaceholder.handleBlur).attr('id',$this.attr('id')||wh.Utils.getUID());data.$label=$('<label/>').insertAfter($this).attr('for',$this.attr('id')).bind('mousedown',transformPlaceholder.handleMouseDown).addClass('placeholder');data.$label.text(text);$this.change();$this.removeAttr('placeholder');}}
transformPlaceholder.handleFocus=function(){$(this).data(placeholderData).$label.hide();};transformPlaceholder.handleBlur=function(){var $this=$(this);$this.data(placeholderData).$label.toggle($this.val()=='');};transformPlaceholder.handleMouseDown=function(e){e.preventDefault();};$.fn.wh_transformInputs=function(){return this.each(function(){$('input[type=checkbox].styled',this).each(transformCheckbox);$('input[placeholder!=""]',this).each(transformPlaceholder);});};}(jQuery));
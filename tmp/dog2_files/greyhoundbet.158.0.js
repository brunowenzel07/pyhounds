
var webApp=webApp||{};webApp.sortByCollection={number:'Horse number',draw:'Draw',odds:'Odds',tips:'Tips',rpr:'RP Rating',ts:'Topspeed',weight:'Weight',age:'Age',name:'Horse A - Z'};webApp.oddsCollection={fractional:'Fractional',decimal:'Decimal'};webApp.commentsCollection={'true':'Show','false':'Hide'};webApp.bookiesCollection={wh:{name:'William Hill',diffName:'WH_OXI',terms:webApp.WH_TERMS_REDIRECT_URL,webSite:'WilliamHill.com',openAccountUrl:'#wh-register',id:'B16'},ladb:{name:'Ladbrokes',diffName:'LADB',terms:webApp.LADB_TERMS_REDIRECT_URL,webSite:'Ladbrokes.com',openAccountUrl:'#ladb-home/action=registration',id:'B11'}};
var webApp=webApp||{};webApp.sortByCollection=$.extend(webApp.sortByCollection||{},{number:'Trap',topSpeed:'Topspeed'});
var greyhoundbet=greyhoundbet||{};greyhoundbet.predictorSettings=(function(){var dogImageWidth=webApp.isMobile?106:150;var pricesSidebarWidth=64;var averageTimeDiff=0.36;var windowWidth=$(window).width();var raceLineWidth=windowWidth-pricesSidebarWidth;var raceLineLength=(raceLineWidth-dogImageWidth)/dogImageWidth;return{raceLineLength:raceLineLength,dogSize:dogImageWidth/(windowWidth-pricesSidebarWidth)*100,scale:raceLineLength/averageTimeDiff}})();
var webApp=webApp||{};webApp.GaEventTracker=function(){window._gaq=window._gaq||[];var _eventsConfig={};var _eventCustomVars={};var _eventVarSlotNum=0;var _latestEvent=[];var _deviceOrientation='';this.EVENT_CLICK_TRACK_EVENT='click.trackEvent';var CUSTOM_VAR_SCOPE_PAGE=3;this.ATTR_EVENT_ID='data-eventid';this.ATTR_EVENT_LABEL='data-eventlabel';this.setEventsConfig=function(config){_eventsConfig=config;return this;};this.setDeviceOrientation=function(orientation){_deviceOrientation=orientation;};this._pushCall=function(call,isParams){window._gaq.push(call);};this.trackEvent=function(category,action,label,value,noninteraction){var call=['_trackEvent'];if(!category||!action){throw{name:'ParamError',message:'Event category and action are required'};}
call.push(category,action);if(typeof label!="undefined"){call.push(label);}
if(typeof value!="undefined"){call.push(value);}
if(typeof noninteraction!="undefined"){call.push(noninteraction);}
this.setCustomVar(1,_deviceOrientation,category+':'+action,CUSTOM_VAR_SCOPE_PAGE);this._pushCall(call);_latestEvent=$.merge([],arguments);};this.trackEventById=function(eventId,label){};this.trackEventByElement=function($element){var eventId=$element.data('eventid'),eventLabel=$element.data('eventlabel');this.trackEventById(eventId,eventLabel);};this.setCustomVar=function(slot,name,value,scope){var call=['_setCustomVar'];if(!slot||!name||!value){throw{name:'ParamError',message:'Variable slot, name and value are required'};}
call.push(slot,name,value);if(typeof scope!="undefined"){call.push(scope);}
this._pushCall(call,true);};this.trackChangeOrientation=function(orientation){this.setDeviceOrientation(orientation);if(_latestEvent.length){this.trackEvent.apply(this,_latestEvent);}};this.getEventAttrs=function(eventId,label){var eventAttrs='';eventAttrs+=this.getEventIdAttr(eventId);if(label){eventAttrs+=' '+this.getEventLabelAttr(label);}
return eventAttrs;};this.getEventIdAttr=function(eventId){return this.ATTR_EVENT_ID+'='+eventId;};this.getEventLabelAttr=function(label){return this.ATTR_EVENT_LABEL+'='+JSON.stringify(label,'"',"-");};this.bindEventTracking=function($content){var $bindCollection=[];var context=this;if(!$content||$content.length==0){return;}
$bindCollection=$content.find('['+this.ATTR_EVENT_ID+']');if(!$bindCollection.length){return;}
$bindCollection.bind(this.EVENT_CLICK_TRACK_EVENT,function(event){context.processElem(this,event);});};this.processElem=function(elem,event){var $elem=$(elem);var eventId=$elem.attr(this.ATTR_EVENT_ID);var label=$elem.attr(this.ATTR_EVENT_LABEL);if(!eventId){return;}
this.trackEventById(eventId,label);};this.getTrackingId=function(){if(webApp.isIosWrapper&&webApp.isIPad){return webApp.IPAD_WRAPPER_GA_ACCOUNT_ID;}else if(webApp.isTablet){return webApp.TABLET_GA_ACCOUNT_ID;}else{return webApp.SERVER_SERVER_GA_TRACKER_ID;}};};
var webApp=webApp||{};webApp.GaEventTrackerSender=function(eventTracker){this.eventTracker=eventTracker;this.operate=function(method,params){if(this[method]){this[method](params);}};};
var webApp=webApp||{};webApp.prefBookmaker=(function(){var bookies={'wh':'pref_wh','ladb':'pref_ladb'};return{sessionPrefBookmaker:'',get:function(){var bookie=!!this.sessionPrefBookmaker?this.sessionPrefBookmaker:webApp.userSettings.get('bookie');return!!bookie?bookie:'wh';},set:function(newBookie){var currentBookie=this.get();var isBookieChanged=!(newBookie&&currentBookie==newBookie),$Body=$('body');if(newBookie){if(!bookies.hasOwnProperty(newBookie)||!isBookieChanged){return;}
$Body.removeClass(bookies[currentBookie]);}else{newBookie=currentBookie;}
$Body.addClass(bookies[newBookie]);var bookieParams=webApp.bookieCollection.getBookieParams(newBookie);webApp.PREFERRED_BOOKMAKER=bookieParams.diffName;diffusion.utils.topic.setPreferredBookmaker(webApp.PREFERRED_BOOKMAKER);this.sessionPrefBookmaker=newBookie;webApp.userSettings.set('bookie',newBookie);if(isBookieChanged){$(window).trigger('changebookie',[newBookie]);webApp.whRadio.stop();}},setWithMessage:function(newBookieName,message){webApp.prefBookmaker.set(newBookieName);webApp.confirmMessage.show(message);}};})();
var webApp=webApp||{};webApp.UserBalanceHelper={init:function($block){var show=webApp.userSettings.get('showUserBalance');var userBal=$block.find('#userBalance');var showBal=$block.find('#showBalance');var userStat=$block.find('#userStat');if(show){userBal.show();showBal.hide();}else{userBal.hide();showBal.show();}
userStat.click(function(){webApp.UserBalanceHelper.toggle();});},toggle:function(){var show=webApp.userSettings.get('showUserBalance');webApp.userSettings.set('showUserBalance',!show);if(!show){$('#userBalance').show();$('#showBalance').hide();}else{$('#userBalance').hide();$('#showBalance').show();}}};
var webApp=webApp||{};webApp.SwipeToEditPlugin=function(selector){var EVENT_NS='.swipeToEditNs';var RESIZE_EVENT='resize'+EVENT_NS+' '+
webApp.EVENT_CHANGE_ORIENTATION+EVENT_NS;var SWIPE_DIRECTION_ON='left';var SWIPE_DIRECTION_OFF='right';var me=this;var $editedEl=null;var config;var clickCapturingStrategy;this.init=function(cfg){config=getDefaultConfig();if(cfg){$.extend(config,cfg);}
clickCapturingStrategy=webApp.swipeToEdit[config.captureClickStrategy];this._getSwipeElementsBySelector().on('swipe',function(e,direction,swipeTime){if(isSwipeTimeValid(swipeTime)&&SWIPE_DIRECTION_ON===direction){me.switchToEditMode($(this));}});};this.beforeEditModeOn=function($editedEl){};this.afterEditModeOn=function($editedEl){};this.leaveEditMode=function(){if(isInEditMode()){clickCapturingStrategy.destroy();stopTrackingEvents();this.onLeaveEditMode($editedEl);$editedEl=null;}};this.onLeaveEditMode=function(){};this.switchToEditMode=function($el){if(isInEditMode()){return;}
if(false===me.beforeEditModeOn($el)){return;}
$editedEl=$el;clickCapturingStrategy.init($el,$.proxy(me.leaveEditMode,me),config.captureClickStrategyOptions);trackSwipe($el);me.afterEditModeOn($el);};this._getSwipeElementsBySelector=function(){return $(selector);};var getDefaultConfig=function(){return{captureClickStrategy:'nonCapturingStrategy',timeThreshold:800,captureClickStrategyOptions:{trackClickOverlapping:true,clickOverlappingThreshold:14}};};var trackSwipe=function($el){$el.on('swipe',function(e,direction,swipeTime){if(isSwipeTimeValid(swipeTime)&&SWIPE_DIRECTION_OFF===direction){me.leaveEditMode();}});};var isSwipeTimeValid=function(deltaTime){return(deltaTime<config.timeThreshold);};var isInEditMode=function(){return!!$editedEl;};var stopTrackingEvents=function(){$(window).off(RESIZE_EVENT);$(document.body).off(EVENT_NS);$editedEl.off(EVENT_NS);};};
var webApp=webApp||{};(function(){webApp.swipeToEdit=webApp.swipeToEdit||{};var EVENT_NS='.swipeToEditNs';var CLICK_OUTSIDE_SELECTION_EVENT;var leaveEditModeCallback;var config;webApp.swipeToEdit.nonCapturingStrategy={init:function($el,cb,cfg){CLICK_OUTSIDE_SELECTION_EVENT=webApp.EVENT_TAP_START+EVENT_NS;leaveEditModeCallback=cb;trackClickOutsideSwipedElement($el);config=cfg||{};},destroy:function(){}};var trackClickOutsideSwipedElement=function($el){$(document.body).on(CLICK_OUTSIDE_SELECTION_EVENT,function(e){if(!($el.has(e.target).length||isClickOverlapsEl($el,e))){leaveEditModeCallback();}});};var isClickOverlapsEl=function($el,ev){if(!config.trackClickOverlapping){return true;}
var clickX;var clickY;if(ev.originalEvent.touches){clickX=ev.originalEvent.touches[0].pageX;clickY=ev.originalEvent.touches[0].pageY;}else if(ev.pageX!==undefined){clickX=ev.pageX;clickY=ev.pageY;}else{return false;}
var elTop=$el.offset().top;var elLeft=$el.offset().left;var elBottom=elTop+$el.outerHeight();var elRight=elLeft+$el.outerWidth();var minDelta=Math.min(dist(clickX,elLeft),dist(clickX,elRight),dist(clickY,elTop),dist(clickY,elBottom));return(minDelta<config.clickOverlappingThreshold);};var dist=function(a,b){return Math.abs(a-b);};}());
var webApp=webApp||{};webApp.PriceHandlerHelper=function(config){var _setEachWay=function(eachWay){_eachWay=eachWay;};var _setBOG=function(data){_BOG=(data.data[0]==='1');};var _subscribePrices=function(){if(_topic===''){return;}
var listener=new webApp.SimplePriceListener({price:$.proxy(function(data){_acceptPrice(data);},this),eachWay:$.proxy(function(data){_setEachWay(data);},this),bestOdds:$.proxy(function(data){_setBOG(data);},this)});DiffusionConnector.subscribe(_topic,listener,[["\/PRC","(\/PRC)?"]]);_diffusionListener=listener;};this.unsubscribePrices=function(){DiffusionConnector.unsubscribe(_diffusionListener);};var _trackClick=function(selection){var eventTracker=webApp.eventTracker;var bookie=webApp.bookieCollection.getCurrentBookieParams();var eventLabel=selection.data().courseName+' '+moment.unix(selection.data().raceTs).utc().format('h:mm')+', '+selection.data().selectionName
+' - '+bookie.name+' - '+_trackingLabel;eventTracker.trackEventById('bets_price_click',eventLabel);};var _acceptPrice=function(price){price.price=price.toString();var
priceBoxId=_selectorPrefix+price.selectionName,selectionName=_selectionNameCallback('diffusionName',price.selectionName).name||'',priceButtonSelector='#'+priceBoxId+' span';if(!selectionName){return;}
var bookie=webApp.bookieCollection.getCurrentBookieParams();var $button=webApp.viewManager.renderTpl('price-button',{price:price,bookie:bookie});var selectionData={selectionName:selectionName,raceTs:price.raceTs};$.extend(selectionData,_selectionData);var selection=new rp.betting.Selection({id:price.selectionId,price:price.fractional==='SP'?null:{num:price.numerator,den:price.denominator},isSP:!!(price.fractional==='SP'),data:selectionData});if(!price.isSuspended){$button.bind('click.betClick',$.proxy(function(){webApp.registry.set('backUrlHash',_backUrl);_clickReportCallback(price);_trackClick(selection);selection.eachWay(_eachWay);selection.data().isBOG=_BOG;webApp.SelectionsManager.processPriceClick(selection,priceButtonSelector,_firstSelectionCallback,bookie);},this));}
$('#'+priceBoxId).html($button);webApp.SelectionsManager.getSelections().length&&webApp.SelectionsManager.isSelected(selection)&&webApp.SelectionsManager.highlightSelectionPrice(priceButtonSelector);};var _topic=config.topic;var _diffusionListener=config.diffusionListener;var _selectionData=config.selectionData;var _selectorPrefix=config.selectorPrefix;var _trackingLabel=config.trackingLabel;var _backUrl=config.backUrl;var _clickReportCallback=config.clickReportCallback;var _selectionNameCallback=config.selectionNameCallback;var _firstSelectionCallback=config.firstSelectionCallback;var _eachWay=null,_BOG=null;_subscribePrices();};
var webApp=webApp||{};webApp.WhRegisterValidation=function($forms){var _showErrors=function(errorMap,errorList){var firstError=errorList[0];if(typeof(firstError)=='undefined'){return;}
$(firstError.element).addClass('error');alert(firstError.message);};jQuery.validator.addMethod("tel",function(value,element){var pattern=new RegExp('^[0-9\-\(\)\+]+$');return pattern.test(value);});var requiredMessage='This is a required field',lenghts={password:[6,15],login:[6,15],name:[2,60],surname:[2,60],phone:[6]},minLengthMessage='Minimum length is %s%.',maxLengthMessage='Maximum length is %s%.';$forms[0].validate({onfocusout:false,onkeyup:false,onsubmit:false,showErrors:_showErrors,rules:{firstName:{required:true,minlength:lenghts.name[0],maxlength:lenghts.name[1]},surname:{required:true,minlength:lenghts.surname[0],maxlength:lenghts.surname[1]},day:'required',month:'required',year:'required',email:{required:true,email:true},tel:{required:true,tel:true,minlength:lenghts.phone[0]},title:'required'},messages:{firstName:{maxlength:maxLengthMessage.replace('%s%',lenghts.name[1]),minlength:minLengthMessage.replace('%s%',lenghts.name[0]),required:requiredMessage},surname:{maxlength:maxLengthMessage.replace('%s%',lenghts.surname[1]),minlength:minLengthMessage.replace('%s%',lenghts.surname[0]),required:requiredMessage},email:{email:'Not a valid email address',required:requiredMessage},tel:{minlength:minLengthMessage.replace('%s%',lenghts.phone[0]),required:requiredMessage,tel:'Not a valid phone number'},title:{required:requiredMessage},day:{required:requiredMessage},month:{required:requiredMessage},year:{required:requiredMessage}}});$forms[1].validate({onfocusout:false,onkeyup:false,onsubmit:false,showErrors:_showErrors,rules:{address1:'required',city:'required',country:'required',postcode:'required'},messages:{address1:{required:requiredMessage},city:{required:requiredMessage},country:{required:requiredMessage},postcode:{required:'Postcode/ZIP'}}});$forms[2].validate({onfocusout:false,onkeyup:false,onsubmit:false,showErrors:_showErrors,rules:{login:{required:true,minlength:lenghts.login[0],maxlength:lenghts.login[1]},password:{required:true,minlength:lenghts.password[0],maxlength:lenghts.password[1]},confirmation:{equalTo:'#password'},agree:'required',answer:'required',currency:'required',question:'required'},messages:{login:{required:requiredMessage,maxlength:maxLengthMessage.replace('%s%',lenghts.login[1]),minlength:minLengthMessage.replace('%s%',lenghts.login[0])},password:{required:requiredMessage,maxlength:maxLengthMessage.replace('%s%',lenghts.password[1]),minlength:minLengthMessage.replace('%s%',lenghts.password[0])},confirmation:{equalTo:'Passwords must match'},question:{required:'Please specify a security question'},answer:{required:'Please provide an answer to your security question'},currency:{required:requiredMessage},agree:{required:'You need to accept Terms & Conditions'}}});};
var webApp=webApp||{};webApp.deviceDependentSettings=(function(){var DEVICE_TABLET='tablet';var DEVICE_MOBILE='mobile';var currDeviceType=null;var settingsSheme=function(){return{ladbApiKey:''};};var mobileSettingsSet=new settingsSheme();mobileSettingsSet.ladbApiKey='l7xx57db2af1975044948cc37c841e86ffa6';var tabletSettingsSet=new settingsSheme();tabletSettingsSet.ladbApiKey='LADa36ee65ef357406c83404bfe789859d9';var devicesSettings={};devicesSettings[DEVICE_MOBILE]=mobileSettingsSet;devicesSettings[DEVICE_TABLET]=tabletSettingsSet;var getter=function(property){return function(){return currDeviceType&&devicesSettings[currDeviceType][property]||null};};var result={};var settingsScheme=new settingsSheme();for(var property in settingsScheme){result[property]=new getter(property);}
result.setDeviceTypeTablet=function(){currDeviceType=DEVICE_TABLET;};result.setDeviceTypeMobile=function(){currDeviceType=DEVICE_MOBILE;};result.setLadbApiKey=function(key){mobileSettingsSet.ladbApiKey=key;};return result;})();
var webApp=webApp||{};webApp.whRadio=(function(){var mediaElement=null;var suspededEventRecieved=null;var playingEventRecieved=null;var playEventRecieved=null;var clientOnPlayingHandler=null;var isPlaying=false;var mediaElementSrc=null;var desktopRadio=null;return{play:function(DOMMediaElement){if(webApp.HorseDetailsController){DOMMediaElement.append('<audio id="whRadioAudio" src="http://rp.whill.tscplayer.net/wh/whr/mp3.m3u" preload="auto" ></audio>');}
else{DOMMediaElement.append('<audio id="whRadioAudio" src="http://rp.whill.tscplayer.net/wh-hls/dogs/playlist.m3u8" preload="auto" ></audio>');}
mediaElement=document.getElementById('whRadioAudio');var context=this;mediaElement.addEventListener('play',function(){playEventRecieved=true;});mediaElement.addEventListener('suspend',function(){suspededEventRecieved=true;});mediaElement.addEventListener('playing',function(){playingEventRecieved=true;if(!context.isPlaying()){context.stop();}else if(typeof clientOnPlayingHandler=='function'){clientOnPlayingHandler();}});playingEventRecieved=false;playEventRecieved=false;isPlaying=true;mediaElement.play();},stop:function(){if(!mediaElement){return;}
$('#whRadioAudio').remove();playingEventRecieved=false;playEventRecieved=false;suspededEventRecieved=false;isPlaying=false;mediaElement.pause();mediaElement.src='';},setOnPlayingCallBack:function(handler){clientOnPlayingHandler=handler;},isPlaying:function(){return isPlaying;},initDesktopRadio:function(DOMMediaElement){var context=this;$(window).bind('changebookie',function(){if(webApp.prefBookmaker.get()==='ladb'){context.stopDesktopRadio();isPlaying=false;}});if(navigator.userAgent.toLowerCase().indexOf('firefox')!==-1){DOMMediaElement.append('<video id="radioPlayer" height="100" width="100" type="video/rtmp" src="rtmp://rp.whill.tscplayer.net/wh/dogs"></video>');}
else{DOMMediaElement.append('<video id="radioPlayer" height="0" width="0" ><source type="video/rtmp" src="rtmp://rp.whill.tscplayer.net/wh/dogs" /></video>');}
desktopRadio=new MediaElementPlayer("#radioPlayer",{features:[],alwaysShowControls:false});},playDesktopRadio:function(){desktopRadio.setSrc("rtmp://rp.whill.tscplayer.net/wh/dogs");desktopRadio.play();isPlaying=true;},stopDesktopRadio:function(){desktopRadio.pause();isPlaying=false;}};})();
var webApp=webApp||{};webApp.bookieCollection=(function(){var _availableProviders={};var _currentProvider=null;var _getWilliamHillProvider=function(){var mintUrl=webApp.WH_API_URL,mintScheme=utils.string.url(mintUrl).scheme,windowScheme=utils.string.url(window.location).scheme,serverTimestamp=webApp.SERVER_TIMESTAMP,localTimestamp=((new Date()).getTime()/1000),timeDelta=serverTimestamp-localTimestamp,proxy,bookieParams=webApp.bookieCollection.getBookieParams('wh');proxy=new rp.betting.LocalProxy(webApp.SERVER_WH_PROXY_URL);return new rp.betting.mint.Provider({url:mintUrl,proxy:proxy,params:{deviceType:webApp.isTablet?'tablet':'mobile'},settings:{serverDateDelta:timeDelta,timeZone:webApp.SERVER_TIMEZONE,bookmakerId:bookieParams.id,gaSiteCode:webApp.SERVER_GA_TRACKER_ID,affiliateId:webApp.AFFILIATE_ID,minStake:0.03}});};var _getLadbrokesProvider=function(){namespace('rp.betting.ladbrokes');var serverTimestamp=webApp.SERVER_TIMESTAMP,localTimestamp=((new Date()).getTime()/1000),timeDelta=serverTimestamp-localTimestamp,ladbCommand=rp.betting.ladbrokes.Command,apiVersions={};apiVersions[ladbCommand.CUSTOMER_API]=(webApp.LADB_CUSTOMER_API_VERSION||'');apiVersions[ladbCommand.BETTING_API]=(webApp.LADB_BETTING_API_VERSION||'');apiVersions[ladbCommand.BANKING_API]=(webApp.LADB_BANKING_API_VERSION||'');apiVersions[ladbCommand.SPORTSBOOK_API]=(webApp.LADB_SPORTSBOOK_API_VERSION||'');return new rp.betting.ladbrokes.Provider({url:'https://api.ladbrokes.com/',apiVersions:apiVersions,params:{"locale":"en-GB","api-key":webApp.deviceDependentSettings.ladbApiKey()},settings:{apiKey:webApp.deviceDependentSettings.ladbApiKey(),redirectUrl:webApp.LADB_REDIRECT_URL,timeZone:webApp.SERVER_TIMEZONE,tokenRefreshTime:webApp.LADB_TOKEN_REFRESH_TIME,serverDateDelta:timeDelta,openBetsPeriodMonths:6,settledBetsChunksPeriodDays:21,settledBetsRetryLimit:3,minStake:0.1}});};return{init:function(){_availableProviders={'wh':_getWilliamHillProvider(),'ladb':_getLadbrokesProvider()};},getAllProviders:function(){return _availableProviders;},getCurrentProvider:function(){var prefBookie=webApp.prefBookmaker.get();if(_availableProviders[prefBookie]){_currentProvider=_availableProviders[prefBookie];}else{_currentProvider=null;console.log('ERROR: Provider for current Preferred bookmaker is not available!');}
return _currentProvider;},getProvider:function(bookie){if(_availableProviders[bookie]){return _availableProviders[bookie];}else{console.log('ERROR: Provider for current Preferred bookmaker is not available!');return false;}},getProviderName:function(bookie){var bookie=this.getBookieParams(bookie);return bookie.name;},getCurrentProviderName:function(){var prefBookie=webApp.prefBookmaker.get();return this.getProviderName(prefBookie);},getErrorClassName:function(bookie){switch(bookie){case'wh':return rp.betting.mint.Error;break;case'ladb':return rp.betting.ladbrokes.Error;break;default:return rp.betting.Error;}},getCurrentErrorClassName:function(){var prefBookie=webApp.prefBookmaker.get();return this.getErrorClassName(prefBookie);},getLoggedInBookies:function(){var bookies=webApp.bookiesCollection;var loggedIn=$.map(bookies,function(value,key){var provider=webApp.bookieCollection.getProvider(key);var isLoggedIn=Boolean(provider.isLoggedIn());if(isLoggedIn&&Boolean(provider.user())){return bookies[key].name;}});return loggedIn.join(',');},getBookieParams:function(bookie){var bookies=webApp.bookiesCollection;if(bookies[bookie]){return bookies[bookie];}else{console.log('ERROR: Provider for current Preferred bookmaker is not available! Preferred bookmaker is'
+bookie+'.');return false;}},getCurrentBookieParams:function(){var prefBookie=webApp.prefBookmaker.get();return this.getBookieParams(prefBookie);}};})();
var webApp=webApp||{};webApp.cmsAds=function(opt){this.adsTemplate='';this.adsPlace=null;this.adsList=null;this.adsContainer=null;this.adMarkerClass='webAppHaveAd';this.currentIndex=0;this._config={};this.init(opt);};webApp.cmsAds.prototype={_adTimeId:null,_orientationChange:null,init:function(opt){this.adsTemplate=opt['template']||'';this.adsContainer=$(opt['containerId'])||null;this.adsList=opt['data']||[];this._config=opt['config']||{};this.name=opt.name;this.checkOrientation();return this;},next:function(){if(typeof(this.adsList[this.currentIndex+1])!='undefined'){this.currentIndex=this.currentIndex+1;}else if(typeof(this.adsList[0])!='undefined'){this.currentIndex=0;}
return this;},checkOrientation:function(){this.run();var context=this;this._orientationChange=$(window).unbind('.addOrientation').bind(webApp.EVENT_CHANGE_ORIENTATION+'.addOrientation',function(){setTimeout(function(){context.run();},200);});return this;},run:function(){if(webApp.orientation=='Portrait'&&this._config.vertical){this.display().start();}else if(webApp.orientation=='Landscape'&&this._config.horizontal){this.display().start();}else{this.stop().hide();}},hide:function(){$('body').removeClass('webAppHaveAd');this.adsContainer.html('');return this;},stop:function(){if(this._adTimeId!=null){clearInterval(this._adTimeId);this._adTimeId=null;}
return this;},start:function(){clearInterval(this._adTimeId);var context=this;if(this.adsList.length>1){this._adTimeId=setInterval(function(){context.next().checkOrientation();},context.adsList[this.currentIndex].duration*1000);}
return this;},display:function(){if(this.adsList==null||this.adsList.length==0){return this;}
var html=$.tmpl(this.adsTemplate,this.adsList[this.currentIndex]);this.adsContainer.html(html);if(webApp.orientation=='Landscape'){this.adsContainer.insertBefore($('#'+this.name+'-content').find('> .appFooter'));}else{this.adsContainer.insertBefore(webApp.$appHeader);}
$('body').addClass('webAppHaveAd');this.adsContainer.find('.adImage').css('opacity','1');return this;},kill:function(){this.stop().hide();if(this._orientationChange!=null){$(window).unbind(webApp.EVENT_CHANGE_ORIENTATION,this._orientationChange);this._orientationChange=null;}
this.adsList=[];}};
var webApp=webApp||{};webApp.simplePager=function(opt){this.opt={upSelector:'#pager-up',downSelector:'#pager-down',countSelector:'',disabledClass:'disablePagerButton',urlValue:'story_id',loop:true};this.$upBtn=null;this.$downBtn=null;this.$count=null;this.currentIndex=0;this.dataLength=0;this.clickFlag=false;this.init(opt);};webApp.simplePager.prototype={init:function(opt){if(!opt){throw{name:"ParamError",message:"Provide options"};}
if(!opt.data){throw{name:"ParamError",message:"Provide data for pager"};}
if(!opt.urlParams){throw{name:"ParamError",message:"Provide url params for pager"};}
$.extend(this.opt,opt);this.$upBtn=$(this.opt.upSelector);this.$downBtn=$(this.opt.downSelector);if(this.opt.countSelector){this.$count=$(this.opt.countSelector);}
this.dataLength=this.opt.data.length-1;this.saveCurrentIndex();if(this.currentIndex==-1||this.dataLength<1){$.few(this.$upBtn,this.$downBtn).hide();return;}
$.few(this.$upBtn,this.$downBtn).attr('href',webApp.urlManager.getHash());this.setHrefs();if(this.$count){this.setCount();}
this.addEvents();var context=this;$(window).bind(webApp.EVENT_CHANGE_HASH+'.simplePagerChangeHash',function(e,hashArr){if(!context.clickFlag){context.opt.urlParams=hashArr[1];var prevIndex=context.currentIndex;context.saveCurrentIndex();if(prevIndex!=context.currentIndex){context.setHrefs();if(context.$count){context.setCount();}}}else{context.clickFlag=false;}});$(window).bind(webApp.EVENT_CHANGE_CONTROLLER+'.simplePagerChangeController',function(){$(window).unbind('.simplePagerChangeHash');$(window).unbind('.simplePagerChangeController');});},saveCurrentIndex:function(){var startInUrl=this.opt.urlParams[this.opt.urlValue];this.currentIndex=-1;for(var i in this.opt.data){if(this.opt.data[i]==startInUrl){this.currentIndex=parseInt(i);break;}}},setHrefs:function(){if(!this.opt.loop){$.few(this.$downBtn,this.$upBtn).removeClass(this.opt.disabledClass);}
if(this.currentIndex==0){if(!this.opt.loop){this.$upBtn.addClass(this.opt.disabledClass);this.setHref(this.$upBtn,this.currentIndex);}else{this.setHref(this.$upBtn,this.dataLength);}}else{this.setHref(this.$upBtn,this.currentIndex-1);}
if(this.currentIndex==this.dataLength){if(!this.opt.loop){this.$downBtn.addClass(this.opt.disabledClass);this.setHref(this.$downBtn,this.currentIndex);}else{this.setHref(this.$downBtn,0);}}else{this.setHref(this.$downBtn,this.currentIndex+1);}
var pageScroll=webApp.viewManager.getScroll(webApp.currentControllerName);if(pageScroll){pageScroll.scrollTo(0,0,0);}},setCount:function(){this.$count.html((this.currentIndex+1)+' of '+(this.dataLength+1));},addEvents:function(){var context=this;this.$upBtn.bind('click.simplePagerClick',function(e){if(context.currentIndex==0&&!context.opt.loop){e.preventDefault();}else{context.currentIndex--;if(context.currentIndex<0){context.currentIndex=context.dataLength;}
if(context.$count){context.setCount();}
context.clickFlag=true;setTimeout(function(){context.setHrefs();},10);}});this.$downBtn.bind('click.simplePagerClick',function(e){if(context.currentIndex==context.dataLength&&!context.opt.loop){e.preventDefault();}else{context.currentIndex++;if(context.currentIndex>context.dataLength){context.currentIndex=0;}
if(context.$count){context.setCount();}
context.clickFlag=true;setTimeout(function(){context.setHrefs();},10);}});},renew:function(contentId){this.opt.urlParams[this.opt.urlValue]=contentId;var notFound=false;this.saveCurrentIndex();if(this.currentIndex==-1){notFound=true;}else{this.setHrefs();}
return notFound;},setHref:function($button,index){var params={};params[this.opt.urlValue]=this.opt.data[index];webApp.urlManager.changeLink($button,params);}};
var webApp=webApp||{};webApp.SimpleCircle=function(opt,displayFullInformation){this.currentEl=0;this.dataArray=[];this.elPos={};this.htmlEl='';if(displayFullInformation){this.initDesktopSimpleCircle(opt);}
else{this.init(opt);}};webApp.SimpleCircle.prototype={init:function(opt){var data=opt.data;for(var i=0;i<data.length;i++){var el=data[i];for(var key in el){this.setVal(key,el[key]);break;}}
this.htmlEl=$('#'+opt.id);this.setBtnSize();this.bind();this.rotate();return this;},initDesktopSimpleCircle:function(opt){var data=opt.data;for(var i=0;i<data.length;i++){var el=data[i];for(var key in el){this.setVal(key,el[key]);break;}}
this.htmlEl=$('#'+opt.id);this.setBtnSize();this.displayDesktop();return this;},setBtnSize:function(){this.htmlEl.css('maxWidth',this.htmlEl.parent().width()-26);},bind:function(){var context=this;this.htmlEl.bind('click.titleToggle',function(){context.rotate();});return this;},setVal:function(name,val){if(val==""){return this;}
if(typeof(this.elPos[name])!='undefined'){this.dataArray[this.elPos[name]]=val;}else{this.dataArray.push(val);this.elPos[name]=(this.dataArray.length-1);}
return this;},getVal:function(name){if(typeof(this.elPos[name])!='undefined'){return this.dataArray[this.elPos[name]];}
return false;},getNextVal:function(){if(typeof(this.dataArray[this.getCurrentPos()])!='undefined'){var curPos=this.getCurrentPos();var val=this.dataArray[curPos];this.setCurrentPos(++curPos);return val;}
return'';},setCurrentPos:function(pos){this.currentEl=pos;return this;},getCurrentPos:function(){if(this.currentEl>=this.dataArray.length||this.currentEl<0){this.currentEl=0;}
return this.currentEl;},displayByName:function(name){if(typeof(this.elPos[name])!='undefined'){this.display(this.dataArray[this.elPos[name]]);this.setCurrentPos(this.elPos[name]+1);}
return this;},display:function(html){this.htmlEl.html(html);return this;},displayDesktop:function(){var fullRaceDetails='';for(var i=0;i<this.dataArray.length;i++){fullRaceDetails=fullRaceDetails+''+this.dataArray[i];}
this.htmlEl.html(fullRaceDetails);return this;},rotate:function(){var val=this.getNextVal();this.display(val);return this;}};
var greyhoundbet=greyhoundbet||{};greyhoundbet.racePager=function(opt){this.opt={prevSelector:'#pagerPrevCard',nextSelector:'#pagerNextCard',timeSelector:'#pagerCardTime',urlValue:['race_id'],dataValue:['raceId'],speed:600,enableSwipe:true,maxCount:15};this.$prevBlock=$([]);this.$nextBlock=$([]);this.$prevCount=$([]);this.$nextCount=$([]);this.$prevBtn=$([]);this.$nextBtn=$([]);this.$timeBlock=$([]);this.size=0;this.index=0;this.prevIndex=0;this.nextIndex=0;this.clickFlag=false;this.init(opt);};greyhoundbet.racePager.prototype={init:function(opt){if(!opt){throw{name:"ParamError",message:"Provide options"};}
if(!opt.data){throw{name:"ParamError",message:"Provide data for pager"};}
if(!opt.urlParams){throw{name:"ParamError",message:"Provide url params for pager"};}
$.extend(this.opt,opt);this.$prevBlock=$(this.opt.prevSelector);this.$prevBtn=this.$prevBlock.find('> a');this.$prevCount=this.$prevBlock.find('> div');this.$nextBlock=$(this.opt.nextSelector);this.$nextBtn=this.$nextBlock.find('> a');this.$nextCount=this.$nextBlock.find('> div');if($('.webAppPage.card-meeting-result').length!==0&&$('.webAppPage.result-meeting-result').length!==0){this.$timeBlock=$('.result-meeting-result #pagerResultTime');}else{this.$timeBlock=$(this.opt.timeSelector);}
this.size=this.opt.data.length;this.saveIndex();if(this.size>0&&this.index!=-1){this.$timeBlock.html(this.getRaceTime());}
if(this.index==-1||this.size<2){return;}
this.appendPagerCount();this.setButtonsDefaultHref();this.$prevBlock.show();this.$nextBlock.show();this.addEvents();var context=this;$(window).bind(webApp.EVENT_CHANGE_HASH+'.racePagerChangeHash',function(e,hashArr){if(!context.clickFlag){context.opt.urlParams=hashArr[1];var prevIndex=context.index;context.saveIndex();if(prevIndex!=context.index&&context.index!=-1){context.$timeBlock.html(context.getRaceTime());context.appendPagerCount();context.setButtonsDefaultHref();if(typeof context.opt.callback=='function'){context.opt.callback(context.getCurrentData(context.index));}}}else{context.clickFlag=false;}});$(window).bind(webApp.EVENT_CHANGE_CONTROLLER+'.racePagerChangeController',function(){$(window).unbind('.racePagerChangeHash');$(window).unbind('.racePagerChangeController');});},getRaceTime:function(){var date=utils.date.fromString('2012-01-01 '+this.opt.data[this.index].raceTime,0);return date.format('hh:mn');},appendPagerCount:function(){var pagesCount=[];for(var i=0;i<this.index;i++){pagesCount.push('<i></i>');if(i==this.opt.maxCount){break;}}
this.$prevCount.html(pagesCount.join(''));if(this.index<this.opt.maxCount){pagesCount=[];for(var i=this.index+1;i<this.size;i++){pagesCount.push('<i></i>');if(i==this.opt.maxCount){break;}}
this.$nextCount.html(pagesCount.join(''));}},setButtonsDefaultHref:function(){var pageHash=webApp.urlManager.getHash();this.$prevBtn.attr('href',pageHash);this.$nextBtn.attr('href',pageHash);this.setButtonsHref();},setButtonsHref:function(){if(this.index==0){this.setHref(this.$prevBtn,this.size-1);}else{this.setHref(this.$prevBtn,this.index-1);}
if(this.index==(this.size-1)){this.setHref(this.$nextBtn,0);}else{this.setHref(this.$nextBtn,this.index+1);}},saveIndex:function(){var startInUrl={};for(var i in this.opt.urlValue){startInUrl[this.opt.dataValue[i]]=this.opt.urlParams[this.opt.urlValue[i]];}
this.index=-1;for(var i in this.opt.data){var count=0;for(var j in startInUrl){if(this.opt.data[i][j]!=startInUrl[j]){break;}
count++;}
if(count==this.opt.urlValue.length){this.index=parseInt(i);break;}}},setHref:function($button,index){var params={};for(var i in this.opt.urlValue){params[this.opt.urlValue[i]]=this.opt.data[index][this.opt.dataValue[i]];}
webApp.urlManager.changeLink($button,params);},addEvents:function(){var context=this;this.$prevBtn.bind('click.racePagerClick',function(e){context.index--;if(context.checkIndex()&&(context.index<context.opt.maxCount)){context.$prevCount.find('> i').eq(0).remove();context.$nextCount.append('<i></i>');}
context.$timeBlock.html(context.getRaceTime());context.clickFlag=true;setTimeout(function(){context.setButtonsHref();},10);if(typeof context.opt.callback=='function'){context.opt.callback(context.getCurrentData(context.index));}});this.$nextBtn.bind('click.racePagerClick',function(e){context.index++;if(context.checkIndex()&&(context.index<context.opt.maxCount+1)){context.$nextCount.find('> i').eq(0).remove();context.$prevCount.append('<i></i>');}
context.$timeBlock.html(context.getRaceTime());context.clickFlag=true;setTimeout(function(){context.setButtonsHref();},10);if(typeof context.opt.callback=='function'){context.opt.callback(context.getCurrentData(context.index));}});if(this.opt.enableSwipe){this.$timeBlock.closest('.racePager').bind('swipe.racePagerSwipe',function(e,direction){if(direction==='left'){webApp.urlManager.setHash(context.$nextBtn.attr('href'));}else{webApp.urlManager.setHash(context.$prevBtn.attr('href'));}});}},getCurrentData:function(index){return this.opt.data[index];},checkIndex:function(){if(this.index<0){this.index=this.size-1;this.$nextCount.find('i').appendTo(this.$prevCount);return false;}else if(this.index==this.size){this.index=0;this.$prevCount.find('i').appendTo(this.$nextCount);return false;}
return true;},setButtonsHrefParam:function(params){webApp.urlManager.changeLink(this.$prevBtn,params);webApp.urlManager.changeLink(this.$nextBtn,params);}};
var webApp=webApp||{};webApp.googleTagAds=(function(){var adsSelectors={'ladbAdContainerClass':'.js-ladbAdContainer','cardAdContainerClass':'.js-cardAdContainer','ladbSideAd':'.js-ladbSideAd','whTopAd':'.js-whTopAd','prgtvSideAd':'.js-prgtvSideAd','cardTabAdd':'.js-cardTabAdd'};var adsState={'whTop':false,'ladbSide':false,'rpgtvSide':false,'cardPage':false};function _toggleWhTopAd(isWideBreakpointReached){if(isWideBreakpointReached){if(!adsState.whTop){_displayWhTopAd();adsState.whTop=true;}}
else if(adsState.whTop){$(adsSelectors.whTopAd).empty();adsState.whTop=false;}}
function _toggleLadbSideAd(isWideBreakpointReached,isHeightBreakpointReached){if(isWideBreakpointReached&&isHeightBreakpointReached){if(!adsState.ladbSide){$(adsSelectors.ladbAdContainerClass).show();_displayLadbSideAd();adsState.ladbSide=true;}}
else if(adsState.ladbSide){$(adsSelectors.ladbSideAd).empty();$(adsSelectors.ladbAdContainerClass).hide();adsState.ladbSide=false;}}
function _toggleRpgtvAds(isWideBreakpointReached,controllerName){var isAddContainersRendered=!!$(adsSelectors.prgtvSideAd)[0];if(isWideBreakpointReached&&isAddContainersRendered&&controllerName==='advanced-video'){if(!adsState.rpgtvSide){_displayRpgtvSideAds();adsState.rpgtvSide=true;}}
else if(adsState.rpgtvSide){$(adsSelectors.prgtvSideAd).empty();adsState.rpgtvSide=false;}}
function _toggleCardTabAd(isWideBreakpointReached,controllerName,opts){var $cardTabAd=$(adsSelectors.cardAdContainerClass),isAddContainerRendered=!!$cardTabAd[0],destroyCardTabAd=opts.isCardTabDestroyed||false;if(isWideBreakpointReached&&isAddContainerRendered&&controllerName==='card'){if(!adsState.cardPage){_displayCardTabAd();adsState.cardPage=true;}
else if(destroyCardTabAd){$(adsSelectors.cardTabAdd).empty();adsState.cardPage=false;}}
else if(adsState.cardPage){$(adsSelectors.cardTabAdd).empty();adsState.cardPage=false;}}
function _displayWhTopAd(){googletag.cmd.push(function(){googletag.whAdSlot=googletag.defineSlot('/5614/greyhounds/cards',[970,90],'div-gpt-ad-1445252014425-0').addService(googletag.pubads());googletag.enableServices();googletag.display('div-gpt-ad-1445252014425-0');});googletag.pubads().refresh([googletag.whAdSlot]);}
function _displayLadbSideAd(){googletag.cmd.push(function(){googletag.ladbAdSlot=googletag.defineSlot("/5614/greyhounds/ghtv",[300,250],"div-gpt-ad-1445252554342-0").addService(googletag.pubads());googletag.enableServices();googletag.display("div-gpt-ad-1445252554342-0");});googletag.pubads().refresh([googletag.ladbAdSlot]);}
function _displayRpgtvSideAds(){googletag.cmd.push(function(){googletag.rpgSideAdPos1=googletag.defineSlot('/5614/greyhounds/ghtv',[300,75],'div-gpt-ad-1445251158808-0').setTargeting('pos',['one']).addService(googletag.pubads());googletag.rpgSideAdPos2=googletag.defineSlot('/5614/greyhounds/ghtv',[300,75],'div-gpt-ad-1445251253030-0').setTargeting('pos',['two']).addService(googletag.pubads());googletag.rpgSideAdPos3=googletag.defineSlot('/5614/greyhounds/ghtv',[300,75],'div-gpt-ad-1445251340614-0').setTargeting('pos',['three']).addService(googletag.pubads());googletag.rpgSideAdPos4=googletag.defineSlot('/5614/greyhounds/ghtv',[300,75],'div-gpt-ad-1445251380728-0').setTargeting('pos',['four']).addService(googletag.pubads());googletag.rpgSideAdPos5=googletag.defineSlot('/5614/greyhounds/ghtv',[300,75],'div-gpt-ad-1445251411709-0').setTargeting('pos',['five']).addService(googletag.pubads());googletag.rpgSideAdPos6=googletag.defineSlot('/5614/greyhounds/ghtv',[300,75],'div-gpt-ad-1445251472470-0').setTargeting('pos',['six']).addService(googletag.pubads());googletag.rpgSideAdPos7=googletag.defineSlot('/5614/greyhounds/ghtv',[300,75],'div-gpt-ad-1495191588231-0').setTargeting('pos',['7']).addService(googletag.pubads());googletag.rpgSideAdPos8=googletag.defineSlot('/5614/greyhounds/ghtv',[300,75],'div-gpt-ad-1495191836811-0').setTargeting('pos',['8']).addService(googletag.pubads());googletag.enableServices();googletag.display('div-gpt-ad-1445251158808-0');googletag.display('div-gpt-ad-1445251253030-0');googletag.display('div-gpt-ad-1445251340614-0');googletag.display('div-gpt-ad-1445251380728-0');googletag.display('div-gpt-ad-1445251411709-0');googletag.display('div-gpt-ad-1445251472470-0');googletag.display('div-gpt-ad-1495191588231-0');googletag.display('div-gpt-ad-1495191836811-0');});googletag.pubads().refresh([googletag.rpgSideAdPos1,googletag.rpgSideAdPos2,googletag.rpgSideAdPos3,googletag.rpgSideAdPos4,googletag.rpgSideAdPos5,googletag.rpgSideAdPos6,googletag.rpgSideAdPos7,googletag.rpgSideAdPos8]);}
function _displayCardTabAd(){googletag.cmd.push(function(){googletag.cardTabAdSlot=googletag.defineSlot('/5614/greyhounds/cards',[468,60],'div-gpt-ad-1445251928649-0').addService(googletag.pubads());googletag.enableServices();googletag.display('div-gpt-ad-1445251928649-0');});googletag.pubads().refresh([googletag.cardTabAdSlot]);}
return{proccessAds:function(windowWidth,windowHeight,opts){var wideBreakpoint=1140,heightBreakpoint=755,isWideBreakpointReached=windowWidth>=wideBreakpoint,isHeightBreakpointReached=windowHeight>=heightBreakpoint,controllerName=webApp.urlManager.getControllerName(),opts=opts||{};_toggleWhTopAd(isWideBreakpointReached);_toggleLadbSideAd(isWideBreakpointReached,isHeightBreakpointReached);_toggleRpgtvAds(isWideBreakpointReached,controllerName);_toggleCardTabAd(isWideBreakpointReached,controllerName,opts);}}})();
var webApp=webApp||{};webApp.confirmPopup=function(options){$('#confirm').remove();var opt={okCallback:null,cancelCallback:null};if(typeof options=='object'){$.extend(opt,options);}
var tpl=opt.tpl||'confirm';var $confirmBox=webApp.viewManager.renderTpl(tpl,opt);if(webApp.HorseDetailsController){webApp.overlay.show();$confirmBox.appendTo($('body')).css('marginTop',$confirmBox.outerHeight()/2*-1);}
else{webApp.overlay.showContentOverlay();$confirmBox.appendTo($('#webApp')).css('marginTop',$confirmBox.outerHeight()*-1);}
if(typeof opt.okCallback=='function'){$confirmBox.find('.confirmOK').bind('click.confirmOK',opt.okCallback);}
if(typeof opt.cancelCallback=='function'){$confirmBox.find('.confirmCancel').bind('click.confirmCancel',opt.cancelCallback);}
$confirmBox.find('> .buttons > .confirmBtn').bind('click.hideConfirm',function(){if(webApp.HorseDetailsController){webApp.overlay.hide();}
else{webApp.overlay.hideContentOverlay();}
$confirmBox.remove();});if($confirmBox.hasClass('scrollable')){var scrollWrapperId=$confirmBox.find('.scroll-wrapper').attr('id');var scrollOptions={fadeScrollbars:webApp.isMobile,mouseWheel:true,scrollbars:true,scrollX:false,mouseWheelSpeed:100,interactiveScrollbars:true,preventDefault:false,freeScroll:false,useTransition:false,useTransform:true,click:false,tap:false};var iscroll=new IScroll('#'+scrollWrapperId,scrollOptions);}};
var webApp=webApp||{};webApp.overlay=(function(){var $overlay=null;return{init:function(){$overlay=$('#overlay');},show:function(options){$overlay.show();},hide:function(){$overlay.hide();},showContentOverlay:function(){$('.contentOverlay').show();},hideContentOverlay:function(){$('.contentOverlay').hide();}};})();
var webApp=webApp||{};webApp.dataLoading={show:function(text,showOverlay){this.hide();var msg=text||'Connect to William Hill...';var $loading=webApp.viewManager.renderTpl('view-preloader',{text:msg});if(showOverlay!==false){webApp.overlay.show();}
if(!webApp.HorseDetailsController){$loading.appendTo($('.webApp'));}
else{$loading.appendTo($('body'));}
$loading.css('marginTop',($loading.height()/2+48)*-1);},hide:function(){$('#data-loading').remove();webApp.overlay.hide();},showContentLoading:function(){this.hideContentLoading();var $pagePreLoader=webApp.viewManager.renderTpl('view-page-preloader');$pagePreLoader.css('marginTop',($pagePreLoader.height()/2+48)*-1);if(webApp.isFirstCall){$pagePreLoader.appendTo($('body'));}
else{$pagePreLoader.appendTo($('.webApp'));}},hideContentLoading:function(){$('.pageLoading').remove();}};
var webApp=webApp||{};webApp.SelectBtn=function(options){this.opt={$select:$([]),requestParam:''};$.extend(this.opt,options);this.$btn=this.opt.$select.parent();this.$btnText=this.$btn.find('em');this.init();};webApp.SelectBtn.prototype={init:function(){var location=webApp.urlManager.getHash();var request=webApp.urlManager.parseHash(location)[1];var prevVal=request[this.opt.requestParam];if(request[this.opt.requestParam]){this.opt.$select.val(prevVal);}
this.setBtnText();var context=this;var selectId=this.opt.$select.attr('id');$(window).unbind(webApp.EVENT_CHANGE_HASH+'.'+selectId).bind(webApp.EVENT_CHANGE_HASH+'.'+selectId,function(){var hashArr=context.getHashArray();if(hashArr[1][context.opt.requestParam]){var newVal=hashArr[1][context.opt.requestParam];context.opt.$select.val(newVal);if(!context.opt.$select.find('option:selected').length){context.opt.$select.val(prevVal);}else{if(newVal!=prevVal){context.setBtnText();prevVal=newVal;if(typeof context.opt.callback=='function'){context.opt.callback(context.opt.$select);}}}}});var controllerName=webApp.urlManager.getControllerName();$(window).bind('switchpage.'+selectId,function(e,cn){if(controllerName!=cn){$(window).unbind(webApp.EVENT_CHANGE_HASH+'.'+selectId).unbind('switchpage.'+selectId);}});this.$btn.bind('click.showSelectClick',function(){if(typeof context.opt.showCallback=='function'){context.opt.showCallback(context.opt.$select);}});this.opt.$select.bind('change.changeSelectBtn',function(){var $selected=$(this).find('option:selected');if($(this).data('tracklabel')){var trackLabel=$selected.text().replace(/ \(.*/,"");webApp.eventTracker.trackEventById($(this).data('tracklabel'),trackLabel);}
var selectValue=$(this).val();if(selectValue.indexOf('#')==-1){var cn=webApp.urlManager.getControllerName();if(controllerName!=cn){webApp.urlManager.replaseHash(webApp.urlManager.getBackUrlFor(controllerName));}
var hashArr=context.getHashArray();hashArr[1][context.opt.requestParam]=selectValue;if(context.opt.controllerName){hashArr[0]=context.opt.controllerName;var hashString=webApp.urlManager.createHash(hashArr);webApp.urlManager.setHash(hashString);}else{if(context.opt.dataUrl){webApp.urlManager.changeParams($selected.data(context.opt.dataUrl));}else{webApp.urlManager.changeParams(hashArr[1]);}}}else{webApp.urlManager.setHash(selectValue.substring(1));}});},getHashArray:function(){var hashString=webApp.urlManager.getHash();var hashArr=webApp.urlManager.parseHash(hashString);return hashArr;},setBtnText:function(){var $selectOption=this.opt.$select.find('option:selected');if($selectOption.data('short')){this.$btnText.html($selectOption.data('short'));}else{this.$btnText.html($selectOption.text());}}};
var webApp=webApp||{};webApp.accountSettingsList=function(listId,stateName,childrenSelector,setValObj,callback){if(stateName==='bookie'){var active=webApp.prefBookmaker.get();}else{var active=webApp.userSettings.get(stateName)!=null?webApp.userSettings.get(stateName):'number';}
var $listItems=$('#'+listId+' > li');var $clickItems=$listItems;$('#'+stateName+'-'+active).addClass('tick');if(childrenSelector){var $childrens=$listItems.find(childrenSelector);$clickItems=$childrens;}
$clickItems.bind('click.cardSortClick',function(){$listItems.removeClass('tick');var $activeItem=childrenSelector?$(this).closest('li'):$(this);$activeItem.addClass('tick');var newActive=$activeItem.attr('id').split('-');if(stateName!='bookie'){webApp.userSettings.set(stateName,newActive[1]);if(typeof callback=='function'){callback(newActive[1]);}
if(setValObj){$(setValObj.selector).html(setValObj.collection?setValObj.collection[newActive[1]]:newActive[1]);}}else{var currentActive=webApp.prefBookmaker.get(),bookieChanges=webApp.userSettings.get('bookieChanges');bookieChanges=bookieChanges?parseInt(bookieChanges):0;webApp.prefBookmaker.set(newActive[1]);if(bookieChanges<3&&currentActive!=newActive[1]){var message=webApp.bookieCollection.getProviderName(newActive[1])+' prices will now be displayed';webApp.confirmMessage.show(message);webApp.userSettings.set('bookieChanges',bookieChanges+1);}}});};
var webApp=webApp||{};webApp.blockScroll=function(options){if(!options.blockId){return;}
this.opt={space:14,active:0,isWindow:false,minHeight:210,contentHeight:false};$.extend(this.opt,options);this.$block=$('#'+this.opt.blockId);this.$parent=this.$block.parent();this.$wrapper=this.opt.isWindow?this.$block.closest('.scrollParent'):this.$block.closest('.scrollContent');if(!this.$wrapper||this.$wrapper.parent().hasClass('webAppPageContent')){this.$wrapper=this.$block.closest('.webAppPage');}
this.iscroll=null;this.$items=$([]);this.forController=webApp.currentControllerName;this.active=this.opt.active;this.init();}
webApp.blockScroll.prototype={init:function(){var context=this;setTimeout(function(){context.setSize();context.setScroll();},0);var updateTimeId;$(window).unbind('updateScroolSize.'+this.opt.blockId).bind('updateScroolSize.'+this.opt.blockId,function(){clearTimeout(updateTimeId);updateTimeId=setTimeout(function(){context.setSize();if(context.opt.isSnap&&context.iscroll){context.iscroll.goToPage(context.active,0,0);context.refresh();}},440);});$(window).unbind('switchpage.'+this.opt.blockId).bind('switchpage.'+this.opt.blockId,function(e,cn){if(!context.opt.isWindow){if(context.forController&&context.forController!=cn){context.destroy();}else{setTimeout(function(){context.setSize();},100);}}});},setSize:function(){this.$block.show();var $scrollContent=this.$block.find('> .scrollContent');if(this.opt.isSnap){$scrollContent.data('snap',true);if(!this.$items.length){this.$items=$(this.opt.itemsSelector);}
var contentWidth=this.$block.width();$scrollContent.width(contentWidth*this.$items.length);this.$items.each(function(i){$(this).width(contentWidth).css('left',i*contentWidth);});}
var blockHeight=$scrollContent.height();this.$block.hide().height('auto');var contentHeight=0;var wrapperHeight=this.$wrapper.outerHeight();if(this.opt.isWindow){if(this.opt.displayNear){this.$wrapper.addClass('landingDisplayNear')
this.$block.show();blockHeight=$scrollContent.height();}else{contentHeight=webApp.windowHeight-contentHeight-(this.opt.space*2);blockHeight=blockHeight>contentHeight?contentHeight:blockHeight;}
this.$block.height(blockHeight).css('overflow','hidden').show();if(this.opt.displayNear){var $dn=$(this.opt.displayNear);if($dn.is(':visible')){this.$wrapper.css({'bottom':webApp.windowHeight-$dn.offset().top+24,'left':$dn.offset().left+$dn.innerWidth()/2-215});}else{this.$wrapper.css('marginLeft','-149px');this.$wrapper.css('bottom','25px');}}else{if(blockHeight==contentHeight){this.$wrapper.css('top',this.opt.space);}else{this.$wrapper.css('top',webApp.windowHeight/2-this.$wrapper.outerHeight()/2);}}}else{var $wblock=this.$wrapper;if(this.$wrapper.data('snap')){$wblock=this.$block.parent();}
$wblock.find('> div').each(function(){if($(this).css('display')!='none'){contentHeight+=$(this).height();}});contentHeight=wrapperHeight-contentHeight||contentHeight;blockHeight=contentHeight;if(!this.opt.contentHeight){this.$block.height(blockHeight).css('overflow','hidden').show();}else{this.$block.show();contentHeight=$scrollContent.outerHeight();var height;if(contentHeight<blockHeight){height=this.opt.minHeight>contentHeight?this.opt.minHeight:contentHeight;}else{height=blockHeight;}
this.$block.height(height).css('overflow','hidden');}}
this.refresh();},setScroll:function(){var enableTimeid;if(this.iscroll){this.iscroll.destroy();this.iscroll=null;}
var isUseTransform=true;if(webApp.isAndroid_2){isUseTransform=this.$block.find('input[type=text], input[type=password], input[type=number], select').length?false:true;}
var scrollOptions={fadeScrollbars:!webApp.isAndroid_2,mouseWheel:true,scrollbars:webApp.isMobile?true:'custom',scrollX:false,mouseWheelSpeed:100,interactiveScrollbars:false,preventDefault:false,freeScroll:false,useTransition:false,useTransform:isUseTransform,click:false,tap:false}
if(this.opt.isSnap){$.extend(scrollOptions,{snap:true,momentum:false,bounce:false,scrollbars:false,snapThreshold:26,scrollX:true});}
this.iscroll=new IScroll('#'+this.opt.blockId,scrollOptions);this.iscroll.on('beforeScrollStart',function(){webApp.disableScroll=true;});this.iscroll.on('scrollEnd',$.proxy(function(){if(this.iscroll&&this.opt.isSnap&&this.iscroll.currentPage.pageX!=this.opt.active){this.opt.active=this.iscroll.currentPage.pageX;if(typeof this.opt.callback=='function'){this.active=this.iscroll.currentPage.pageX;this.opt.callback(this.iscroll.currentPage.pageX);}}},this));if(this.opt.isSnap){if(this.iscroll){this.iscroll.goToPage(this.opt.active,0,0);}}},destroy:function(){if(this.iscroll){this.iscroll.destroy();this.iscroll=null;webApp.viewManager.enableScrolls();}
this.$block.height('auto').css('overflow','visible');$(window).unbind('changeorientaion.'+this.opt.blockId).unbind('switchpage.'+this.opt.blockId);},refresh:function(){if(this.iscroll){this.iscroll.refresh();}}}
var webApp=webApp||{};webApp.confirmMessage={show:function(text,template){this.hide();var template=template||'account-bookie-change';var $message=webApp.viewManager.renderTpl(template,{text:text});if(!webApp.HorseDetailsController){$message.appendTo($('.webApp'));}
else{$message.appendTo($('body'));}
setTimeout($.proxy(function(){this.hide();},this),1500);},hide:function(){$('#confirm-message').remove();}};
var webApp=webApp||{};webApp.choicePopup={$box:null,$container:null,opt:{},show:function(opt){this.hide();this.opt=opt;this.$box=webApp.viewManager.renderTpl('choice-popup');this.$container=this.opt.$el.closest('.scrollContent');this.$box.find('> .choicePopupHeadline').html(this.opt.headline);this.$box.find('> .choicePopupContent').html(webApp.viewManager.renderTpl(this.opt.template));this.setPosition();this.$container.append(this.$box);if(typeof this.opt.showCallback=='function'){this.opt.showCallback();}
var context=this;setTimeout(function(){$(document).bind('click.hideChoicePopup',function(){context.hide();});},10);var resizeTimeid;$(window).bind('resize.resizeChoicePopup',function(){clearTimeout(resizeTimeid);resizeTimeid=setTimeout(function(){context.setPosition();},300);});},setPosition:function(){var topPos=this.opt.$el.offset().top-this.$container.offset().top+this.opt.$el.outerHeight()/2+18;var leftPos=this.opt.$el.offset().left+(this.opt.$el.outerWidth()/2-150);this.$box.css({top:topPos,left:leftPos});},hide:function(){if(this.$box){this.$box.remove();}
$(document).unbind('.hideChoicePopup');$(window).unbind('.resizeChoicePopup');}};
var webApp=webApp||{};webApp.selectionsConfirm=function(count,options){options=options||{};options.count=count;options.tpl='bet-confirm';webApp.confirmPopup(options);};
var webApp=webApp||{};webApp.BottomMenuControl=(function(){var opt={};var $control=$([]);function getDayData(d,active,available,isFirstDay){var fStr=utils.date.fromString(d+' 00:00',0);var obj={btnText:fStr.format('mmm dd'),urlParam:d,text:'<em>'+fStr.format('mmm')+'</em><span>'+fStr.format('dd')+'</span><i>'+fStr.format('ddd')+'</i>'};if(isFirstDay===true){obj.text=obj.text.replace('<em>','<em class="firstDay">');}
if(available===false){obj.disabled=true;}else if(d===active){obj.active=true;}
return obj;}
function addEvents(){$(window).bind(webApp.EVENT_CHANGE_HASH+'.hideBottomMenu',function(){hide();});$control.find('.cancel').on('click',function(){hide();});$control.find('strong:not(.disabled)').on('click',function(){var obj={};var param=$(this).data('param');obj[opt.urlParam]=param;webApp.urlManager.changeParams(obj);$(opt.btnSelector).html($(this).data('btntext'));if(typeof opt.callback=='function'){opt.callback(param);}
hide();});}
function show(){hide();var activeParamVal=opt?webApp.urlManager.getParams()[1][opt.urlParam]:new Date().format('yyyy-0mm-0dd');var templateData={};templateData.items={};for(var i in opt.items){var menuItem=opt.items[i];var itemArr=[];if(i=='date'){if(menuItem.days){for(var j=0;j<menuItem.days.length;j++){if(menuItem.days[j].day.search(/-01$/)!==-1&&parseInt(activeParamVal.split('-')[1],10)<parseInt(menuItem.days[j].day.split('-')[1],10)){menuItem.days[j].isFirstDay=true;}else{menuItem.days[j].isFirstDay=false;}
itemArr.push(getDayData(menuItem.days[j].day,activeParamVal,menuItem.days[j].racesAvailable,menuItem.days[j].isFirstDay));}}else{if(menuItem.start=='today'){menuItem.start=utils.moment.getSynchronizedToServerNow(0,'YYYY-MM-DD');}
itemArr.push(getDayData(menuItem.start,activeParamVal));if(menuItem.prevDays){var dateObj=new Date(menuItem.start);for(var d=menuItem.prevDays;d>0;d--){dateObj.setDate(dateObj.getDate()-1);var dateString=utils.date.toString(dateObj);itemArr.unshift(getDayData(dateString,activeParamVal));}}
if(menuItem.nextDays){var dateObj=new Date(menuItem.start);for(var d=menuItem.nextDays;d>0;d--){dateObj.setDate(dateObj.getDate()+1);var dateString=utils.date.toString(dateObj);itemArr.push(getDayData(dateString,activeParamVal));}}}}else{var obj={btnText:menuItem.btnText,urlParam:menuItem.urlParamValue,text:menuItem.text};if(activeParamVal==menuItem.urlParamValue){obj.active=true;}
itemArr.push(obj);}
templateData.items[i]=itemArr;}
$control=$.tmpl('bottom-menu-control',templateData);if(webApp.isMobile){$control.appendTo($('body')).find('.overlay').css('bottom',$control.innerHeight());}else{$control.appendTo($('body'));}
addEvents();}
function hide(){var $datePicker=$('.date-picker-container');if($datePicker.length>=1){$datePicker.remove();$('.date-picker-overlay').remove();}else{$('#bottomMenuControl').remove();}
$control=$([]);$(window).unbind(webApp.EVENT_CHANGE_ORIENTATION+'.hideBottomMenuOrient').unbind(webApp.EVENT_CHANGE_ORIENTATION+'.hideBottomMenuOrient');}
return{init:function(params){opt=params;var paramVal=webApp.urlManager.getParams()[1][opt.urlParam];var btnText=utils.date.fromString(paramVal+' 00:00',0).format('mmm dd');if(btnText==' '){for(var i in opt.items){if(opt.items[i].urlParamValue==paramVal){btnText=opt.items[i].btnText;break;}}}
$(opt.btnSelector).html(btnText).on('click',$.proxy(function(){show();},this));},showCalendar:function(){if(!opt||!opt.items){$.ajax({url:'meeting/blocks.sd',data:{r_date:new Date().format('yyyy-0mm-0dd'),blocks:'header'},type:'GET',dataType:'json',cache:true,timeout:(1000*60*1),success:function(data){opt.items.date={};opt.items.date.days=data['header'];show();},error:function(e){console.log(e);},complete:function(){}});}
else{show();}}}})();
var webApp=webApp||{};webApp.Calendar=(function(){var $appendTo=null,highlightedDate=null,currDisplayingDate=new Date(webApp.urlManager.getParams()[1].r_date),orientation=null,maxYearsBack=5,matrixWidth=7,$control=$([]),dateClickCallback=function(date){webApp.urlManager.changeParams({r_date:date});webApp.Calendar.hide();webApp.eventTracker.trackEventById('results_date_select',date);},todayButtonHandler=function(){webApp.Calendar.hide();var dateToday=utils.date.getSynchronizedToServerNow().format('yyyy-0mm-0dd');webApp.urlManager.changeParams({r_date:dateToday});webApp.eventTracker.trackEventById('results_date_select',dateToday);},currDisplayingMonth=null,currDisplayingYear=null,currDisplayingDay=null,daysAbbreviations=['M','T','W','T','F','S','S'],now=utils.date.getSynchronizedToServerNow();now=new Date(now.getFullYear(),now.getMonth(),now.getDate());function generateDatesMatrix(date,matrixWidth){var matrixDates=[],emptyCell={text:'&nbsp;',isCurrDate:false,disabled:true},dateYear=date.getFullYear(),dateMonth=date.getMonth(),monthDaysCount=new Date(dateYear,dateMonth+1,0).getDate(),daysCounter=1,firstEnabledDate=new Date(now.getFullYear()-maxYearsBack,now.getMonth(),now.getDate()),firstDayIfWeekStartsFromSunday=new Date(dateYear,dateMonth,1).getDay(),firstDayIndex=firstDayIfWeekStartsFromSunday==0?6:firstDayIfWeekStartsFromSunday-1;while(daysCounter<=monthDaysCount){var matrixRow=[];for(var i=0;i<matrixWidth;i++){if((i<firstDayIndex&&daysCounter<=1)||daysCounter>monthDaysCount){matrixRow.push(emptyCell);}else{var currDate=new Date(dateYear,dateMonth,daysCounter),dateStr=currDate.format('yyyy-0mm-0dd'),isCurrDate=dateStr==highlightedDate.format('yyyy-0mm-0dd'),isFutureDate=currDate>now,dateExceedsMaxBackRange=currDate<firstEnabledDate,disabled=isFutureDate||dateExceedsMaxBackRange;matrixRow.push({text:daysCounter,isCurrDate:isCurrDate,disabled:disabled,date:dateStr});daysCounter++;}}
matrixDates.push(matrixRow);}
return matrixDates;}
function updateCurrentlyDisplayingDateParts(){currDisplayingMonth=currDisplayingDate.getMonth();currDisplayingYear=currDisplayingDate.getFullYear();currDisplayingDay=currDisplayingDate.getDate();}
function attachEvents(){$('.calMonthBack:not(.disabled)').on('click',function(){hide();currDisplayingDate=new Date(currDisplayingYear,currDisplayingMonth-1,1);render();});$('.calMonthForward:not(.disabled)').on('click',function(){hide();currDisplayingDate=new Date(currDisplayingYear,currDisplayingMonth+1,1);render();});$('.calToday').on('click',function(){todayButtonHandler();});$('.calCancel').on('click',function(){currDisplayingDate=highlightedDate;hide();});$control.find('[data-date]:not(.disabled)').on('click',function(){var param=$(this).data('date');dateClickCallback(param);});}
function render(){updateCurrentlyDisplayingDateParts();var monthAndYear=currDisplayingDate.format('mmm yyyy'),monthForwardDisabled=currDisplayingYear==now.getFullYear()&&currDisplayingMonth==now.getMonth(),monthBackwardDisabled=currDisplayingYear==(now.getFullYear()-maxYearsBack)&&currDisplayingMonth==now.getMonth(),templateData={items:generateDatesMatrix(currDisplayingDate,matrixWidth),monthAndYear:monthAndYear,monthForwardDisabled:monthForwardDisabled,monthBackwardDisabled:monthBackwardDisabled,daysAbbreviations:daysAbbreviations};$control=$.tmpl('calendar',templateData);if(webApp.isMobile){$control.appendTo($('body')).find('.overlay').css('bottom',$control.innerHeight());}else{$control.appendTo($('body'));}
attachEvents();}
function hide(){var $datePicker=$('.date-picker-container');if($datePicker.length>=1){$datePicker.remove();$('.date-picker-overlay').remove()}else{$('#bottomMenuControl').remove();}
$control=$([]);}
function updateWidthDependingOnOrientation(orientation){if(webApp.isMobile){$control.appendTo($('body')).find('.overlay').css('bottom',$control.innerHeight());}else{$control.appendTo($('body'));}}
return{init:function(config){$appendTo=config.$appendTo||null;orientation=config.orientation||null;maxYearsBack=config.maxYearsBack||maxYearsBack;updateWidthDependingOnOrientation(orientation);updateCurrentlyDisplayingDateParts();},show:function(){highlightedDate=webApp.urlManager.getParams()[1]?new Date(webApp.urlManager.getParams()[1].r_date):new Date();currDisplayingDate=highlightedDate;render();},hide:function(){hide();},setOrientation:function(orientation){updateWidthDependingOnOrientation(orientation);}};})();
var webApp=webApp||{};webApp.landing={iscroll:null,$container:$([]),init:function(){this.$container=$('#webAppLanding');},show:function(opt){this.hide();this.$container.height(webApp.windowHeight).show();var templateData=opt.templateData||{};this.$container.append($.tmpl(opt.template,templateData));this.$bubble=this.$container.find('> .landingBubble').eq(0);this.$bubble.show();this.showBubble(opt.full);if(webApp.userSettings.get('isDefaultBookieSet')&&!webApp.userSettings.get('isLandingJourneyComplete')){var bookie=webApp.prefBookmaker.get();this.changeBubble($('#landing'+bookie.toUpperCase()));}
$(window).bind('changeorientaion.bookieLanding',$.proxy(function(){this.$container.height(webApp.windowHeight);},this));if(typeof opt.callback=='function'){opt.callback();}},showBubble:function(isFullSize){if(this.iscroll){this.iscroll.destroy();this.iscroll=null;}
this.iscroll=new webApp.blockScroll({blockId:this.$bubble.find('> .landingBubbleWrapper').attr('id'),isWindow:true,displayNear:webApp.isTablet&&!isFullSize?'#accountMenu':false});if(!webApp.HorseDetailsController){$.each($('.website-display'),function(i,cur){$.each($(cur).children(),function(index,current){$(current).html($(current).html().replace(/\bapp\b/,'site'));});});}},changeBubble:function($newBubble){webApp.userSettings.set('isDefaultBookieSet',true);var $bookiesContainer=$('#prefBookieList');if($bookiesContainer.length>0){$('#prefBookieList').find('li').each(function(index,elem){$(elem).removeClass('tick');});}
webApp.accountSettingsList('prefBookieList','bookie','.colA');this.$bubble.hide();this.$bubble=$newBubble;this.$bubble.show();this.showBubble();},bookieCallback:function(){var $bookiesContainer=$('#landingBookiesList');var context=webApp.landing;context._shuffle($bookiesContainer.children()).each(function(index,$el){$bookiesContainer.append($el);});var selectedLabel=' Selected';var loginLabel=' Login';var registerLabel=' Register';var startLabel=' Start using the app';context.$container.find('.setLandingJourneyComplete').bind('click',function(){webApp.userSettings.set('isLandingJourneyComplete',true);});context.$container.find('#showLandingWH').bind('click.gaEvent',function(){webApp.eventTracker.trackEventById('pref_bookie_select',webApp.bookieCollection.getProviderName('wh')+selectedLabel);});context.$container.find('#showLandingLADB').bind('click.gaEvent',function(){webApp.eventTracker.trackEventById('pref_bookie_select',webApp.bookieCollection.getProviderName('ladb')+selectedLabel);});context.$container.find('#landingWHLogin').bind('click.gaEvent',function(){webApp.eventTracker.trackEventById('pref_bookie_login',webApp.bookieCollection.getProviderName('wh')+loginLabel);});context.$container.find('#landingWHRegister').bind('click.gaEvent',function(){webApp.eventTracker.trackEventById('pref_bookie_register',webApp.bookieCollection.getProviderName('wh')+registerLabel);});context.$container.find('#landingWHStart').bind('click.gaEvent',function(){webApp.eventTracker.trackEventById('pref_bookie_start',webApp.bookieCollection.getProviderName('wh')+startLabel);});context.$container.find('#landingLADBLogin').bind('click.gaEvent',function(){webApp.eventTracker.trackEventById('pref_bookie_login',webApp.bookieCollection.getProviderName('ladb')+loginLabel);});context.$container.find('#landingLADBRegister').bind('click.gaEvent',function(){webApp.eventTracker.trackEventById('pref_bookie_register',webApp.bookieCollection.getProviderName('ladb')+registerLabel);});context.$container.find('#landingLADBStart').bind('click.gaEvent',function(){webApp.eventTracker.trackEventById('pref_bookie_start',webApp.bookieCollection.getProviderName('ladb')+startLabel);});$('#showLandingWH').bind('click',function(){webApp.prefBookmaker.set('wh');$('#showLandingWH').addClass('tick');setTimeout(function(){context.changeBubble($('#landingWH'));},500);});$('#showLandingLADB').bind('click',function(){webApp.prefBookmaker.set('ladb');$('#showLandingLADB').addClass('tick');setTimeout(function(){context.changeBubble($('#landingLADB'));},500);});context.$container.find('.hideWebAppLanding').bind('click',function(){context.hide();});},hide:function(){if(this.iscroll){this.iscroll.destroy();this.iscroll=null;}
this.$container.empty().hide();$(window).unbind('.bookieLanding');},initDesktopLanding:function(){var bookiesArray=['wh','ladb'];var preferredBookie=this._shuffle(bookiesArray)[0];webApp.prefBookmaker.set(preferredBookie);webApp.userSettings.set('isDefaultBookieSet',true);webApp.userSettings.set('isLandingJourneyComplete',true);},_shuffle:function(o){for(var j,x,i=o.length;i;j=parseInt(Math.random()*i),x=o[--i],o[i]=o[j],o[j]=x);return o;}};
webApp=webApp||{};webApp.sortOrder={date:'desc',track:'asc',dis:'asc',trp:'asc',split:'asc',pos:'asc',fin:'asc',by:'asc',win:'asc',rem:'asc',wt:'asc',go:'asc',wght:'asc',sp:'asc',grade:'asc',cal:'asc'};webApp.sortableColumns=(function(){'use strict';function _refreshIndexesAfterSort(){for(var i=0;i<webApp.dogCareerDataForSort.forms.length;i++){webApp.dogCareerDataForSort.forms[i].index=i;}}
function _getDogStats(column){var columnConverter={date:'raceTime',track:'trackShortName',dis:'distMetre',trp:'trapNum',split:'secTimeS',pos:'bndPos',fin:'rOutcomeDesc',by:'by',win:'otherDogName',rem:'closeUpCmnt',wt:'winnersTimeS',go:'goingType',wght:'weight',sp:'oddsDesc',grade:'rGradeCde',cal:'calcRTimeS'};if(webApp.sortOrder[column]==='asc'){if(column==='dis'||column==='track'||column==='split'||column==='trp'||column==='go'||column==='wt'||column==='cal'||column==='wght'){webApp.dogCareerDataForSort.forms.sort(_ascendingAlphabeticalAndNumericalSort(columnConverter[column]));}
if(column==='fin'){webApp.dogCareerDataForSort.forms.sort(_finColumnSort(columnConverter[column]));}
if(column==='date'){webApp.dogCareerDataForSort.forms.sort(_dateColumnSort(columnConverter[column]));}
if(column==='by'){webApp.dogCareerDataForSort.forms.sort(_byColumnSort(columnConverter[column]));}
if(column==='sp'){webApp.dogCareerDataForSort.forms.sort(_spColumnSort(columnConverter[column]));}
if(column==='grade'){webApp.dogCareerDataForSort.forms.sort(_gradeColumnSort(columnConverter[column]));}
_refreshSortOrder(column);}else if(webApp.sortOrder[column]==='desc'){if(column==='dis'||column==='track'||column==='split'||column==='trp'||column==='go'||column==='wt'||column==='cal'||column==='wght'){webApp.dogCareerDataForSort.forms.sort(_descendingAlphabeticalAndNumericalSort(columnConverter[column]));}
if(column==='fin'){webApp.dogCareerDataForSort.forms.sort(_finColumnSortDesc(columnConverter[column]));}
if(column==='date'){webApp.dogCareerDataForSort.forms.sort(_dateColumnSortDesc(columnConverter[column]));}
if(column==='by'){webApp.dogCareerDataForSort.forms.sort(_byColumnSortDesc(columnConverter[column]));}
if(column==='sp'){webApp.dogCareerDataForSort.forms.sort(_spColumnSortDesc(columnConverter[column]));}
if(column==='grade'){webApp.dogCareerDataForSort.forms.sort(_gradeColumnSortDesc(columnConverter[column]));}
_refreshSortOrder(column);}}
function _refreshSortOrder(column){var currentOrder=webApp.sortOrder[column];webApp.sortOrder={date:'asc',track:'asc',dis:'asc',trp:'asc',split:'asc',pos:'asc',fin:'asc',by:'asc',win:'asc',rem:'asc',wt:'asc',go:'asc',wght:'asc',sp:'asc',grade:'asc',cal:'asc'};if(currentOrder==='asc'){webApp.sortOrder[column]='desc';}else{webApp.sortOrder[column]='asc';}}
function _ascendingAlphabeticalAndNumericalSort(prop){return function(a,b){if(a[prop]===''||a[prop]==='N'){a[prop]=0;}
if(b[prop]===''||b[prop]==='N'){b[prop]=0;}
if(prop==='secTimeS'||prop==='distMetre'||prop==='goingTime'||prop==='weight'||prop==='winnersTimeS'||prop==='calcRTimeS'){a[prop]=parseFloat(a[prop]);b[prop]=parseFloat(b[prop]);}
if(a[prop]<b[prop]){return-1;}
if(a[prop]>b[prop]){return 1;}
if(a[prop]===b[prop]){if(a['raceTime'.split(' ')[0]]<b['raceTime'.split(' ')[0]]){return 1;}
if(a['raceTime'.split(' ')[0]]>b['raceTime'.split(' ')[0]]){return-1;}}
return 0;};}
function _descendingAlphabeticalAndNumericalSort(prop){return function(a,b){if(a[prop]===''||a[prop]==='N'){a[prop]=0;}
if(b[prop]===''||b[prop]==='N'){b[prop]=0;}
if(prop==='secTimeS'||prop==='distMetre'||prop==='goingTime'||prop==='weight'||prop==='winnersTimeS'||prop==='calcRTimeS'){a[prop]=parseFloat(a[prop]);b[prop]=parseFloat(b[prop]);}
if(a[prop]<b[prop]){return 1;}
if(a[prop]>b[prop]){return-1;}
if(a[prop]===b[prop]){if(a['raceTime'.split(' ')[0]]<b['raceTime'.split(' ')[0]]){return 1;}
if(a['raceTime'.split(' ')[0]]>b['raceTime'.split(' ')[0]]){return-1;}}
return 0;};}
function _dateColumnSort(prop){return function(a,b){if(a[prop].split(' ')[0]<b[prop].split(' ')[0]){return 1;}
if(a[prop].split(' ')[0]>b[prop].split(' ')[0]){return-1;}
return 0;};}
function _dateColumnSortDesc(prop){return function(a,b){if(a[prop].split(' ')[0]<b[prop].split(' ')[0]){return-1;}
if(a[prop].split(' ')[0]>b[prop].split(' ')[0]){return 1;}
return 0;};}
function _finColumnSort(prop){return function(a,b){if(a[prop]==='NR'){a[prop]=18;}
if(b[prop]==='NR'){b[prop]=18;}
if(a[prop]===''){a[prop]=10;}
if(b[prop]===''){b[prop]=10;}
a[prop]=parseFloat(a[prop]);b[prop]=parseFloat(b[prop]);if(a[prop]<b[prop]){return-1;}
if(a[prop]>b[prop]){return 1;}
if(a[prop]===b[prop]){if(a['raceTime'.split(' ')[0]]<b['raceTime'.split(' ')[0]]){return 1;}
if(a['raceTime'.split(' ')[0]]>b['raceTime'.split(' ')[0]]){return-1;}}
return 0;};}
function _finColumnSortDesc(prop){return function(a,b){if(a[prop]==='NR'){a[prop]=18;}
if(b[prop]==='NR'){b[prop]=18;}
if(a[prop]===''){a[prop]=10;}
if(b[prop]===''){b[prop]=10;}
a[prop]=parseFloat(a[prop]);b[prop]=parseFloat(b[prop]);if(a[prop]<b[prop]){return 1;}
if(a[prop]>b[prop]){return-1;}
if(a[prop]===b[prop]){if(a['raceTime'.split(' ')[0]]<b['raceTime'.split(' ')[0]]){return 1;}
if(a['raceTime'.split(' ')[0]]>b['raceTime'.split(' ')[0]]){return-1;}}
return 0;};}
function _calculateFraction(obj){if(obj.by==='shd'){return 0.15;}
if(obj.by==='hd'){return 0.25;}
if(obj.by==='nk'){return 0.40;}
if(obj.by==='dist'){return 85;}
if(obj.by===''){return 0;}
var numberArr=obj.by.split('&frac');var result=parseFloat(numberArr[0])||0;var fraction,fracArr;if(!numberArr[1]){return result;}
if(numberArr[0]===''){result=0;}
fracArr=numberArr[1].split('');fraction=parseFloat(fracArr[0])/parseFloat(fracArr[1]);result=result+fraction;return result;}
function _byColumnSort(prop){return function(a,b){var byA=_calculateFraction(a);var byB=_calculateFraction(b);if(byA<byB){return-1;}
if(byA>byB){return 1;}
if(byA===byB){if(a['raceTime'.split(' ')[0]]<b['raceTime'.split(' ')[0]]){return 1;}
if(a['raceTime'.split(' ')[0]]>b['raceTime'.split(' ')[0]]){return-1;}}
return 0;};}
function _byColumnSortDesc(prop){return function(a,b){var byA=_calculateFraction(a);var byB=_calculateFraction(b);if(byA<byB){return 1;}
if(byA>byB){return-1;}
if(byA===byB){if(a['raceTime'.split(' ')[0]]<b['raceTime'.split(' ')[0]]){return 1;}
if(a['raceTime'.split(' ')[0]]>b['raceTime'.split(' ')[0]]){return-1;}}
return 0;};}
function _calculateSpGroup(obj){var group=obj.oddsDesc.slice(-1);switch(group){case'F':return 3;case'J':return 2;case'C':return 1;default:return 0;}}
function _convertToNumber(obj){if(obj.oddsDesc===''){return 0;}
if(obj.oddsDesc.search('Evs')!==-1){return 1;}
var numberArr=obj.oddsDesc.split('/');var result=parseFloat(parseFloat(numberArr[0]))/parseFloat(numberArr[1]);return result;}
function _spColumnSort(prop){return function(a,b){var oddsDescGroupA=_calculateSpGroup(a);var oddsDescGroupB=_calculateSpGroup(b);var oddsA=_convertToNumber(a);var oddsB=_convertToNumber(b);if(oddsA<oddsB){return-1;}
if(oddsA>oddsB){return 1;}
if(oddsA===oddsB){if(oddsDescGroupA<oddsDescGroupB){return 1;}
if(oddsDescGroupA>oddsDescGroupB){return-1;}
if(oddsDescGroupA===oddsDescGroupB){if(a['raceTime'.split(' ')[0]]<b['raceTime'.split(' ')[0]]){return 1;}
if(a['raceTime'.split(' ')[0]]>b['raceTime'.split(' ')[0]]){return-1;}
return 0;}}};}
function _spColumnSortDesc(prop){return function(a,b){var oddsDescGroupA=_calculateSpGroup(a);var oddsDescGroupB=_calculateSpGroup(b);var oddsA=_convertToNumber(a);var oddsB=_convertToNumber(b);if(oddsA<oddsB){return 1;}
if(oddsA>oddsB){return-1;}
if(oddsA===oddsB){if(oddsDescGroupA<oddsDescGroupB){return-1;}
if(oddsDescGroupA>oddsDescGroupB){return 1;}
if(oddsDescGroupA===oddsDescGroupB){if(a['raceTime'.split(' ')[0]]<b['raceTime'.split(' ')[0]]){return 1;}
if(a['raceTime'.split(' ')[0]]>b['raceTime'.split(' ')[0]]){return-1;}
return 0;}}};}
function _calculateGradeGroup(obj){if(obj.rGradeCde===''){obj.rGradeCde=obj.trialFlag;}
var group=obj.rGradeCde.slice(0,2);switch(group){case'OR':return 2;case'IV':return 1;default:return 0;}}
function _cutFirstLetter(obj){if(obj.rGradeCde===''){obj.rGradeCde=obj.trialFlag;}
return obj.rGradeCde.slice(0,1);}
function _cutLastNumber(obj){if(obj.rGradeCde===''){obj.rGradeCde=obj.trialFlag;}
return parseInt(obj.rGradeCde.slice(1),10);}
function _gradeColumnSort(prop){return function(a,b){var letterA=_cutFirstLetter(a);var letterB=_cutFirstLetter(b);var numberA=_cutLastNumber(a);var numberB=_cutLastNumber(b);var groupA=_calculateGradeGroup(a);var groupB=_calculateGradeGroup(b);if(groupA<groupB){return 1;}
if(groupA>groupB){return-1;}
if(groupA===groupB&&groupA!==0){if(a['raceTime'.split(' ')[0]]<b['raceTime'.split(' ')[0]]){return 1;}
if(a['raceTime'.split(' ')[0]]>b['raceTime'.split(' ')[0]]){return-1;}
return 0;}
if(groupA===groupB&&groupA===0){if(letterA<letterB){return-1;}
if(letterA>letterB){return 1;}
if(letterA===letterB){if(numberA<numberB){return-1;}
if(numberA>numberB){return 1;}
if(numberA===numberB){if(a['raceTime'.split(' ')[0]]<b['raceTime'.split(' ')[0]]){return 1;}
if(a['raceTime'.split(' ')[0]]>b['raceTime'.split(' ')[0]]){return-1;}
return 0;}}}};}
function _gradeColumnSortDesc(prop){return function(a,b){var letterA=_cutFirstLetter(a);var letterB=_cutFirstLetter(b);var numberA=_cutLastNumber(a);var numberB=_cutLastNumber(b);var groupA=_calculateGradeGroup(a);var groupB=_calculateGradeGroup(b);if(groupA<groupB){return-1;}
if(groupA>groupB){return 1;}
if(groupA===groupB&&groupA!==0){if(a['raceTime'.split(' ')[0]]<b['raceTime'.split(' ')[0]]){return 1;}
if(a['raceTime'.split(' ')[0]]>b['raceTime'.split(' ')[0]]){return-1;}
return 0;}
if(groupA===groupB&&groupA===0){if(letterA<letterB){return 1;}
if(letterA>letterB){return-1;}
if(letterA===letterB){if(numberA<numberB){return 1;}
if(numberA>numberB){return-1;}
if(numberA===numberB){if(a['raceTime'.split(' ')[0]]<b['raceTime'.split(' ')[0]]){return 1;}
if(a['raceTime'.split(' ')[0]]>b['raceTime'.split(' ')[0]]){return-1;}
return 0;}}}};}
function _renderTable(table){var tBody=table.children();var tBodyDetached=tBody.detach();var tableRows=tBodyDetached.children();var columnHeadersRow=tableRows[0];var documentFragment=document.createDocumentFragment();documentFragment.appendChild(columnHeadersRow);for(var i=0;i<tableRows.length-1;i++){documentFragment.appendChild(tableRows[webApp.dogCareerDataForSort.forms[i].index+1]);}
table.append('<tbody></tbody>').append(documentFragment);}
return{init:function(table){table.on('click',function(event){var clickedColumnHeader,clickedColumnClass;if($(event.target).parent().hasClass('columnHeaders')&&!$(event.target).hasClass('win')&&!$(event.target).hasClass('rem')&&!$(event.target).hasClass('pos')){clickedColumnHeader=$(event.target);}else{return;}
if(webApp.highlightedSortableHeader&&$('.date').hasClass('black-text')===false&&!webApp.highlightedSortableHeader.hasClass('date')){webApp.highlightedSortableHeader.removeClass('black-text');}else{$('.date.black-text').removeClass('black-text');}
webApp.highlightedSortableHeader=clickedColumnHeader;clickedColumnHeader.addClass('black-text');clickedColumnClass=clickedColumnHeader.attr('class').split(' ')[0];_getDogStats(clickedColumnClass);_renderTable(table);_refreshIndexesAfterSort();});}};})();
webApp=webApp||{};webApp.printForm=(function(){"use strict";function domManipulation(){var sortContainer=$('#sortContainer');var printContainer;$('body').append(sortContainer.clone().addClass('printContainer'));printContainer=$('.printContainer');printContainer.prepend('<div class="printHeader"></div>');$('.printHeader').append('<div class="printRaceName"></div><div class="headerRaceDetails"></div><div class="headerDate"></div>');if(webApp.raceInfo[0].postPick!==''){$('.headerRaceDetails').html($('#pagerCardTime').html()+" "+webApp.raceInfo[0].raceTitle+" ("+webApp.raceInfo[0].raceGrade+")"+" - "+webApp.raceInfo[0].distance+"m - Post Pick: "+webApp.raceInfo[0].postPick);}else{$('.headerRaceDetails').html($('#pagerCardTime').html()+" "+webApp.raceInfo[0].raceTitle+" ("+webApp.raceInfo[0].raceGrade+")"+" - "+webApp.raceInfo[0].distance+"m ");}
var unformatedDate=webApp.raceInfo[2];var formatedDate=formatDate(unformatedDate);$('.headerDate').html(formatedDate);modifyHeadersWithDogDetails();}
function _removeZeros(unformatedDate){var dateArray=unformatedDate.split('-');var a;for(var i=1;i<dateArray.length-1;i++){a=dateArray[i].split('');if(a[0]==='0'){dateArray[i]=a[1];}}
return dateArray;}
function formatDate(unformatedDate){var dateArray=_removeZeros(unformatedDate);var formatMonth={1:'January',2:'February',3:'March',4:'April',5:'May',6:'June',7:'July',8:'August',9:'September',10:'October',11:'November',12:'December'};dateArray[1]=formatMonth[dateArray[1]];return dateArray[2]+' '+dateArray[1]+' '+dateArray[0];}
function modifyHeadersWithDogDetails(){var runnerForms=$('.runnerBlock');var dogInfo=$('.dogInfo');var runnerArray=$('.printContainer .runner');var dogDetailsArray;var brtArray;var trainerArray;var dogVacantArray=[];var dogDetails,brt,trainer;var i,rows,current;runnerArray.append('<div class="dogDetails"></div>');runnerArray.append('<div class="brtAndTrainer"><div class="brt"></div><div class="trainer"></div></div>');dogDetailsArray=$('.runner .dogDetails');brtArray=$('.runner .brt');trainerArray=$('.runner .trainer');for(i=0;i<runnerForms.length;i++){if($($(runnerForms[i]).children()[1]).hasClass('info')===true){dogVacantArray.push({trapNumber:i,isVacant:false});}else{dogVacantArray.push({trapNumber:i,isVacant:true});}}
current=0;for(i=0;i<runnerArray.length;i++){if(dogVacantArray[i].isVacant===false){rows=$(dogInfo[current].children).children();dogDetails=$(rows[0]).children()[0].innerHTML;brt=$(rows[1]).children()[0].innerHTML.replace('<em>','').replace('</em>','');trainer=$(rows[1]).children()[1].innerHTML.replace('<em>','').replace('</em>','');dogDetailsArray[i].innerHTML=dogDetails;brtArray[i].innerHTML=brt;trainerArray[i].innerHTML=trainer;current+=1;}}}
return{init:function(printButton){domManipulation();printButton.on('click',function(){window.print();});},remove:function(){$('.printContainer').remove();}};})();
webApp.isSupportTablet=false;function scrollDebug(){if($('#debugConent').height()>$('#debug').height()){$('#debugConent').css('top',parseInt($('#debugConent').css('top'))-14);}}
console.error=function(msg){if(typeof msg=='string'||typeof msg=='number'){$('#debugConent').append('<div>'+msg+'</div>');scrollDebug();}else if(typeof msg=='boolean'){$('#debugConent').append('<div>'+(msg?'true':'false')+'</div>');scrollDebug();}else if(typeof msg=='object'){for(var i in msg){$('#debugConent').append('<div>'+i+' : '+msg[i]+'</div>');scrollDebug();}}};$(document).ready(appBootstrap);function appBootstrap(){webApp.ajaxManager.init(webApp.routes);webApp.registry=new rp.Registry();webApp.userSettings.setStorage(utils.localStorage);webApp.userSettings.setDefaults(2);if(window.localStorage.getItem('isSupportStorage')=='y'){webApp.cacheManager.init(localStorage,2000000);}else{webApp.cacheManager.init(null,2000000);}
if(webApp.cacheManager.getCacheDateChanged()){console.log('clearing old cache');webApp.cacheManager.clearAllCache();}
webApp.bookiesCollection.wh.diffName=webApp.WH_DIFFUSION_NAME;webApp.deviceDependentSettings.setLadbApiKey(webApp.LADB_API_KEY);webApp.deviceDependentSettings.setDeviceTypeMobile();webApp.bookieCollection.init();webApp.overlay.init();webApp.landing.init();diffusion.utils.topic.setPreferredBookmaker(webApp.PREFERRED_BOOKMAKER);webApp.eventTracker=new webApp.GaEventTracker();webApp.eventTracker.setEventsConfig(webApp.gaEvents);webApp.eventTracker.setDeviceOrientation(webApp.core.getOrientation());webApp.core.addHelper('eventTracker',webApp.eventTracker);webApp.eventTrackerSender=new webApp.GaEventTrackerSender(webApp.eventTracker);webApp.core.addHelper('GaEventTrackerSender',webApp.eventTrackerSender);$(document).bind(webApp.EVENT_VIEW_RENDER_TPL,function(event,data){var $content=data.$content||{};webApp.eventTracker.bindEventTracking($content);});webApp.$appContainer=$('#webApp');webApp.$mainTabs=$('#mainTabs');webApp.$mainTabsLinks=webApp.$mainTabs.find('> ul a');$(window).bind(webApp.EVENT_CHANGE_ORIENTATION,function(event,data){if(data.orientation){webApp.eventTracker.trackChangeOrientation(data.orientation);}});$(window).bind(webApp.EVENT_CHANGE_HASH,function(event,data){if(data&&data[0]){window._gaq.push(['_trackPageview','/'+data[0]]);}});webApp.ErrorHandler.setErrorTracker(webApp.eventTracker);webApp.genericWhErrorHandler=(new webApp.WhErrorHandler({user:function(message){alert(message);},developer:function(message){var action=webApp.ErrorHandler.actionWh;if(message['errorSource']=='topUpController'){action='Top Up Error Message';}
webApp.ErrorHandler.process(message['statusMessage'],null,action);}})).generic;webApp.radioSupport=webApp.isIDevice;webApp.isRadioDisplayed=(webApp.isIDevice||webApp.isAndroid||webApp.isDesktop);webApp.clickReportHandler=new utils.clickReport('betClk',webApp.appletUrl);webApp.clickReportHandler.init();webApp.selectionsAlert.init();webApp.SelectionsManager.init();if(!utils.localStorage.get('userId')){utils.localStorage.set('userId',Math.floor(Math.random()*1000000000000+1));}
$('#firstLoadingAnimation').remove();webApp.checkDeviseAppSupport();if(!webApp.isImportJS){$(window).trigger('load');}
webApp.core.init(webApp.configs);if(webApp.isIOS_8){function touchToClickConvertor(startEvent){var target=startEvent.target,touchStart=startEvent.originalEvent.touches[0],startX=touchStart.pageX,startY=touchStart.pageY,threshold=10,timeout,$self=$(this),timeThreshold=300,isMoved=false;function removeClickHandler(){clearTimeout(timeout);$self.off('touchmove',moveHandler).off('touchend',clickHandler);}
function clickHandler(endEvent){removeClickHandler();if(target===endEvent.target&&isMoved){$self[0].click();}}
function moveHandler(moveEvent){var touchMove=moveEvent.originalEvent.touches[0],moveX=touchMove.pageX,moveY=touchMove.pageY;isMoved=true;if(Math.abs(moveX-startX)>threshold||Math.abs(moveY-startY)>threshold){removeClickHandler();}}
timeout=setTimeout(removeClickHandler,timeThreshold);$self.on('touchmove',moveHandler).on('touchend',clickHandler);}
$('body').on('touchstart','a',touchToClickConvertor);$('body').on('touchstart','.betButton',touchToClickConvertor);}
if(webApp.isDesktop){$('.futureBtn').on('click',function(event){if(webApp.urlManager.isTransitionNotNeeded('meeting-list')){event.preventDefault();}
setTimeout(function(){webApp.BottomMenuControl.showCalendar();},200);});$('.archiveCalendar').on('click',function(event){if(webApp.urlManager.isTransitionNotNeeded('results-list')){event.preventDefault();}
setTimeout(function(){webApp.Calendar.show();},200);});}
window._gaq.push(['_setAccount',webApp.eventTracker.getTrackingId()]);window._gaq.push(['_trackPageview']);}
var webApp=webApp||{};var wh=wh||{};webApp.placeBet=function(params,onValid,onError){var _redirect,_acceptError;var _sendBettingRequest=function(params,delayToken){var freebets=[];if(params.takeSp){params.priceNum='1';params.priceDen='1';}
if(params.hasOwnProperty('freebets')&&params.freebets.length>0){$.each(params.freebets,function(i,value){freebets.push({'tokenId':value});});}
var betslipParams={"whoPlaceBetRequest":{"affiliateId":webApp.AFFILIATE_ID,"returnBetDelays":true,"whoBets":[{"betNumber":1,"stake":params.unitStake,"legType":params.eachWay?'EachWay':'Win',"whoBetType":{"betTypeCode":"SGL","minStake":params.minStake,"maxStake":params.maxStake,"betTypeName":"Single","betNoOfLines":1},"whoSelections":[{"selectionId":params.selectionId,"status":"active","legType":params.eachWay?'E':'W',"priceType":params.takeSp?'S':'L',"priceNum":params.priceNum==='Evs'?1:params.priceNum,"priceDen":params.priceNum==='Evs'?1:params.priceDen,"priceDec":params.decimal,"eachWayPlaces":null,"includedInMultiple":false,"singleAvailable":true,"ewAvailable":params.eachWay,"spAvailable":params.takeSp,"priceChanged":false,"statusChanged":false}],"whoFailures":[],"whoFreeBets":freebets}]}};if(typeof delayToken!=='undefined'){betslipParams.whoPlaceBetRequest.whoBets[0].delayToken=delayToken;}
wh.mint.Client.placeBet(betslipParams,function(response){var receiptData=response.whoPlaceBetResponse.whoBetPlacements[0];var receipt=$.extend({betReference:receiptData.betReceipt,totalStake:receiptData.totalStake,estimatedReturns:params.estimated},params);webApp.registry.set('lastReceipt',receipt);if(typeof onValid==='function'){onValid(response);}
webApp.openBets.saveOpenBets(params);_redirect('wh-receipt');},function(response){_acceptError(response,onError,params);});};_redirect=function(url){webApp.urlManager.setHash(webApp.urlManager.createHash([url]));};if(!wh.mint.Client.isLoggedIn()){_redirect('wh-home');return;}
_sendBettingRequest(params);_acceptError=function(data,onError,params){var failure={},isStatusChanged=false;if(data.hasOwnProperty('whoPlaceBetResponse')&&data.whoPlaceBetResponse.hasOwnProperty('whoBets')&&typeof data.whoPlaceBetResponse.whoBets[0]!=='undefined'){if(data.whoPlaceBetResponse.whoBets[0].hasOwnProperty('whoFailures')){if(typeof data.whoPlaceBetResponse.whoBets[0].whoFailures[0]!=='undefined'){failure=data.whoPlaceBetResponse.whoBets[0].whoFailures[0];}
$.each(data.whoPlaceBetResponse.whoBets[0].whoFailures,function(i,error){if(error.hasOwnProperty('betFailureType')&&error.betFailureType==='whoStatusChanged'){isStatusChanged=true;}});}}
if(failure.hasOwnProperty('betFailureType')){if(failure.betFailureType==='whoInsufficientFunds'){data.statusMessage='Insufficient funds to place bet.';}
if(failure.betFailureType==='whoPriceChanged'){data.statusMessage='The price for the selected bet has changed.';data.statusCode=62;}}
if(isStatusChanged){data.statusMessage='Selection status changed';data.statusCode=70;}
if(typeof onError==='function'){onError(data);}
switch(data.statusCode){case 60:_redirect('wh-generic-error');break;case 61:case 68:case 70:_redirect('wh-market-suspend-error');break;case 62:var lastPrice=$.extend({stake:params.unitStake,oldNum:params.priceNum,oldDen:params.priceDen},params,{priceNum:failure.priceNum,priceDen:failure.priceDen,priceDec:failure.priceDec});webApp.registry.set('lastPrice',lastPrice);_redirect('wh-price-changed-error/r='+Math.random());break;case 71:var delayInfo=data.whoPlaceBetResponse.whoBetDelays;var delay=setTimeout(function(){_sendBettingRequest(params,delayInfo.whoBetDelay[0].delayToken);},delayInfo.delayPeriod*1000);webApp.dataLoading.show();break;default:webApp.genericWhErrorHandler(data);}};};
var webApp=webApp||{};webApp.openBets={maxSecondsToStore:3600000,_getBookieUser:function(bookie){var provider=webApp.bookieCollection.getProvider(bookie);if(!provider){return null;}
var user=provider.user();return user;},setUserOpenBets:function(bets,bookie){var user=this._getBookieUser(bookie);if(!user){return;}
var userName=user.login();var storageName=bookie+'_'+userName;webApp.userSettings.set(storageName,bets);},getUserOpenBets:function(bookie){var user=this._getBookieUser(bookie);if(!user){return null;}
var userName=user.login();var storageName=bookie+'_'+userName;var result=webApp.userSettings.get(storageName)||{};var openBets=this.clearOpenBets(result,bookie);return openBets;},saveOpenBets:function(data,bookie){bookie=bookie||webApp.prefBookmaker.get();var raceId=data["race_id"];var raceTs=data["race_ts"];var openBets=this.getUserOpenBets(bookie);var bets={};var betKey=data["selectionId"]+"_"+(new Date()).getTime();if(openBets[raceTs]&&openBets[raceTs][raceId]){bets=openBets[raceTs][raceId];}
bets[betKey]=data["unitStake"];openBets[raceTs]=openBets[raceTs]||{};openBets[raceTs][raceId]=bets;this.setUserOpenBets(openBets,bookie);},clearOpenBets:function(openBets,bookie){var clearedBets=openBets||{};if($.isEmptyObject(openBets)==false){for(var ts in openBets){var lowDateLimit=new Date();lowDateLimit.setTime(ts*1000+lowDateLimit.getTimezoneOffset()*1000);var currentDate=utils.date.getSynchronizedToServerNow();if(utils.date.datesDiff(currentDate,lowDateLimit)>=this.maxSecondsToStore){delete(clearedBets[ts]);}}
this.setUserOpenBets(clearedBets,bookie);}
return clearedBets;}};